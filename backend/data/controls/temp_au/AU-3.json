[
  {
    "control_id": "AU-3",
    "control_name": "Content of Audit Records",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Ensure that audit records contain information that establishes the following: a. What type of event occurred; b. When the event occurred; c. Where the event occurred; d. Source of the event; e. Outcome of the event; and f. Identity of any individuals, subjects, or objects associated with the event.",
    "source": "NIST SP 800-53 Rev 5",
    "stig_id": "RHEL-08-030180, RHEL-08-030190, RHEL-08-030200",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Every audit record must answer the critical questions: What happened? When did it happen? Where did it happen? Who or what caused it? What was the result? This ensures complete traceability for security investigations and compliance requirements.",
    "ai_guidance": "Configure auditd to capture comprehensive event metadata meeting the '5 Ws and H' framework: (1) Event type via -F arch and syscall specifications, (2) Timestamps with millisecond precision (time_format = enriched), (3) Location via executable paths and working directories (-F dir= and -F path=), (4) Source via auid (original user) and uid (effective user), (5) Outcome via res=success/failure, (6) Identity via subject and object contexts. Key auditd.conf settings: log_format = ENRICHED (includes resolved names), name_format = hostname (identifies system), and max_log_file_action = rotate (prevents loss). Implement centralized syslog forwarding (AU-4.1) to ensure tamper-evident audit trails with cryptographic integrity (AU-9).",
    "example_implementation": "This implementation configures auditd to generate audit records containing all six required informational elements per NIST SP 800-53 Rev 5 AU-3. Records include event type classification, precise timestamps, execution location paths, originating user identification (both authentic and effective), success/failure outcomes, and complete subject-object relationships for accountability.",
    "non_technical_guidance": "1. Review your audit configuration to ensure every log entry answers these questions: What action was performed? When was it performed? Where (which system/file) was it performed? Who performed it? What was the result (success/failure)? Who or what was affected? 2. Work with your IT team to enable detailed logging that captures user identities (both original and effective users), timestamps with sufficient precision, file paths, and command outcomes. 3. Test audit logs by performing sample actions and verifying the logs contain complete information for investigation. 4. Document your audit content requirements in your Security Plan and ensure they align with regulatory requirements (HIPAA, PCI-DSS, FISMA, etc.). 5. Periodically review audit log samples to confirm content completeness and readability for incident responders.",
    "is_technical": true,
    "enhancements": [
      {
        "id": "AU-3.1",
        "title": "Additional Audit Information",
        "official_text": "Generate audit records containing the following additional information: [Assignment: organization-defined additional information]."
      },
      {
        "id": "AU-3.2",
        "title": "Centralized Management of Planned Audit Record Content",
        "official_text": "Provide centralized management and configuration of the content to be captured in audit records generated by [Assignment: organization-defined system components]."
      },
      {
        "id": "AU-3.3",
        "title": "Limit Personally Identifiable Information Elements",
        "official_text": "Limit personally identifiable information contained in audit records to the following elements identified in the privacy risk assessment: [Assignment: organization-defined elements]."
      }
    ],
    "related_controls": [
      "AU-2",
      "AU-8",
      "AU-12",
      "MA-4",
      "PL-9",
      "SA-8",
      "SI-7",
      "SI-11"
    ],
    "supplemental_guidance": "Audit record content requirements directly support incident response, forensic analysis, and compliance verification. The six essential elements (what, when, where, source, outcome, identity) provide the minimum information needed for security event reconstruction. Organizations must balance comprehensive logging with storage capacity (AU-4), performance impact, and privacy considerations (AU-3.3). Enriched log formats that resolve UIDs to usernames and include additional context improve investigator efficiency but increase storage requirements. Consider Common Event Format (CEF) or JavaScript Object Notation (JSON) for structured logging that facilitates automated analysis and correlation across distributed systems.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -euo pipefail\n\n# AU-3: Content of Audit Records - Configure auditd for comprehensive event logging\n# Implements STIG RHEL-08-030180, 030190, 030200\n\necho '[AU-3] Configuring audit record content requirements...'\n\n# Backup configuration\ncp /etc/audit/auditd.conf \"/etc/audit/auditd.conf.backup.$(date +%Y%m%d_%H%M%S)\"\n\n# Configure auditd.conf for enriched log format\necho '[AU-3] Setting log format to ENRICHED for comprehensive event data...'\nsed -i 's/^log_format = .*/log_format = ENRICHED/' /etc/audit/auditd.conf\nif ! grep -q '^log_format = ENRICHED' /etc/audit/auditd.conf; then\n    echo 'log_format = ENRICHED' >> /etc/audit/auditd.conf\nfi\n\n# Configure hostname in logs for location identification\necho '[AU-3] Setting name_format to hostname for event location tracking...'\nsed -i 's/^name_format = .*/name_format = hostname/' /etc/audit/auditd.conf\nif ! grep -q '^name_format = hostname' /etc/audit/auditd.conf; then\n    echo 'name_format = hostname' >> /etc/audit/auditd.conf\nfi\n\n# Ensure audit rules directory exists\nmkdir -p /etc/audit/rules.d\n\n# Create comprehensive audit rules for event content capture\ncat > /etc/audit/rules.d/au-3-content.rules << 'EOFAU3'\n## AU-3: Audit Record Content Requirements\n## Captures: what, when, where, source, outcome, identity\n\n# Delete existing rules\n-D\n\n# Buffer size\n-b 8192\n\n# Failure mode (2 = panic for high-security systems, 1 = printk for moderate)\n-f 1\n\n# === WHAT: Event type via syscall and action classification ===\n\n# File access and modification events\n-a always,exit -F arch=b64 -S openat,open,creat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access_denied\n-a always,exit -F arch=b64 -S openat,open,creat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access_denied\n-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=unset -k file_deletion\n\n# Privileged command execution (captures WHO executed WHAT)\n-a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=unset -k privileged_sudo\n-a always,exit -F path=/usr/bin/su -F perm=x -F auid>=1000 -F auid!=unset -k privileged_su\n\n# Authentication events (captures outcome - success/failure)\n-w /var/log/lastlog -p wa -k authentication_lastlog\n-w /var/run/faillock -p wa -k authentication_failures\n\n# === WHERE: Location via file paths and directories ===\n-w /etc/passwd -p wa -k identity_changes\n-w /etc/group -p wa -k identity_changes\n-w /etc/shadow -p wa -k identity_changes\n-w /etc/sudoers -p wa -k privilege_changes\n-w /etc/sudoers.d/ -p wa -k privilege_changes\n\n# System configuration changes (location + what changed)\n-w /etc/audit/auditd.conf -p wa -k audit_config_changes\n-w /etc/audit/rules.d/ -p wa -k audit_rule_changes\n\n# === SOURCE & IDENTITY: auid (original user) and uid (effective user) captured automatically ===\n# auditd enriched format includes:\n#   - auid: Original authenticated user ID\n#   - uid: Effective user ID performing the action\n#   - ses: Session ID\n#   - comm: Command name\n#   - exe: Executable path\n\n# === WHEN: Timestamps with millisecond precision included automatically ===\n\n# === OUTCOME: res=success or res=failure included automatically ===\n\n# Make rules immutable (requires reboot to modify)\n-e 2\nEOFAU3\n\necho '[AU-3] Audit rules created at /etc/audit/rules.d/au-3-content.rules'\n\n# Load rules\naugenrules --load\n\n# Restart auditd service\necho '[AU-3] Restarting auditd service...'\nsystemctl restart auditd\n\n# Verify configuration\necho '[AU-3] Verifying audit configuration...'\nauditctl -l | head -20\ngrep -E '^(log_format|name_format)' /etc/audit/auditd.conf\n\necho '[AU-3] Audit record content configuration complete!'\necho '[AU-3] Audit records now capture: event type, timestamp, location, source, outcome, identity'\necho '[AU-3] Test with: sudo ausearch -m USER_CMD -i | head -5'",
        "ansible": "---\n- name: Configure AU-3 Audit Record Content\n  hosts: all\n  become: true\n  tasks:\n    - name: Install auditd packages\n      package:\n        name:\n          - audit\n          - audit-libs\n        state: present\n\n    - name: Backup auditd.conf before changes\n      copy:\n        src: /etc/audit/auditd.conf\n        dest: \"/etc/audit/auditd.conf.backup.{{ ansible_date_time.epoch }}\"\n        remote_src: true\n\n    - name: Configure enriched log format for comprehensive content\n      lineinfile:\n        path: /etc/audit/auditd.conf\n        regexp: '^log_format'\n        line: 'log_format = ENRICHED'\n        state: present\n\n    - name: Configure hostname in logs for location tracking\n      lineinfile:\n        path: /etc/audit/auditd.conf\n        regexp: '^name_format'\n        line: 'name_format = hostname'\n        state: present\n\n    - name: Create AU-3 audit rules for content requirements\n      copy:\n        dest: /etc/audit/rules.d/au-3-content.rules\n        content: |\n          ## AU-3: Audit Record Content\n          -D\n          -b 8192\n          -f 1\n          \n          # File access events (what, when, where, who, outcome)\n          -a always,exit -F arch=b64 -S openat,open -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access_denied\n          -a always,exit -F arch=b64 -S unlink,unlinkat -F auid>=1000 -F auid!=unset -k file_deletion\n          \n          # Privileged commands\n          -a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=unset -k privileged_sudo\n          \n          # Identity and privilege changes\n          -w /etc/passwd -p wa -k identity_changes\n          -w /etc/group -p wa -k identity_changes\n          -w /etc/shadow -p wa -k identity_changes\n          -w /etc/sudoers -p wa -k privilege_changes\n          -w /etc/sudoers.d/ -p wa -k privilege_changes\n          \n          # Audit configuration changes\n          -w /etc/audit/auditd.conf -p wa -k audit_config_changes\n          -w /etc/audit/rules.d/ -p wa -k audit_rule_changes\n          \n          -e 2\n        mode: '0640'\n        owner: root\n        group: root\n\n    - name: Load audit rules\n      command: augenrules --load\n      changed_when: true\n\n    - name: Restart auditd service\n      systemd:\n        name: auditd\n        state: restarted\n        enabled: true"
      },
      "windows": {
        "powershell": "# AU-3: Content of Audit Records - Windows Implementation\n# Configures Advanced Audit Policies for comprehensive event logging\n\nWrite-Host '[AU-3] Configuring Windows audit record content requirements...' -ForegroundColor Green\n\n# Enable Advanced Audit Policy for comprehensive event data\n# Captures: what (event ID + category), when (timestamp), where (computer name),\n#           source (user SID + account), outcome (success/failure), identity (subject + object)\n\nWrite-Host '[AU-3] Enabling detailed tracking audit policies...' -ForegroundColor Yellow\n\n# WHAT: Event type classification via audit categories\nAuditpol /set /subcategory:\"Logon\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Account Logon\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Object Access\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Privilege Use\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Detailed Tracking\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Policy Change\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"Account Management\" /success:enable /failure:enable\nAuditpol /set /subcategory:\"System\" /success:enable /failure:enable\n\n# WHEN: Timestamps automatically included with millisecond precision\n# WHERE: Computer name automatically included in all events\n# SOURCE: User SID and account name automatically captured\n# OUTCOME: Success/Failure keywords automatically included\n# IDENTITY: Subject (user) and Object (resource) captured in event details\n\nWrite-Host '[AU-3] Configuring Security Event Log for comprehensive retention...' -ForegroundColor Yellow\n\n# Configure Security log for adequate storage (captures full event context)\nwevtutil sl Security /ms:1073741824  # 1GB maximum size\nwevtutil sl Security /rt:true         # Retain old events when full\n\n# Enable command line process auditing for detailed execution context (WHAT + HOW)\nWrite-Host '[AU-3] Enabling command line process auditing...' -ForegroundColor Yellow\nreg add \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\" /v ProcessCreationIncludeCmdLine_Enabled /t REG_DWORD /d 1 /f\n\n# Configure PowerShell script block logging for detailed script execution (WHAT was executed)\nWrite-Host '[AU-3] Enabling PowerShell script block logging...' -ForegroundColor Yellow\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1 /f\n\n# Verify audit policy configuration\nWrite-Host '[AU-3] Verifying audit policy configuration...' -ForegroundColor Yellow\nAuditpol /get /category:* | Select-String -Pattern \"Success and Failure\" | Measure-Object | Select-Object -ExpandProperty Count\n\nWrite-Host '[AU-3] Audit record content configuration complete!' -ForegroundColor Green\nWrite-Host '[AU-3] Event logs now capture: Event Type, Timestamp, Computer Name, User Identity, Outcome, Object Details' -ForegroundColor Green\nWrite-Host '[AU-3] Verify with: Get-WinEvent -LogName Security -MaxEvents 5 | Format-List TimeCreated, Id, Message' -ForegroundColor Cyan",
        "ansible": "---\n- name: Configure AU-3 on Windows\n  hosts: windows\n  tasks:\n    - name: Enable comprehensive audit policies\n      win_shell: |\n        Auditpol /set /subcategory:\"Logon\" /success:enable /failure:enable\n        Auditpol /set /subcategory:\"Object Access\" /success:enable /failure:enable\n        Auditpol /set /subcategory:\"Privilege Use\" /success:enable /failure:enable\n        Auditpol /set /subcategory:\"Account Management\" /success:enable /failure:enable\n      changed_when: true\n\n    - name: Configure Security Event Log capacity\n      win_shell: 'wevtutil sl Security /ms:1073741824'\n      changed_when: true\n\n    - name: Enable command line process auditing\n      win_regedit:\n        path: HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\n        name: ProcessCreationIncludeCmdLine_Enabled\n        data: 1\n        type: dword"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T15:30:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T15:30:00Z",
      "source": "ComplianceAsCode / DISA STIG",
      "cac_status": "validated",
      "cac_planned": true,
      "stig_references": [
        "RHEL-08-030180",
        "RHEL-08-030190",
        "RHEL-08-030200"
      ],
      "implementation_guidance": "Configure auditd with log_format=ENRICHED to capture comprehensive event metadata. Enable audit rules for all six required elements: event type (syscall classification), timestamp (millisecond precision), location (file paths), source (auid/uid), outcome (res=success/failure), identity (subject/object contexts). Implement centralized logging for tamper-evidence."
    }
  },
  {
    "control_id": "AU-3.1",
    "control_name": "Additional Audit Information",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Generate audit records containing the following additional information: [Assignment: organization-defined additional information].",
    "parent_control": "AU-3",
    "source": "NIST SP 800-53 Rev 5",
    "stig_id": "RHEL-08-030181",
    "baselines": {
      "low": false,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Beyond the basic required audit information, your organization may need to capture additional details specific to your environment, such as application-specific data, environmental variables, parent process IDs, network connection details, or custom security labels. This enhancement allows tailoring audit records to your specific compliance and investigative needs.",
    "ai_guidance": "Extend auditd rules with custom fields using -F key=value pairs to capture organization-specific requirements. Common additions: (1) Parent Process ID (-F ppid) for process genealogy analysis, (2) Session ID (-F ses) for user session tracking, (3) Exit codes (-F exit) for detailed outcome analysis, (4) SELinux contexts (-F subj_type and -F obj_type) for mandatory access control auditing, (5) Network details (-F saddr and -F daddr) for connection tracking. Use ausearch filters and custom keys (-k custom_tag) for efficient log analysis. Consider performance impact when adding fields to high-frequency syscalls.",
    "example_implementation": "This implementation extends AU-3 baseline requirements with organization-defined additional audit information fields including parent process IDs, SELinux security contexts, detailed exit codes, session identifiers, and network connection metadata for enhanced forensic analysis and compliance reporting.",
    "non_technical_guidance": "1. Meet with your compliance and security teams to identify what additional information beyond basic audit requirements your organization needs (e.g., application transaction IDs, cost center codes, classification labels). 2. Document these additional requirements in your System Security Plan. 3. Work with IT to configure logging systems to capture these custom fields. 4. Test that additional fields appear in audit logs without impacting system performance. 5. Train incident responders on how to leverage additional audit information during investigations. 6. Periodically review whether additional fields remain relevant to organizational needs.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-2",
      "AU-3",
      "AU-12",
      "PM-14"
    ],
    "supplemental_guidance": "Additional audit information requirements vary by organization and are driven by regulatory mandates, contractual obligations, and operational needs. Healthcare organizations may require HIPAA-specific fields like patient identifiers and reasons for access. Financial institutions may need transaction amounts and account numbers. Federal agencies may require security classification labels and compartment codes. Balance information richness with storage costs and privacy requirements (AU-3.3). Use structured logging formats (CEF, JSON) to facilitate parsing of custom fields.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -euo pipefail\n\n# AU-3.1: Additional Audit Information - Organization-specific custom fields\n\necho '[AU-3.1] Configuring additional audit information capture...'\n\n# Create enhanced audit rules with additional fields\ncat > /etc/audit/rules.d/au-3.1-additional.rules << 'EOFAU31'\n## AU-3.1: Additional Audit Information (Organization-Defined)\n## Captures: parent PID, session ID, SELinux context, detailed exit codes, network connections\n\n# Process execution with parent process tracking\n-a always,exit -F arch=b64 -S execve -F auid>=1000 -F auid!=unset -F key=process_execution\n# Captures: ppid (parent process ID), ses (session ID), comm (command), exe (executable path)\n\n# Network connections with source/destination details\n-a always,exit -F arch=b64 -S connect -F auid>=1000 -F auid!=unset -k network_connections\n# Captures: saddr (source address), daddr (destination address), sport, dport\n\n# File operations with SELinux security context\n-a always,exit -F arch=b64 -S openat,open -F dir=/var/www -F auid>=1000 -F auid!=unset -k web_file_access\n# Captures: subj_type (subject SELinux type), obj_type (object SELinux type)\n\n# Privileged operations with detailed outcome codes\n-a always,exit -F arch=b64 -S setuid,setgid,setreuid,setregid -F auid>=1000 -F auid!=unset -k privilege_escalation\n# Captures: a0 (syscall argument 0 - target UID), exit (return code), res (success/failure)\n\n# Application-specific: Database access (example)\n-w /var/lib/mysql -p rwxa -k database_file_access\n\n# Organization-specific: Financial transactions directory (example)\n-w /var/app/transactions -p wa -k financial_transactions\nEOFAU31\n\necho '[AU-3.1] Loading additional audit rules...'\naugenrules --load\n\necho '[AU-3.1] Additional audit information configuration complete!'\necho '[AU-3.1] Now capturing: parent PID, session ID, SELinux context, exit codes, network details'",
        "ansible": "---\n- name: Configure AU-3.1 Additional Audit Information\n  hosts: all\n  become: true\n  tasks:\n    - name: Create AU-3.1 enhanced audit rules\n      copy:\n        dest: /etc/audit/rules.d/au-3.1-additional.rules\n        content: |\n          ## AU-3.1: Additional organization-specific audit information\n          \n          # Process execution with parent tracking\n          -a always,exit -F arch=b64 -S execve -F auid>=1000 -F auid!=unset -k process_execution\n          \n          # Network connections\n          -a always,exit -F arch=b64 -S connect -F auid>=1000 -F auid!=unset -k network_connections\n          \n          # Privileged operations with detailed outcomes\n          -a always,exit -F arch=b64 -S setuid,setgid -F auid>=1000 -F auid!=unset -k privilege_escalation\n        mode: '0640'\n\n    - name: Reload audit rules\n      command: augenrules --load\n      changed_when: true"
      },
      "windows": {
        "powershell": "# AU-3.1: Additional Audit Information - Windows Enhanced Logging\n\nWrite-Host '[AU-3.1] Configuring additional audit information capture...' -ForegroundColor Green\n\n# Enable detailed process tracking with command lines\nAuditpol /set /subcategory:\"Process Creation\" /success:enable /failure:enable\n\n# Enable registry auditing for additional context\nAuditpol /set /subcategory:\"Registry\" /success:enable /failure:enable\n\n# Enable file system detailed auditing\nAuditpol /set /subcategory:\"File System\" /success:enable /failure:enable\n\n# Enable network auditing for connection details\nAuditpol /set /subcategory:\"Filtering Platform Connection\" /success:enable /failure:enable\n\n# Configure additional fields via registry\nreg add \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v AuditAccountLogonEvents /t REG_DWORD /d 3 /f\n\nWrite-Host '[AU-3.1] Additional audit information configured!' -ForegroundColor Green",
        "ansible": "---\n- name: Configure AU-3.1 on Windows\n  hosts: windows\n  tasks:\n    - name: Enable detailed process tracking\n      win_shell: 'Auditpol /set /subcategory:\"Process Creation\" /success:enable /failure:enable'\n      changed_when: true"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T15:30:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T15:30:00Z",
      "source": "ComplianceAsCode / NIST SP 800-53 Rev 5",
      "cac_status": "validated",
      "stig_references": [
        "RHEL-08-030181"
      ],
      "implementation_guidance": "Extend audit rules with organization-specific fields using auditd -F filters. Common additions: ppid (parent process), ses (session), SELinux contexts (subj_type/obj_type), network details (saddr/daddr), exit codes. Balance detail with performance and storage."
    }
  },
  {
    "control_id": "AU-3.2",
    "control_name": "Centralized Management of Planned Audit Record Content",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Provide centralized management and configuration of the content to be captured in audit records generated by [Assignment: organization-defined system components].",
    "parent_control": "AU-3",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "plain_english_explanation": "Instead of configuring audit settings individually on each system, use a centralized management tool to define and deploy consistent audit record requirements across your entire infrastructure. This ensures uniform audit content, reduces configuration errors, and simplifies compliance verification across thousands of systems.",
    "ai_guidance": "Implement centralized audit configuration management using Ansible, Puppet, Chef, or enterprise configuration management platforms. Deploy audit rule templates from a central repository with version control (Git). Key implementation patterns: (1) Define audit rule profiles per system classification (web servers, databases, endpoints), (2) Use configuration management to deploy /etc/audit/rules.d/ files consistently, (3) Implement validation checks post-deployment via auditctl -l, (4) Centralize auditd.conf settings for log format and retention, (5) Use orchestration tools (Ansible Tower, Satellite) for scheduled policy updates. Monitor configuration drift with compliance scanners (OpenSCAP, Nessus). Integrate with SIEM for centralized rule effectiveness monitoring.",
    "example_implementation": "This implementation establishes centralized audit configuration management using Ansible automation, deploying consistent audit rule sets across multiple system classifications, ensuring uniform audit content capture organization-wide with automated validation and drift detection.",
    "non_technical_guidance": "1. Select a configuration management tool approved for your environment (Ansible, Puppet, Group Policy). 2. Create standardized audit configuration templates for different system types (web servers, databases, workstations). 3. Store templates in version control with change approval processes. 4. Deploy configurations from a central management server to all systems. 5. Implement automated checks to verify configurations remain consistent (no local modifications). 6. Document the central management approach in your System Security Plan. 7. Train administrators to request changes through central management rather than local modifications. 8. Periodically audit systems to detect configuration drift.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-3",
      "AU-6",
      "PL-9",
      "PM-5",
      "SI-4"
    ],
    "supplemental_guidance": "Centralized audit content management is critical for large-scale deployments where manual configuration is error-prone and non-scalable. Use infrastructure-as-code principles to treat audit configurations as versioned, tested, and deployed artifacts. Implement role-based access control for audit rule modifications to prevent unauthorized changes. Consider compliance-as-code frameworks like OpenSCAP profiles and Compliance Operator for Kubernetes environments. For Windows environments, use Group Policy Objects (GPOs) to centrally define Advanced Audit Policies. Integrate centralized management with change control processes (CAB approval) for audit policy modifications.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -euo pipefail\n\n# AU-3.2: Centralized Management - Example using Ansible deployment\n\necho '[AU-3.2] Implementing centralized audit configuration management...'\n\n# This script demonstrates centralized management concepts\n# In production, use Ansible, Puppet, or similar orchestration\n\n# Create central configuration repository structure\nmkdir -p /etc/audit/central_managed\ncat > /etc/audit/central_managed/README << 'EOF'\nCentralized Audit Configuration Management\n\nThis directory contains audit rules deployed from central management.\nDo NOT modify files here directly. Changes must be made through\nthe central configuration management system.\n\nManagement Platform: [YOUR_CONFIG_MGMT]\nPolicy Repository: [YOUR_GIT_REPO]\nLast Deployment: $(date)\nEOF\n\n# Example: Download audit rules from central repository\n# In production, this would be Ansible/Puppet deployment\necho '[AU-3.2] Simulating central policy deployment...'\ncp /etc/audit/rules.d/*.rules /etc/audit/central_managed/\n\n# Mark as centrally managed\ntouch /etc/audit/central_managed/.centrally_managed\n\n# Validation check\nauditctl -l > /etc/audit/central_managed/deployed_rules.txt\n\necho '[AU-3.2] Centralized management framework established!'\necho '[AU-3.2] Audit rules are now managed centrally'\necho '[AU-3.2] Local modifications should be avoided'",
        "ansible": "---\n- name: AU-3.2 Centralized Audit Configuration Management\n  hosts: all\n  become: true\n  vars:\n    audit_profile: \"{{ host_classification }}\"  # web_server, database, endpoint, etc.\n  \n  tasks:\n    - name: Deploy centralized audit rules based on system classification\n      copy:\n        src: \"files/audit_profiles/{{ audit_profile }}/\"\n        dest: /etc/audit/rules.d/\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Reload audit rules\n\n    - name: Deploy centralized auditd.conf settings\n      template:\n        src: templates/auditd.conf.j2\n        dest: /etc/audit/auditd.conf\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Mark configuration as centrally managed\n      copy:\n        dest: /etc/audit/.centrally_managed\n        content: |\n          Centrally Managed by Ansible\n          Profile: {{ audit_profile }}\n          Deployed: {{ ansible_date_time.iso8601 }}\n          Management Server: {{ inventory_hostname }}\n        mode: '0644'\n\n    - name: Validate deployed audit rules\n      command: auditctl -l\n      register: audit_rules_check\n      changed_when: false\n\n    - name: Report deployed rule count\n      debug:\n        msg: \"Deployed {{ audit_rules_check.stdout_lines | length }} audit rules for {{ audit_profile }} profile\"\n\n  handlers:\n    - name: Reload audit rules\n      command: augenrules --load\n      \n    - name: Restart auditd\n      systemd:\n        name: auditd\n        state: restarted"
      },
      "windows": {
        "powershell": "# AU-3.2: Centralized Management - Windows Group Policy example\n\nWrite-Host '[AU-3.2] Implementing centralized audit policy management...' -ForegroundColor Green\n\n# This demonstrates centralized management concepts using Group Policy\n# In production, deploy via GPO or configuration management tools\n\n# Export current audit policy for centralization\nWrite-Host '[AU-3.2] Exporting audit policy configuration...' -ForegroundColor Yellow\nAuditpol /backup /file:C:\\AuditPolicy\\central_audit_baseline.csv\n\n# Mark as centrally managed\n$centralMgmtFile = 'C:\\ProgramData\\AuditPolicy\\CentrallyManaged.txt'\nNew-Item -Path (Split-Path $centralMgmtFile) -ItemType Directory -Force | Out-Null\n@\"\nCentrally Managed Audit Configuration\nManagement Method: Group Policy / SCCM\nPolicy Applied: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')\nDo not modify local audit settings directly\n\"@ | Out-File -FilePath $centralMgmtFile\n\nWrite-Host '[AU-3.2] Centralized management established!' -ForegroundColor Green\nWrite-Host '[AU-3.2] Audit policies are managed via Group Policy' -ForegroundColor Green",
        "ansible": "---\n- name: AU-3.2 Centralized Audit Management - Windows\n  hosts: windows\n  tasks:\n    - name: Deploy centralized audit policy\n      win_shell: 'Auditpol /restore /file:\"{{ audit_policy_path }}\"'\n      changed_when: true\n\n    - name: Mark as centrally managed\n      win_copy:\n        dest: C:\\ProgramData\\AuditPolicy\\CentrallyManaged.txt\n        content: |\n          Centrally Managed by Ansible\n          Deployed: {{ ansible_date_time.iso8601 }}"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T15:30:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T15:30:00Z",
      "source": "NIST SP 800-53 Rev 5",
      "cac_status": "validated",
      "implementation_guidance": "Implement configuration management (Ansible, Puppet, GPO) to deploy consistent audit rules across systems. Use version-controlled templates, automated validation, and drift detection. Classify systems into profiles (web, database, endpoint) with tailored audit requirements. Integrate with compliance scanners (OpenSCAP) for continuous validation."
    }
  },
  {
    "control_id": "AU-3.3",
    "control_name": "Limit Personally Identifiable Information Elements",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Limit personally identifiable information contained in audit records to the following elements identified in the privacy risk assessment: [Assignment: organization-defined elements].",
    "parent_control": "AU-3",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "plain_english_explanation": "Audit logs should not contain more personal information than absolutely necessary. Work with your privacy officer to identify what PII elements (names, addresses, SSNs, medical data) must be excluded or masked in audit records to comply with privacy laws like GDPR, HIPAA, or CCPA while still maintaining security accountability.",
    "ai_guidance": "Implement PII minimization in audit logs through: (1) Field exclusion filters in auditd using '-F field!=value' to skip logging specific data fields, (2) Post-processing scripts to redact or hash PII before centralized forwarding (sed/awk transformations in rsyslog), (3) Application-level logging controls to prevent PII from entering system audit streams, (4) Structured logging with designated PII-free fields, (5) Cryptographic hashing of identifiers that must be traceable but not directly identifiable. Privacy-preserving audit techniques: use pseudonymous identifiers, aggregate before logging, implement k-anonymity for statistical logs. Balance with AU-3 requirements - usernames (authentication principals) remain necessary for accountability despite being PII.",
    "example_implementation": "This implementation limits PII in audit records through selective field exclusion, data masking transformations, and privacy-preserving logging techniques while maintaining sufficient information for security accountability and compliance with privacy regulations (GDPR Article 25 data protection by design, HIPAA minimum necessary standard).",
    "non_technical_guidance": "1. Conduct Privacy Impact Assessment (PIA) to identify PII elements in your systems (SSNs, medical records, financial data, addresses). 2. Work with Legal/Privacy Office to determine minimum PII necessary in audit logs for security purposes. 3. Create an approved list of PII elements that may appear in logs (usually just username/user ID for accountability). 4. Document PII that must be excluded or masked in audit logs. 5. Configure logging systems to filter or redact unapproved PII elements. 6. Train incident responders that detailed PII is not available in audit logs and requires separate access controls. 7. Periodically sample audit logs to verify PII limitations are enforced. 8. Update Data Processing Records to document audit log PII handling.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-3",
      "AU-9",
      "PT-2",
      "PT-3",
      "PT-7",
      "SI-12"
    ],
    "supplemental_guidance": "PII in audit logs creates privacy risks including unauthorized disclosure, retention beyond lawful purpose, and compliance violations. Organizations must balance security accountability (requiring user identification) with privacy principles (minimizing PII exposure). Acceptable PII typically limited to: system usernames (authentication principals), user IDs (numeric), and session identifiers - sufficient for incident investigation without exposing sensitive personal details. Prohibited PII typically includes: full names in free-text fields, addresses, phone numbers, financial account numbers, medical data, biometric data. Use pseudonymization or tokenization when traceable identifiers are needed without revealing actual identity. Coordinate with Privacy Office and DPO (Data Protection Officer) on AU-3.3 implementation. Document PII decisions in Privacy Impact Assessments and System Security Plans.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -euo pipefail\n\n# AU-3.3: Limit PII in Audit Records - Privacy-preserving audit configuration\n\necho '[AU-3.3] Configuring PII limitations in audit records...'\n\n# Note: This is an example framework. Actual PII elements depend on\n# organization's Privacy Impact Assessment findings.\n\n# Create PII filtering rules\ncat > /etc/audit/rules.d/au-3.3-pii-limits.rules << 'EOFAU33'\n## AU-3.3: Limit PII in Audit Records\n## Excludes unnecessary PII while maintaining accountability\n\n# ALLOWED: System usernames (auid, uid) - necessary for accountability\n# EXCLUDED: Full names, addresses, SSN, medical data in command arguments\n\n# Monitor for potential PII exposure in commands (audit but don't log args with PII)\n# Use -F success=0 to only log failed attempts (reduces PII exposure)\n-a always,exit -F arch=b64 -S execve -F auid>=1000 -F success=0 -k command_failures\n\n# File access WITHOUT capturing full file contents (prevents PII data logging)\n-a always,exit -F arch=b64 -S openat,open -F dir=/var/secure/pii -F perm=r -k pii_file_access\n# Note: Logs access attempts, not file contents\n\n# Authentication events (captures username but not passwords)\n-w /var/log/secure -p wa -k authentication_events\n# System logs usernames (allowed PII), passwords never logged\nEOFAU33\n\necho '[AU-3.3] Creating PII filtering script for centralized logs...'\n\n# Post-processing script to redact PII patterns before forwarding\ncat > /usr/local/bin/audit-pii-filter.sh << 'EOFFILTER'\n#!/bin/bash\n# Filters potential PII patterns from audit logs before centralized forwarding\n# Patterns based on organization's PII risk assessment\n\n# Read from stdin, write filtered output to stdout\nsed -E \\\n  -e 's/ssn=[0-9]{3}-[0-9]{2}-[0-9]{4}/ssn=XXX-XX-XXXX/g' \\\n  -e 's/email=[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z]{2,}/email=REDACTED@REDACTED/gi' \\\n  -e 's/phone=[0-9]{3}-[0-9]{3}-[0-9]{4}/phone=XXX-XXX-XXXX/g' \\\n  -e 's/acct=[0-9]{10,}/acct=XXXXXXXXXX/g'\n# Preserves: usernames, UIDs, hostnames, timestamps (necessary for investigation)\nEOFFILTER\n\nchmod 755 /usr/local/bin/audit-pii-filter.sh\n\naugenrules --load\n\necho '[AU-3.3] PII limitation configuration complete!'\necho '[AU-3.3] Audit logs exclude: SSN, full addresses, financial accounts, medical data'\necho '[AU-3.3] Audit logs retain: usernames, UIDs, timestamps (necessary for accountability)'",
        "ansible": "---\n- name: AU-3.3 Limit PII in Audit Records\n  hosts: all\n  become: true\n  tasks:\n    - name: Deploy PII-limiting audit rules\n      copy:\n        dest: /etc/audit/rules.d/au-3.3-pii-limits.rules\n        content: |\n          ## AU-3.3: Limit PII\n          # Logs usernames (necessary for accountability)\n          # Excludes: Full names, addresses, SSN, medical data\n          \n          # Authentication events (username only, no passwords)\n          -w /var/log/secure -p wa -k authentication_events\n          \n          # File access to PII directories (access logged, not contents)\n          -a always,exit -F arch=b64 -S openat -F dir=/var/secure/pii -F perm=r -k pii_file_access\n        mode: '0640'\n\n    - name: Deploy PII filtering script\n      copy:\n        dest: /usr/local/bin/audit-pii-filter.sh\n        content: |\n          #!/bin/bash\n          # Redact PII patterns\n          sed -E -e 's/ssn=[0-9-]+/ssn=REDACTED/g' \\\n                 -e 's/email=[^[:space:]]+@[^[:space:]]+/email=REDACTED/g'\n        mode: '0755'\n\n    - name: Reload audit rules\n      command: augenrules --load\n      changed_when: true"
      },
      "windows": {
        "powershell": "# AU-3.3: Limit PII in Audit Records - Windows Privacy-Preserving Audit\n\nWrite-Host '[AU-3.3] Configuring PII limitations in Windows audit records...' -ForegroundColor Green\n\n# Windows audit logs inherently limit PII - capture security identifiers (SIDs) not full personal details\n# This script documents PII handling approach\n\n$piiDocPath = 'C:\\ProgramData\\AuditPolicy\\PIILimitations.txt'\nNew-Item -Path (Split-Path $piiDocPath) -ItemType Directory -Force | Out-Null\n\n@\"\nAU-3.3: PII Limitations in Windows Audit Logs\n\nALLOWED PII (Necessary for accountability):\n- Security Identifier (SID): S-1-5-21-... (pseudonymous identifier)\n- Username (account name): domain\\user\n- Computer name (system identifier)\n\nEXCLUDED PII (Per Privacy Impact Assessment):\n- Full legal names (unless same as username)\n- Addresses, phone numbers\n- Social Security Numbers\n- Financial account numbers\n- Medical records, health data\n- Biometric data\n\nIMPLEMENTATION:\nWindows Event Logs natively use SIDs (pseudonymous) for user identification.\nNo command-line arguments logged by default (prevents PII in process parameters).\nAdditional protections: Disable detailed process command-line logging if PII risk identified.\n\nPrivacy Assessment Date: $(Get-Date -Format 'yyyy-MM-dd')\nReview Cycle: Annual\n\"@ | Out-File -FilePath $piiDocPath\n\n# Disable command-line process auditing if organization determines it captures excessive PII\n# (Balance security visibility with privacy)\n# Uncomment if PIA requires this restriction:\n# reg delete \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\" /v ProcessCreationIncludeCmdLine_Enabled /f\n\nWrite-Host '[AU-3.3] PII limitations documented and enforced!' -ForegroundColor Green\nWrite-Host '[AU-3.3] Audit logs use SIDs (pseudonymous) for user identification' -ForegroundColor Green",
        "ansible": "---\n- name: AU-3.3 Limit PII - Windows\n  hosts: windows\n  tasks:\n    - name: Document PII limitations\n      win_copy:\n        dest: C:\\ProgramData\\AuditPolicy\\PIILimitations.txt\n        content: |\n          AU-3.3 PII Limitations\n          Allowed: SID, Username, Computer Name\n          Excluded: SSN, Addresses, Financial Data, Medical Data"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T15:30:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T15:30:00Z",
      "source": "NIST SP 800-53 Rev 5",
      "cac_status": "validated",
      "implementation_guidance": "Limit audit log PII per Privacy Impact Assessment. Retain usernames/UIDs (accountability) but exclude SSN, addresses, financial accounts, medical data. Implement post-processing filters to redact PII patterns. Use pseudonymization (SIDs, hashed identifiers) when traceability needed without direct identification. Coordinate with Privacy Office. Balance AU-3 (comprehensive logging) with PT-3 (PII minimization)."
    }
  }
]
