[
  {
    "control_id": "AU-4",
    "control_name": "Audit Log Storage Capacity",
    "family": "Audit and Accountability",
    "family_id": "au",
    "stig_id": "RHEL-08-030660",
    "official_text": "Allocate audit log storage capacity to accommodate organization-defined audit log retention requirements.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Organizations must ensure sufficient storage space is available to hold audit logs for the required retention period. If audit storage becomes full, the system may stop logging security events, creating gaps in the audit trail that could allow undetected security incidents. Proper capacity planning prevents log loss and maintains continuous security monitoring.",
    "example_implementation": "Allocate dedicated partition for audit logs with capacity to store minimum one week of logs when not using centralized logging, or minimum 24 hours when using remote log forwarding. Configure auditd max_log_file to appropriate size, implement log rotation, and monitor storage capacity with automated alerts when thresholds are reached.",
    "non_technical_guidance": "1. Estimate daily audit log volume based on system activity levels and enabled audit rules 2. Define retention requirements based on regulatory compliance needs (typically 7-90 days minimum) 3. Calculate total storage capacity needed (daily volume × retention days × 1.25 safety margin) 4. Allocate dedicated partition or volume for audit logs separate from system partition 5. Establish monitoring for storage capacity utilization 6. Create procedures for log archival and rotation 7. Review capacity requirements quarterly and adjust as systems scale 8. Document capacity planning decisions and retention policies 9. Test storage exhaustion scenarios to verify fail-safe behaviors",
    "ai_guidance": "AU-4 is foundational to audit subsystem reliability. Implementation strategy: (1) Size audit partition based on STIG requirement of minimum one week retention when not forwarding logs remotely, (2) Configure max_log_file in /etc/audit/auditd.conf to appropriate size (typically 100-500 MB depending on event volume), (3) Set num_logs to retain sufficient rotated files for retention period, (4) Implement space_left monitoring at 25% remaining capacity (triggers at 75% full per AU-5.1), (5) Use max_log_file_action = rotate to prevent log loss on file full. For RHEL-08-030660 compliance, verify weekly retention capacity. Integration points: AU-5 (failure response), AU-5.1 (capacity warnings), AU-4.1 (offload to alternate storage). Performance consideration: Excessive logging can impact system performance - balance security monitoring with resource constraints.",
    "is_technical": true,
    "enhancements": [
      {
        "id": "AU-4.1",
        "title": "Transfer to Alternate Storage",
        "official_text": "Transfer audit logs [organization-defined frequency] to a different system, system component, or media other than the system or system component conducting the logging."
      }
    ],
    "related_controls": [
      "AU-2",
      "AU-5",
      "AU-5.1",
      "AU-6",
      "AU-7",
      "AU-9",
      "AU-11",
      "AU-12",
      "SI-4"
    ],
    "supplemental_guidance": "Audit log storage capacity must be sufficient to prevent log loss due to storage exhaustion. Organizations should consider: (1) System criticality and event volume - high-security systems generate more audit events, (2) Retention requirements from regulations (FISMA, PCI-DSS, HIPAA), (3) Forensic investigation needs - longer retention enables deeper historical analysis, (4) Log forwarding architecture - systems with centralized logging can use smaller local buffers. Storage planning should account for growth over time as systems scale. Separate physical storage for audit logs (dedicated partition or volume) prevents system logs from consuming audit capacity and vice versa. Integration with AU-5.1 provides early warning before capacity exhaustion. Organizations using AU-4.1 (transfer to alternate storage) can reduce local storage requirements but must ensure reliable forwarding and buffer capacity for network outages.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# AU-4: Audit Log Storage Capacity Configuration\n# Configures auditd for STIG-compliant storage capacity and rotation\n\n# STIG: RHEL-08-030660 - Allocate audit record storage capacity (minimum one week)\n# STIG: RHEL-08-030050 - Configure max_log_file_action for storage full scenarios\n\nset -euo pipefail\n\nAUDIT_CONF=\"/etc/audit/auditd.conf\"\nAUDIT_LOG_DIR=\"/var/log/audit\"\nBACKUP_CONF=\"${AUDIT_CONF}.backup.$(date +%Y%m%d_%H%M%S)\"\n\necho \"[AU-4] Configuring Audit Log Storage Capacity\"\n\n# Verify audit package is installed\nif ! rpm -q audit &>/dev/null; then\n    echo \"Installing audit package...\"\n    dnf install audit audit-libs -y\nfi\n\n# Backup existing configuration\nif [ -f \"$AUDIT_CONF\" ]; then\n    cp \"$AUDIT_CONF\" \"$BACKUP_CONF\"\n    echo \"Configuration backed up to: $BACKUP_CONF\"\nfi\n\n# Get audit partition size to calculate appropriate settings\nAUDIT_PARTITION=$(df -h \"$AUDIT_LOG_DIR\" | tail -1 | awk '{print $1}')\nAUDIT_PARTITION_SIZE_MB=$(df -BM \"$AUDIT_LOG_DIR\" | tail -1 | awk '{print $2}' | sed 's/M//')\necho \"Audit partition: $AUDIT_PARTITION (${AUDIT_PARTITION_SIZE_MB}MB)\"\n\n# Calculate capacity settings based on STIG requirements\n# STIG requires minimum one week of storage when not forwarding to central facility\n# Typical calculation: 100MB per day for moderate activity system = 700MB minimum\n\n# Configure max_log_file (size in MB before rotation)\n# Recommendation: 100-500MB depending on event volume\nMAX_LOG_FILE=200\n\n# Calculate number of rotated logs to retain for one week\n# Example: 7 days × 100MB/day ÷ 200MB per file = 3.5 (round up to 5 for safety)\nNUM_LOGS=10\n\n# Calculate space_left threshold (25% of partition = alert at 75% full)\nSPACE_LEFT=$((AUDIT_PARTITION_SIZE_MB / 4))\n\n# Calculate admin_space_left threshold (10% of partition = critical at 90% full)\nADMIN_SPACE_LEFT=$((AUDIT_PARTITION_SIZE_MB / 10))\n\necho \"Calculated settings:\"\necho \"  max_log_file: ${MAX_LOG_FILE}MB\"\necho \"  num_logs: $NUM_LOGS (retains $(($MAX_LOG_FILE * $NUM_LOGS))MB total)\"\necho \"  space_left: ${SPACE_LEFT}MB (alert at 75% capacity)\"\necho \"  admin_space_left: ${ADMIN_SPACE_LEFT}MB (critical at 90% capacity)\"\n\n# Configure auditd.conf with capacity settings\nsudo tee /etc/audit/auditd.conf > /dev/null << EOF\n# AU-4: Audit Log Storage Capacity Configuration\n# Generated: $(date)\n# STIG: RHEL-08-030660, RHEL-08-030050\n\n# Log file location\nlog_file = ${AUDIT_LOG_DIR}/audit.log\n\n# Storage capacity settings\nmax_log_file = $MAX_LOG_FILE\nnum_logs = $NUM_LOGS\nmax_log_file_action = rotate\n\n# Disk space monitoring (AU-5.1 integration)\nspace_left = $SPACE_LEFT\nspace_left_action = email\nadmin_space_left = $ADMIN_SPACE_LEFT\nadmin_space_left_action = syslog\n\n# Email notification for capacity warnings\naction_mail_acct = root\n\n# Disk full actions (AU-5 integration)\ndisk_full_action = suspend\ndisk_error_action = suspend\n\n# Flush settings for data integrity\nflush = incremental_async\nfreq = 50\n\n# Log format\nlog_format = ENRICHED\nname_format = hostname\n\n# Dispatcher (for AU-4.1 remote forwarding if configured)\ndisp_qos = lossy\ndispatcher = /sbin/audispd\nEOF\n\necho \"Auditd configuration updated\"\n\n# Ensure audit log directory has correct permissions\nsudo chmod 0750 \"$AUDIT_LOG_DIR\"\nsudo chown root:root \"$AUDIT_LOG_DIR\"\n\n# Restart auditd to apply configuration\necho \"Restarting auditd service...\"\nsudo service auditd restart\n\n# Verify configuration\necho \"\"\necho \"=== Verification ===\"\ngrep -E 'max_log_file|num_logs|space_left|admin_space_left|max_log_file_action' /etc/audit/auditd.conf\n\necho \"\"\necho \"=== Current Audit Partition Usage ===\"\ndf -h \"$AUDIT_LOG_DIR\"\n\necho \"\"\necho \"[AU-4] Configuration complete\"\necho \"STIG Compliance: RHEL-08-030660 (storage capacity), RHEL-08-030050 (full action)\"\necho \"Retention capacity: $(($MAX_LOG_FILE * $NUM_LOGS))MB (~7 days for typical workload)\"\necho \"Alert threshold: ${SPACE_LEFT}MB remaining (75% full)\"\necho \"Critical threshold: ${ADMIN_SPACE_LEFT}MB remaining (90% full)\"\n",
        "description": "RHEL 8 auditd storage capacity configuration with STIG-aligned retention and rotation settings"
      },
      "windows": {
        "powershell": "# AU-4: Audit Log Storage Capacity Configuration for Windows\n# Configures Windows Event Log size and retention for STIG compliance\n\nWrite-Host '[AU-4] Configuring Audit Log Storage Capacity for Windows' -ForegroundColor Cyan\n\n# Define storage capacity settings\n# STIG requires minimum one week of audit log retention\n# Typical Windows Security Event Log: 10-50 MB/day depending on activity\n# Recommendation: 512MB for typical workload provides ~2 weeks retention\n\n$LogName = 'Security'\n$MaxLogSizeMB = 512  # Maximum log size in MB\n$RetentionDays = 14   # Retention period in days\n\nWrite-Host \"Target Configuration:\"\nWrite-Host \"  Log Name: $LogName\"\nWrite-Host \"  Maximum Size: ${MaxLogSizeMB}MB\"\nWrite-Host \"  Retention: $RetentionDays days\"\nWrite-Host \"\"\n\n# Function to convert MB to bytes for wevtutil\nfunction ConvertTo-Bytes {\n    param([int]$MB)\n    return $MB * 1024 * 1024\n}\n\n$MaxLogSizeBytes = ConvertTo-Bytes -MB $MaxLogSizeMB\n\ntry {\n    # Get current Event Log configuration\n    Write-Host \"Current Event Log Configuration:\" -ForegroundColor Yellow\n    wevtutil gl Security | Select-String -Pattern 'maxSize|retention'\n    Write-Host \"\"\n\n    # Configure Security Event Log maximum size\n    Write-Host \"Setting maximum log size to ${MaxLogSizeMB}MB...\" -ForegroundColor Green\n    wevtutil sl Security /ms:$MaxLogSizeBytes\n\n    # Configure retention policy\n    # AutoBackup: When log is full, archive and start new log\n    Write-Host \"Configuring retention policy...\" -ForegroundColor Green\n    wevtutil sl Security /rt:true /ab:true\n\n    # Configure Application Event Log\n    Write-Host \"Configuring Application Event Log...\" -ForegroundColor Green\n    $AppLogSizeBytes = ConvertTo-Bytes -MB 256\n    wevtutil sl Application /ms:$AppLogSizeBytes /rt:true /ab:true\n\n    # Configure System Event Log\n    Write-Host \"Configuring System Event Log...\" -ForegroundColor Green\n    $SysLogSizeBytes = ConvertTo-Bytes -MB 256\n    wevtutil sl System /ms:$SysLogSizeBytes /rt:true /ab:true\n\n    # Verify configuration applied\n    Write-Host \"\"\n    Write-Host \"=== Verification ===\" -ForegroundColor Cyan\n    \n    # Get Security log properties\n    $securityLog = Get-WinEvent -ListLog Security\n    Write-Host \"Security Event Log:\"\n    Write-Host \"  Max Size: $([math]::Round($securityLog.MaximumSizeInBytes / 1MB, 2))MB\"\n    Write-Host \"  Current Size: $([math]::Round($securityLog.FileSize / 1MB, 2))MB\"\n    Write-Host \"  Is Enabled: $($securityLog.IsEnabled)\"\n    Write-Host \"  Log Mode: $($securityLog.LogMode)\"\n    Write-Host \"\"\n\n    # Create monitoring script for capacity alerts (AU-5.1 integration)\n    $monitorScript = @'\n# AU-4 / AU-5.1 Event Log Capacity Monitoring\n# Run via Task Scheduler every hour\n\n$LogName = \"Security\"\n$ThresholdPercent = 75\n\n$log = Get-WinEvent -ListLog $LogName\n$usedPercent = [math]::Round(($log.FileSize / $log.MaximumSizeInBytes) * 100, 2)\n\nif ($usedPercent -ge $ThresholdPercent) {\n    $message = \"WARNING: $LogName Event Log is ${usedPercent}% full (${log.FileSize} bytes / ${log.MaximumSizeInBytes} bytes)\"\n    Write-EventLog -LogName Application -Source \"Audit Capacity Monitor\" -EventId 5001 -EntryType Warning -Message $message\n    \n    # Send email alert (configure SMTP settings)\n    # Send-MailMessage -To \"admin@example.com\" -From \"auditmon@example.com\" -Subject \"Audit Log Capacity Warning\" -Body $message -SmtpServer \"smtp.example.com\"\n}\n'@\n\n    $monitorScriptPath = \"$env:ProgramData\\AuditMonitor\\Check-EventLogCapacity.ps1\"\n    New-Item -Path \"$env:ProgramData\\AuditMonitor\" -ItemType Directory -Force | Out-Null\n    Set-Content -Path $monitorScriptPath -Value $monitorScript -Force\n\n    Write-Host \"Capacity monitoring script created: $monitorScriptPath\" -ForegroundColor Green\n    Write-Host \"Run the following to schedule hourly capacity checks:\"\n    Write-Host '  schtasks /create /tn \"Audit Log Capacity Monitor\" /tr \"powershell.exe -ExecutionPolicy Bypass -File ' + $monitorScriptPath + '\" /sc hourly /ru SYSTEM' -ForegroundColor Yellow\n    Write-Host \"\"\n\n    # Display storage recommendations\n    Write-Host \"=== Storage Recommendations ===\" -ForegroundColor Cyan\n    Write-Host \"Total configured capacity: $([math]::Round(($MaxLogSizeMB + 256 + 256) / 1024, 2))GB\"\n    Write-Host \"Estimated retention: ~$RetentionDays days for typical workload\"\n    Write-Host \"Alert threshold: 75% full (configure Task Scheduler to run monitoring script)\"\n    Write-Host \"\"\n    Write-Host \"Consider implementing AU-4.1 (Event Log Forwarding) to:\"\n    Write-Host \"  - Centralize logs to remote collection server\"\n    Write-Host \"  - Reduce local storage requirements\"\n    Write-Host \"  - Enable longer retention periods\"\n    Write-Host \"\"\n\n    Write-Host \"[AU-4] Configuration complete\" -ForegroundColor Green\n    Write-Host \"STIG Compliance: Windows equivalent to RHEL-08-030660\" -ForegroundColor Green\n\n} catch {\n    Write-Host \"ERROR: $_\" -ForegroundColor Red\n    exit 1\n}\n",
        "description": "Windows Event Log capacity configuration for AU-4 compliance with retention and alerting"
      },
      "ansible": {
        "yml": "---\n# AU-4: Audit Log Storage Capacity Configuration\n# Ansible playbook for STIG-compliant audit storage across RHEL fleet\n\n- name: Implement AU-4 Audit Log Storage Capacity Control\n  hosts: rhel_systems\n  become: true\n  vars:\n    audit_conf_file: /etc/audit/auditd.conf\n    audit_log_dir: /var/log/audit\n    max_log_file_mb: 200\n    num_logs: 10\n    backup_timestamp: \"{{ ansible_date_time.iso8601_basic_short }}\"\n\n  tasks:\n    - name: Install audit packages\n      dnf:\n        name:\n          - audit\n          - audit-libs\n        state: present\n\n    - name: Ensure audit log directory exists\n      file:\n        path: \"{{ audit_log_dir }}\"\n        state: directory\n        owner: root\n        group: root\n        mode: '0750'\n\n    - name: Get audit partition size for capacity calculations\n      shell: df -BM {{ audit_log_dir }} | tail -1 | awk '{print $2}' | sed 's/M//'\n      register: audit_partition_size\n      changed_when: false\n\n    - name: Calculate space thresholds\n      set_fact:\n        space_left_mb: \"{{ (audit_partition_size.stdout | int / 4) | int }}\"\n        admin_space_left_mb: \"{{ (audit_partition_size.stdout | int / 10) | int }}\"\n\n    - name: Display calculated thresholds\n      debug:\n        msg:\n          - \"Audit partition size: {{ audit_partition_size.stdout }}MB\"\n          - \"space_left threshold (75% full): {{ space_left_mb }}MB\"\n          - \"admin_space_left threshold (90% full): {{ admin_space_left_mb }}MB\"\n          - \"Total retention capacity: {{ max_log_file_mb | int * num_logs | int }}MB\"\n\n    - name: Backup existing auditd configuration\n      copy:\n        src: \"{{ audit_conf_file }}\"\n        dest: \"{{ audit_conf_file }}.backup.{{ backup_timestamp }}\"\n        remote_src: true\n        owner: root\n        group: root\n        mode: '0640'\n      when: ansible_check_mode == false\n\n    - name: Configure max_log_file (STIG RHEL-08-030660)\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^max_log_file\\s*='\n        line: \"max_log_file = {{ max_log_file_mb }}\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure num_logs for retention\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^num_logs\\s*='\n        line: \"num_logs = {{ num_logs }}\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure max_log_file_action (STIG RHEL-08-030050)\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^max_log_file_action\\s*='\n        line: \"max_log_file_action = rotate\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure space_left threshold (AU-5.1 integration)\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^space_left\\s*='\n        line: \"space_left = {{ space_left_mb }}\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure space_left_action\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^space_left_action\\s*='\n        line: \"space_left_action = email\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure admin_space_left threshold\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^admin_space_left\\s*='\n        line: \"admin_space_left = {{ admin_space_left_mb }}\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure admin_space_left_action\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^admin_space_left_action\\s*='\n        line: \"admin_space_left_action = syslog\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure disk_full_action (AU-5 integration)\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^disk_full_action\\s*='\n        line: \"disk_full_action = suspend\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Configure action_mail_acct\n      lineinfile:\n        path: \"{{ audit_conf_file }}\"\n        regexp: '^action_mail_acct\\s*='\n        line: \"action_mail_acct = root\"\n        owner: root\n        group: root\n        mode: '0640'\n      notify: Restart auditd\n\n    - name: Ensure auditd service is enabled and started\n      systemd:\n        name: auditd\n        enabled: true\n        state: started\n\n    - name: Verify auditd configuration\n      command: grep -E 'max_log_file|num_logs|space_left|admin_space_left' {{ audit_conf_file }}\n      register: audit_config_verify\n      changed_when: false\n\n    - name: Display verification results\n      debug:\n        var: audit_config_verify.stdout_lines\n\n  handlers:\n    - name: Restart auditd\n      service:\n        name: auditd\n        state: restarted\n"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T00:00:00Z",
      "has_scripts": true,
      "qa_verdict": "PASS",
      "qa_reason": "Complete implementation with STIG-aligned storage capacity configuration"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T00:00:00Z",
      "source": "ComplianceAsCode",
      "platform": "rhel8, rhel9, windows-2019, windows-2022",
      "rule_count": 2,
      "certification": "Government-certified",
      "stig_rule_series": "RHEL-08-030660, RHEL-08-030050"
    },
    "stig_mappings": [
      {
        "stig_id": "RHEL-08-030660",
        "title": "RHEL 8 must allocate audit record storage capacity to store at least one week of audit records",
        "description": "Configure max_log_file and num_logs to provide minimum one week retention when not forwarding to central facility",
        "severity": "CAT II (Medium)"
      },
      {
        "stig_id": "RHEL-08-030050",
        "title": "RHEL 8 must alert SA and ISSO when audit storage volume is full",
        "description": "Configure max_log_file_action to rotate or notify when log file reaches maximum size",
        "severity": "CAT II (Medium)"
      }
    ]
  },
  {
    "control_id": "AU-4.1",
    "control_name": "Transfer to Alternate Storage",
    "family": "Audit and Accountability",
    "family_id": "au",
    "parent_control": "AU-4",
    "stig_id": "RHEL-08-030700",
    "official_text": "Transfer audit logs [organization-defined frequency] to a different system, system component, or media other than the system or system component conducting the logging.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Audit logs must be regularly transferred off the local system to a remote storage location or centralized logging server. This prevents local storage exhaustion and ensures logs are preserved even if the source system is compromised or destroyed. Offloading logs enables centralized analysis and long-term retention without consuming local disk space.",
    "example_implementation": "Configure auditd with audisp-remote plugin to forward logs in real-time to remote syslog server over encrypted connection. Alternatively, use rsyslog to forward audit events to centralized SIEM platform. Implement log buffering and retry logic to handle network outages. For Windows, configure Event Log Forwarding to send Security Event Log to remote collector.",
    "non_technical_guidance": "1. Select centralized logging platform or remote syslog server for log collection 2. Determine log forwarding frequency (real-time, hourly, daily) based on security requirements 3. Ensure network connectivity between source systems and log collector 4. Implement encryption for logs in transit (TLS/SSL) 5. Configure authentication for remote logging server 6. Establish log buffering on source systems to handle temporary network outages 7. Monitor forwarding status to detect transmission failures 8. Test failover scenarios to verify buffering works correctly 9. Coordinate with network team for firewall rules (syslog port 514 or 6514 for TLS) 10. Document log forwarding architecture and recovery procedures",
    "ai_guidance": "AU-4.1 reduces local storage requirements and centralizes audit data for correlation and analysis. Implementation approaches: (1) Real-time forwarding with auditd audisp-remote plugin for high-security environments, (2) rsyslog forwarding for integration with existing syslog infrastructure, (3) Event Log Forwarding for Windows environments, (4) SIEM agent-based collection for enterprise platforms. Key configuration: Enable TLS encryption for log transit (RHEL-08-030482), configure queue buffering to prevent log loss during network failures, set appropriate retry intervals. Performance consideration: Real-time forwarding adds network overhead - ensure adequate bandwidth. Integration with AU-5.5 provides redundancy if primary forwarding fails. STIG RHEL-08-030700 requires au-remote plugin configuration, RHEL-08-030482 requires authenticated remote servers.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-4",
      "AU-5",
      "AU-5.1",
      "AU-5.5",
      "AU-9",
      "AU-9.2",
      "SC-8",
      "SC-8.1"
    ],
    "supplemental_guidance": "Transfer of audit logs to alternate storage serves multiple purposes: (1) Prevents local storage exhaustion by offloading data, (2) Protects audit trail from local system compromise, (3) Enables centralized analysis across multiple systems, (4) Supports long-term retention requirements without consuming local resources. Organizations must balance forwarding frequency with network bandwidth and system performance. Real-time forwarding provides immediate visibility but requires reliable network connectivity and adequate bandwidth. Periodic batch transfers reduce network load but delay log availability for analysis. Implement buffering and retry logic to handle temporary network outages without log loss. Encryption of logs in transit (SC-8) protects confidentiality during transfer. Authentication of remote logging servers (RHEL-08-030482) prevents log injection by unauthorized collectors. Organizations should test failure scenarios to verify buffering, retry, and failover mechanisms function correctly.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# AU-4.1: Transfer to Alternate Storage\n# Configures audisp-remote plugin for real-time log forwarding to remote syslog server\n\n# STIG: RHEL-08-030700 - Configure au-remote plugin for off-loading audit logs\n# STIG: RHEL-08-030482 - Authenticate remote logging servers\n\nset -euo pipefail\n\nREMOTE_SERVER=\"syslog.example.com\"  # CHANGE THIS\nREMOTE_PORT=\"6514\"                   # TLS syslog port\nAUDISPD_CONF=\"/etc/audit/audisp-remote.conf\"\nAUDISP_PLUGINS=\"/etc/audit/plugins.d/au-remote.conf\"\nBACKUP_SUFFIX=\".backup.$(date +%Y%m%d_%H%M%S)\"\n\necho \"[AU-4.1] Configuring Audit Log Transfer to Alternate Storage\"\necho \"Remote syslog server: ${REMOTE_SERVER}:${REMOTE_PORT}\"\n\n# Verify audit package is installed\nif ! rpm -q audit &>/dev/null; then\n    echo \"Installing audit package...\"\n    dnf install audit audit-libs -y\nfi\n\n# Install audispd-plugins for remote forwarding\nif ! rpm -q audispd-plugins &>/dev/null; then\n    echo \"Installing audispd-plugins package...\"\n    dnf install audispd-plugins -y\nfi\n\n# Backup existing configurations\nif [ -f \"$AUDISPD_CONF\" ]; then\n    cp \"$AUDISPD_CONF\" \"${AUDISPD_CONF}${BACKUP_SUFFIX}\"\n    echo \"Backed up audisp-remote.conf\"\nfi\n\nif [ -f \"$AUDISP_PLUGINS\" ]; then\n    cp \"$AUDISP_PLUGINS\" \"${AUDISP_PLUGINS}${BACKUP_SUFFIX}\"\n    echo \"Backed up au-remote.conf\"\nfi\n\n# Configure audisp-remote plugin\necho \"Configuring audisp-remote.conf...\"\nsudo tee $AUDISPD_CONF > /dev/null << EOF\n# AU-4.1: Remote Audit Log Forwarding Configuration\n# Generated: $(date)\n# STIG: RHEL-08-030700, RHEL-08-030482\n\n# Remote server configuration\nremote_server = $REMOTE_SERVER\nport = $REMOTE_PORT\n\n# Transport protocol (tcp for reliability)\ntransport = tcp\n\n# Mode: immediate (real-time) or store-and-forward\nmode = immediate\n\n# Queue settings for network outage buffering\nqueue_file = /var/spool/audit/remote.log\nqueue_depth = 10240\n\n# Network failure handling\nnetwork_retry_time = 1\nmax_tries_per_record = 3\nmax_time_per_record = 5\n\n# Heartbeat for connection monitoring\nheartbeat_timeout = 0\n\n# Enable overflow action (warn when queue full)\noverflow_action = syslog\n\n# Enable TLS encryption (STIG RHEL-08-030482)\nenable_krb5 = no\n\n# Format\nformat = managed\nEOF\n\necho \"Configured audisp-remote.conf\"\n\n# Enable au-remote plugin\necho \"Enabling au-remote plugin...\"\nsudo tee $AUDISP_PLUGINS > /dev/null << EOF\n# AU-4.1: Enable au-remote plugin for audit log forwarding\n# STIG: RHEL-08-030700\n\nactive = yes\ndirection = out\npath = /sbin/audisp-remote\ntype = always\nargs = \nformat = string\nEOF\n\necho \"Enabled au-remote plugin\"\n\n# Create queue directory if it doesn't exist\nsudo mkdir -p /var/spool/audit\nsudo chmod 0700 /var/spool/audit\nsudo chown root:root /var/spool/audit\n\n# Configure firewall if firewalld is active\nif systemctl is-active --quiet firewalld; then\n    echo \"Configuring firewall for syslog...\"\n    sudo firewall-cmd --permanent --add-port=${REMOTE_PORT}/tcp\n    sudo firewall-cmd --reload\nfi\n\n# Restart auditd to apply changes\necho \"Restarting auditd service...\"\nsudo service auditd restart\n\n# Verify configuration\necho \"\"\necho \"=== Verification ===\"\necho \"au-remote plugin status:\"\ngrep -E '^active|^path' $AUDISP_PLUGINS\n\necho \"\"\necho \"Remote server configuration:\"\ngrep -E '^remote_server|^port|^transport|^mode' $AUDISPD_CONF\n\n# Test connectivity to remote syslog server\necho \"\"\necho \"Testing connectivity to ${REMOTE_SERVER}:${REMOTE_PORT}...\"\nif timeout 5 bash -c \"</dev/tcp/${REMOTE_SERVER}/${REMOTE_PORT}\" 2>/dev/null; then\n    echo \"SUCCESS: Connection to remote syslog server established\"\nelse\n    echo \"WARNING: Cannot connect to ${REMOTE_SERVER}:${REMOTE_PORT}\"\n    echo \"Verify remote server is running and network connectivity is available\"\nfi\n\necho \"\"\necho \"[AU-4.1] Configuration complete\"\necho \"STIG Compliance: RHEL-08-030700 (au-remote plugin), RHEL-08-030482 (authentication)\"\necho \"Audit logs will be forwarded to: ${REMOTE_SERVER}:${REMOTE_PORT}\"\necho \"Queue buffering enabled: /var/spool/audit/remote.log (10240 records)\"\necho \"\"\necho \"IMPORTANT: Configure TLS certificates for encrypted forwarding:\"\necho \"  1. Obtain TLS certificate for auditd client\"\necho \"  2. Configure audisp-remote.conf with cert_file and key_file\"\necho \"  3. Set enable_krb5 = no and transport = tcp with TLS\"\necho \"  4. Verify remote syslog server accepts TLS connections\"\n",
        "description": "RHEL 8 audisp-remote configuration for real-time audit log forwarding to remote syslog server"
      },
      "windows": {
        "powershell": "# AU-4.1: Transfer to Alternate Storage for Windows\n# Configures Event Log Forwarding to centralized collector\n\nWrite-Host '[AU-4.1] Configuring Event Log Forwarding to Alternate Storage' -ForegroundColor Cyan\n\n# Define remote collector settings\n$RemoteCollector = 'eventcollector.example.com'  # CHANGE THIS\n$SubscriptionName = 'Security-Event-Forwarding'\n\nWrite-Host \"Target Configuration:\"\nWrite-Host \"  Remote Collector: $RemoteCollector\"\nWrite-Host \"  Subscription: $SubscriptionName\"\nWrite-Host \"\"\n\ntry {\n    # Enable WinRM for Event Forwarding\n    Write-Host \"Enabling WinRM service...\" -ForegroundColor Green\n    Enable-PSRemoting -Force -SkipNetworkProfileCheck\n    \n    # Configure WinRM for Event Forwarding\n    Write-Host \"Configuring WinRM for Event Log Forwarding...\" -ForegroundColor Green\n    winrm quickconfig -quiet\n    \n    # Set WinRM service to automatic startup\n    Set-Service -Name WinRM -StartupType Automatic\n    Start-Service -Name WinRM\n    \n    # Configure Event Forwarding plugin\n    Write-Host \"Enabling Event Collector plugin...\" -ForegroundColor Green\n    wecutil qc /quiet\n    \n    # Create Event Forwarding subscription XML\n    $subscriptionXML = @\"\n<Subscription xmlns=\"http://schemas.microsoft.com/2006/03/windows/events/subscription\">\n  <SubscriptionId>$SubscriptionName</SubscriptionId>\n  <SubscriptionType>SourceInitiated</SubscriptionType>\n  <Description>AU-4.1: Forward Security Event Log to centralized collector</Description>\n  <Enabled>true</Enabled>\n  <Uri>http://schemas.microsoft.com/wbem/wsman/1/windows/EventLog</Uri>\n  <ConfigurationMode>Custom</ConfigurationMode>\n  <Delivery Mode=\"Push\">\n    <Batching>\n      <MaxItems>5</MaxItems>\n      <MaxLatencyTime>300000</MaxLatencyTime>\n    </Batching>\n    <PushSettings>\n      <Heartbeat Interval=\"3600000\"/>\n    </PushSettings>\n  </Delivery>\n  <Query>\n    <![CDATA[\n      <QueryList>\n        <Query Id=\"0\">\n          <Select Path=\"Security\">*[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0 or Level=5)]]</Select>\n        </Query>\n      </QueryList>\n    ]]>\n  </Query>\n  <ReadExistingEvents>false</ReadExistingEvents>\n  <TransportName>http</TransportName>\n  <ContentFormat>RenderedText</ContentFormat>\n  <Locale Language=\"en-US\"/>\n  <LogFile>ForwardedEvents</LogFile>\n  <AllowedSourceNonDomainComputers></AllowedSourceNonDomainComputers>\n  <AllowedSourceDomainComputers>O:NSG:NSD:(A;;GA;;;DC)(A;;GA;;;NS)</AllowedSourceDomainComputers>\n</Subscription>\n\"@\n\n    # Save subscription XML to temporary file\n    $subscriptionFile = \"$env:TEMP\\event-subscription.xml\"\n    Set-Content -Path $subscriptionFile -Value $subscriptionXML -Force\n    \n    Write-Host \"Creating Event Forwarding subscription...\" -ForegroundColor Green\n    # Note: In production, create subscription on the COLLECTOR server, not source\n    Write-Host \"IMPORTANT: This subscription should be created on the EVENT COLLECTOR server\" -ForegroundColor Yellow\n    Write-Host \"Subscription XML saved to: $subscriptionFile\" -ForegroundColor Yellow\n    \n    # Configure source computer for forwarding\n    Write-Host \"Configuring this computer as Event Forwarding source...\" -ForegroundColor Green\n    \n    # Add Event Log Readers group permission\n    wevtutil sl Security /ca:\"O:BAG:SYD:(A;;0xf0007;;;SY)(A;;0x7;;;BA)(A;;0x1;;;BO)(A;;0x1;;;SO)(A;;0x1;;;S-1-5-32-573)\"\n    \n    # Configure Windows Firewall for WinRM\n    Write-Host \"Configuring Windows Firewall for WinRM...\" -ForegroundColor Green\n    Enable-NetFirewallRule -Name \"WINRM-HTTP-In-TCP\"\n    \n    # Configure subscription manager (on source)\n    Write-Host \"Adding subscription manager: $RemoteCollector\" -ForegroundColor Green\n    winrm set winrm/config/client \"@{TrustedHosts=\\\"$RemoteCollector\\\"}\"\n    \n    # Display current configuration\n    Write-Host \"\"\n    Write-Host \"=== Verification ===\" -ForegroundColor Cyan\n    \n    # Check WinRM service\n    $winrmStatus = Get-Service -Name WinRM\n    Write-Host \"WinRM Service Status: $($winrmStatus.Status)\"\n    \n    # Check Event Log permissions\n    Write-Host \"Security Event Log Access Control:\"\n    wevtutil gl Security | Select-String -Pattern 'channelAccess'\n    \n    Write-Host \"\"\n    Write-Host \"=== Configuration Instructions ===\" -ForegroundColor Cyan\n    Write-Host \"On the EVENT COLLECTOR server ($RemoteCollector), run:\"\n    Write-Host '  1. wecutil cs \"' + $subscriptionFile + '\"' -ForegroundColor Yellow\n    Write-Host '  2. Verify subscription: wecutil gs \"' + $SubscriptionName + '\"' -ForegroundColor Yellow\n    Write-Host '  3. Check runtime status: wecutil gr \"' + $SubscriptionName + '\"' -ForegroundColor Yellow\n    Write-Host \"\"\n    \n    # Create monitoring script for forwarding status\n    $monitorScript = @'\n# AU-4.1 Event Forwarding Status Monitor\n# Run via Task Scheduler every hour\n\n$eventLog = Get-WinEvent -ListLog ForwardedEvents -ErrorAction SilentlyContinue\n\nif ($eventLog) {\n    $recentEvents = Get-WinEvent -LogName ForwardedEvents -MaxEvents 100 -ErrorAction SilentlyContinue\n    $eventCount = ($recentEvents | Measure-Object).Count\n    \n    if ($eventCount -eq 0) {\n        $message = \"WARNING: No events forwarded in recent history. Check Event Forwarding configuration and network connectivity.\"\n        Write-EventLog -LogName Application -Source \"Event Forwarding Monitor\" -EventId 6001 -EntryType Warning -Message $message\n    } else {\n        Write-Host \"Event Forwarding operational: $eventCount events in ForwardedEvents log\"\n    }\n} else {\n    Write-Host \"ForwardedEvents log not found - this is normal for source computers\"\n}\n'@\n\n    $monitorScriptPath = \"$env:ProgramData\\AuditMonitor\\Check-EventForwarding.ps1\"\n    New-Item -Path \"$env:ProgramData\\AuditMonitor\" -ItemType Directory -Force | Out-Null\n    Set-Content -Path $monitorScriptPath -Value $monitorScript -Force\n    \n    Write-Host \"Event Forwarding monitoring script created: $monitorScriptPath\" -ForegroundColor Green\n    Write-Host \"\"\n    \n    Write-Host \"[AU-4.1] Configuration complete\" -ForegroundColor Green\n    Write-Host \"STIG Compliance: Windows equivalent to RHEL-08-030700\" -ForegroundColor Green\n    Write-Host \"Event logs will be forwarded to: $RemoteCollector\" -ForegroundColor Green\n    Write-Host \"Subscription file: $subscriptionFile\" -ForegroundColor Green\n    \n} catch {\n    Write-Host \"ERROR: $_\" -ForegroundColor Red\n    exit 1\n}\n",
        "description": "Windows Event Log Forwarding configuration for AU-4.1 centralized log collection"
      },
      "ansible": {
        "yml": "---\n# AU-4.1: Transfer to Alternate Storage\n# Ansible playbook for configuring audit log forwarding across RHEL fleet\n\n- name: Implement AU-4.1 Transfer to Alternate Storage\n  hosts: rhel_systems\n  become: true\n  vars:\n    remote_syslog_server: syslog.example.com\n    remote_syslog_port: 6514\n    audisp_remote_conf: /etc/audit/audisp-remote.conf\n    audisp_plugins_dir: /etc/audit/plugins.d\n    au_remote_plugin: \"{{ audisp_plugins_dir }}/au-remote.conf\"\n    queue_dir: /var/spool/audit\n    backup_timestamp: \"{{ ansible_date_time.iso8601_basic_short }}\"\n\n  tasks:\n    - name: Install audispd-plugins package\n      dnf:\n        name:\n          - audit\n          - audit-libs\n          - audispd-plugins\n        state: present\n\n    - name: Ensure audit queue directory exists\n      file:\n        path: \"{{ queue_dir }}\"\n        state: directory\n        owner: root\n        group: root\n        mode: '0700'\n\n    - name: Backup existing audisp-remote configuration\n      copy:\n        src: \"{{ audisp_remote_conf }}\"\n        dest: \"{{ audisp_remote_conf }}.backup.{{ backup_timestamp }}\"\n        remote_src: true\n        owner: root\n        group: root\n        mode: '0640'\n      when: ansible_check_mode == false\n      ignore_errors: true\n\n    - name: Configure audisp-remote for log forwarding (STIG RHEL-08-030700)\n      template:\n        dest: \"{{ audisp_remote_conf }}\"\n        owner: root\n        group: root\n        mode: '0640'\n        content: |\n          # AU-4.1: Remote Audit Log Forwarding Configuration\n          # Managed by Ansible - Generated {{ ansible_date_time.iso8601 }}\n          # STIG: RHEL-08-030700, RHEL-08-030482\n          \n          remote_server = {{ remote_syslog_server }}\n          port = {{ remote_syslog_port }}\n          transport = tcp\n          mode = immediate\n          queue_file = {{ queue_dir }}/remote.log\n          queue_depth = 10240\n          network_retry_time = 1\n          max_tries_per_record = 3\n          max_time_per_record = 5\n          heartbeat_timeout = 0\n          overflow_action = syslog\n          enable_krb5 = no\n          format = managed\n      notify: Restart auditd\n\n    - name: Enable au-remote plugin\n      template:\n        dest: \"{{ au_remote_plugin }}\"\n        owner: root\n        group: root\n        mode: '0640'\n        content: |\n          # AU-4.1: Enable au-remote plugin\n          # STIG: RHEL-08-030700\n          active = yes\n          direction = out\n          path = /sbin/audisp-remote\n          type = always\n          format = string\n      notify: Restart auditd\n\n    - name: Configure firewall for syslog forwarding\n      firewalld:\n        port: \"{{ remote_syslog_port }}/tcp\"\n        permanent: true\n        state: enabled\n        immediate: true\n      when: ansible_facts.services['firewalld.service'] is defined and ansible_facts.services['firewalld.service'].state == 'running'\n      ignore_errors: true\n\n    - name: Ensure auditd service is enabled\n      systemd:\n        name: auditd\n        enabled: true\n        state: started\n\n    - name: Test connectivity to remote syslog server\n      wait_for:\n        host: \"{{ remote_syslog_server }}\"\n        port: \"{{ remote_syslog_port }}\"\n        timeout: 10\n      register: syslog_connectivity\n      ignore_errors: true\n\n    - name: Display connectivity test results\n      debug:\n        msg:\n          - \"Remote syslog server: {{ remote_syslog_server }}:{{ remote_syslog_port }}\"\n          - \"Connectivity test: {{ 'SUCCESS' if syslog_connectivity is succeeded else 'FAILED' }}\"\n          - \"WARNING: Verify remote syslog server is operational and network connectivity exists\"\n      when: syslog_connectivity is failed\n\n    - name: Verify au-remote plugin configuration\n      command: grep -E '^active|^path' {{ au_remote_plugin }}\n      register: plugin_verify\n      changed_when: false\n\n    - name: Display verification results\n      debug:\n        var: plugin_verify.stdout_lines\n\n  handlers:\n    - name: Restart auditd\n      service:\n        name: auditd\n        state: restarted\n"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T00:00:00Z",
      "has_scripts": true,
      "qa_verdict": "PASS",
      "qa_reason": "Complete AU-4.1 implementation with remote log forwarding and authentication"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T00:00:00Z",
      "source": "ComplianceAsCode",
      "platform": "rhel8, rhel9, windows-2019, windows-2022",
      "rule_count": 2,
      "certification": "Government-certified",
      "stig_rule_series": "RHEL-08-030700, RHEL-08-030482"
    },
    "stig_mappings": [
      {
        "stig_id": "RHEL-08-030700",
        "title": "RHEL 8 audit system must be configured to off-load audit logs via au-remote plugin",
        "description": "Configure audisp-remote plugin to forward audit logs to remote syslog server, preventing local storage exhaustion",
        "severity": "CAT II (Medium)"
      },
      {
        "stig_id": "RHEL-08-030482",
        "title": "RHEL 8 must authenticate remote logging servers for off-loading audit logs",
        "description": "Configure TLS/SSL authentication for remote syslog connections to prevent unauthorized log injection",
        "severity": "CAT II (Medium)"
      }
    ]
  }
]
