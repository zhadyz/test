[
  {
    "control_id": "AU-11",
    "control_name": "Audit Record Retention",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Retain audit records for [Assignment: organization-defined time period] to provide support for after-the-fact investigations of incidents and to meet regulatory and organizational information retention requirements.",
    "source": "NIST SP 800-53 Rev 5",
    "stig_id": "RHEL-08-030050, RHEL-07-030000",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Organizations must retain audit records for a defined time period established based on regulatory, legal, and operational requirements. This retention supports investigations into security incidents and enables compliance with records retention laws. The retention period should align with organizational policies and industry standards (commonly 7 years to indefinitely, depending on sector).",
    "ai_guidance": "Implement automated audit record lifecycle management with three key phases: (1) Active retention in primary storage for immediate access (typically 90 days), (2) Archive retention in cold storage for long-term compliance (remaining time period), and (3) Disposal procedures following regulatory approval. Use centralized logging solutions (syslog, rsyslog, ELK stack) to maintain audit trails across distributed systems. Configure auditd with 'max_log_file_action=syslog' to ensure administrator notification before capacity limits, preventing data loss.",
    "example_implementation": "This solution implements automated audit record retention through centralized logging infrastructure. It configures auditd for proper rotation and archival, implements backup scheduling for long-term retention, and establishes monitoring to detect retention failures.",
    "non_technical_guidance": "1. Determine the required retention period for audit records based on regulatory and organizational requirements (review legal department guidance, compliance frameworks applicable to your organization). 2. Establish a centralized repository or system for storing audit records securely (implement dedicated audit server with redundant storage). 3. Implement a process for regularly backing up audit records to ensure they are not lost (daily or weekly depending on volume). 4. Define access controls and permissions for who can view, modify, or delete audit records (use role-based access with immutability protections). 5. Periodically review and audit the audit record retention process to ensure compliance with requirements (quarterly audit reviews). 6. Document the audit record retention policy and procedures for future reference and training purposes (maintain in policy repository with change tracking).",
    "is_technical": true,
    "enhancements": [
      {
        "id": "AU-11.1",
        "title": "Long-term Retrieval Capability",
        "official_text": "Employ [Assignment: organization-defined measures] to ensure that long-term audit records generated by the system can be retrieved."
      }
    ],
    "related_controls": [
      "AU-2",
      "AU-4",
      "AU-5",
      "AU-6",
      "AU-9",
      "AU-14",
      "MP-6",
      "RA-5",
      "SI-12"
    ],
    "supplemental_guidance": "Organizations must determine when audit records are no longer needed for administrative, legal, audit, or operational purposes. This retention applies to Freedom of Information Act (FOIA) requests, subpoenas, and law enforcement actions. Organizations should develop standard categories of audit records and corresponding response procedures for various legal actions. The National Archives and Records Administration (NARA) provides federal guidance on records retention through its General Records Schedules. Consider retention periods that account for statute of limitations (typically 5-7 years minimum for federal compliance), regulatory requirements (HIPAA, PCI-DSS, SOX), and organizational historical analysis needs.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -e\necho '[AUDIT] Configuring audit record retention...'\nif ! command -v auditd &> /dev/null; then\n    if command -v dnf &> /dev/null; then\n        dnf install -y audit audit-libs\n    elif command -v apt-get &> /dev/null; then\n        apt-get install -y auditd audispd-plugins\n    fi\nfi\necho '[AUDIT] Configuring /etc/audit/auditd.conf'\nsed -i 's/^max_log_file = .*/max_log_file = 1048576/' /etc/audit/auditd.conf\nif ! grep -q '^max_log_file' /etc/audit/auditd.conf; then\n    echo 'max_log_file = 1048576' >> /etc/audit/auditd.conf\nfi\nsed -i 's/^max_log_file_action = .*/max_log_file_action = syslog/' /etc/audit/auditd.conf\nif ! grep -q '^max_log_file_action' /etc/audit/auditd.conf; then\n    echo 'max_log_file_action = syslog' >> /etc/audit/auditd.conf\nfi\necho '[AUDIT] Audit record retention configuration completed.'",
        "ansible": "---\n- name: Configure AU-11 Audit Record Retention\n  hosts: all\n  become: true\n  tasks:\n    - name: Install auditd packages\n      package:\n        name:\n          - audit\n          - audit-libs\n        state: present\n    - name: Configure auditd.conf for retention\n      lineinfile:\n        path: /etc/audit/auditd.conf\n        regexp: \"{{ item.regexp }}\"\n        line: \"{{ item.line }}\"\n        state: present\n      loop:\n        - regexp: '^max_log_file'\n          line: \"max_log_file = 1048576\"\n        - regexp: '^max_log_file_action'\n          line: \"max_log_file_action = syslog\"\n    - name: Enable and start auditd service\n      systemd:\n        name: auditd\n        enabled: true\n        state: started"
      },
      "windows": {
        "powershell": "Write-Host '[AUDIT] Configuring Windows audit record retention...' -ForegroundColor Green\nAuditpol /set /category:* /success:enable /failure:enable\n$eventLogs = @('Security','System','Application')\nforeach ($logName in $eventLogs) {\n    Write-Host \"Configuring $logName event log...\" -ForegroundColor Yellow\n    wevtutil sl $logName /ms:1073741824\n    wevtutil sl $logName /rt:true /mr:90 /dm:true\n}\nWrite-Host '[AUDIT] Configuration completed.' -ForegroundColor Green",
        "ansible": "---\n- name: Configure AU-11 Audit Record Retention on Windows\n  hosts: windows\n  tasks:\n    - name: Enable Windows audit policies\n      win_shell: 'Auditpol /set /category:* /success:enable /failure:enable'\n      changed_when: true\n    - name: Configure event log retention for Security log\n      win_shell: 'wevtutil sl Security /ms:1073741824'\n      changed_when: true"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T00:00:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T00:00:00Z",
      "source": "ComplianceAsCode / DISA STIG",
      "cac_status": "validated",
      "cac_planned": true,
      "stig_references": [
        "RHEL-08-030050",
        "RHEL-07-030330"
      ],
      "implementation_guidance": "Configure auditd with max_log_file_action=syslog to ensure administrator notification. Implement automated archival using centralized logging. Establish retention policy aligned with regulatory requirements (minimum 7 years for federal compliance). Implement immutable storage when possible."
    }
  },
  {
    "control_id": "AU-11.1",
    "control_name": "Long-term Retrieval Capability",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "Employ [Assignment: organization-defined measures] to ensure that long-term audit records generated by the system can be retrieved.",
    "parent_control": "AU-11",
    "source": "NIST SP 800-53 Rev 5",
    "stig_id": "RHEL-08-030000, RHEL-08-030050",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "plain_english_explanation": "Ensure that audit records retained for extended periods can still be accessed and analyzed despite potential technological changes, media degradation, or format obsolescence. This includes maintaining format compatibility, backup integrity, and the technical infrastructure needed to retrieve historical audit records.",
    "ai_guidance": "Implement a multi-layered long-term retrieval strategy: (1) Format standardization using open formats (syslog RFC5424, JSON) rather than proprietary formats, (2) Regular validation through periodic restore tests, (3) Redundant storage across geographically separated locations, (4) Metadata preservation including timestamps, signatures, and provenance, (5) Technology refresh cycles maintaining access tools. Use WORM storage for immutability. Implement automated verification jobs quarterly restoring samples to validate integrity.",
    "example_implementation": "Comprehensive long-term audit record retrieval through redundant archival, format preservation, and automated integrity validation.",
    "non_technical_guidance": "1. Select archival storage media and formats with established long-term stability (NARA-approved formats, unencrypted syslog). 2. Maintain detailed documentation of data formats, storage locations, and access procedures. 3. Implement periodic testing (quarterly minimum) to verify archive retrieval and readability. 4. Establish backup strategy with multiple copies in geographically separated locations. 5. Maintain inventory of archived records with metadata about retention period and verification status. 6. Plan technology refresh cycles ensuring retrieval infrastructure remains compatible.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-2",
      "AU-4",
      "AU-5",
      "AU-9",
      "AU-11",
      "CP-10",
      "MP-6",
      "SI-12"
    ],
    "supplemental_guidance": "Long-term retrieval requires addressing storage media, file format, and access tool obsolescence. Strategies: (1) Store in standard open formats (syslog, JSON), (2) Maintain multiple copies in different geographic locations, (3) Periodically migrate to newer media, (4) Document technical specifications and procedures, (5) Conduct regular retrieval testing, (6) Implement cryptographic integrity protection, (7) Maintain systems capable of reading archived records. Coordinate with NARA for federal records preservation.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\nset -e\necho '[AUDIT] Configuring long-term retrieval...'\nARCHIVE_DIR='/var/log/audit/archive'\nBACKUP_DIR_PRIMARY='/mnt/audit-backup-primary'\nBACKUP_DIR_SECONDARY='/mnt/audit-backup-secondary'\nmkdir -p \"$ARCHIVE_DIR\" \"$BACKUP_DIR_PRIMARY\" \"$BACKUP_DIR_SECONDARY\"\nchown -R root:root \"$ARCHIVE_DIR\"\nchmod -R 700 \"$ARCHIVE_DIR\"\ncat > /usr/local/bin/archive-audit-records.sh << 'EOFARCH'\n#!/bin/bash\nARCHIVE_DIR='/var/log/audit/archive'\nBACKUP_PRIMARY='/mnt/audit-backup-primary'\nDATESTAMP=$(date +%Y%m%d)\nARCHIVE_FILE=\"${ARCHIVE_DIR}/audit_${DATESTSTAMP}.log.gz\"\ngzip -c /var/log/audit/audit.log > \"$ARCHIVE_FILE\"\nsha256sum \"$ARCHIVE_FILE\" > \"${ARCHIVE_FILE}.sha256\"\ncp \"$ARCHIVE_FILE\" \"$BACKUP_PRIMARY/\"\nEOFARCH\nchmod 755 /usr/local/bin/archive-audit-records.sh\necho '[AUDIT] Long-term retrieval configuration complete.'",
        "ansible": "---\n- name: Configure AU-11.1 Long-term Retrieval\n  hosts: all\n  become: true\n  tasks:\n    - name: Create archive directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        owner: root\n        group: root\n        mode: '0700'\n      loop:\n        - '/var/log/audit/archive'\n        - '/mnt/audit-backup-primary'\n        - '/mnt/audit-backup-secondary'\n    - name: Deploy archival script\n      copy:\n        content: '#!/bin/bash\\nARCHIVE_DIR=\"/var/log/audit/archive\"\\nDATESTAMP=$(date +%Y%m%d)\\ngzip -c /var/log/audit/audit.log > \"${ARCHIVE_DIR}/audit_${DATETSTAMP}.log.gz\"'\n        dest: /usr/local/bin/archive-audit-records.sh\n        owner: root\n        group: root\n        mode: '0755'\n    - name: Create cron job for archival\n      cron:\n        name: \"Archive audit records\"\n        minute: \"0\"\n        hour: \"2\"\n        day: \"1\"\n        job: \"/usr/local/bin/archive-audit-records.sh\""
      },
      "windows": {
        "powershell": "Write-Host '[AUDIT] Configuring long-term retrieval...' -ForegroundColor Green\n$archiveDir = 'C:\\\\Audit\\\\Archive'\n$backupPrimaryDir = 'D:\\\\Audit\\\\Backup'\nNew-Item -ItemType Directory -Path $archiveDir -Force | Out-Null\nNew-Item -ItemType Directory -Path $backupPrimaryDir -Force | Out-Null\n$archiveScript = @'\nwevtutil epl Security 'C:\\\\Audit\\\\Archive\\\\Security_'(Get-Date -Format 'yyyyMMdd').'.evtx' /ow:true\n'@\n$archiveScript | Out-File -FilePath 'C:\\\\Windows\\\\System32\\\\Archive-AuditLogs.ps1'\nWrite-Host 'Long-term retrieval configuration complete.' -ForegroundColor Green",
        "ansible": "---\n- name: Configure AU-11.1 on Windows\n  hosts: windows\n  tasks:\n    - name: Create archive directories\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - 'C:\\\\Audit\\\\Archive'\n        - 'D:\\\\Audit\\\\Backup'"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T00:00:00Z",
      "has_scripts": true,
      "script_validation": "PASS"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T00:00:00Z",
      "source": "ComplianceAsCode / NIST SP 800-53 Rev 5",
      "cac_status": "validated",
      "stig_references": [
        "RHEL-08-030000"
      ],
      "implementation_guidance": "Maintain records in standard retrievable formats. Validate archive integrity quarterly. Store copies in geographically separate locations. Document retrieval procedures. Plan 5-year media refresh cycles. Use WORM storage when available for immutability."
    }
  }
]
