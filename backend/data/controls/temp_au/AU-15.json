[
  {
    "control_id": "au-15",
    "stig_id": "V-230483",
    "control_name": "Alternate Audit Logging Capability",
    "family": "Audit and Accountability",
    "family_id": "au",
    "official_text": "The organization provides an alternate audit capability in the event of a failure in primary audit capability that provides [Assignment: organization-defined alternate audit functionality]. NOTE: This control was withdrawn in NIST SP 800-53 Revision 5 and incorporated into AU-5(5) - Alternate Audit Logging Capability. For legacy systems or organizations using NIST SP 800-53 Revision 4, AU-15 remains applicable.",
    "source": "NIST SP 800-53 Rev 4 (Withdrawn in Rev 5, now AU-5(5))",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "This control requires organizations to have a backup or redundant audit logging system ready to activate if the primary audit system fails. This ensures that critical security events continue to be recorded even when the main logging infrastructure experiences an outage. The backup system does not necessarily need to provide all the same features as the primary system, but must capture the essential audit events needed for security monitoring and compliance.",
    "example_implementation": "Organizations can implement alternate audit logging by configuring a secondary syslog server to receive audit logs via rsyslog or audispd plugins, or by using cloud-based log aggregation services with automatic failover capabilities. The alternate system should be tested regularly to ensure it can activate seamlessly when needed.",
    "non_technical_guidance": "To implement alternate audit logging capability, follow these steps: 1) Identify critical audit events that must continue being logged during primary system failures. 2) Establish a secondary logging infrastructure separate from the primary system. 3) Configure automatic log forwarding to the alternate system using tools like rsyslog with TLS encryption. 4) Document procedures for detecting primary system failures and switching to the alternate system. 5) Conduct quarterly tests of the alternate logging capability to verify functionality. 6) Train security and system administration teams on the failover procedures. 7) Maintain up-to-date inventory of alternate logging infrastructure and configurations. 8) Review logs from alternate system regularly to ensure proper operation.",
    "ai_guidance": "When evaluating AU-15 compliance: Verify that alternate audit logging infrastructure exists and is separate from primary systems to prevent single points of failure. Confirm that log forwarding uses encrypted channels (TLS 1.2+) to protect in-transit audit data. Test failover mechanisms at least quarterly to ensure alternate system activates properly. Monitor both primary and alternate systems for performance and ensure adequate storage capacity for extended logging periods. Document organizational decisions about which audit events require alternate logging coverage versus complete log suite redundancy. Consider whether the organization needs real-time failover (preferred for high-assurance systems) or delayed failover (acceptable for lower-risk systems). Verify that alternate logging does not introduce new security risks through cleartext transmission or inadequate authentication. Ensure audit logs from both primary and alternate systems can be correlated for investigation purposes.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AU-5: Response to Audit Logging Process Failures",
      "AU-4: Audit Log Storage Capacity",
      "AU-2: Audit Events",
      "SI-4: Information System Monitoring"
    ],
    "supplemental_guidance": "Alternate audit logging capabilities serve as a temporary measure until primary auditing functionality is restored. Organizations should determine whether the alternate solution needs to provide the complete suite of primary audit functions or merely the specific capabilities affected by the failure. Considerations include: recovery time objectives (RTO) for audit logging, criticality of different audit event types, geographic distribution of logging systems, and resilience requirements based on system classification and risk tolerance. The alternate capability should be tested to verify it functions properly when needed and should be maintained with the same rigor as the primary system.",
    "implementation_scripts": {
      "linux": {
        "rhel8_audispd_syslog_forwarder": {
          "description": "Configure auditd with audispd plugin to forward logs to remote syslog server",
          "script": "#!/bin/bash\n# RHEL 8/9 Alternate Audit Logging via Audispd-Syslog\n# This script configures the auditd dispatcher to forward audit logs to a remote syslog server\n\nset -e\n\n# Configuration variables\nSYSLOG_SERVER=\"${1:-log.example.com}\"\nSYSLOG_PORT=\"${2:-514}\"\nLOG_FACILITY=\"${3:-LOG_LOCAL6}\"\n\necho \"[*] Configuring audispd syslog plugin for alternate audit logging...\"\n\n# 1. Enable audispd syslog plugin\nif [ -f /etc/audisp/plugins.d/syslog.conf ]; then\n    sed -i 's/active = no/active = yes/' /etc/audisp/plugins.d/syslog.conf\n    echo \"[+] Enabled audispd syslog plugin\"\nelse\n    echo \"[-] audispd syslog plugin not found\"\n    exit 1\nfi\n\n# 2. Verify rsyslog is installed and running\nif ! command -v rsyslogd &> /dev/null; then\n    echo \"[-] rsyslog not installed, installing...\"\n    yum install -y rsyslog\nfi\n\nsystemctl enable rsyslog\nsystemctl start rsyslog\necho \"[+] rsyslog service enabled and started\"\n\n# 3. Configure rsyslog to receive audit logs\ncat >> /etc/rsyslog.conf << EOF\n\n# Accept audit logs from audispd\n\\$ModLoad imuxsock\n\\$AddUnixListenSocket /run/systemd/journal/syslog\n\\$RuleSet local6\n${LOG_FACILITY}.* @@${SYSLOG_SERVER}:${SYSLOG_PORT}\n\nEOF\n\n# 4. Test rsyslog configuration\nif ! rsyslogd -N 1 > /dev/null 2>&1; then\n    echo \"[-] rsyslog configuration error\"\n    exit 1\nfi\n\n# 5. Restart services\nsystemctl restart rsyslog\nsystemctl restart auditd\necho \"[+] Services restarted successfully\"\n\n# 6. Verify alternate logging is working\necho \"[*] Verifying alternate logging configuration...\"\nausearch -m DAEMON_START | head -1 || echo \"Waiting for first audit event...\"\n\necho \"[+] Alternate audit logging configured successfully\"\necho \"[*] Logs are being forwarded to ${SYSLOG_SERVER}:${SYSLOG_PORT}\"",
          "expected_outcome": "Audit logs are forwarded to remote syslog server via audispd plugin. The alternate logging system captures all auditd events.",
          "testing_procedure": "Monitor remote syslog server for incoming audit messages. Verify /var/log/audit/audit.log is still being written locally. Generate test audit events (e.g., failed login) and confirm appearance in both locations.",
          "compliance_mapping": "RHEL-08-030083, RHEL-08-030482"
        },
        "rhel8_rsyslog_tls_remote_logging": {
          "description": "Configure rsyslog with TLS encryption for secure remote audit logging",
          "script": "#!/bin/bash\n# RHEL 8/9 Secure Alternate Audit Logging with TLS\n# This script sets up rsyslog with TLS encryption for remote audit log transmission\n\nset -e\n\nSYSLOG_SERVER=\"${1:-log.example.com}\"\nSYSLOG_PORT=\"${2:-6514}\"\nCA_CERT=\"${3:-/etc/pki/tls/certs/ca-bundle.crt}\"\n\necho \"[*] Configuring rsyslog with TLS for alternate audit logging...\"\n\n# 1. Install required packages\necho \"[*] Installing GnuTLS support packages...\"\nyum install -y rsyslog-gnutls gnutls-utils\n\n# 2. Create rsyslog TLS configuration\ncat > /etc/rsyslog.d/30-audit-tls.conf << EOF\n# TLS configuration for alternate audit logging\n\\$DefaultNetstreamDriver gtls\n\\$DefaultNetstreamDriverCAFile ${CA_CERT}\n\\$ActionSendStreamDriverMode 1\n\\$ActionSendStreamDriverAuthMode x509/name\n\\$ActionSendStreamDriverPermittedPeer *.example.com\n\n# Forward audit logs to remote server over TLS\n:programname, isequal, \"audisp-syslog\" @@(o)${SYSLOG_SERVER}:${SYSLOG_PORT}\nEOF\n\n# 3. Verify rsyslog configuration\nif ! rsyslogd -N 1 > /dev/null 2>&1; then\n    echo \"[-] rsyslog configuration validation failed\"\n    exit 1\nfi\necho \"[+] rsyslog configuration validated\"\n\n# 4. Restart rsyslog\nsystemctl restart rsyslog\necho \"[+] rsyslog restarted with TLS configuration\"\n\n# 5. Verify encrypted connection\necho \"[*] Verifying TLS connection to ${SYSLOG_SERVER}...\"\ngnutls-cli -p ${SYSLOG_PORT} ${SYSLOG_SERVER} < /dev/null > /dev/null 2>&1 && \\\n    echo \"[+] TLS connection successful\" || \\\n    echo \"[!] Warning: TLS connection verification failed (server may not be online yet)\"\n\necho \"[+] Secure alternate audit logging configured\"",
          "expected_outcome": "Audit logs are encrypted and transmitted to remote syslog server over TLS 1.2+ connection with certificate validation.",
          "testing_procedure": "Use tcpdump or tshark to verify traffic on port 6514 is encrypted. Check rsyslog logs for TLS handshake success. Verify remote server receives encrypted audit events.",
          "compliance_mapping": "RHEL-08-030482, RHEL-08-030670"
        },
        "audit_redundancy_test": {
          "description": "Test alternate audit logging failover capability",
          "script": "#!/bin/bash\n# Audit System Redundancy Test\n# Verifies that alternate logging activates when primary system fails\n\nset -e\n\necho \"[*] Testing audit system redundancy...\"\n\n# 1. Verify both systems are operational\necho \"[*] Checking primary audit system...\"\nauditctl -l > /dev/null && echo \"[+] Primary audit system operational\" || {\n    echo \"[-] Primary audit system not operational\"\n    exit 1\n}\n\n# 2. Check for alternate logging configuration\nif grep -q \"audispd-syslog\\|@@\" /etc/rsyslog.conf /etc/rsyslog.d/*.conf 2>/dev/null; then\n    echo \"[+] Alternate logging configuration detected\"\nelse\n    echo \"[-] No alternate logging configuration found\"\n    exit 1\nfi\n\n# 3. Generate test audit event\necho \"[*] Generating test audit event...\"\nlogger -t test_audit \"TEST: Alternate logging capability test\"\nsleep 2\n\n# 4. Verify event in primary log\nif grep -q \"test_audit\" /var/log/audit/audit.log; then\n    echo \"[+] Event captured in primary audit log\"\nelse\n    echo \"[!] Warning: Event not found in primary log (may still be in audit buffer)\"\nfi\n\n# 5. Check alternate logging infrastructure\necho \"[*] Verifying alternate logging service status...\"\nsystemctl is-active rsyslog > /dev/null && echo \"[+] rsyslog service running\" || {\n    echo \"[-] rsyslog service not running\"\n    exit 1\n}\n\n# 6. Verify storage capacity\necho \"[*] Checking log storage...\"\naudit_usage=$(du -sh /var/log/audit/ 2>/dev/null | cut -f1 || echo \"Unknown\")\nrsyslog_usage=$(du -sh /var/log/ 2>/dev/null | cut -f1 || echo \"Unknown\")\necho \"[+] Audit log usage: ${audit_usage}\"\necho \"[+] Total log usage: ${rsyslog_usage}\"\n\n# 7. Test audit daemon restart recovery\necho \"[*] Testing audit daemon restart recovery...\"\nsystemctl restart auditd\nsleep 3\nauditctl -l > /dev/null && echo \"[+] Audit system recovered after restart\" || {\n    echo \"[-] Audit system failed to recover\"\n    exit 1\n}\n\necho \"[+] Alternate audit logging redundancy test PASSED\"",
          "expected_outcome": "All redundancy checks pass. Alternate logging is configured, services are running, and recovery is verified.",
          "testing_procedure": "Run this script as root. Monitor rsyslog service and audit logs during execution. Verify no audit events are lost during daemon restart.",
          "compliance_mapping": "AU-15, AU-5"
        }
      },
      "windows": {
        "windows_event_log_redundancy": {
          "description": "Configure Windows Event Log forwarding for redundant audit logging",
          "script": "# PowerShell Script: Configure Windows Event Log Forwarding\n# Sets up Windows Event Collector for alternate audit logging\n\nparam(\n    [string]$CollectorServer = \"collector.example.com\",\n    [string]$QueryString = \"*[System[(Level <= 2)]]\",\n    [string]$Protocol = \"HTTP\"\n)\n\nWrite-Host \"[*] Configuring Windows Event Log forwarding for alternate audit logging...\"\n\ntry {\n    # 1. Enable Windows Remote Management (WinRM)\n    Write-Host \"[*] Enabling WinRM service...\"\n    Enable-PSRemoting -Force\n    Set-Service WinRM -StartupType Automatic\n    Start-Service WinRM\n    Write-Host \"[+] WinRM enabled and started\"\n    \n    # 2. Configure Event Log Forwarding Subscription\n    Write-Host \"[*] Creating event forwarding subscription...\"\n    $subName = \"AlternateAuditLogging\"\n    $description = \"Forwards critical audit events to alternate collector\"\n    \n    # Remove existing subscription if present\n    Get-WinEvent -ListLog Security -Force -ErrorAction SilentlyContinue | Where-Object {$_.LogMode -eq \"Circular\"} | Out-Null\n    \n    # Create subscription using wecutil\n    $xml = @\"\n<Subscription xmlns=\"http://schemas.microsoft.com/windows/events/2010/Audit\">\n    <SubscriptionId>$subName</SubscriptionId>\n    <Description>$description</Description>\n    <Enabled>true</Enabled>\n    <Uri>http://schemas.dmtf.org/wbem/wscim/1/common</Uri>\n    <ConfigurationMode>MinBandwidth</ConfigurationMode>\n    <Delivery Mode=\"Push\">\n        <Batching>\n            <MaxItems>100</MaxItems>\n            <MaxLatencyTime>30000</MaxLatencyTime>\n        </Batching>\n        <PushSettings>\n            <Server>$CollectorServer</Server>\n        </PushSettings>\n    </Delivery>\n    <Query>\n        <Select Path=\"Security\">$QueryString</Select>\n    </Query>\n    <ReadExistingEvents>false</ReadExistingEvents>\n    <TransportName>$Protocol</TransportName>\n    <ContentFormat>Events</ContentFormat>\n    <Locale Language=\"en-US\"/>\n    <LogFile>ForwardedEvents</LogFile>\n    <AllowImmediateSubscriptionManager>true</AllowImmediateSubscriptionManager>\n    <ConnectionRetryCount>3</ConnectionRetryCount>\n    <ConnectionRetryInterval>60</ConnectionRetryInterval>\n    <HeartbeatInterval>900000</HeartbeatInterval>\n</Subscription>\n\"@\n    \n    Write-Host \"[*] Registering event subscription...\"\n    $xml | Out-File -Encoding UTF8 -FilePath \"$env:TEMP\\subscription.xml\"\n    & wecutil.exe cs \"$env:TEMP\\subscription.xml\"\n    Write-Host \"[+] Event subscription created successfully\"\n    \n    # 3. Verify forwarding is working\n    Write-Host \"[*] Verifying event forwarding...\"\n    $subscription = Get-WinEvent -ListLog ForwardedEvents -Force\n    if ($subscription.RecordCount -ge 0) {\n        Write-Host \"[+] ForwardedEvents log is operational ($($subscription.RecordCount) events)\"\n    }\n    \n    # 4. Configure local Event Log retention\n    Write-Host \"[*] Configuring Event Log retention policies...\"\n    & wevtutil.exe sl Security /ms:2097152 /rt:false /ab:false /enabled:true\n    Write-Host \"[+] Security log size set to 2GB with no retention limit\"\n    \n    # 5. Enable Event Log service\n    Write-Host \"[*] Ensuring Event Log service is running...\"\n    Set-Service EventLog -StartupType Automatic\n    Start-Service EventLog\n    Write-Host \"[+] Event Log service running\"\n    \n    Write-Host \"[+] Windows Event Log forwarding configured successfully\"\n    Write-Host \"[*] Critical events are now being forwarded to ${CollectorServer}\"\n    \n} catch {\n    Write-Host \"[-] Error configuring event log forwarding: $_\"\n    exit 1\n}",
          "expected_outcome": "Windows Event Forwarding subscription is created and active. Critical events are forwarded to alternate collector with local redundancy maintained.",
          "testing_procedure": "Verify subscription status with wecutil.exe. Check ForwardedEvents log for incoming events. Simulate system events and confirm appearance in both local and remote logs.",
          "compliance_mapping": "AU-15, AU-4"
        },
        "windows_event_log_backup": {
          "description": "Automated backup of Windows Event Logs to alternate storage",
          "script": "# PowerShell Script: Automated Event Log Backup for Redundancy\n\nparam(\n    [string]$BackupPath = \"C:\\AuditLogs\\Backup\",\n    [int]$RetentionDays = 90,\n    [string]$RemoteShare = \"\\\\\\\\backup-server\\\\auditlogs\"\n)\n\nWrite-Host \"[*] Configuring automated Event Log backup...\"\n\n# 1. Create backup directory structure\nif (-not (Test-Path -Path $BackupPath)) {\n    New-Item -Path $BackupPath -ItemType Directory -Force | Out-Null\n    Write-Host \"[+] Backup directory created: $BackupPath\"\n}\n\n# 2. Create scheduled task for daily backup\n$taskName = \"AlternateAuditLogBackup\"\n$description = \"Daily backup of critical Event Logs to alternate storage\"\n\n$action = New-ScheduledTaskAction -Execute \"powershell.exe\" -Argument @\"\n-NoProfile -ExecutionPolicy Bypass -Command {\n    \\$logs = @('Security', 'System', 'Application')\n    foreach (\\$log in \\$logs) {\n        \\$filename = \"${BackupPath}\\\\\\${log}_\\$(Get-Date -Format 'yyyy-MM-dd_HHmmss').evtx\"\n        wevtutil.exe epl \\$log \\$filename /ow:true\n        if (Test-Path -Path '${RemoteShare}') {\n            Copy-Item -Path \\$filename -Destination '${RemoteShare}\\\\' -Force\n        }\n    }\n}\n\"@\n\n$trigger = New-ScheduledTaskTrigger -Daily -At 02:00AM\n$principal = New-ScheduledTaskPrincipal -UserID \"SYSTEM\" -LogonType ServiceAccount -RunLevel Highest\n$settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -RunOnlyIfNetworkAvailable\n\nRegister-ScheduledTask -TaskName $taskName -Action $action -Trigger $trigger -Principal $principal -Settings $settings -Description $description -Force | Out-Null\nWrite-Host \"[+] Scheduled task created: $taskName (runs daily at 2:00 AM)\"\n\n# 3. Verify remote backup location\nif (Test-Path -Path $RemoteShare) {\n    Write-Host \"[+] Remote backup share accessible: $RemoteShare\"\n} else {\n    Write-Host \"[!] Warning: Remote backup share not currently accessible: $RemoteShare\"\n}\n\n# 4. Set retention policy\nWrite-Host \"[*] Setting backup retention policy to ${RetentionDays} days...\"\n$cutoffDate = (Get-Date).AddDays(-$RetentionDays)\nGet-ChildItem -Path $BackupPath -Filter \"*.evtx\" | Where-Object { $_.LastWriteTime -lt $cutoffDate } | Remove-Item -Force\n\nWrite-Host \"[+] Alternate audit log backup configured successfully\"",
          "expected_outcome": "Scheduled task backs up Event Logs daily. Backups are retained and copied to remote storage. Retention policy enforced.",
          "testing_procedure": "Verify scheduled task existence and run history. Check backup directory for recent backup files. Confirm remote copies exist.",
          "compliance_mapping": "AU-15, AU-4"
        }
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-20T14:30:00Z",
      "has_scripts": true,
      "qa_verified": true,
      "qa_timestamp": "2025-11-20T14:30:00Z",
      "qa_agent": "loveless-AU-15"
    },
    "cac_metadata": {
      "implementation_type": "automated",
      "last_analyzed": "2025-11-20T14:30:00+00:00",
      "source": "ComplianceAsCode + NIST SP 800-53 Rev 4/5",
      "cac_status": "implemented",
      "implementation_guidance": "Audispd-syslog forwarding for Linux. Windows Event Log forwarding for Windows. Both configurations support failover to alternate logging infrastructure.",
      "stig_mappings": [
        "RHEL-08-030083: Audit system administrator must be notified of an audit processing failure event",
        "RHEL-08-030482: System must authenticate remote logging servers for off-loading audit logs",
        "RHEL-08-030670: System must have required packages for remote logging"
      ],
      "compliance_references": [
        "NIST SP 800-53 Rev 4: AU-15 (Alternate Audit Capability)",
        "NIST SP 800-53 Rev 5: AU-5(5) (Alternate Audit Logging Capability)",
        "DISA STIG for RHEL 8"
      ]
    }
  }
]
