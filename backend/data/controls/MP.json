[
  {
    "control_id": "MP-1",
    "control_name": "Policy and Procedures",
    "family": "Media Protection",
    "family_id": "MP",
    "stig_id": null,
    "official_text": "a. Develop, document, and disseminate to [Assignment: organization-defined personnel or roles]:\n  1. [Selection (one or more): Organization-level; Mission/business process-level; System-level] media protection policy that:\n    (a) Addresses purpose, scope, roles, responsibilities, management commitment, coordination among organizational entities, and compliance; and\n    (b) Is consistent with applicable laws, executive orders, directives, regulations, policies, standards, and guidelines; and\n  2. Procedures to facilitate the implementation of the media protection policy and the associated media protection controls;\nb. Designate an [Assignment: organization-defined official] to manage the development, documentation, and dissemination of the media protection policy and procedures; and\nc. Review and update the current media protection:\n  1. Policy [Assignment: organization-defined frequency] and following [Assignment: organization-defined events]; and\n  2. Procedures [Assignment: organization-defined frequency] and following [Assignment: organization-defined events].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Establish comprehensive governance for media protection by requiring documented policies and procedures that define how organizational media (both digital and non-digital) is controlled, accessed, marked, stored, transported, sanitized, and disposed of throughout its lifecycle.",
    "plain_english_explanation": "Organizations must create, document, and share media protection policies and procedures with designated staff. Media protection encompasses all forms of information storage media including digital media (hard drives, USB drives, CDs, DVDs, flash drives, magnetic tapes) and non-digital media (paper documents, microfilm, microfiche). The policy must define who can access different types of media, how media is marked to indicate sensitivity levels, secure storage requirements, transportation procedures, sanitization methods before disposal or reuse, and media destruction processes. A designated official must manage these policies, review them regularly, and update them when significant events occur such as security incidents, audit findings, or regulatory changes. This control establishes the foundation for all other controls in the Media Protection (MP) family.",
    "example_implementation": "Develop a comprehensive Media Protection Policy document that outlines organizational commitment to protecting sensitive information stored on all media types. The policy should define media classification categories aligned with data sensitivity levels, establish access authorization requirements, specify marking and labeling standards, detail secure storage procedures for different media types, describe approved sanitization methods (clearing, purging, destruction), and document chain-of-custody requirements for media transport. Assign the Chief Information Security Officer (CISO) or designated official to manage policy development and updates. Establish procedures for media inventory management, access control verification, and regular policy effectiveness reviews.",
    "non_technical_guidance": "To comply with MP-1, follow these organizational steps:\n\n1. Draft a Media Protection Policy that clearly states the organization's commitment to protecting information on all media types (digital and non-digital), defines scope to include all organizational systems and information, and assigns specific roles and responsibilities for media protection oversight.\n\n2. Designate an official (CISO, Information Security Manager, or equivalent) responsible for developing, maintaining, and distributing the media protection policy and procedures.\n\n3. Document procedures that support the policy, including: media access authorization processes, marking and labeling standards aligned with data classification, secure storage requirements for different media types and sensitivity levels, transportation procedures including chain-of-custody documentation, sanitization procedures following NIST SP 800-88 guidelines, and destruction methods for different media types.\n\n4. Ensure the policy addresses applicable federal laws (FISMA), executive orders, regulations (FedRAMP, HIPAA where applicable), and organizational standards.\n\n5. Establish review cycles: review and update the policy at least annually and after significant events such as security breaches, regulatory changes, technology updates, or audit findings.\n\n6. Distribute the policy to all relevant personnel including IT operations staff, records management personnel, facilities management, and contractors who handle organizational media.\n\n7. Maintain records of policy versions, distribution dates, personnel acknowledgments, and review cycles for audit purposes.\n\n8. Integrate media protection policy with related organizational policies for physical security (PE family), access control (AC family), personnel security (PS family), and system integrity (SI family) to ensure comprehensive security coverage.\n\n9. Define procedures for handling media containing different classification levels including Controlled Unclassified Information (CUI) in accordance with 32 CFR Part 2002.\n\n10. Establish training requirements to ensure all personnel understand media handling, marking, storage, and disposal procedures appropriate to their roles.",
    "ai_guidance": "MP-1 establishes the foundational governance for all media protection activities across the organization. Implementation should prioritize clear documentation of roles (who authorizes media access, who performs sanitization, who handles classified media), scope (all digital and non-digital media containing organizational information), and review frequency (minimum annual, triggered by incidents, audits, or regulatory changes). The policy must align with applicable laws and organizational mission while addressing coordination with related security controls in the Physical and Environmental Protection (PE), Access Control (AC), and System and Communications Protection (SC) families. Procedures should cover media access authorization workflows, marking and labeling standards based on data classification, secure storage requirements by media type and sensitivity level, transportation and chain-of-custody procedures, and sanitization methods following NIST SP 800-88 (Guidelines for Media Sanitization). For digital media, the policy should reference technical controls that support media protection including encryption requirements (SC-28), access controls (AC-3), and audit logging (AU-2). This is purely organizational - no technical automation exists for implementing the policy itself. Focus on creating comprehensive documentation that establishes accountability, provides clear guidance for all media handling scenarios, and ensures compliance with federal requirements for protecting Controlled Unclassified Information.",
    "implementation_guidance": "This is an organizational policy control that requires governance and documentation rather than technical implementation. Organizations should develop a formal Media Protection Policy document using a standard policy template that includes sections for purpose, scope, roles, responsibilities, compliance requirements, and references to related policies. The policy should be approved by senior management and integrated into the organization's overall security program. Procedures should be detailed enough to guide media protection activities across all organizational systems while remaining flexible enough to accommodate different media types, risk levels, and handling scenarios. The designated official should have sufficient authority and resources to enforce policy compliance. Regular reviews should include feedback from IT operations, records management, security personnel, compliance officers, and facilities management to ensure the policy remains relevant and effective.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "PM-9",
      "PS-8",
      "SI-12",
      "MP-2",
      "MP-3",
      "MP-4",
      "MP-5",
      "MP-6",
      "MP-7",
      "MP-8",
      "AC-1",
      "AC-3",
      "AC-19",
      "PE-3",
      "PE-16",
      "SC-28"
    ],
    "supplemental_guidance": "Media protection policy and procedures address the controls in the MP family that are implemented within systems and organizations. The risk management strategy is an important factor in establishing such policies and procedures. Policies and procedures contribute to security and privacy assurance. Therefore, it is important that security and privacy programs collaborate on the development of media protection policy and procedures. Security and privacy program policies and procedures at the organization level are preferable, in general, and may obviate the need for mission- or system-specific policies and procedures. The policy can be included as part of the general security and privacy policy or be represented by multiple policies reflecting the complex nature of organizations. Procedures can be established for security and privacy programs, for mission or business processes, and for systems, if needed. Procedures describe how the policies or controls are implemented and can be directed at the individual or role that is the object of the procedure. Procedures can be documented in system security and privacy plans or in one or more separate documents. Events that may precipitate an update to media protection policy and procedures include assessment or audit findings, security incidents or breaches, or changes in applicable laws, executive orders, directives, regulations, policies, standards, and guidelines. Simply restating controls does not constitute an organizational policy or procedure.",
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null,
        "ansible": null
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "MP-1 is an organizational policy control that requires documented policies and procedures for media protection programs. This control cannot be automated through technical means (SCAP, Ansible, Bash scripts) as it addresses governance, documentation, and organizational processes rather than system configurations. Organizations must manually create policy documents, assign responsible officials, establish review procedures, and maintain documentation in accordance with applicable laws and regulations. No STIG mappings exist for this control as it is purely procedural."
    },
    "nist_csf_mappings": {
      "v1.1": [
        "ID.GV-1",
        "ID.GV-3",
        "PR.DS-1",
        "PR.DS-2",
        "PR.DS-3"
      ],
      "v2.0": [
        "GV.OC-03",
        "GV.PO-01",
        "GV.PO-02",
        "PR.DS-01",
        "PR.DS-02"
      ]
    },
    "nist_sp_800_171_mapping": "03.08.01"
  },
  {
    "control_id": "MP-2",
    "control_name": "Media Access",
    "family": "Media Protection",
    "family_id": "MP",
    "stig_id": null,
    "official_text": "Restrict access to [Assignment: organization-defined types of digital and/or non-digital media] to [Assignment: organization-defined personnel or roles].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Ensure that only authorized personnel can access organizational media containing sensitive information, preventing unauthorized disclosure, modification, or destruction of information stored on both digital and non-digital media.",
    "plain_english_explanation": "Organizations must restrict who can access media containing organizational information. This applies to both digital media (USB flash drives, external hard drives, CDs, DVDs, magnetic tapes, solid-state drives, memory cards) and non-digital media (paper documents, microfilm, microfiche, printed reports). Access restrictions should be based on job responsibilities, security clearance levels, and need-to-know requirements. For example, only authorized healthcare providers should access patient medical records stored on paper or electronic media, and only development team members should access design specifications stored on compact discs. Organizations must define which types of media require access restrictions and which personnel or roles are authorized to access each media type. This control addresses physical access to media storage locations as well as logical access to digital media content.",
    "example_implementation": "Implement role-based access controls for media storage areas and content. Establish a media library or secure storage area with access limited to authorized personnel through badge readers, combination locks, or key controls. Maintain access logs for media storage locations. For digital media, implement filesystem permissions and encryption to prevent unauthorized access. Create and maintain an authorized access list specifying which personnel or roles can access different media types based on data classification. Regularly review and update access authorizations when personnel change roles or leave the organization.",
    "non_technical_guidance": "To comply with MP-2, follow these steps:\n\n1. Inventory all organizational media types including digital media (USB drives, external hard drives, backup tapes, CDs/DVDs, removable storage) and non-digital media (paper documents, printed reports, microfilm).\n\n2. Classify media based on the sensitivity of information contained (e.g., public, internal use, confidential, restricted, classified).\n\n3. Define authorized personnel or roles for each media type and classification level based on job responsibilities, security clearance, and need-to-know requirements.\n\n4. Implement physical access controls for media storage locations including locked cabinets, safes, secure rooms, or media libraries with controlled entry.\n\n5. Establish sign-in/sign-out procedures for removable media to maintain chain of custody and accountability.\n\n6. Document media access policies and communicate them to all personnel who may handle organizational media.\n\n7. Implement logical access controls for digital media including filesystem permissions, access control lists, and encryption for sensitive content.\n\n8. Conduct regular access reviews to verify that only currently authorized personnel have access to sensitive media.\n\n9. Revoke media access promptly when personnel change roles, transfer, or separate from the organization.\n\n10. Maintain audit logs of media access for accountability and forensic purposes.\n\n11. Train personnel on media access procedures and their responsibilities for protecting organizational information.\n\n12. Consider additional protections for highly sensitive media such as dual-person access requirements or time-limited access authorizations.",
    "ai_guidance": "MP-2 focuses on restricting access to organizational media to authorized personnel only. Implementation requires defining which media types exist in the organization (digital: USB drives, external drives, optical media, tapes; non-digital: paper, microfilm), determining who needs access to each type based on job function and security requirements, and implementing both physical and logical access controls. Physical controls include secure storage areas (locked cabinets, media libraries, secure rooms) with access limited to authorized personnel through keys, combination locks, or badge readers. Logical controls include filesystem permissions, encryption, and access control lists for digital media. Organizations should maintain access authorization records, implement sign-out procedures for portable media, conduct regular access reviews, and promptly revoke access when no longer needed. This control coordinates with PE-3 (Physical Access Control) for physical media storage, AC-3 (Access Enforcement) for logical access to digital media content, and MP-4 (Media Storage) for secure storage requirements. No direct STIG automation exists for the base MP-2 control as it primarily addresses organizational access management rather than specific technical configurations, though related technical controls (AC-3, AC-6) provide supporting automation.",
    "implementation_guidance": "This control requires both organizational procedures and supporting technical controls. Organizations should establish a media access control program that includes: (1) inventory of all organizational media by type and classification, (2) defined access authorizations based on roles and need-to-know, (3) physical security measures for media storage locations, (4) logical access controls for digital media content, (5) sign-out procedures and tracking for portable media, (6) regular access reviews and re-authorization, and (7) prompt access revocation processes. While the base control is primarily organizational, technical controls support implementation including filesystem permissions (AC-3), encryption (SC-28), and audit logging (AU-2). Coordinate with Physical Access Control (PE-3) for secure storage areas.",
    "is_technical": false,
    "enhancements": [
      {
        "id": "MP-2.1",
        "title": "Automated Restricted Access",
        "status": "withdrawn",
        "withdrawal_note": "Incorporated into MP-4(2)"
      },
      {
        "id": "MP-2.2",
        "title": "Cryptographic Protection",
        "status": "withdrawn",
        "withdrawal_note": "Incorporated into SC-28(1)"
      }
    ],
    "related_controls": [
      "AC-3",
      "AC-6",
      "AC-19",
      "AU-9",
      "CP-2",
      "CP-9",
      "CP-10",
      "MA-5",
      "MP-4",
      "MP-6",
      "PE-2",
      "PE-3",
      "SC-12",
      "SC-13",
      "SC-28",
      "SC-34",
      "SI-12"
    ],
    "supplemental_guidance": "System media includes digital and non-digital media. Digital media includes flash drives, diskettes, magnetic tapes, external or removable hard disk drives (e.g., solid state, magnetic), compact discs, and digital versatile discs. Non-digital media includes paper and microfilm. Denying access to patient medical records in a community hospital unless the individuals seeking access to such records are authorized healthcare providers is an example of restricting access to non-digital media. Limiting access to the design specifications stored on compact discs in the media library to individuals on the system development team is an example of restricting access to digital media.",
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null,
        "ansible": null
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "MP-2 is primarily an organizational control requiring access management procedures for media. While no direct STIG automation exists for the base control, supporting technical controls include filesystem permissions, encryption, and audit logging. Note that enhancements MP-2(1) and MP-2(2) have been WITHDRAWN in NIST 800-53 Rev 5 and incorporated into MP-4(2) and SC-28(1) respectively."
    },
    "nist_csf_mappings": {
      "v1.1": [
        "PR.AC-1",
        "PR.AC-2",
        "PR.AC-4",
        "PR.DS-1",
        "PR.DS-5"
      ],
      "v2.0": [
        "PR.AA-01",
        "PR.AA-02",
        "PR.DS-01",
        "PR.DS-02"
      ]
    },
    "nist_sp_800_171_mapping": "03.08.02",
    "references": [
      "OMB A-130",
      "FIPS 199",
      "NIST SP 800-111"
    ]
  },
  {
    "control_id": "MP-2.1",
    "control_name": "Automated Restricted Access",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-2",
    "stig_id": null,
    "official_text": "[Withdrawn: Incorporated into MP-4(2)].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement has been withdrawn in NIST 800-53 Rev 5. Its requirements for automated mechanisms to restrict access to media storage areas and log access attempts have been incorporated into MP-4(2) Media Storage - Automated Restricted Access.",
    "plain_english_explanation": "IMPORTANT: This control enhancement has been WITHDRAWN in NIST SP 800-53 Revision 5. Organizations should NOT implement this enhancement separately. Instead, the functionality previously covered by MP-2(1) - using automated mechanisms to restrict access to media storage areas and maintain access logs - is now addressed by MP-4(2) Media Storage - Automated Restricted Access. If your organization requires automated access control for media storage areas, implement MP-4(2) instead. Legacy systems or documentation referencing MP-2(1) should be updated to reference MP-4(2).",
    "example_implementation": "N/A - This enhancement has been withdrawn. See MP-4(2) for implementation guidance on automated restricted access to media storage areas.",
    "non_technical_guidance": "N/A - This control enhancement has been withdrawn in NIST 800-53 Revision 5 and incorporated into MP-4(2). Organizations should:\n\n1. Update security plans and documentation to remove references to MP-2(1)\n2. Map any existing MP-2(1) implementations to MP-4(2)\n3. For new implementations requiring automated media storage access controls, implement MP-4(2) instead\n4. Ensure assessment procedures reference MP-4(2) rather than this withdrawn enhancement",
    "ai_guidance": "MP-2(1) has been WITHDRAWN in NIST SP 800-53 Revision 5 and its requirements incorporated into MP-4(2) Media Storage - Automated Restricted Access. Organizations should not implement this enhancement separately. The original intent was to require automated mechanisms to restrict access to media storage areas and log access attempts. This functionality is now covered under MP-4(2). When reviewing existing implementations or updating documentation, map any MP-2(1) references to MP-4(2). For compliance assessments, do not assess against MP-2(1) as it is no longer a valid control enhancement.",
    "implementation_guidance": "This enhancement has been withdrawn. Implement MP-4(2) for automated restricted access to media storage areas.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-4",
      "MP-4.2"
    ],
    "supplemental_guidance": "This control enhancement was withdrawn in NIST SP 800-53 Revision 5. The requirements for automated mechanisms to restrict access to media storage areas have been consolidated into MP-4(2) to eliminate redundancy and improve control organization. Organizations using previous versions of NIST 800-53 should update their implementations to reference MP-4(2).",
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null,
        "ansible": null
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false,
      "implementation_type": "withdrawn",
      "withdrawal_version": "NIST SP 800-53 Rev 5",
      "incorporated_into": "MP-4(2)"
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This enhancement has been WITHDRAWN in NIST 800-53 Rev 5. Its requirements have been incorporated into MP-4(2). No implementation is required for this enhancement. Update documentation to reference MP-4(2) instead."
    }
  },
  {
    "control_id": "MP-2.2",
    "control_name": "Cryptographic Protection",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-2",
    "stig_id": null,
    "official_text": "[Withdrawn: Incorporated into SC-28(1)].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement has been withdrawn in NIST 800-53 Rev 5. Its requirements for cryptographic mechanisms to protect information on digital media have been incorporated into SC-28(1) Protection of Information at Rest - Cryptographic Protection.",
    "plain_english_explanation": "IMPORTANT: This control enhancement has been WITHDRAWN in NIST SP 800-53 Revision 5. Organizations should NOT implement this enhancement separately. Instead, the functionality previously covered by MP-2(2) - using cryptographic mechanisms to protect information stored on digital media - is now addressed by SC-28(1) Protection of Information at Rest - Cryptographic Protection. If your organization requires encryption of information on digital media, implement SC-28(1) instead. Legacy systems or documentation referencing MP-2(2) should be updated to reference SC-28(1). This consolidation reflects the broader scope of SC-28(1) which addresses cryptographic protection for all information at rest, not just media.",
    "example_implementation": "N/A - This enhancement has been withdrawn. See SC-28(1) for implementation guidance on cryptographic protection of information at rest, including information stored on digital media.",
    "non_technical_guidance": "N/A - This control enhancement has been withdrawn in NIST 800-53 Revision 5 and incorporated into SC-28(1). Organizations should:\n\n1. Update security plans and documentation to remove references to MP-2(2)\n2. Map any existing MP-2(2) implementations to SC-28(1)\n3. For new implementations requiring cryptographic protection of media, implement SC-28(1) instead\n4. Ensure assessment procedures reference SC-28(1) rather than this withdrawn enhancement\n5. Note that SC-28(1) has broader scope covering all information at rest, providing more comprehensive protection",
    "ai_guidance": "MP-2(2) has been WITHDRAWN in NIST SP 800-53 Revision 5 and its requirements incorporated into SC-28(1) Protection of Information at Rest - Cryptographic Protection. Organizations should not implement this enhancement separately. The original intent was to require cryptographic mechanisms to protect and restrict access to information on digital media. This functionality is now covered under SC-28(1), which provides broader protection for all information at rest. When reviewing existing implementations or updating documentation, map any MP-2(2) references to SC-28(1). For compliance assessments, do not assess against MP-2(2) as it is no longer a valid control enhancement. SC-28(1) implementations should use FIPS 140-validated cryptographic modules.",
    "implementation_guidance": "This enhancement has been withdrawn. Implement SC-28(1) for cryptographic protection of information at rest, including information stored on digital media. SC-28(1) provides comprehensive coverage using FIPS 140-validated cryptographic modules.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "SC-28",
      "SC-28.1",
      "SC-12",
      "SC-13"
    ],
    "supplemental_guidance": "This control enhancement was withdrawn in NIST SP 800-53 Revision 5. The requirements for cryptographic protection of information on digital media have been consolidated into SC-28(1) Protection of Information at Rest - Cryptographic Protection. This consolidation eliminates redundancy and provides more comprehensive coverage, as SC-28(1) addresses cryptographic protection for all information at rest, not just information on media. Organizations using previous versions of NIST 800-53 should update their implementations to reference SC-28(1).",
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null,
        "ansible": null
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false,
      "implementation_type": "withdrawn",
      "withdrawal_version": "NIST SP 800-53 Rev 5",
      "incorporated_into": "SC-28(1)"
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This enhancement has been WITHDRAWN in NIST 800-53 Rev 5. Its requirements have been incorporated into SC-28(1). No implementation is required for this enhancement. Update documentation to reference SC-28(1) instead."
    }
  },
  {
    "control_id": "MP-3",
    "control_name": "Media Marking",
    "family": "Media Protection",
    "family_id": "MP",
    "stig_id": null,
    "official_text": "a. Mark system media indicating the distribution limitations, handling caveats, and applicable security markings (if any) of the information; and\nb. Exempt [Assignment: organization-defined types of system media] from marking if the media remain within [Assignment: organization-defined controlled areas].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": true,
      "high": true
    },
    "intent": "Ensure that media containing organizational information is properly marked to indicate its sensitivity level, distribution limitations, and handling requirements, enabling personnel to apply appropriate protection measures throughout the media lifecycle.",
    "plain_english_explanation": "Organizations must mark system media to indicate the sensitivity and handling requirements of the information it contains. Media marking involves applying visible labels, stamps, or other indicators that communicate distribution limitations (who can receive the media), handling caveats (special instructions for storage, transport, or use), and security markings (classification levels, CUI designations, or other sensitivity indicators). This applies to both digital media (USB drives, external hard drives, CDs, DVDs, backup tapes) and non-digital media (paper documents, microfilm, printed reports). Organizations can exempt certain media types from marking requirements if the media remain within defined controlled areas where physical and logical access controls already restrict access to authorized personnel. For example, server hard drives that never leave a secure data center may be exempt, while removable media that could leave the facility must be marked. Media marking enables proper handling by ensuring anyone who encounters the media understands the level of protection required.",
    "example_implementation": "Establish a media marking program aligned with the organization's data classification scheme. Create standardized labels for different sensitivity levels (e.g., Public, Internal Use Only, Confidential, Restricted) that include distribution limitations and handling instructions. For digital media, apply physical labels to the media surface and maintain corresponding electronic records. For paper documents, apply header/footer markings on each page. Use color-coded labels for quick visual identification of sensitivity levels. Maintain a marking exemption list for media types that remain within controlled areas such as internal server storage and network-attached storage in secured data centers. Train personnel on marking requirements and provide readily available marking supplies in work areas.",
    "non_technical_guidance": "To comply with MP-3, follow these steps:\n\n1. Define a media marking standard aligned with your organization's data classification policy. Include marking formats for different sensitivity levels such as PUBLIC, CUI, CONFIDENTIAL, RESTRICTED, or classification levels for classified systems.\n\n2. Establish marking requirements that indicate:\n   - Distribution limitations (e.g., 'Internal Use Only', 'Do Not Distribute', 'Authorized Recipients Only')\n   - Handling caveats (e.g., 'Encrypt Before Transport', 'Destroy By Shredding', 'Store in Approved Container')\n   - Security markings (e.g., CUI categories, classification levels, dissemination controls)\n\n3. Develop marking procedures for different media types:\n   - Digital media: Apply durable labels to USB drives, external drives, optical discs, and backup tapes\n   - Paper documents: Apply header/footer markings, stamps, or cover sheets\n   - Electronic files: Include classification banners or metadata where technically feasible\n\n4. Create a marking exemption policy that defines:\n   - Which media types may be exempt from marking (e.g., internal server storage, SAN/NAS in data centers)\n   - The controlled areas where exempt media must remain (e.g., Tier III data center, SCIF)\n   - Conditions that trigger marking requirements (e.g., media removal from controlled area)\n\n5. Provide marking supplies (labels, stamps, markers) and templates in work areas where media is created or handled.\n\n6. Train personnel on marking requirements, including:\n   - How to determine appropriate markings based on content sensitivity\n   - Proper marking application techniques\n   - Responsibilities when encountering unmarked media\n   - Procedures for media leaving controlled areas\n\n7. Implement verification procedures to ensure media is properly marked before distribution, transport, or removal from controlled areas.\n\n8. For Controlled Unclassified Information (CUI), follow marking requirements in 32 CFR Part 2002 and agency CUI guidance.\n\n9. Establish procedures for re-marking media when information sensitivity changes or when sanitizing media for reuse.\n\n10. Document exemptions and maintain records of controlled areas where exempt media is stored.\n\n11. Conduct periodic audits to verify marking compliance and address deficiencies.\n\n12. Consider color-coded marking schemes for rapid visual identification of sensitivity levels.",
    "ai_guidance": "MP-3 requires organizations to mark media to indicate distribution limitations, handling requirements, and security markings appropriate to the information sensitivity. Implementation requires developing a marking standard aligned with data classification policy, creating marking procedures for different media types (digital and non-digital), establishing an exemption policy for media remaining in controlled areas, providing marking supplies and training to personnel, and conducting periodic compliance audits. Key considerations include: (1) markings must be durable and remain visible throughout media lifecycle, (2) markings should enable personnel to quickly identify required protection level, (3) exemptions apply only while media remains within defined controlled areas - marking is required when media leaves, (4) CUI marking must comply with 32 CFR Part 2002, (5) classified information marking follows applicable classification guides. This is an organizational control without direct technical automation, though digital rights management (DRM) and document classification tools can support marking for electronic files. Coordinate with AC-16 (Security and Privacy Attributes) for automated marking of digital information and with MP-5 (Media Transport) to ensure media is properly marked before leaving controlled areas.",
    "implementation_guidance": "This is primarily an organizational control requiring documented procedures, marking supplies, and personnel training. Organizations should develop a comprehensive media marking program that includes: (1) marking standards aligned with data classification (sensitivity levels, CUI categories, classification levels), (2) marking procedures for different media types, (3) exemption criteria and controlled area definitions, (4) training requirements for personnel who create, handle, or transport media, and (5) compliance verification procedures. While no STIG automation exists for physical media marking, organizations can implement technical controls such as document classification tools, digital rights management (DRM), and metadata tagging to support marking of digital content. Coordinate with data classification, records management, and physical security programs.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "AC-16",
      "CP-9",
      "MP-2",
      "MP-4",
      "MP-5",
      "PE-22",
      "SI-12"
    ],
    "supplemental_guidance": "Security marking refers to the application or use of human-readable security attributes. Digital and non-digital media include diskettes, magnetic tapes, external or removable hard disk drives (e.g., solid state, magnetic), flash drives, compact discs, and digital versatile discs. Non-digital media includes paper and microfilm. Controlled Unclassified Information is defined by the National Archives and Records Administration along with the appropriate safeguarding and dissemination requirements for such information and is codified in 32 CFR 2002. Security markings are generally not required for media that contains information determined by organizations to be in the public domain or to be publicly releasable. Some organizations may require markings for public information indicating that the information is publicly releasable. System media marking reflects applicable laws, executive orders, directives, policies, regulations, standards, and guidelines.",
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null,
        "ansible": null
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "MP-3 is an organizational control requiring media marking procedures, supplies, and personnel training. No STIG automation exists for physical media marking. Technical controls such as document classification tools and DRM can support marking of digital content. Implementation focuses on developing marking standards aligned with data classification, establishing exemption policies for controlled areas, and training personnel on marking requirements."
    },
    "nist_csf_mappings": {
      "v1.1": [
        "PR.DS-1",
        "PR.DS-5",
        "PR.IP-6"
      ],
      "v2.0": [
        "PR.DS-01",
        "PR.DS-02",
        "PR.DS-10"
      ]
    },
    "nist_sp_800_171_mapping": "03.08.04",
    "references": [
      "32 CFR Part 2002",
      "NIST SP 800-60",
      "FIPS 199"
    ]
  },
  {
    "control_id": "MP-4",
    "control_name": "Media Storage",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "a. Physically control and securely store [Assignment: organization-defined types of digital and/or non-digital media] within [Assignment: organization-defined controlled areas]; and\nb. Protect system media types defined in MP-4a until the media are destroyed or sanitized using approved equipment, techniques, and procedures.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Media Storage requires organizations to physically control and securely store all types of digital media (flash drives, external hard drives, CDs, DVDs, magnetic tapes) and non-digital media (paper documents, microfilm) in designated secure areas. The organization must maintain physical accountability through inventory tracking, checkout/return procedures, and secure storage mechanisms such as locked cabinets, safes, or controlled media libraries. The level of protection must be commensurate with the sensitivity or classification of the information contained on the media. Media must remain protected until properly destroyed or sanitized using approved methods that prevent unauthorized data recovery.",
    "ai_guidance": "Implement comprehensive media storage controls by: (1) Establishing designated controlled areas with physical access controls such as cipher locks, badge readers, or biometric systems for media storage locations. (2) Creating and maintaining accurate inventories of all system media including serial numbers, classification levels, and custodian assignments. (3) Implementing formal checkout/return procedures with signature logs and accountability tracking. (4) Deploying secure storage containers (GSA-approved safes for classified, locked cabinets for CUI) appropriate to information sensitivity levels. (5) Labeling all media with appropriate classification/sensitivity markings per MP-3. (6) Conducting periodic inventories (monthly for high-sensitivity, quarterly for moderate) to verify media accountability. (7) Integrating with sanitization procedures (MP-6) to ensure proper disposition tracking. (8) Training personnel on media handling requirements and consequences of unauthorized disclosure. (9) Implementing environmental controls (temperature, humidity, fire suppression) in storage areas to prevent media degradation. (10) Establishing incident response procedures for lost or missing media.",
    "stig_id": null,
    "intent": "Ensure physical protection and accountability of system media containing organizational information through controlled storage and access mechanisms.",
    "is_technical": false,
    "enhancements": [
      {
        "id": "MP-4.1",
        "title": "Cryptographic Protection",
        "official_text": "[Withdrawn: Incorporated into SC-28(1)]",
        "status": "withdrawn"
      },
      {
        "id": "MP-4.2",
        "title": "Automated Restricted Access",
        "official_text": "Restrict access to media storage areas and log access attempts and access granted using [Assignment: organization-defined automated mechanisms]."
      }
    ],
    "related_controls": [
      "AC-19",
      "CP-2",
      "CP-6",
      "CP-9",
      "CP-10",
      "MP-2",
      "MP-7",
      "PE-3",
      "PL-2",
      "SC-12",
      "SC-13",
      "SC-28",
      "SC-34",
      "SI-12"
    ],
    "supplemental_guidance": "System media includes digital and non-digital media. Digital media includes flash drives, diskettes, magnetic tapes, external or removable hard disk drives (solid state and magnetic), compact discs, and digital versatile discs. Non-digital media includes paper and microfilm. Physically controlling stored media includes conducting inventories, ensuring procedures are in place to allow individuals to check out and return media to the library, and maintaining accountability for stored media. Secure storage includes a locked drawer, desk, or cabinet or a controlled media library. The type of media storage is commensurate with the security category or classification of the information on the media. Controlled areas are spaces that provide physical and procedural controls to meet the requirements established for protecting information and systems.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control requires organizational policy documentation and physical security measures. Primary technical automation focuses on SC-28(1) for cryptographic protection of stored media."
    }
  },
  {
    "control_id": "MP-4.1",
    "control_name": "Cryptographic Protection",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "[Withdrawn: Incorporated into SC-28(1)]",
    "parent_control": "MP-4",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "This control enhancement has been withdrawn in NIST SP 800-53 Rev 5 and its requirements have been incorporated into SC-28(1) Protection of Information at Rest - Cryptographic Protection. Organizations should refer to SC-28(1) for requirements regarding cryptographic protection of stored information on system media. The consolidation reflects the broader scope of SC-28(1) which addresses cryptographic protection for all information at rest, not just media storage scenarios.",
    "ai_guidance": "This enhancement was withdrawn in NIST SP 800-53 Rev 5. For cryptographic protection of stored media, implement SC-28(1) which requires: (1) Full disk encryption using FIPS 140-2/140-3 validated cryptographic modules (LUKS2 with AES-XTS-256 on Linux, BitLocker with AES-256 on Windows). (2) Hardware-based encryption for portable storage devices (self-encrypting drives). (3) File-level encryption for sensitive data containers (GPG, VeraCrypt, 7-Zip AES). (4) Key management procedures including secure key storage, rotation, and escrow. (5) Implementation of STIG RHEL-08-010030 requiring crypto_LUKS encryption for all local disk partitions. Organizations maintaining legacy compliance mappings should cross-reference this control to SC-28(1).",
    "stig_id": "RHEL-08-010030",
    "intent": "[WITHDRAWN] Cryptographic protection requirements consolidated into SC-28(1) for comprehensive information-at-rest protection.",
    "is_technical": true,
    "withdrawal_info": {
      "withdrawn_version": "Rev 5",
      "incorporated_into": "SC-28(1)",
      "rationale": "Consolidation of cryptographic protection requirements for information at rest into a single control"
    },
    "enhancements": [],
    "related_controls": [
      "SC-28",
      "SC-28.1",
      "SC-12",
      "SC-13"
    ],
    "supplemental_guidance": "This enhancement has been withdrawn. See SC-28(1) for cryptographic protection of information at rest requirements including media storage scenarios.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-4.1 WITHDRAWN - See SC-28(1) for cryptographic media protection\n# This script documents LUKS encryption verification for reference\nset -euo pipefail\n\nLOG_FILE=\"/var/log/mp41_encryption_check.log\"\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\necho \"[$TIMESTAMP] MP-4.1 has been withdrawn and incorporated into SC-28(1)\" | tee -a \"$LOG_FILE\"\necho \"[$TIMESTAMP] Checking disk encryption status per STIG RHEL-08-010030...\" | tee -a \"$LOG_FILE\"\n\n# Verify LUKS encryption on partitions\necho \"=== Disk Encryption Status ===\"\nblkid | grep -E '(crypto_LUKS|TYPE)' || echo \"No LUKS encrypted partitions found\"\n\n# Check for dm-crypt devices\necho \"\" && echo \"=== Active dm-crypt Devices ===\"\ndmsetup status 2>/dev/null | grep -E 'crypt' || echo \"No active dm-crypt devices\"\n\n# LUKS header info for encrypted volumes\necho \"\" && echo \"=== LUKS Volume Details ===\"\nfor dev in $(blkid -t TYPE=crypto_LUKS -o device 2>/dev/null); do\n    echo \"Device: $dev\"\n    cryptsetup luksDump \"$dev\" 2>/dev/null | head -20 || true\ndone\n\necho \"\" && echo \"[$TIMESTAMP] Refer to SC-28(1) implementation for cryptographic protection controls\" | tee -a \"$LOG_FILE\"\n",
        "ansible": "---\n# MP-4.1 WITHDRAWN - Incorporated into SC-28(1)\n# This playbook documents encryption verification for legacy compliance mapping\n- name: MP-4.1 Cryptographic Protection (WITHDRAWN - See SC-28.1)\n  hosts: all\n  become: yes\n  gather_facts: yes\n\n  vars:\n    control_id: \"MP-4.1\"\n    control_status: \"WITHDRAWN\"\n    incorporated_into: \"SC-28(1)\"\n    log_file: \"/var/log/mp41_withdrawn.log\"\n\n  tasks:\n    - name: Document withdrawal status\n      copy:\n        dest: \"/etc/compliance/mp-4-1_withdrawn.txt\"\n        owner: root\n        group: root\n        mode: '0644'\n        content: |\n          # MP-4.1 Cryptographic Protection\n          Status: WITHDRAWN in NIST SP 800-53 Rev 5\n          Incorporated Into: SC-28(1) Protection of Information at Rest\n          \n          Organizations should implement SC-28(1) for:\n          - Full disk encryption (LUKS, BitLocker)\n          - File-level encryption for sensitive data\n          - FIPS 140-2/140-3 validated cryptographic modules\n          \n          STIG Reference: RHEL-08-010030\n          Requirement: All local disk partitions must implement crypto_LUKS\n\n    - name: Check LUKS encryption status\n      shell: blkid | grep -c crypto_LUKS || echo \"0\"\n      register: luks_count\n      changed_when: false\n\n    - name: Report encryption status\n      debug:\n        msg: \"Found {{ luks_count.stdout }} LUKS encrypted partition(s). Implement SC-28(1) for full compliance.\"\n\n    - name: Log withdrawal notice\n      lineinfile:\n        path: \"{{ log_file }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] MP-4.1 WITHDRAWN - See SC-28(1) for cryptographic protection\"\n        create: yes\n"
      },
      "windows": {
        "powershell": "# MP-4.1 WITHDRAWN - See SC-28(1) for cryptographic media protection\n# This script documents BitLocker encryption verification for reference\n$ErrorActionPreference = 'Continue'\n\n$Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n$LogFile = \"C:\\Logs\\MP-41_Encryption_Check.log\"\n\nif (-not (Test-Path \"C:\\Logs\")) {\n    New-Item -ItemType Directory -Path \"C:\\Logs\" -Force | Out-Null\n}\n\nWrite-Host \"[$Timestamp] MP-4.1 has been withdrawn and incorporated into SC-28(1)\"\nAdd-Content -Path $LogFile -Value \"[$Timestamp] MP-4.1 WITHDRAWN - See SC-28(1)\"\n\nWrite-Host \"`n=== BitLocker Encryption Status ===\"\ntry {\n    $BitLockerVolumes = Get-BitLockerVolume -ErrorAction SilentlyContinue\n    if ($BitLockerVolumes) {\n        foreach ($vol in $BitLockerVolumes) {\n            Write-Host \"Volume: $($vol.MountPoint)\"\n            Write-Host \"  Protection Status: $($vol.ProtectionStatus)\"\n            Write-Host \"  Encryption Method: $($vol.EncryptionMethod)\"\n            Write-Host \"  Volume Status: $($vol.VolumeStatus)\"\n            Write-Host \"\"\n        }\n    } else {\n        Write-Host \"No BitLocker protected volumes found\"\n    }\n} catch {\n    Write-Host \"BitLocker cmdlets not available or requires elevation\"\n}\n\nWrite-Host \"`n=== Withdrawal Notice ===\"\n$Notice = @\"\nMP-4.1 Cryptographic Protection has been WITHDRAWN in NIST SP 800-53 Rev 5.\nThis requirement is now addressed by SC-28(1) Protection of Information at Rest.\n\nFor Windows systems, implement:\n- BitLocker Drive Encryption (AES-256)\n- BitLocker To Go for removable media\n- Windows EFS for file-level encryption\n- TPM-based key protection\n\nRefer to SC-28(1) implementation for complete requirements.\n\"@\nWrite-Host $Notice\n\nAdd-Content -Path $LogFile -Value \"[$Timestamp] Encryption check complete - See SC-28(1)\"\n"
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "cac_status": "withdrawn",
      "implementation_guidance": "WITHDRAWN in Rev 5. Implement SC-28(1) for cryptographic protection of stored media. STIG RHEL-08-010030 requires LUKS encryption for all local partitions."
    }
  },
  {
    "control_id": "MP-4.2",
    "control_name": "Automated Restricted Access",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "Restrict access to media storage areas and log access attempts and access granted using [Assignment: organization-defined automated mechanisms].",
    "parent_control": "MP-4",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "Automated Restricted Access requires organizations to implement automated mechanisms to control and monitor access to areas where system media is stored. This includes deploying physical access control systems such as keypads, biometric readers (fingerprint, iris, facial recognition), smart card readers, or proximity badge systems at media storage locations. All access attempts, whether successful or denied, must be automatically logged with timestamps, user identification, and access outcome. These logs enable security teams to detect unauthorized access attempts, investigate security incidents, and maintain comprehensive audit trails for compliance verification. The automated nature ensures consistent enforcement without relying on manual processes that could be circumvented or forgotten.",
    "ai_guidance": "Implement automated media storage access controls through: (1) Deploy electronic access control systems (EACS) at media storage locations including card readers, keypads, or biometric devices integrated with the organization's identity management system. (2) Configure access control lists (ACLs) that restrict media storage area entry to only authorized personnel with documented need-to-know. (3) Implement logging of all access events including timestamp, user ID, badge/credential number, door/location, and access result (granted/denied). (4) Configure automated alerts for multiple failed access attempts, after-hours access, or access by terminated/suspended personnel. (5) Integrate physical access logs with SIEM solutions for correlation with logical access events. (6) Establish log retention per organizational policy (minimum 90 days, 1 year recommended). (7) Deploy video surveillance at storage entry points with footage retention aligned with access logs. (8) Implement two-factor authentication for high-security media storage areas (badge + PIN or badge + biometric). (9) Configure automated reports for periodic access review by security personnel. (10) Ensure backup power for access control systems to maintain security during outages.",
    "stig_id": "RHEL-08-030603",
    "intent": "Automate physical access control and comprehensive logging for media storage areas to ensure consistent security enforcement and audit capability.",
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-3",
      "AC-6",
      "AU-2",
      "AU-6",
      "AU-12",
      "PE-2",
      "PE-3",
      "PE-8"
    ],
    "supplemental_guidance": "Automated mechanisms include keypads, biometric readers, or card readers that control physical entry to storage facilities while maintaining audit trails of access events. The combination of automated access restriction and comprehensive logging provides defense-in-depth for media storage security.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-4.2: Automated Restricted Access - Audit Logging for Media Storage\n# Configures auditd rules to log access to media storage locations\nset -euo pipefail\n\nLOG_FILE=\"/var/log/mp42_implementation.log\"\nAUDIT_RULES_FILE=\"/etc/audit/rules.d/99-mp42-media-storage.rules\"\nMEDIA_DIRS=\"/media /mnt /run/media\"\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\nlog_msg() {\n    echo \"[$TIMESTAMP] $1\" | tee -a \"$LOG_FILE\"\n}\n\nlog_msg \"[*] Implementing MP-4.2 Automated Restricted Access\"\n\n# Ensure auditd is installed and running\nif ! command -v auditctl &>/dev/null; then\n    log_msg \"[*] Installing audit package...\"\n    yum install -y audit audit-libs 2>/dev/null || apt-get install -y auditd 2>/dev/null || true\nfi\n\n# Create audit rules for media storage directories\ncat > \"$AUDIT_RULES_FILE\" << 'AUDITEOF'\n## MP-4.2: Automated Restricted Access - Media Storage Audit Rules\n## Monitor access to removable media mount points and storage directories\n\n# Monitor /media directory for all access and modifications\n-w /media -p rwxa -k mp42_media_storage\n\n# Monitor /mnt directory for mounting activities\n-w /mnt -p rwxa -k mp42_media_storage\n\n# Monitor /run/media for user-mounted removable devices\n-w /run/media -p rwxa -k mp42_media_storage\n\n# Monitor mount/umount system calls for removable media\n-a always,exit -F arch=b64 -S mount -S umount2 -F auid>=1000 -F auid!=4294967295 -k mp42_mount_operations\n-a always,exit -F arch=b32 -S mount -S umount -S umount2 -F auid>=1000 -F auid!=4294967295 -k mp42_mount_operations\n\n# Monitor USB device connections via udev\n-w /etc/udev/rules.d -p wa -k mp42_udev_rules\n\n# Monitor changes to removable media policies\n-w /etc/modprobe.d -p wa -k mp42_modprobe_config\n\n# Monitor USBGuard configuration if present\n-w /etc/usbguard -p wa -k mp42_usbguard_config\nAUDITEOF\n\nchmod 640 \"$AUDIT_RULES_FILE\"\nlog_msg \"[+] Created audit rules: $AUDIT_RULES_FILE\"\n\n# Reload audit rules\nif systemctl is-active --quiet auditd; then\n    augenrules --load 2>/dev/null || auditctl -R \"$AUDIT_RULES_FILE\" 2>/dev/null || true\n    log_msg \"[+] Audit rules loaded successfully\"\nelse\n    systemctl enable --now auditd 2>/dev/null || true\n    log_msg \"[*] Started auditd service\"\nfi\n\n# Configure log rotation for audit logs\ncat > /etc/logrotate.d/audit-mp42 << 'ROTATEEOF'\n/var/log/audit/audit.log {\n    weekly\n    rotate 52\n    compress\n    delaycompress\n    notifempty\n    create 0600 root root\n    postrotate\n        /sbin/service auditd rotate 2>/dev/null || true\n    endscript\n}\nROTATEEOF\n\nlog_msg \"[+] Configured audit log rotation (52 weeks retention)\"\n\n# Create report script for media access review\ncat > /usr/local/bin/mp42_access_report.sh << 'REPORTEOF'\n#!/bin/bash\n# MP-4.2 Media Storage Access Report Generator\nREPORT_FILE=\"/var/log/mp42_access_report_$(date +%Y%m%d).txt\"\necho \"=== MP-4.2 Media Storage Access Report ===\" > \"$REPORT_FILE\"\necho \"Generated: $(date)\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\necho \"=== Media Storage Access Events (Last 24 Hours) ===\" >> \"$REPORT_FILE\"\nausearch -k mp42_media_storage -ts today 2>/dev/null >> \"$REPORT_FILE\" || echo \"No events found\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\necho \"=== Mount Operations ===\" >> \"$REPORT_FILE\"\nausearch -k mp42_mount_operations -ts today 2>/dev/null >> \"$REPORT_FILE\" || echo \"No mount events\" >> \"$REPORT_FILE\"\necho \"Report saved: $REPORT_FILE\"\nREPORTEOF\nchmod 750 /usr/local/bin/mp42_access_report.sh\n\n# Schedule daily access report\n(crontab -l 2>/dev/null | grep -v mp42_access_report; echo \"0 6 * * * /usr/local/bin/mp42_access_report.sh\") | crontab - 2>/dev/null || true\n\nlog_msg \"[+] MP-4.2 Implementation complete\"\nlog_msg \"[+] Daily access reports scheduled at 06:00\"\n",
        "ansible": "---\n- name: MP-4.2 Automated Restricted Access Implementation\n  hosts: all\n  become: yes\n  gather_facts: yes\n\n  vars:\n    control_id: \"MP-4.2\"\n    control_name: \"Automated Restricted Access\"\n    audit_rules_file: \"/etc/audit/rules.d/99-mp42-media-storage.rules\"\n    log_file: \"/var/log/mp42_implementation.log\"\n    report_script: \"/usr/local/bin/mp42_access_report.sh\"\n\n  tasks:\n    - name: Ensure audit packages are installed\n      package:\n        name:\n          - audit\n          - audit-libs\n        state: present\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Ensure auditd packages installed (Debian)\n      apt:\n        name: auditd\n        state: present\n      when: ansible_os_family == \"Debian\"\n\n    - name: Deploy MP-4.2 audit rules\n      copy:\n        dest: \"{{ audit_rules_file }}\"\n        owner: root\n        group: root\n        mode: '0640'\n        content: |\n          ## MP-4.2: Automated Restricted Access - Media Storage Audit Rules\n          ## Implements logging per STIG RHEL-08-030603 guidance\n          \n          # Monitor media storage directories\n          -w /media -p rwxa -k mp42_media_storage\n          -w /mnt -p rwxa -k mp42_media_storage\n          -w /run/media -p rwxa -k mp42_media_storage\n          \n          # Monitor mount/umount operations\n          -a always,exit -F arch=b64 -S mount -S umount2 -F auid>=1000 -F auid!=4294967295 -k mp42_mount_operations\n          -a always,exit -F arch=b32 -S mount -S umount -S umount2 -F auid>=1000 -F auid!=4294967295 -k mp42_mount_operations\n          \n          # Monitor udev and modprobe config\n          -w /etc/udev/rules.d -p wa -k mp42_udev_rules\n          -w /etc/modprobe.d -p wa -k mp42_modprobe_config\n          \n          # Monitor USBGuard if present\n          -w /etc/usbguard -p wa -k mp42_usbguard_config\n      notify: Reload audit rules\n\n    - name: Ensure auditd is enabled and running\n      service:\n        name: auditd\n        state: started\n        enabled: yes\n\n    - name: Configure audit log rotation\n      copy:\n        dest: /etc/logrotate.d/audit-mp42\n        owner: root\n        group: root\n        mode: '0644'\n        content: |\n          /var/log/audit/audit.log {\n              weekly\n              rotate 52\n              compress\n              delaycompress\n              notifempty\n              create 0600 root root\n              postrotate\n                  /sbin/service auditd rotate 2>/dev/null || true\n              endscript\n          }\n\n    - name: Deploy access report script\n      copy:\n        dest: \"{{ report_script }}\"\n        owner: root\n        group: root\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # MP-4.2 Media Storage Access Report\n          REPORT=\"/var/log/mp42_access_report_$(date +%Y%m%d).txt\"\n          echo \"=== MP-4.2 Media Storage Access Report ===\" > \"$REPORT\"\n          echo \"Generated: $(date)\" >> \"$REPORT\"\n          echo \"\" >> \"$REPORT\"\n          ausearch -k mp42_media_storage -ts today >> \"$REPORT\" 2>&1 || echo \"No events\" >> \"$REPORT\"\n          ausearch -k mp42_mount_operations -ts today >> \"$REPORT\" 2>&1 || true\n\n    - name: Schedule daily access reports\n      cron:\n        name: \"MP-4.2 Daily Access Report\"\n        minute: \"0\"\n        hour: \"6\"\n        job: \"{{ report_script }}\"\n        user: root\n\n    - name: Log implementation completion\n      lineinfile:\n        path: \"{{ log_file }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] MP-4.2 Implementation complete - audit rules deployed\"\n        create: yes\n        owner: root\n        group: root\n        mode: '0640'\n\n  handlers:\n    - name: Reload audit rules\n      shell: augenrules --load 2>/dev/null || auditctl -R {{ audit_rules_file }}\n"
      },
      "windows": {
        "powershell": "# MP-4.2: Automated Restricted Access - Windows Implementation\n# Configures Windows Security Event logging for media/storage access\n$ErrorActionPreference = 'Stop'\n\n$LogPath = \"C:\\Logs\"\n$ConfigPath = \"C:\\ConfigManagement\\MP-4-2\"\n$Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n$LogFile = \"$LogPath\\MP-42_Implementation.log\"\n\nfunction Write-Log {\n    param([string]$Message)\n    $entry = \"[$Timestamp] $Message\"\n    if (-not (Test-Path $LogPath)) { New-Item -ItemType Directory -Path $LogPath -Force | Out-Null }\n    Add-Content -Path $LogFile -Value $entry\n    Write-Host $entry\n}\n\nWrite-Log \"Starting MP-4.2 Automated Restricted Access Implementation\"\n\n# Create configuration directory\nif (-not (Test-Path $ConfigPath)) {\n    New-Item -ItemType Directory -Path $ConfigPath -Force | Out-Null\n}\n\n# Enable Security audit policy for Object Access\nWrite-Log \"Configuring Security Audit Policies...\"\n\n# Enable Removable Storage auditing\ntry {\n    auditpol /set /subcategory:\"Removable Storage\" /success:enable /failure:enable\n    Write-Log \"[+] Enabled Removable Storage auditing\"\n} catch {\n    Write-Log \"[-] Failed to configure Removable Storage audit: $_\"\n}\n\n# Enable Detailed File Share auditing\ntry {\n    auditpol /set /subcategory:\"Detailed File Share\" /success:enable /failure:enable\n    Write-Log \"[+] Enabled Detailed File Share auditing\"\n} catch {\n    Write-Log \"[-] Failed to configure File Share audit: $_\"\n}\n\n# Enable File System auditing\ntry {\n    auditpol /set /subcategory:\"File System\" /success:enable /failure:enable\n    Write-Log \"[+] Enabled File System auditing\"\n} catch {\n    Write-Log \"[-] Failed to configure File System audit: $_\"\n}\n\n# Enable PNP Activity auditing (for USB device connections)\ntry {\n    auditpol /set /subcategory:\"Plug and Play Events\" /success:enable /failure:enable\n    Write-Log \"[+] Enabled Plug and Play Events auditing\"\n} catch {\n    Write-Log \"[-] Failed to configure PnP audit: $_\"\n}\n\n# Configure Security Event Log size and retention\nWrite-Log \"Configuring Security Event Log...\"\ntry {\n    $LogName = \"Security\"\n    $Log = Get-WinEvent -ListLog $LogName\n    # Set to 1GB max size with overwrite as needed\n    Limit-EventLog -LogName $LogName -MaximumSize 1073741824 -OverflowAction OverwriteOlder -RetentionDays 90\n    Write-Log \"[+] Security log configured: 1GB max, 90-day retention\"\n} catch {\n    Write-Log \"[-] Failed to configure Security log: $_\"\n}\n\n# Create report script\n$ReportScript = @'\n# MP-4.2 Media Storage Access Report Generator\n$ReportPath = \"C:\\Logs\\MP-42_AccessReport_$(Get-Date -Format 'yyyyMMdd').txt\"\n$StartTime = (Get-Date).AddDays(-1)\n\n\"=== MP-4.2 Media Storage Access Report ===\" | Out-File $ReportPath\n\"Generated: $(Get-Date)\" | Out-File $ReportPath -Append\n\"\" | Out-File $ReportPath -Append\n\n\"=== Removable Storage Events (Last 24h) ===\" | Out-File $ReportPath -Append\ntry {\n    Get-WinEvent -FilterHashtable @{\n        LogName='Security'\n        ID=@(4656,4663,4658)\n        StartTime=$StartTime\n    } -ErrorAction SilentlyContinue | \n    Where-Object { $_.Message -match 'Removable|USB|Media' } |\n    Select-Object TimeCreated, Id, Message |\n    Out-File $ReportPath -Append\n} catch {\n    \"No matching events found\" | Out-File $ReportPath -Append\n}\n\n\"\" | Out-File $ReportPath -Append\n\"=== USB Device Connection Events ===\" | Out-File $ReportPath -Append\ntry {\n    Get-WinEvent -FilterHashtable @{\n        LogName='Security'\n        ID=@(6416,6419,6420,6421,6422)\n        StartTime=$StartTime\n    } -ErrorAction SilentlyContinue |\n    Select-Object TimeCreated, Id, Message |\n    Out-File $ReportPath -Append\n} catch {\n    \"No PnP events found\" | Out-File $ReportPath -Append\n}\n\nWrite-Host \"Report saved: $ReportPath\"\n'@\n\nSet-Content -Path \"$ConfigPath\\Generate-MP42Report.ps1\" -Value $ReportScript\nWrite-Log \"[+] Created report script: $ConfigPath\\Generate-MP42Report.ps1\"\n\n# Create scheduled task for daily reports\n$TaskName = \"MP-4.2 Daily Access Report\"\n$Action = New-ScheduledTaskAction -Execute \"PowerShell.exe\" -Argument \"-ExecutionPolicy Bypass -File `\"$ConfigPath\\Generate-MP42Report.ps1`\"\"\n$Trigger = New-ScheduledTaskTrigger -Daily -At \"06:00\"\n$Principal = New-ScheduledTaskPrincipal -UserId \"SYSTEM\" -LogonType ServiceAccount -RunLevel Highest\n\ntry {\n    Unregister-ScheduledTask -TaskName $TaskName -Confirm:$false -ErrorAction SilentlyContinue\n    Register-ScheduledTask -TaskName $TaskName -Action $Action -Trigger $Trigger -Principal $Principal -Description \"MP-4.2 Media Storage Access Daily Report\"\n    Write-Log \"[+] Created scheduled task: $TaskName\"\n} catch {\n    Write-Log \"[-] Failed to create scheduled task: $_\"\n}\n\n# Document implementation status\n$Status = @\"\nMP-4.2 Automated Restricted Access - Implementation Status\n=========================================================\nControl ID: MP-4.2\nImplementation Date: $(Get-Date -Format 'yyyy-MM-dd')\nHost: $env:COMPUTERNAME\n\nConfigured Audit Policies:\n- Removable Storage: Success/Failure\n- Detailed File Share: Success/Failure\n- File System: Success/Failure\n- Plug and Play Events: Success/Failure\n\nSecurity Log Configuration:\n- Maximum Size: 1 GB\n- Retention: 90 days\n\nScheduled Reports:\n- Daily at 06:00\n- Location: C:\\Logs\\MP-42_AccessReport_*.txt\n\nRelevant Event IDs:\n- 4656: Handle requested (object access)\n- 4663: Object access attempt\n- 4658: Handle closed\n- 6416: New external device recognized\n- 6419: Request to disable device\n- 6420: Device disabled\n- 6421: Request to enable device\n- 6422: Device enabled\n\"@\n\nSet-Content -Path \"$ConfigPath\\Implementation_Status.txt\" -Value $Status\n\nWrite-Log \"[+] MP-4.2 Implementation complete\"\nWrite-Log \"[+] Configuration saved to: $ConfigPath\"\n"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "technical",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "stig_references": [
        "RHEL-08-030603"
      ],
      "implementation_guidance": "Implement automated physical access control systems with logging. Deploy auditd rules on Linux or Windows Security Event logging to capture all media storage access events."
    }
  },
  {
    "control_id": "MP-5",
    "control_name": "Media Transport",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "a. Protect and control [Assignment: organization-defined types of system media] during transport outside of controlled areas using [Assignment: organization-defined controls];\nb. Maintain accountability for system media during transport outside of controlled areas;\nc. Document activities associated with the transport of system media; and\nd. Restrict the activities associated with the transport of system media to authorized personnel.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": true,
      "high": true
    },
    "plain_english_explanation": "Media Transport establishes comprehensive requirements for protecting system media when it must be moved outside of controlled organizational areas. This control addresses the complete lifecycle of media transport including preparation, authorization, actual movement, and delivery verification. Organizations must implement protective measures such as cryptographic encryption, tamper-evident containers, or locked transport cases appropriate to the sensitivity of the information. Accountability must be maintained throughout transport through chain-of-custody documentation, tracking systems, and designated personnel responsible for the media at each stage. All transport activities must be documented including the reason for transport, authorization, departure/arrival times, and any incidents. Only personnel specifically authorized for media transport duties may handle system media outside controlled areas.",
    "ai_guidance": "Implement comprehensive media transport controls by: (1) Establishing a formal media transport authorization process requiring management approval before any media leaves controlled areas. (2) Defining approved transport methods based on information sensitivity (courier services for CUI, cleared couriers for classified, encrypted containers for all sensitive media). (3) Implementing chain-of-custody documentation that tracks media from origin to destination with signatures at each transfer point. (4) Requiring encryption per SC-28(1) for all digital media transported outside controlled areas. (5) Using tamper-evident packaging or containers that reveal if media has been accessed during transport. (6) Maintaining a transport log recording date/time, media description, origin, destination, transporter name, and authorization reference. (7) Establishing procedures for lost or compromised media during transport including incident reporting and damage assessment. (8) Training authorized transport personnel on proper handling, documentation, and incident procedures. (9) Implementing verification procedures at destination to confirm media integrity and chain-of-custody completeness. (10) Conducting periodic reviews of transport logs and procedures to identify security gaps or compliance issues.",
    "stig_id": null,
    "intent": "Protect system media from compromise during transport outside controlled areas through protective measures, accountability tracking, documentation, and authorization controls.",
    "is_technical": false,
    "enhancements": [
      {
        "id": "MP-5.1",
        "title": "Protection Outside of Controlled Areas",
        "official_text": "[Withdrawn: Incorporated into MP-5]",
        "status": "withdrawn"
      },
      {
        "id": "MP-5.2",
        "title": "Documentation of Activities",
        "official_text": "[Withdrawn: Incorporated into MP-5]",
        "status": "withdrawn"
      },
      {
        "id": "MP-5.3",
        "title": "Custodians",
        "official_text": "Employ an identified custodian during transport of system media outside of controlled areas."
      },
      {
        "id": "MP-5.4",
        "title": "Cryptographic Protection",
        "official_text": "[Withdrawn: Incorporated into SC-28(1)]",
        "status": "withdrawn"
      }
    ],
    "related_controls": [
      "AC-7",
      "AC-19",
      "CP-2",
      "CP-9",
      "MP-3",
      "MP-4",
      "PE-16",
      "PL-2",
      "SC-12",
      "SC-13",
      "SC-28",
      "SC-34"
    ],
    "supplemental_guidance": "System media includes digital and non-digital media. Digital media includes flash drives, diskettes, magnetic tapes, external or removable hard disk drives (solid state and magnetic), compact discs, and digital versatile discs. Non-digital media includes microfilm and paper. Controlled areas are spaces for which organizations provide physical or procedural controls to meet requirements established for protecting information and systems. Controls to protect media during transport include cryptography and locked containers. Cryptographic mechanisms can provide confidentiality and integrity protections depending on the mechanisms implemented. Activities associated with media transport include releasing media for transport, ensuring that media enters the appropriate transport processes, and the actual transport. Authorized transport and courier personnel may include individuals external to the organization. Maintaining accountability of media during transport includes restricting transport activities to authorized personnel and tracking and/or obtaining records of transport activities as the media moves through the transportation system to prevent and detect loss, destruction, or tampering.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control requires organizational procedures for media transport authorization, chain-of-custody documentation, and transport personnel authorization. Technical controls for encryption during transport are addressed by SC-28(1)."
    }
  },
  {
    "control_id": "MP-5.1",
    "control_name": "Protection Outside of Controlled Areas",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "[Withdrawn: Incorporated into MP-5]",
    "parent_control": "MP-5",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "This control enhancement has been withdrawn in NIST SP 800-53 Rev 5 and its requirements have been incorporated into the base MP-5 Media Transport control. The original intent of MP-5(1) was to ensure protection measures for media transported outside controlled areas, which is now explicitly addressed in MP-5 part (a) requiring organizations to 'protect and control system media during transport outside of controlled areas using organization-defined controls.' Organizations should implement MP-5 for all media transport protection requirements.",
    "ai_guidance": "This enhancement was withdrawn in NIST SP 800-53 Rev 5 and consolidated into the base MP-5 control. Organizations should implement the following as part of MP-5 compliance: (1) Define specific protection requirements for media transported outside controlled areas based on information sensitivity. (2) Implement physical protection measures such as locked containers, tamper-evident packaging, or secure courier services. (3) Require encryption (per SC-28(1)) for all digital media transported outside organizational facilities. (4) Establish procedures for verifying media integrity upon arrival at destination. (5) Define environmental protection requirements during transport (temperature, humidity, shock protection). For legacy compliance mappings, cross-reference this control to MP-5.",
    "stig_id": null,
    "intent": "[WITHDRAWN] Protection requirements consolidated into base MP-5 control for comprehensive media transport security.",
    "is_technical": false,
    "withdrawal_info": {
      "withdrawn_version": "Rev 5",
      "incorporated_into": "MP-5",
      "rationale": "Consolidation of transport protection requirements into base control for clarity"
    },
    "enhancements": [],
    "related_controls": [
      "MP-5",
      "SC-28"
    ],
    "supplemental_guidance": "This enhancement has been withdrawn. See MP-5 base control for media transport protection requirements.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "cac_status": "withdrawn",
      "implementation_guidance": "WITHDRAWN in Rev 5. Requirements incorporated into MP-5 base control."
    }
  },
  {
    "control_id": "MP-5.2",
    "control_name": "Documentation of Activities",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "[Withdrawn: Incorporated into MP-5]",
    "parent_control": "MP-5",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "This control enhancement has been withdrawn in NIST SP 800-53 Rev 5 and its requirements have been incorporated into the base MP-5 Media Transport control. The original intent of MP-5(2) was to ensure documentation of media transport activities, which is now explicitly addressed in MP-5 part (c) requiring organizations to 'document activities associated with the transport of system media.' Organizations should implement comprehensive documentation as part of their MP-5 compliance program.",
    "ai_guidance": "This enhancement was withdrawn in NIST SP 800-53 Rev 5 and consolidated into the base MP-5 control. Organizations should implement the following documentation as part of MP-5 compliance: (1) Create standardized transport request forms capturing media description, classification, origin, destination, purpose, and authorization. (2) Implement chain-of-custody logs with timestamps and signatures at each custody transfer point. (3) Maintain transport manifests listing all media items being transported together. (4) Record courier/transport service information including tracking numbers and delivery confirmation. (5) Document any incidents or anomalies during transport. (6) Establish retention requirements for transport documentation (minimum 3 years recommended). (7) Conduct periodic audits of transport documentation for completeness and accuracy. For legacy compliance mappings, cross-reference this control to MP-5.",
    "stig_id": null,
    "intent": "[WITHDRAWN] Documentation requirements consolidated into base MP-5 control for comprehensive media transport documentation.",
    "is_technical": false,
    "withdrawal_info": {
      "withdrawn_version": "Rev 5",
      "incorporated_into": "MP-5",
      "rationale": "Consolidation of transport documentation requirements into base control for clarity"
    },
    "enhancements": [],
    "related_controls": [
      "MP-5",
      "AU-2",
      "AU-12"
    ],
    "supplemental_guidance": "This enhancement has been withdrawn. See MP-5 base control part (c) for media transport documentation requirements.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": false
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "cac_status": "withdrawn",
      "implementation_guidance": "WITHDRAWN in Rev 5. Requirements incorporated into MP-5 base control part (c)."
    }
  },
  {
    "control_id": "MP-5.3",
    "control_name": "Custodians",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "Employ an identified custodian during transport of system media outside of controlled areas.",
    "parent_control": "MP-5",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "The Custodians enhancement requires organizations to designate a specific, identifiable individual as the responsible custodian for system media during transport outside controlled areas. This provides a clear point of accountability at every stage of the transport process. The custodian is personally responsible for the security and integrity of the media from the moment they take custody until they transfer it to another designated custodian or deliver it to the final destination. Custodial responsibilities can be formally transferred between authorized individuals through documented handoff procedures, ensuring an unbroken chain of accountability. This approach enables rapid identification of responsibility if media is lost, damaged, or compromised during transport.",
    "ai_guidance": "Implement media transport custodian controls by: (1) Establishing a formal custodian designation process requiring management approval and background verification appropriate to information sensitivity. (2) Creating custodian authorization records documenting name, contact information, authorization scope, and expiration date. (3) Issuing custodian credentials or badges that identify their authorization to transport organizational media. (4) Implementing formal custody transfer procedures requiring both parties to sign and timestamp the transfer, verify media inventory, and inspect packaging integrity. (5) Requiring custodians to maintain physical possession of media at all times during transport (no unattended media). (6) Establishing communication protocols for custodians to report status, incidents, or delays during transport. (7) Defining custodian responsibilities including protection measures, documentation, and incident reporting. (8) Creating procedures for emergency situations where custodian transfer is required unexpectedly. (9) Training custodians on their responsibilities, security procedures, and consequences of non-compliance. (10) Maintaining custodian logs integrated with chain-of-custody documentation for audit purposes.",
    "stig_id": null,
    "intent": "Ensure individual accountability for system media during transport through designated custodians with clear responsibilities and transfer procedures.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-5",
      "PE-16",
      "PS-6",
      "PS-7"
    ],
    "supplemental_guidance": "Identified custodians provide organizations with specific points of contact during the media transport process and facilitate individual accountability. Custodial responsibilities can be transferred from one individual to another if an unambiguous custodian is identified. The organization defines the level of custodian identification required based on the sensitivity of the information on the media being transported.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-5.3: Custodians - Media Transport Custodian Management System\n# Creates documentation templates and tracking for media custodians\nset -euo pipefail\n\nLOG_FILE=\"/var/log/mp53_custodian.log\"\nCUSTODY_DIR=\"/etc/media-protection/custody\"\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\nlog_msg() {\n    echo \"[$TIMESTAMP] $1\" | tee -a \"$LOG_FILE\"\n}\n\nlog_msg \"[*] Implementing MP-5.3 Custodians\"\n\n# Create custody management directories\nmkdir -p \"$CUSTODY_DIR\"/{custodians,transfers,templates,logs}\nchmod 750 \"$CUSTODY_DIR\"\nchmod 750 \"$CUSTODY_DIR\"/*\n\n# Create custodian registration template\ncat > \"$CUSTODY_DIR/templates/custodian_registration.txt\" << 'CUSTODIANEOF'\n===============================================\nMEDIA TRANSPORT CUSTODIAN REGISTRATION FORM\nMP-5.3 Compliance Documentation\n===============================================\n\nCustodian Information:\n---------------------\nFull Name: _______________________________\nEmployee ID: _____________________________\nDepartment: ______________________________\nPhone: ___________________________________\nEmail: ___________________________________\n\nAuthorization:\n-------------\nMaximum Classification Authorized: ________\nAuthorization Start Date: _________________\nAuthorization Expiration: _________________\nAuthorizing Official: ____________________\nAuthorization Signature: _________________\nDate: ____________________________________\n\nTraining Verification:\n---------------------\nMedia Handling Training Date: _____________\nSecurity Awareness Training Date: _________\nTrainer Name: ____________________________\n\nAcknowledgment:\n--------------\nI understand my responsibilities as a media custodian including:\n- Maintaining physical possession of media at all times\n- Properly documenting all custody transfers\n- Reporting any security incidents immediately\n- Following all organizational media protection policies\n\nCustodian Signature: _____________________\nDate: ____________________________________\n===============================================\nCUSTODIANEOF\n\n# Create custody transfer form template\ncat > \"$CUSTODY_DIR/templates/custody_transfer.txt\" << 'TRANSFEREOF'\n===============================================\nMEDIA CUSTODY TRANSFER FORM\nMP-5.3 Chain of Custody Documentation\n===============================================\n\nTransfer ID: _____________________________\nDate/Time: _______________________________\n\nMedia Description:\n-----------------\nMedia Type: ______________________________\nMedia ID/Serial: _________________________\nClassification: __________________________\nDescription: _____________________________\n__________________________________________\n\nReleasing Custodian:\n-------------------\nName: ___________________________________\nEmployee ID: _____________________________\nSignature: _______________________________\nDate/Time: _______________________________\n\nReceiving Custodian:\n-------------------\nName: ___________________________________\nEmployee ID: _____________________________\nSignature: _______________________________\nDate/Time: _______________________________\n\nPackaging Verification:\n----------------------\n[ ] Tamper-evident seal intact\n[ ] Media count verified\n[ ] Physical condition acceptable\n[ ] Documentation complete\n\nNotes: ___________________________________\n__________________________________________\n\nTransfer Witness (if required):\nName: ___________________________________\nSignature: _______________________________\n===============================================\nTRANSFEREOF\n\n# Create custodian registry database (simple CSV format)\ncat > \"$CUSTODY_DIR/custodians/registry.csv\" << 'REGISTRYEOF'\n# MP-5.3 Custodian Registry\n# Format: ID,Name,Department,MaxClassification,AuthStart,AuthExpire,Status\nCUST001,System Administrator,IT Security,CUI,2025-01-01,2026-01-01,Active\nREGISTRYEOF\nchmod 640 \"$CUSTODY_DIR/custodians/registry.csv\"\n\n# Create custody log script\ncat > /usr/local/bin/mp53_custody_log.sh << 'LOGSCRIPTEOF'\n#!/bin/bash\n# MP-5.3 Custody Event Logger\nCUSTODY_LOG=\"/etc/media-protection/custody/logs/custody_$(date +%Y%m).log\"\n\ncase \"$1\" in\n    transfer)\n        echo \"$(date '+%Y-%m-%d %H:%M:%S'),TRANSFER,$2,$3,$4,$5\" >> \"$CUSTODY_LOG\"\n        ;;\n    checkout)\n        echo \"$(date '+%Y-%m-%d %H:%M:%S'),CHECKOUT,$2,$3,$4\" >> \"$CUSTODY_LOG\"\n        ;;\n    checkin)\n        echo \"$(date '+%Y-%m-%d %H:%M:%S'),CHECKIN,$2,$3,$4\" >> \"$CUSTODY_LOG\"\n        ;;\n    *)\n        echo \"Usage: $0 {transfer|checkout|checkin} [args...]\"\n        echo \"  transfer: from_custodian to_custodian media_id location\"\n        echo \"  checkout: custodian media_id destination\"\n        echo \"  checkin: custodian media_id source\"\n        ;;\nesac\nLOGSCRIPTEOF\nchmod 750 /usr/local/bin/mp53_custody_log.sh\n\nlog_msg \"[+] Created custody management templates in $CUSTODY_DIR/templates/\"\nlog_msg \"[+] Created custodian registry at $CUSTODY_DIR/custodians/registry.csv\"\nlog_msg \"[+] Created custody logging script at /usr/local/bin/mp53_custody_log.sh\"\nlog_msg \"[+] MP-5.3 Custodians implementation complete\"\n",
        "ansible": "---\n- name: MP-5.3 Custodians Implementation\n  hosts: all\n  become: yes\n  gather_facts: yes\n\n  vars:\n    control_id: \"MP-5.3\"\n    control_name: \"Custodians\"\n    custody_dir: \"/etc/media-protection/custody\"\n    log_file: \"/var/log/mp53_implementation.log\"\n\n  tasks:\n    - name: Create custody management directories\n      file:\n        path: \"{{ custody_dir }}/{{ item }}\"\n        state: directory\n        owner: root\n        group: root\n        mode: '0750'\n      loop:\n        - custodians\n        - transfers\n        - templates\n        - logs\n\n    - name: Deploy custodian registration template\n      copy:\n        dest: \"{{ custody_dir }}/templates/custodian_registration.txt\"\n        owner: root\n        group: root\n        mode: '0644'\n        content: |\n          ===============================================\n          MEDIA TRANSPORT CUSTODIAN REGISTRATION FORM\n          MP-5.3 Compliance Documentation\n          ===============================================\n          \n          Custodian Information:\n          ---------------------\n          Full Name: _______________________________\n          Employee ID: _____________________________\n          Department: ______________________________\n          Phone: ___________________________________\n          Email: ___________________________________\n          \n          Authorization:\n          -------------\n          Maximum Classification Authorized: ________\n          Authorization Start Date: _________________\n          Authorization Expiration: _________________\n          Authorizing Official: ____________________\n          \n          Acknowledgment:\n          I understand my responsibilities as a media custodian.\n          \n          Custodian Signature: _____________________\n          Date: ____________________________________\n          ===============================================\n\n    - name: Deploy custody transfer template\n      copy:\n        dest: \"{{ custody_dir }}/templates/custody_transfer.txt\"\n        owner: root\n        group: root\n        mode: '0644'\n        content: |\n          ===============================================\n          MEDIA CUSTODY TRANSFER FORM\n          MP-5.3 Chain of Custody Documentation\n          ===============================================\n          \n          Transfer ID: _____________________________\n          Date/Time: _______________________________\n          \n          Media Description:\n          Media Type: ______________________________\n          Media ID/Serial: _________________________\n          Classification: __________________________\n          \n          Releasing Custodian:\n          Name: ___________________________________\n          Signature: _______________________________\n          \n          Receiving Custodian:\n          Name: ___________________________________\n          Signature: _______________________________\n          \n          Packaging Verification:\n          [ ] Tamper-evident seal intact\n          [ ] Media count verified\n          [ ] Physical condition acceptable\n          ===============================================\n\n    - name: Create custodian registry template\n      copy:\n        dest: \"{{ custody_dir }}/custodians/registry.csv\"\n        owner: root\n        group: root\n        mode: '0640'\n        content: |\n          # MP-5.3 Custodian Registry\n          # Format: ID,Name,Department,MaxClassification,AuthStart,AuthExpire,Status\n          CUST001,System Administrator,IT Security,CUI,2025-01-01,2026-01-01,Active\n\n    - name: Deploy custody logging script\n      copy:\n        dest: /usr/local/bin/mp53_custody_log.sh\n        owner: root\n        group: root\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # MP-5.3 Custody Event Logger\n          CUSTODY_LOG=\"/etc/media-protection/custody/logs/custody_$(date +%Y%m).log\"\n          case \"$1\" in\n              transfer) echo \"$(date '+%Y-%m-%d %H:%M:%S'),TRANSFER,$2,$3,$4,$5\" >> \"$CUSTODY_LOG\" ;;\n              checkout) echo \"$(date '+%Y-%m-%d %H:%M:%S'),CHECKOUT,$2,$3,$4\" >> \"$CUSTODY_LOG\" ;;\n              checkin) echo \"$(date '+%Y-%m-%d %H:%M:%S'),CHECKIN,$2,$3,$4\" >> \"$CUSTODY_LOG\" ;;\n              *) echo \"Usage: $0 {transfer|checkout|checkin} [args...]\" ;;\n          esac\n\n    - name: Log implementation completion\n      lineinfile:\n        path: \"{{ log_file }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] MP-5.3 Custodians implementation complete\"\n        create: yes\n        owner: root\n        group: root\n        mode: '0640'\n\n    - name: Report status\n      debug:\n        msg: \"MP-5.3 Custodians implementation complete. Templates at {{ custody_dir }}/templates/\"\n"
      },
      "windows": {
        "powershell": "# MP-5.3: Custodians - Media Transport Custodian Management System\n# Creates documentation templates and tracking for media custodians\n$ErrorActionPreference = 'Stop'\n\n$CustodyPath = \"C:\\MediaProtection\\Custody\"\n$LogPath = \"C:\\Logs\"\n$Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n$LogFile = \"$LogPath\\MP-53_Implementation.log\"\n\nfunction Write-Log {\n    param([string]$Message)\n    $entry = \"[$Timestamp] $Message\"\n    if (-not (Test-Path $LogPath)) { New-Item -ItemType Directory -Path $LogPath -Force | Out-Null }\n    Add-Content -Path $LogFile -Value $entry\n    Write-Host $entry\n}\n\nWrite-Log \"Starting MP-5.3 Custodians Implementation\"\n\n# Create directory structure\n$Directories = @(\"Custodians\", \"Transfers\", \"Templates\", \"Logs\")\nforeach ($dir in $Directories) {\n    $path = Join-Path $CustodyPath $dir\n    if (-not (Test-Path $path)) {\n        New-Item -ItemType Directory -Path $path -Force | Out-Null\n    }\n}\n\n# Create custodian registration template\n$CustodianTemplate = @\"\n===============================================\nMEDIA TRANSPORT CUSTODIAN REGISTRATION FORM\nMP-5.3 Compliance Documentation\n===============================================\n\nCustodian Information:\n---------------------\nFull Name: _______________________________\nEmployee ID: _____________________________\nDepartment: ______________________________\nPhone: ___________________________________\nEmail: ___________________________________\n\nAuthorization:\n-------------\nMaximum Classification Authorized: ________\nAuthorization Start Date: _________________\nAuthorization Expiration: _________________\nAuthorizing Official: ____________________\nAuthorization Signature: _________________\nDate: ____________________________________\n\nTraining Verification:\n---------------------\nMedia Handling Training Date: _____________\nSecurity Awareness Training Date: _________\nTrainer Name: ____________________________\n\nAcknowledgment:\n--------------\nI understand my responsibilities as a media custodian including:\n- Maintaining physical possession of media at all times\n- Properly documenting all custody transfers\n- Reporting any security incidents immediately\n- Following all organizational media protection policies\n\nCustodian Signature: _____________________\nDate: ____________________________________\n===============================================\n\"@\nSet-Content -Path \"$CustodyPath\\Templates\\Custodian_Registration.txt\" -Value $CustodianTemplate\n\n# Create custody transfer template\n$TransferTemplate = @\"\n===============================================\nMEDIA CUSTODY TRANSFER FORM\nMP-5.3 Chain of Custody Documentation\n===============================================\n\nTransfer ID: _____________________________\nDate/Time: _______________________________\n\nMedia Description:\n-----------------\nMedia Type: ______________________________\nMedia ID/Serial: _________________________\nClassification: __________________________\nDescription: _____________________________\n\nReleasing Custodian:\n-------------------\nName: ___________________________________\nEmployee ID: _____________________________\nSignature: _______________________________\nDate/Time: _______________________________\n\nReceiving Custodian:\n-------------------\nName: ___________________________________\nEmployee ID: _____________________________\nSignature: _______________________________\nDate/Time: _______________________________\n\nPackaging Verification:\n----------------------\n[ ] Tamper-evident seal intact\n[ ] Media count verified\n[ ] Physical condition acceptable\n[ ] Documentation complete\n\nNotes: ___________________________________\n\nTransfer Witness (if required):\nName: ___________________________________\nSignature: _______________________________\n===============================================\n\"@\nSet-Content -Path \"$CustodyPath\\Templates\\Custody_Transfer.txt\" -Value $TransferTemplate\n\n# Create custodian registry (CSV format)\n$RegistryHeader = @\"\n# MP-5.3 Custodian Registry\n# Format: ID,Name,Department,MaxClassification,AuthStart,AuthExpire,Status\nCUST001,System Administrator,IT Security,CUI,2025-01-01,2026-01-01,Active\n\"@\nSet-Content -Path \"$CustodyPath\\Custodians\\Registry.csv\" -Value $RegistryHeader\n\n# Create custody logging PowerShell function module\n$LoggingModule = @'\nfunction Write-CustodyEvent {\n    param(\n        [Parameter(Mandatory=$true)]\n        [ValidateSet(\"Transfer\",\"Checkout\",\"Checkin\")]\n        [string]$EventType,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$Custodian,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$MediaID,\n        \n        [string]$Details = \"\"\n    )\n    \n    $LogFile = \"C:\\MediaProtection\\Custody\\Logs\\Custody_$(Get-Date -Format 'yyyyMM').log\"\n    $Entry = \"$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss'),$EventType,$Custodian,$MediaID,$Details\"\n    Add-Content -Path $LogFile -Value $Entry\n    Write-Host \"Custody event logged: $EventType for $MediaID\"\n}\n\nExport-ModuleMember -Function Write-CustodyEvent\n'@\n\n$ModulePath = \"$CustodyPath\\MP53_CustodyLogging.psm1\"\nSet-Content -Path $ModulePath -Value $LoggingModule\n\n# Create implementation status document\n$Status = @\"\nMP-5.3 Custodians - Implementation Status\n==========================================\nControl ID: MP-5.3\nControl Name: Custodians\nImplementation Date: $(Get-Date -Format 'yyyy-MM-dd')\nHost: $env:COMPUTERNAME\n\nCreated Artifacts:\n- $CustodyPath\\Templates\\Custodian_Registration.txt\n- $CustodyPath\\Templates\\Custody_Transfer.txt\n- $CustodyPath\\Custodians\\Registry.csv\n- $CustodyPath\\MP53_CustodyLogging.psm1\n\nUsage:\nImport-Module $CustodyPath\\MP53_CustodyLogging.psm1\nWrite-CustodyEvent -EventType Transfer -Custodian \"John Doe\" -MediaID \"USB-001\" -Details \"Transfer to IT\"\n\nStatus: Implemented\n\"@\nSet-Content -Path \"$CustodyPath\\Implementation_Status.txt\" -Value $Status\n\nWrite-Log \"[+] Created custodian registration template\"\nWrite-Log \"[+] Created custody transfer template\"\nWrite-Log \"[+] Created custodian registry\"\nWrite-Log \"[+] Created custody logging module\"\nWrite-Log \"[+] MP-5.3 Custodians implementation complete\"\nWrite-Log \"[+] Documentation at: $CustodyPath\"\n"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control requires organizational procedures for custodian designation, authorization, and chain-of-custody documentation. Scripts provide templates and logging mechanisms to support custody tracking."
    }
  },
  {
    "control_id": "MP-5.4",
    "control_name": "Cryptographic Protection",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "[Withdrawn: Incorporated into SC-28(1)]",
    "parent_control": "MP-5",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "plain_english_explanation": "This control enhancement has been withdrawn in NIST SP 800-53 Rev 5 and its requirements have been incorporated into SC-28(1) Protection of Information at Rest - Cryptographic Protection. The original intent of MP-5(4) was to require cryptographic protection of information on media during transport outside controlled areas. This is now addressed by SC-28(1) which provides comprehensive requirements for cryptographic protection of information at rest, including scenarios where media is being transported. Organizations should implement SC-28(1) to address cryptographic protection for transported media.",
    "ai_guidance": "This enhancement was withdrawn in NIST SP 800-53 Rev 5. For cryptographic protection of media during transport, implement SC-28(1) which requires: (1) Encrypt all sensitive digital media before transport using FIPS 140-2/140-3 validated cryptographic modules. (2) Use AES-256 encryption minimum for data protection. (3) For Linux systems: LUKS encryption for full disk, GPG for file-level encryption, dm-crypt for encrypted containers. (4) For Windows systems: BitLocker for full disk encryption, BitLocker To Go for USB devices, Windows EFS or third-party tools for file-level encryption. (5) Implement secure key management ensuring transport keys are transmitted separately from encrypted media. (6) Use hardware-encrypted portable storage devices (self-encrypting drives) for frequent transport scenarios. (7) Verify encryption before releasing media for transport. (8) Document encryption methods and key management procedures in transport documentation. STIG RHEL-08-010030 applies for disk encryption requirements.",
    "stig_id": "RHEL-08-010030",
    "intent": "[WITHDRAWN] Cryptographic protection requirements for transported media consolidated into SC-28(1) for comprehensive information-at-rest protection.",
    "is_technical": true,
    "withdrawal_info": {
      "withdrawn_version": "Rev 5",
      "incorporated_into": "SC-28(1)",
      "rationale": "Consolidation of cryptographic protection requirements for information at rest into a single comprehensive control"
    },
    "enhancements": [],
    "related_controls": [
      "SC-28",
      "SC-28.1",
      "SC-12",
      "SC-13",
      "MP-5"
    ],
    "supplemental_guidance": "This enhancement has been withdrawn. See SC-28(1) for cryptographic protection requirements applicable to media in transport. Organizations should implement encryption for all digital media transported outside controlled areas.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-5.4 WITHDRAWN - See SC-28(1) for cryptographic protection during transport\n# This script provides encrypted container creation for media transport\nset -euo pipefail\n\nLOG_FILE=\"/var/log/mp54_encryption.log\"\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\nlog_msg() {\n    echo \"[$TIMESTAMP] $1\" | tee -a \"$LOG_FILE\"\n}\n\nlog_msg \"MP-5.4 has been withdrawn and incorporated into SC-28(1)\"\nlog_msg \"Providing encrypted container utilities for media transport compliance\"\n\n# Create encrypted transport container script\ncat > /usr/local/bin/create_transport_container.sh << 'CONTAINEREOF'\n#!/bin/bash\n# Create encrypted container for secure media transport\n# Implements SC-28(1) requirements (replacing withdrawn MP-5.4)\n\nset -euo pipefail\n\nif [ $# -lt 2 ]; then\n    echo \"Usage: $0 <container_name> <size_in_MB>\"\n    echo \"Example: $0 transport_2025 500\"\n    exit 1\nfi\n\nCONTAINER_NAME=\"$1\"\nSIZE_MB=\"$2\"\nCONTAINER_FILE=\"/tmp/${CONTAINER_NAME}.enc\"\nMOUNT_POINT=\"/mnt/transport_${CONTAINER_NAME}\"\n\necho \"=== Creating Encrypted Transport Container ===\"\necho \"Container: $CONTAINER_FILE\"\necho \"Size: ${SIZE_MB}MB\"\necho \"Mount Point: $MOUNT_POINT\"\necho \"\"\n\n# Create container file\ndd if=/dev/zero of=\"$CONTAINER_FILE\" bs=1M count=\"$SIZE_MB\" status=progress\n\n# Setup LUKS encryption (AES-256-XTS)\necho \"Configuring LUKS encryption (AES-256-XTS)...\"\ncryptsetup luksFormat --type luks2 --cipher aes-xts-plain64 --key-size 512 --hash sha256 \"$CONTAINER_FILE\"\n\n# Open encrypted container\necho \"Opening encrypted container...\"\ncryptsetup open \"$CONTAINER_FILE\" \"transport_${CONTAINER_NAME}\"\n\n# Create filesystem\nmkfs.ext4 \"/dev/mapper/transport_${CONTAINER_NAME}\"\n\n# Mount container\nmkdir -p \"$MOUNT_POINT\"\nmount \"/dev/mapper/transport_${CONTAINER_NAME}\" \"$MOUNT_POINT\"\n\necho \"\"\necho \"=== Encrypted Container Ready ===\"\necho \"Mount point: $MOUNT_POINT\"\necho \"Copy files to transport, then unmount with:\"\necho \"  umount $MOUNT_POINT\"\necho \"  cryptsetup close transport_${CONTAINER_NAME}\"\necho \"\"\necho \"Container file for transport: $CONTAINER_FILE\"\nCONTAINEREOF\nchmod 750 /usr/local/bin/create_transport_container.sh\n\n# Create GPG encryption script for individual files\ncat > /usr/local/bin/encrypt_for_transport.sh << 'GPGEOF'\n#!/bin/bash\n# Encrypt file for secure transport using GPG (AES-256)\n# Implements SC-28(1) file-level encryption\n\nif [ $# -lt 1 ]; then\n    echo \"Usage: $0 <file_to_encrypt> [recipient_email]\"\n    echo \"  If no recipient specified, uses symmetric encryption\"\n    exit 1\nfi\n\nFILE=\"$1\"\nRECIPIENT=\"${2:-}\"\n\nif [ ! -f \"$FILE\" ]; then\n    echo \"Error: File not found: $FILE\"\n    exit 1\nfi\n\nif [ -n \"$RECIPIENT\" ]; then\n    echo \"Encrypting with public key for: $RECIPIENT\"\n    gpg --encrypt --recipient \"$RECIPIENT\" --armor --output \"${FILE}.gpg\" \"$FILE\"\nelse\n    echo \"Using symmetric encryption (AES-256)\"\n    gpg --symmetric --cipher-algo AES256 --armor --output \"${FILE}.gpg\" \"$FILE\"\nfi\n\necho \"Encrypted file: ${FILE}.gpg\"\necho \"Original file retained. Securely delete original before transport:\"\necho \"  shred -vfz -n 3 $FILE\"\nGPGEOF\nchmod 750 /usr/local/bin/encrypt_for_transport.sh\n\nlog_msg \"[+] Created /usr/local/bin/create_transport_container.sh\"\nlog_msg \"[+] Created /usr/local/bin/encrypt_for_transport.sh\"\nlog_msg \"[+] Refer to SC-28(1) implementation for complete cryptographic requirements\"\n",
        "ansible": "---\n# MP-5.4 WITHDRAWN - Incorporated into SC-28(1)\n# This playbook provides encryption utilities for media transport compliance\n- name: MP-5.4 Cryptographic Protection (WITHDRAWN - See SC-28.1)\n  hosts: all\n  become: yes\n  gather_facts: yes\n\n  vars:\n    control_id: \"MP-5.4\"\n    control_status: \"WITHDRAWN\"\n    incorporated_into: \"SC-28(1)\"\n    log_file: \"/var/log/mp54_withdrawn.log\"\n\n  tasks:\n    - name: Document withdrawal status\n      copy:\n        dest: \"/etc/compliance/mp-5-4_withdrawn.txt\"\n        owner: root\n        group: root\n        mode: '0644'\n        content: |\n          # MP-5.4 Cryptographic Protection\n          Status: WITHDRAWN in NIST SP 800-53 Rev 5\n          Incorporated Into: SC-28(1) Protection of Information at Rest\n          \n          Organizations should implement SC-28(1) for:\n          - Full disk encryption (LUKS, BitLocker) for transported media\n          - File-level encryption (GPG, VeraCrypt) for sensitive files\n          - FIPS 140-2/140-3 validated cryptographic modules\n          - Secure key management for transport scenarios\n          \n          STIG Reference: RHEL-08-010030\n          \n          Scripts provided for transport encryption:\n          - /usr/local/bin/create_transport_container.sh\n          - /usr/local/bin/encrypt_for_transport.sh\n\n    - name: Deploy encrypted container creation script\n      copy:\n        dest: /usr/local/bin/create_transport_container.sh\n        owner: root\n        group: root\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # Create LUKS encrypted container for secure media transport\n          # Implements SC-28(1) requirements (replacing withdrawn MP-5.4)\n          set -euo pipefail\n          \n          if [ $# -lt 2 ]; then\n              echo \"Usage: $0 <container_name> <size_in_MB>\"\n              exit 1\n          fi\n          \n          CONTAINER=\"$1\"\n          SIZE=\"$2\"\n          FILE=\"/tmp/${CONTAINER}.enc\"\n          \n          dd if=/dev/zero of=\"$FILE\" bs=1M count=\"$SIZE\" status=progress\n          cryptsetup luksFormat --type luks2 --cipher aes-xts-plain64 --key-size 512 \"$FILE\"\n          echo \"Container created: $FILE\"\n\n    - name: Deploy GPG file encryption script\n      copy:\n        dest: /usr/local/bin/encrypt_for_transport.sh\n        owner: root\n        group: root\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # Encrypt file for transport using GPG AES-256\n          if [ $# -lt 1 ]; then\n              echo \"Usage: $0 <file> [recipient]\"\n              exit 1\n          fi\n          \n          FILE=\"$1\"\n          RCPT=\"${2:-}\"\n          \n          if [ -n \"$RCPT\" ]; then\n              gpg --encrypt --recipient \"$RCPT\" --armor -o \"${FILE}.gpg\" \"$FILE\"\n          else\n              gpg --symmetric --cipher-algo AES256 --armor -o \"${FILE}.gpg\" \"$FILE\"\n          fi\n          echo \"Encrypted: ${FILE}.gpg\"\n\n    - name: Ensure cryptsetup and gpg are installed\n      package:\n        name:\n          - cryptsetup\n          - gnupg2\n        state: present\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Log withdrawal notice\n      lineinfile:\n        path: \"{{ log_file }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] MP-5.4 WITHDRAWN - See SC-28(1) for cryptographic protection\"\n        create: yes\n"
      },
      "windows": {
        "powershell": "# MP-5.4 WITHDRAWN - See SC-28(1) for cryptographic media transport protection\n# This script provides encryption utilities for media transport compliance\n$ErrorActionPreference = 'Continue'\n\n$ConfigPath = \"C:\\ConfigManagement\\MP-5-4\"\n$LogPath = \"C:\\Logs\"\n$Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n$LogFile = \"$LogPath\\MP-54_Implementation.log\"\n\nfunction Write-Log {\n    param([string]$Message)\n    $entry = \"[$Timestamp] $Message\"\n    if (-not (Test-Path $LogPath)) { New-Item -ItemType Directory -Path $LogPath -Force | Out-Null }\n    Add-Content -Path $LogFile -Value $entry\n    Write-Host $entry\n}\n\nWrite-Log \"MP-5.4 has been withdrawn and incorporated into SC-28(1)\"\n\n# Create configuration directory\nif (-not (Test-Path $ConfigPath)) {\n    New-Item -ItemType Directory -Path $ConfigPath -Force | Out-Null\n}\n\n# Document withdrawal status\n$WithdrawalDoc = @\"\nMP-5.4 Cryptographic Protection - WITHDRAWAL NOTICE\n====================================================\nStatus: WITHDRAWN in NIST SP 800-53 Rev 5\nIncorporated Into: SC-28(1) Protection of Information at Rest\n\nOrganizations should implement SC-28(1) for media transport encryption:\n\n1. BitLocker Drive Encryption\n   - Use for full disk encryption on portable drives\n   - Enable BitLocker To Go for USB devices\n   - Configure AES-256 encryption\n\n2. Windows EFS (Encrypting File System)\n   - File-level encryption for individual sensitive files\n   - Requires certificate management\n\n3. Third-party Options\n   - VeraCrypt for cross-platform encrypted containers\n   - 7-Zip with AES-256 encryption for archives\n\n4. Key Management\n   - Store recovery keys securely\n   - Transmit keys separately from encrypted media\n   - Document key management procedures\n\nProvided Scripts:\n- Encrypt-TransportFile.ps1 - Encrypt files for transport\n- New-EncryptedContainer.ps1 - Create encrypted VHD containers\n\"@\n\nSet-Content -Path \"$ConfigPath\\Withdrawal_Notice.txt\" -Value $WithdrawalDoc\n\n# Create file encryption script\n$EncryptScript = @'\n# Encrypt file for transport using Windows EFS or compression encryption\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$FilePath,\n    \n    [Parameter(Mandatory=$false)]\n    [string]$Password,\n    \n    [Parameter(Mandatory=$false)]\n    [ValidateSet(\"7zip\",\"Compress\")]\n    [string]$Method = \"Compress\"\n)\n\nif (-not (Test-Path $FilePath)) {\n    Write-Error \"File not found: $FilePath\"\n    exit 1\n}\n\n$OutputFile = \"$FilePath.encrypted.zip\"\n\nif ($Method -eq \"7zip\") {\n    # Requires 7-Zip installation\n    $7z = \"C:\\Program Files\\7-Zip\\7z.exe\"\n    if (Test-Path $7z) {\n        if ($Password) {\n            & $7z a -tzip -p\"$Password\" -mem=AES256 $OutputFile $FilePath\n        } else {\n            Write-Host \"Password required for 7-Zip encryption\"\n            $secPwd = Read-Host -AsSecureString \"Enter encryption password\"\n            $pwd = [Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR($secPwd))\n            & $7z a -tzip -p\"$pwd\" -mem=AES256 $OutputFile $FilePath\n        }\n    } else {\n        Write-Error \"7-Zip not found. Install from https://7-zip.org\"\n        exit 1\n    }\n} else {\n    # Use built-in compression (note: limited encryption)\n    Compress-Archive -Path $FilePath -DestinationPath $OutputFile -Force\n    Write-Warning \"Built-in compression has limited encryption. Use 7-Zip for AES-256.\"\n}\n\nWrite-Host \"Encrypted file created: $OutputFile\"\nWrite-Host \"Securely delete original before transport.\"\n'@\n\nSet-Content -Path \"$ConfigPath\\Encrypt-TransportFile.ps1\" -Value $EncryptScript\n\n# Create encrypted VHD container script\n$VhdScript = @'\n# Create encrypted VHD container for secure media transport\n# Requires BitLocker and administrator privileges\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$ContainerName,\n    \n    [Parameter(Mandatory=$true)]\n    [int]$SizeMB\n)\n\n$VhdPath = \"C:\\TransportContainers\\$ContainerName.vhdx\"\n$MountLetter = \"T\"\n\n# Create container directory\nif (-not (Test-Path \"C:\\TransportContainers\")) {\n    New-Item -ItemType Directory -Path \"C:\\TransportContainers\" -Force | Out-Null\n}\n\nWrite-Host \"Creating encrypted transport container...\"\nWrite-Host \"Path: $VhdPath\"\nWrite-Host \"Size: ${SizeMB}MB\"\n\n# Create VHD\nNew-VHD -Path $VhdPath -SizeBytes (${SizeMB}MB) -Dynamic\n\n# Mount VHD\n$vhd = Mount-VHD -Path $VhdPath -PassThru\n\n# Initialize and format disk\n$disk = Initialize-Disk -Number $vhd.DiskNumber -PartitionStyle GPT -PassThru\n$partition = New-Partition -DiskNumber $disk.DiskNumber -UseMaximumSize -DriveLetter $MountLetter\nFormat-Volume -DriveLetter $MountLetter -FileSystem NTFS -NewFileSystemLabel \"SecureTransport\"\n\n# Enable BitLocker\nWrite-Host \"Enabling BitLocker encryption (AES-256)...\"\nEnable-BitLocker -MountPoint \"${MountLetter}:\" -EncryptionMethod Aes256 -PasswordProtector\n\nWrite-Host \"\"\nWrite-Host \"=== Encrypted Container Ready ===\"\nWrite-Host \"Drive letter: ${MountLetter}:\"\nWrite-Host \"Copy files, then lock with: Lock-BitLocker -MountPoint ${MountLetter}:\"\nWrite-Host \"Dismount with: Dismount-VHD -Path $VhdPath\"\n'@\n\nSet-Content -Path \"$ConfigPath\\New-EncryptedContainer.ps1\" -Value $VhdScript\n\n# Check BitLocker status\nWrite-Log \"Checking BitLocker availability...\"\ntry {\n    $BitLocker = Get-BitLockerVolume -ErrorAction SilentlyContinue\n    if ($BitLocker) {\n        Write-Log \"[+] BitLocker is available on this system\"\n    }\n} catch {\n    Write-Log \"[-] BitLocker check failed - may require feature installation\"\n}\n\nWrite-Log \"[+] Created encryption utilities at $ConfigPath\"\nWrite-Log \"[+] Refer to SC-28(1) implementation for complete cryptographic requirements\"\nWrite-Log \"[+] MP-5.4 (WITHDRAWN) documentation complete\"\n"
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000000+00:00",
      "source": "ComplianceAsCode",
      "cac_status": "withdrawn",
      "stig_references": [
        "RHEL-08-010030"
      ],
      "implementation_guidance": "WITHDRAWN in Rev 5. Implement SC-28(1) for cryptographic protection of media during transport. Scripts provided create encrypted containers and file encryption utilities."
    }
  },
  {
    "control_id": "MP-6",
    "control_name": "Media Sanitization",
    "family": "Media Protection",
    "family_id": "MP",
    "stig_id": null,
    "official_text": "a. Sanitize [Assignment: organization-defined system media] prior to disposal, release out of organizational control, or release for reuse using [Assignment: organization-defined sanitization techniques and procedures]; and b. Employ sanitization mechanisms with the strength and integrity commensurate with the security category or classification of the information.",
    "intent": "Ensure sensitive information on media is securely erased before disposal, release, or reuse to prevent unauthorized disclosure.",
    "plain_english_explanation": "Media Sanitization requires organizations to securely remove all data from storage devices (hard drives, USB drives, SSDs, etc.) before disposing of them, giving them to someone outside the organization, or reusing them for a different purpose. The sanitization method used must be appropriate for the sensitivity of the data - more sensitive data requires more thorough sanitization. This prevents data breaches from discarded or reassigned storage media.",
    "ai_guidance": "Implement media sanitization following NIST SP 800-88 Guidelines for Media Sanitization. For magnetic media, use secure erase commands or degaussing. For SSDs and flash media, use manufacturer secure erase or physical destruction due to wear leveling. Maintain a media sanitization log tracking: device serial number, sanitization date, method used, and personnel performing sanitization. For organizational implementation: 1) Classify all media by data sensitivity level, 2) Define sanitization methods per classification (Clear for low, Purge for moderate, Destroy for high), 3) Train personnel on proper sanitization procedures, 4) Verify sanitization through sampling or forensic tools, 5) Document all sanitization activities for audit purposes. Consider using automated disk wiping stations for volume operations.",
    "is_technical": false,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "enhancements": [
      {
        "id": "MP-6.1",
        "title": "Review, Approve, Track, Document, and Verify"
      },
      {
        "id": "MP-6.2",
        "title": "Equipment Testing"
      },
      {
        "id": "MP-6.3",
        "title": "Nondestructive Techniques"
      },
      {
        "id": "MP-6.7",
        "title": "Dual Authorization"
      },
      {
        "id": "MP-6.8",
        "title": "Remote Purging or Wiping of Information"
      }
    ],
    "related_controls": [
      "MA-2",
      "MA-4",
      "MP-4",
      "SC-4",
      "SI-12",
      "SR-11"
    ],
    "supplemental_guidance": "Media sanitization applies to all digital and non-digital media. NIST SP 800-88 provides guidance on media sanitization.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6: Media Sanitization Status Check\n# Verifies secure deletion tools are available\n\necho '=== MP-6 Media Sanitization Capability Check ==='\n\n# Check for secure deletion tools\ntools=(\"shred\" \"wipe\" \"scrub\" \"dd\")\nfor tool in \"${tools[@]}\"; do\n    if command -v $tool &> /dev/null; then\n        echo \"[PASS] $tool is available\"\n    else\n        echo \"[INFO] $tool not installed - install with: yum install $(rpm -qf $(which $tool 2>/dev/null) 2>/dev/null || echo $tool)\"\n    fi\ndone\n\n# Check for hdparm (ATA secure erase)\nif command -v hdparm &> /dev/null; then\n    echo \"[PASS] hdparm available for ATA Secure Erase\"\nelse\n    echo \"[INFO] Install hdparm for ATA Secure Erase: yum install hdparm\"\nfi\n\necho '\\nSanitization methods by media type:'\necho '  HDD: shred -vfz -n 3 /dev/sdX or hdparm --security-erase'\necho '  SSD: hdparm --security-erase or physical destruction'\necho '  USB: shred -vfz -n 3 /dev/sdX'\necho '  Refer to NIST SP 800-88 for complete guidance'",
        "ansible": "---\n# MP-6: Media Sanitization Tools Installation\n- name: Ensure media sanitization tools are installed\n  hosts: all\n  become: yes\n  tasks:\n    - name: Install secure deletion tools (RHEL/CentOS)\n      yum:\n        name:\n          - coreutils  # includes shred\n          - hdparm     # ATA secure erase\n          - util-linux # includes blkdiscard\n        state: present\n      when: ansible_os_family == 'RedHat'\n\n    - name: Create sanitization log directory\n      file:\n        path: /var/log/media-sanitization\n        state: directory\n        mode: '0750'\n        owner: root\n        group: root\n\n    - name: Deploy sanitization logging script\n      copy:\n        dest: /usr/local/bin/log-sanitization.sh\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          echo \"$(date -Iseconds),${USER},$1,$2,$3\" >> /var/log/media-sanitization/sanitization.log"
      },
      "windows": {
        "powershell": "# MP-6: Media Sanitization Capability Check\n# Verifies Windows sanitization tools\n\nWrite-Host '=== MP-6 Media Sanitization Capability Check ===' -ForegroundColor Cyan\n\n# Check for Cipher (built-in)\n$cipher = Get-Command cipher.exe -ErrorAction SilentlyContinue\nif ($cipher) {\n    Write-Host '[PASS] Cipher.exe available for secure file deletion' -ForegroundColor Green\n    Write-Host '  Usage: cipher /w:C:\\path\\to\\folder' -ForegroundColor Gray\n} else {\n    Write-Host '[FAIL] Cipher.exe not found' -ForegroundColor Red\n}\n\n# Check for SDelete (Sysinternals)\n$sdelete = Get-Command sdelete.exe -ErrorAction SilentlyContinue\nif ($sdelete) {\n    Write-Host '[PASS] SDelete available' -ForegroundColor Green\n} else {\n    Write-Host '[INFO] SDelete not installed - Download from Sysinternals' -ForegroundColor Yellow\n}\n\n# Check BitLocker status\n$bl = Get-BitLockerVolume -ErrorAction SilentlyContinue\nif ($bl) {\n    Write-Host '[INFO] BitLocker available - encrypted drives can be sanitized by key destruction' -ForegroundColor Cyan\n}\n\nWrite-Host \"`nSanitization methods:\"\nWrite-Host '  Files: cipher /w:C:\\ or SDelete -p 3 -s C:\\path'\nWrite-Host '  Drive: Format with /P:3 or use manufacturer secure erase'\nWrite-Host '  SSD: Use manufacturer secure erase tool'\nWrite-Host '  Refer to NIST SP 800-88 for complete guidance'"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-6.1",
    "control_name": "Review, Approve, Track, Document, and Verify",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "Review, approve, track, document, and verify media sanitization and disposal actions.",
    "intent": "Establish accountability and auditability for all media sanitization activities through formal review and documentation processes.",
    "plain_english_explanation": "This enhancement requires organizations to implement a formal process for media sanitization that includes management review and approval before sanitization occurs, tracking of all media through the sanitization process, detailed documentation of what was sanitized and how, and verification that the sanitization was successful. This creates an audit trail and ensures proper oversight of data destruction activities.",
    "ai_guidance": "Implement a media sanitization workflow system with the following components: 1) Request submission form capturing device details (serial number, asset tag, data classification, reason for sanitization), 2) Approval workflow routing to data owner and security officer, 3) Tracking system with unique sanitization job IDs, 4) Documentation templates recording: sanitization date/time, method used, personnel involved, verification results, 5) Verification process using forensic sampling or certification from sanitization tools, 6) Secure certificate of destruction generation. Maintain records per retention requirements. Consider implementing barcode/RFID tracking for physical media chain of custody. Integrate with asset management system for automatic inventory updates post-sanitization.",
    "is_technical": true,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "related_controls": [
      "MP-6",
      "AU-2",
      "AU-6"
    ],
    "supplemental_guidance": "Organizations review and approve media to be sanitized to ensure compliance with records retention policies.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6.1: Media Sanitization Tracking and Documentation\n# Creates sanitization record with verification\n\nSAN_LOG=\"/var/log/media-sanitization/sanitization.log\"\nSAN_DIR=\"/var/log/media-sanitization\"\n\nmkdir -p \"$SAN_DIR\"\n\n# Function to log sanitization\nlog_sanitization() {\n    local DEVICE=$1\n    local METHOD=$2\n    local SERIAL=$(hdparm -I $DEVICE 2>/dev/null | grep 'Serial Number' | awk '{print $3}')\n    local JOB_ID=$(uuidgen)\n    local TIMESTAMP=$(date -Iseconds)\n    local USER=$(whoami)\n    \n    echo \"$JOB_ID,$TIMESTAMP,$USER,$DEVICE,$SERIAL,$METHOD,PENDING_VERIFICATION\" >> \"$SAN_LOG\"\n    echo \"Sanitization job $JOB_ID created for $DEVICE\"\n    echo \"Method: $METHOD\"\n    echo \"Awaiting verification...\"\n}\n\n# Function to verify and complete\nverify_sanitization() {\n    local JOB_ID=$1\n    local VERIFIER=$(whoami)\n    local TIMESTAMP=$(date -Iseconds)\n    \n    # Update log with verification\n    sed -i \"s/$JOB_ID,\\(.*\\),PENDING_VERIFICATION/$JOB_ID,\\1,VERIFIED,$VERIFIER,$TIMESTAMP/\" \"$SAN_LOG\"\n    echo \"Job $JOB_ID verified by $VERIFIER at $TIMESTAMP\"\n}\n\necho 'MP-6.1 Sanitization tracking system initialized'\necho \"Log file: $SAN_LOG\"",
        "ansible": "---\n# MP-6.1: Sanitization Tracking System Deployment\n- name: Deploy media sanitization tracking system\n  hosts: all\n  become: yes\n  vars:\n    san_log_dir: /var/log/media-sanitization\n    san_db: /var/lib/media-sanitization/tracking.db\n  tasks:\n    - name: Create sanitization directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n        owner: root\n        group: security\n      loop:\n        - \"{{ san_log_dir }}\"\n        - /var/lib/media-sanitization\n\n    - name: Initialize SQLite tracking database\n      shell: |\n        sqlite3 {{ san_db }} <<EOF\n        CREATE TABLE IF NOT EXISTS sanitization_jobs (\n          job_id TEXT PRIMARY KEY,\n          device TEXT,\n          serial TEXT,\n          method TEXT,\n          requester TEXT,\n          approver TEXT,\n          status TEXT,\n          created_at DATETIME,\n          completed_at DATETIME,\n          verified_by TEXT\n        );\n        EOF\n      args:\n        creates: \"{{ san_db }}\"\n\n    - name: Set database permissions\n      file:\n        path: \"{{ san_db }}\"\n        mode: '0640'\n        owner: root\n        group: security"
      },
      "windows": {
        "powershell": "# MP-6.1: Media Sanitization Tracking System\n# Creates audit trail for all sanitization activities\n\n$SanLogPath = 'C:\\ProgramData\\MediaSanitization'\n$SanLogFile = Join-Path $SanLogPath 'sanitization_log.csv'\n\n# Initialize log directory and file\nif (-not (Test-Path $SanLogPath)) {\n    New-Item -ItemType Directory -Path $SanLogPath -Force\n    # Initialize CSV with headers\n    'JobID,Timestamp,Requester,Approver,Device,SerialNumber,Method,Status,VerifiedBy,VerifiedAt' | \n        Out-File -FilePath $SanLogFile -Encoding UTF8\n}\n\nfunction New-SanitizationRequest {\n    param(\n        [string]$Device,\n        [string]$Method,\n        [string]$Approver\n    )\n    \n    $JobID = [guid]::NewGuid().ToString()\n    $Timestamp = Get-Date -Format 'o'\n    $Requester = $env:USERNAME\n    \n    # Get device serial if possible\n    $Serial = (Get-WmiObject Win32_DiskDrive | Where-Object {$_.DeviceID -like \"*$Device*\"}).SerialNumber\n    \n    $Record = \"$JobID,$Timestamp,$Requester,$Approver,$Device,$Serial,$Method,PENDING_APPROVAL,,\"\n    Add-Content -Path $SanLogFile -Value $Record\n    \n    Write-Host \"Sanitization request created: $JobID\" -ForegroundColor Green\n    return $JobID\n}\n\nfunction Complete-SanitizationVerification {\n    param([string]$JobID, [string]$Verifier)\n    \n    $VerifyTime = Get-Date -Format 'o'\n    # Update the CSV record (simplified - production would use proper CSV manipulation)\n    Write-Host \"Job $JobID verified by $Verifier at $VerifyTime\" -ForegroundColor Green\n}\n\nWrite-Host 'MP-6.1 Sanitization tracking system initialized' -ForegroundColor Cyan\nWrite-Host \"Log file: $SanLogFile\""
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-6.2",
    "control_name": "Equipment Testing",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "Test sanitization equipment and procedures [Assignment: organization-defined frequency] to ensure that the intended sanitization is being achieved.",
    "intent": "Verify that sanitization equipment and procedures function correctly and effectively destroy data as intended.",
    "plain_english_explanation": "Organizations must periodically test their media sanitization equipment (disk wipers, degaussers, shredders) and procedures to confirm they actually work as expected. This involves running test sanitizations and then attempting to recover data to verify it was properly destroyed. Testing frequency should be based on how often equipment is used and the sensitivity of data being sanitized.",
    "ai_guidance": "Establish a sanitization equipment testing program: 1) Create test media with known data patterns for verification, 2) Schedule regular testing (quarterly for high-use equipment, annually for low-use), 3) Document test procedures including: equipment model/serial, test date, test media used, sanitization settings, recovery attempt results, 4) Use forensic tools (Autopsy, FTK, PhotoRec) to verify no recoverable data remains, 5) Maintain calibration records for degaussers, 6) Test after equipment maintenance or repair, 7) Retain test records for audit purposes. For software-based sanitization, verify correct implementation of DoD 5220.22-M, NIST SP 800-88 Clear/Purge standards.",
    "is_technical": true,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "related_controls": [
      "MP-6",
      "MP-6.1"
    ],
    "supplemental_guidance": "Testing of sanitization equipment ensures that equipment performance is adequate for the intended purpose.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6.2: Sanitization Equipment Testing\n# Tests disk wiping tools with verification\n\nTEST_FILE=\"/tmp/san_test_$(date +%s)\"\nTEST_SIZE=\"10M\"\n\necho '=== MP-6.2 Sanitization Tool Testing ==='\n\n# Create test file with known pattern\necho 'Creating test file with known pattern...'\ndd if=/dev/urandom of=\"$TEST_FILE\" bs=1M count=10 2>/dev/null\nORIG_HASH=$(sha256sum \"$TEST_FILE\" | awk '{print $1}')\necho \"Original hash: $ORIG_HASH\"\n\n# Test shred\necho -e '\\nTesting shred...'\ncp \"$TEST_FILE\" \"${TEST_FILE}_shred\"\nshred -vfz -n 3 \"${TEST_FILE}_shred\" 2>&1 | tail -5\n\n# Verify file is destroyed\nif [ ! -f \"${TEST_FILE}_shred\" ]; then\n    echo '[PASS] shred: File successfully destroyed'\nelse\n    FINAL_HASH=$(sha256sum \"${TEST_FILE}_shred\" 2>/dev/null | awk '{print $1}')\n    if [ \"$FINAL_HASH\" != \"$ORIG_HASH\" ]; then\n        echo '[PASS] shred: File content destroyed'\n    else\n        echo '[FAIL] shred: File content may remain'\n    fi\nfi\n\n# Test dd zero-fill\necho -e '\\nTesting dd zero-fill...'\ncp \"$TEST_FILE\" \"${TEST_FILE}_dd\"\ndd if=/dev/zero of=\"${TEST_FILE}_dd\" bs=1M count=10 conv=notrunc 2>/dev/null\nZERO_HASH=$(sha256sum \"${TEST_FILE}_dd\" | awk '{print $1}')\nif [ \"$ZERO_HASH\" != \"$ORIG_HASH\" ]; then\n    echo '[PASS] dd zero-fill: Content overwritten'\nelse\n    echo '[FAIL] dd zero-fill: Content may remain'\nfi\n\n# Cleanup\nrm -f \"$TEST_FILE\" \"${TEST_FILE}_dd\"\n\necho -e '\\nTest complete. Log results per MP-6.1 requirements.'",
        "ansible": "---\n# MP-6.2: Sanitization Equipment Testing Playbook\n- name: Test sanitization equipment and procedures\n  hosts: sanitization_stations\n  become: yes\n  vars:\n    test_dir: /var/lib/san-testing\n    report_dir: /var/log/media-sanitization/equipment-tests\n  tasks:\n    - name: Create test directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n      loop:\n        - \"{{ test_dir }}\"\n        - \"{{ report_dir }}\"\n\n    - name: Create test data file\n      shell: dd if=/dev/urandom of={{ test_dir }}/test_data bs=1M count=100\n      args:\n        creates: \"{{ test_dir }}/test_data\"\n\n    - name: Record original hash\n      shell: sha256sum {{ test_dir }}/test_data > {{ test_dir }}/original_hash.txt\n\n    - name: Test shred utility\n      shell: |\n        cp {{ test_dir }}/test_data {{ test_dir }}/shred_test\n        time shred -vfz -n 3 {{ test_dir }}/shred_test 2>&1\n      register: shred_result\n\n    - name: Generate test report\n      copy:\n        dest: \"{{ report_dir }}/test_{{ ansible_date_time.date }}.txt\"\n        content: |\n          Equipment Test Report - {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          Shred Test: {{ 'PASS' if shred_result.rc == 0 else 'FAIL' }}\n          Duration: {{ shred_result.delta | default('N/A') }}"
      },
      "windows": {
        "powershell": "# MP-6.2: Sanitization Equipment Testing\n# Tests Windows sanitization tools\n\n$TestDir = 'C:\\Temp\\SanitizationTest'\n$ReportDir = 'C:\\ProgramData\\MediaSanitization\\EquipmentTests'\n\n# Create directories\nNew-Item -ItemType Directory -Path $TestDir -Force | Out-Null\nNew-Item -ItemType Directory -Path $ReportDir -Force | Out-Null\n\nWrite-Host '=== MP-6.2 Sanitization Tool Testing ===' -ForegroundColor Cyan\n\n# Create test file with known content\n$TestFile = Join-Path $TestDir 'test_data.bin'\n$RandomBytes = New-Object byte[] (10MB)\n[System.Security.Cryptography.RandomNumberGenerator]::Fill($RandomBytes)\n[System.IO.File]::WriteAllBytes($TestFile, $RandomBytes)\n$OrigHash = (Get-FileHash $TestFile -Algorithm SHA256).Hash\nWrite-Host \"Original hash: $OrigHash\"\n\n# Test Cipher /w\nWrite-Host \"`nTesting Cipher /w (free space wipe)...\" -ForegroundColor Yellow\n$CipherTest = Join-Path $TestDir 'cipher_test'\nNew-Item -ItemType Directory -Path $CipherTest -Force | Out-Null\nCopy-Item $TestFile (Join-Path $CipherTest 'testfile.bin')\nRemove-Item (Join-Path $CipherTest 'testfile.bin')\n$CipherStart = Get-Date\ncipher /w:$CipherTest 2>&1 | Out-Null\n$CipherDuration = (Get-Date) - $CipherStart\nWrite-Host \"[PASS] Cipher /w completed in $($CipherDuration.TotalSeconds) seconds\" -ForegroundColor Green\n\n# Generate report\n$Report = @\"\nEquipment Test Report - $(Get-Date -Format 'o')\nHost: $env:COMPUTERNAME\nTest File Size: 10 MB\nOriginal Hash: $OrigHash\nCipher /w Test: PASS (Duration: $($CipherDuration.TotalSeconds)s)\n\nRecommendation: Verify with forensic tools that no recoverable data remains.\n\"@\n\n$ReportFile = Join-Path $ReportDir \"test_$(Get-Date -Format 'yyyy-MM-dd').txt\"\n$Report | Out-File $ReportFile\nWrite-Host \"`nReport saved: $ReportFile\" -ForegroundColor Cyan\n\n# Cleanup\nRemove-Item $TestDir -Recurse -Force"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-6.3",
    "control_name": "Nondestructive Techniques",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "Apply nondestructive sanitization techniques to portable storage devices prior to connecting such devices to the system under the following circumstances: [Assignment: organization-defined circumstances requiring sanitization of portable storage devices].",
    "intent": "Prevent malware introduction by sanitizing portable storage devices before they connect to organizational systems.",
    "plain_english_explanation": "Before connecting any portable storage device (USB drive, external hard drive, memory card) to your organization's systems, you must sanitize it using methods that clean the device without destroying it. This prevents malware or unauthorized data from being introduced to your network through infected or compromised portable media. The circumstances requiring this (e.g., all external devices, devices from untrusted sources) are defined by your organization.",
    "ai_guidance": "Implement pre-connection sanitization for portable media: 1) Deploy dedicated sanitization kiosks/workstations isolated from production network, 2) Use write-blockers during initial scan to prevent auto-execution, 3) Perform full antivirus/antimalware scan before sanitization, 4) Apply nondestructive sanitization: format with full overwrite (not quick format), or use tools like shred/SDelete on all files while preserving partition structure, 5) Re-scan after sanitization before allowing network connection, 6) Log all sanitized devices with serial numbers and timestamps. For high-security environments, consider using USB data diodes or one-way transfer stations. Train users never to connect unsanitized media directly to production systems.",
    "is_technical": true,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "related_controls": [
      "MP-6",
      "MP-7",
      "SC-41",
      "SI-3"
    ],
    "supplemental_guidance": "Nondestructive sanitization removes malware while preserving the device for reuse.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6.3: Nondestructive Portable Media Sanitization\n# Sanitizes USB devices without destroying the device\n\nif [ -z \"$1\" ]; then\n    echo 'Usage: $0 /dev/sdX'\n    echo 'WARNING: This will DESTROY all data on the device!'\n    exit 1\nfi\n\nDEVICE=$1\nLOG_FILE=\"/var/log/media-sanitization/portable_$(date +%Y%m%d_%H%M%S).log\"\n\necho \"=== MP-6.3 Nondestructive Media Sanitization ===\" | tee -a \"$LOG_FILE\"\necho \"Device: $DEVICE\" | tee -a \"$LOG_FILE\"\necho \"Date: $(date -Iseconds)\" | tee -a \"$LOG_FILE\"\necho \"Operator: $(whoami)\" | tee -a \"$LOG_FILE\"\n\n# Get device info\necho -e '\\nDevice Information:' | tee -a \"$LOG_FILE\"\nlsblk \"$DEVICE\" 2>&1 | tee -a \"$LOG_FILE\"\n\n# Confirm\nread -p 'Proceed with sanitization? (yes/no): ' CONFIRM\nif [ \"$CONFIRM\" != \"yes\" ]; then\n    echo 'Aborted.' | tee -a \"$LOG_FILE\"\n    exit 1\nfi\n\n# Unmount if mounted\numount \"${DEVICE}\"* 2>/dev/null\n\n# Sanitization - 3 pass overwrite\necho -e '\\nPass 1/3: Random data...' | tee -a \"$LOG_FILE\"\ndd if=/dev/urandom of=\"$DEVICE\" bs=4M status=progress 2>&1 | tee -a \"$LOG_FILE\"\n\necho -e '\\nPass 2/3: Zero fill...' | tee -a \"$LOG_FILE\"\ndd if=/dev/zero of=\"$DEVICE\" bs=4M status=progress 2>&1 | tee -a \"$LOG_FILE\"\n\necho -e '\\nPass 3/3: Random data...' | tee -a \"$LOG_FILE\"\ndd if=/dev/urandom of=\"$DEVICE\" bs=4M status=progress 2>&1 | tee -a \"$LOG_FILE\"\n\n# Create fresh filesystem\necho -e '\\nCreating new FAT32 filesystem...' | tee -a \"$LOG_FILE\"\nmkfs.vfat -F 32 \"$DEVICE\" 2>&1 | tee -a \"$LOG_FILE\"\n\necho -e '\\n[COMPLETE] Device sanitized and ready for use.' | tee -a \"$LOG_FILE\"\necho \"Log: $LOG_FILE\"",
        "ansible": "---\n# MP-6.3: Portable Media Sanitization Station Setup\n- name: Configure portable media sanitization station\n  hosts: sanitization_kiosks\n  become: yes\n  tasks:\n    - name: Install sanitization tools\n      yum:\n        name:\n          - coreutils\n          - dosfstools\n          - ntfs-3g\n          - clamav\n          - clamav-update\n        state: present\n\n    - name: Update ClamAV signatures\n      command: freshclam\n      ignore_errors: yes\n\n    - name: Create sanitization script\n      copy:\n        dest: /usr/local/bin/sanitize-portable.sh\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # Nondestructive sanitization for portable media\n          DEVICE=$1\n          # Scan for malware first\n          clamscan -r /mnt/scan_target --log=/var/log/clamav/scan.log\n          # Wipe and reformat\n          dd if=/dev/urandom of=$DEVICE bs=4M status=progress\n          mkfs.vfat -F 32 $DEVICE\n\n    - name: Create udev rule for USB detection logging\n      copy:\n        dest: /etc/udev/rules.d/99-usb-sanitization.rules\n        content: |\n          ACTION==\"add\", SUBSYSTEM==\"block\", ENV{ID_BUS}==\"usb\", RUN+=\"/usr/local/bin/log-usb-insert.sh %k\""
      },
      "windows": {
        "powershell": "# MP-6.3: Nondestructive Portable Media Sanitization\n# Sanitizes USB/removable devices for safe use\n\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$DriveLetter\n)\n\n$LogDir = 'C:\\ProgramData\\MediaSanitization\\PortableLogs'\nNew-Item -ItemType Directory -Path $LogDir -Force | Out-Null\n$LogFile = Join-Path $LogDir \"sanitize_$(Get-Date -Format 'yyyyMMdd_HHmmss').log\"\n\nfunction Write-Log {\n    param([string]$Message)\n    $Timestamp = Get-Date -Format 'o'\n    \"$Timestamp - $Message\" | Tee-Object -FilePath $LogFile -Append\n}\n\nWrite-Log '=== MP-6.3 Nondestructive Media Sanitization ==='\nWrite-Log \"Drive: $DriveLetter\"\nWrite-Log \"Operator: $env:USERNAME\"\n\n# Get drive info\n$Volume = Get-Volume -DriveLetter $DriveLetter.TrimEnd(':')\nWrite-Log \"Volume Label: $($Volume.FileSystemLabel)\"\nWrite-Log \"Size: $([math]::Round($Volume.Size/1GB, 2)) GB\"\nWrite-Log \"FileSystem: $($Volume.FileSystem)\"\n\n# Confirm\n$Confirm = Read-Host 'This will DESTROY all data. Proceed? (yes/no)'\nif ($Confirm -ne 'yes') {\n    Write-Log 'Aborted by user'\n    exit\n}\n\n# Run antimalware scan first\nWrite-Log 'Running Windows Defender scan...'\nStart-MpScan -ScanPath \"$DriveLetter\\\" -ScanType QuickScan\n\n# Format with full overwrite (not quick format)\nWrite-Log 'Formatting with full overwrite (this may take a while)...'\n$FormatResult = Format-Volume -DriveLetter $DriveLetter.TrimEnd(':') -FileSystem FAT32 -Full -Force\nWrite-Log \"Format complete: $($FormatResult.HealthStatus)\"\n\n# Optional: Additional wipe of free space\nWrite-Log 'Wiping free space with cipher...'\ncipher /w:\"$DriveLetter\\\" 2>&1 | Out-Null\n\nWrite-Log '[COMPLETE] Device sanitized and ready for use'\nWrite-Host \"Log saved: $LogFile\" -ForegroundColor Green"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-6.4",
    "control_name": "Controlled Unclassified Information",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "[Withdrawn: Incorporated into MP-6].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement has been withdrawn in NIST 800-53 Rev 5 and incorporated into the base MP-6 control.",
    "plain_english_explanation": "IMPORTANT: This control enhancement has been WITHDRAWN in NIST SP 800-53 Revision 5. Organizations should NOT implement this enhancement separately. The requirements for sanitizing media containing Controlled Unclassified Information (CUI) are now addressed by the base MP-6 Media Sanitization control. Update documentation to reference MP-6 instead.",
    "ai_guidance": "MP-6(4) has been WITHDRAWN in NIST SP 800-53 Revision 5 and incorporated into the base MP-6 control. Organizations should implement CUI media sanitization requirements through MP-6 following NIST SP 800-88 guidelines and 32 CFR Part 2002 CUI requirements.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-6"
    ],
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": false,
      "incorporated_into": "MP-6"
    }
  },
  {
    "control_id": "MP-6.5",
    "control_name": "Classified Information",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "[Withdrawn: Incorporated into MP-6].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement has been withdrawn in NIST 800-53 Rev 5 and incorporated into the base MP-6 control.",
    "plain_english_explanation": "IMPORTANT: This control enhancement has been WITHDRAWN in NIST SP 800-53 Revision 5. Organizations should NOT implement this enhancement separately. The requirements for sanitizing media containing classified information are now addressed by the base MP-6 Media Sanitization control. Update documentation to reference MP-6 instead.",
    "ai_guidance": "MP-6(5) has been WITHDRAWN in NIST SP 800-53 Revision 5 and incorporated into the base MP-6 control. Organizations handling classified information should implement media sanitization through MP-6 following NSA/CSS EPL media destruction requirements.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-6"
    ],
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": false,
      "incorporated_into": "MP-6"
    }
  },
  {
    "control_id": "MP-6.6",
    "control_name": "Media Destruction",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "[Withdrawn: Incorporated into MP-6].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement has been withdrawn in NIST 800-53 Rev 5 and incorporated into the base MP-6 control.",
    "plain_english_explanation": "IMPORTANT: This control enhancement has been WITHDRAWN in NIST SP 800-53 Revision 5. Organizations should NOT implement this enhancement separately. The requirements for media destruction are now addressed by the base MP-6 Media Sanitization control which covers all sanitization methods including destruction. Update documentation to reference MP-6 instead.",
    "ai_guidance": "MP-6(6) has been WITHDRAWN in NIST SP 800-53 Revision 5 and incorporated into the base MP-6 control. Media destruction requirements are now covered under MP-6 following NIST SP 800-88 Destroy methods including disintegration, incineration, pulverization, shredding, and melting.",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-6"
    ],
    "implementation_scripts": {
      "linux": {
        "bash": null,
        "ansible": null
      },
      "windows": {
        "powershell": null
      }
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": false,
      "incorporated_into": "MP-6"
    }
  },
  {
    "control_id": "MP-6.7",
    "control_name": "Dual Authorization",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "Enforce dual authorization for the sanitization of [Assignment: organization-defined system media].",
    "intent": "Require two authorized individuals to approve and witness media sanitization for high-value or sensitive assets.",
    "plain_english_explanation": "For certain types of sensitive media (as defined by your organization), two separate authorized people must be involved in the sanitization process. One person cannot sanitize sensitive media alone. This provides additional oversight, prevents unauthorized destruction, and ensures accountability for handling the most sensitive data. Typically applies to media containing classified, PII, or business-critical information.",
    "ai_guidance": "Implement dual authorization controls for sensitive media sanitization: 1) Define which media types require dual authorization (classified, PII, financial, etc.), 2) Implement two-person integrity (TPI) procedures requiring both a sanitization operator and an independent verifier, 3) Create authentication system requiring two separate credentials before sanitization tools will execute, 4) Neither individual should have complete access alone - use split knowledge or split authorization tokens, 5) Document both individuals' identities in sanitization records, 6) Consider implementing hardware tokens or biometrics for sanitization station access, 7) Audit logs must capture both authorizers' identities and timestamps. Technical implementation can use PAM modules requiring two authentications or custom scripts with dual password prompts.",
    "is_technical": true,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "related_controls": [
      "MP-6",
      "MP-6.1",
      "AC-3",
      "AC-5"
    ],
    "supplemental_guidance": "Dual authorization ensures no single individual can unilaterally sanitize high-sensitivity media.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6.7: Dual Authorization Media Sanitization\n# Requires two authorized users to approve sanitization\n\nDUAL_AUTH_LOG=\"/var/log/media-sanitization/dual_auth.log\"\n\necho '=== MP-6.7 Dual Authorization Sanitization ==='\necho 'Two authorized users are required to proceed.'\necho\n\n# First authorizer\necho 'First Authorizer:'\nread -p 'Username: ' AUTH1_USER\nread -sp 'Password: ' AUTH1_PASS\necho\n\n# Validate first user (using PAM or custom validation)\nif ! echo \"$AUTH1_PASS\" | su - \"$AUTH1_USER\" -c 'exit' 2>/dev/null; then\n    echo '[FAIL] First authorization failed'\n    exit 1\nfi\necho '[OK] First authorization accepted'\n\n# Second authorizer (must be different user)\necho -e '\\nSecond Authorizer (must be different user):'\nread -p 'Username: ' AUTH2_USER\n\nif [ \"$AUTH1_USER\" == \"$AUTH2_USER\" ]; then\n    echo '[FAIL] Second authorizer must be different from first'\n    exit 1\nfi\n\nread -sp 'Password: ' AUTH2_PASS\necho\n\nif ! echo \"$AUTH2_PASS\" | su - \"$AUTH2_USER\" -c 'exit' 2>/dev/null; then\n    echo '[FAIL] Second authorization failed'\n    exit 1\nfi\necho '[OK] Second authorization accepted'\n\n# Log dual authorization\nTIMESTAMP=$(date -Iseconds)\necho \"$TIMESTAMP,DUAL_AUTH,$AUTH1_USER,$AUTH2_USER,APPROVED\" >> \"$DUAL_AUTH_LOG\"\n\necho -e '\\n[SUCCESS] Dual authorization complete'\necho \"Authorizers: $AUTH1_USER and $AUTH2_USER\"\necho 'Sanitization may now proceed.'\n\n# Return success - actual sanitization script would follow\nexit 0",
        "ansible": "---\n# MP-6.7: Dual Authorization System for Sanitization\n- name: Configure dual authorization sanitization controls\n  hosts: sanitization_stations\n  become: yes\n  tasks:\n    - name: Create sanitization operators group\n      group:\n        name: san_operators\n        state: present\n\n    - name: Create sanitization verifiers group\n      group:\n        name: san_verifiers\n        state: present\n\n    - name: Deploy dual-auth sanitization wrapper\n      copy:\n        dest: /usr/local/bin/dual-auth-sanitize.sh\n        mode: '0750'\n        owner: root\n        group: san_operators\n        content: |\n          #!/bin/bash\n          # Dual authorization wrapper\n          # Requires authentication from both san_operators and san_verifiers groups\n          \n          echo 'MP-6.7 Dual Authorization Required'\n          \n          # Check operator (must be in san_operators)\n          if ! groups | grep -q san_operators; then\n              echo 'ERROR: Must be member of san_operators group'\n              exit 1\n          fi\n          \n          # Require verifier authentication\n          read -p 'Verifier username: ' VERIFIER\n          if ! id -nG \"$VERIFIER\" | grep -q san_verifiers; then\n              echo 'ERROR: Verifier must be in san_verifiers group'\n              exit 1\n          fi\n          \n          # Verify credentials\n          echo \"Verifier $VERIFIER please authenticate:\"\n          su - \"$VERIFIER\" -c 'echo \"Verification successful\"' || exit 1\n          \n          echo 'Dual authorization complete. Proceeding...'\n          # Execute actual sanitization\n          /usr/local/bin/sanitize-media.sh \"$@\"\n\n    - name: Configure sudo for dual-auth script\n      lineinfile:\n        path: /etc/sudoers.d/sanitization\n        line: '%san_operators ALL=(root) NOPASSWD: /usr/local/bin/dual-auth-sanitize.sh'\n        create: yes\n        validate: 'visudo -cf %s'"
      },
      "windows": {
        "powershell": "# MP-6.7: Dual Authorization Media Sanitization\n# Requires two authorized domain users to approve\n\n$LogFile = 'C:\\ProgramData\\MediaSanitization\\dual_auth.log'\n\nfunction Test-DualAuthorization {\n    Write-Host '=== MP-6.7 Dual Authorization Required ===' -ForegroundColor Cyan\n    Write-Host 'Two authorized users must authenticate to proceed.'\n    Write-Host\n    \n    # First authorizer\n    Write-Host 'First Authorizer:' -ForegroundColor Yellow\n    $Cred1 = Get-Credential -Message 'First authorizer credentials'\n    \n    # Validate first user against AD\n    try {\n        $Domain = $env:USERDOMAIN\n        $Context = New-Object System.DirectoryServices.AccountManagement.PrincipalContext(\n            [System.DirectoryServices.AccountManagement.ContextType]::Domain, $Domain)\n        $Valid1 = $Context.ValidateCredentials($Cred1.UserName, $Cred1.GetNetworkCredential().Password)\n        \n        if (-not $Valid1) {\n            Write-Host '[FAIL] First authorization failed' -ForegroundColor Red\n            return $false\n        }\n        Write-Host '[OK] First authorization accepted' -ForegroundColor Green\n    } catch {\n        Write-Host \"[FAIL] Authentication error: $_\" -ForegroundColor Red\n        return $false\n    }\n    \n    # Second authorizer\n    Write-Host \"`nSecond Authorizer (must be different):\" -ForegroundColor Yellow\n    $Cred2 = Get-Credential -Message 'Second authorizer credentials'\n    \n    if ($Cred1.UserName -eq $Cred2.UserName) {\n        Write-Host '[FAIL] Second authorizer must be different from first' -ForegroundColor Red\n        return $false\n    }\n    \n    $Valid2 = $Context.ValidateCredentials($Cred2.UserName, $Cred2.GetNetworkCredential().Password)\n    if (-not $Valid2) {\n        Write-Host '[FAIL] Second authorization failed' -ForegroundColor Red\n        return $false\n    }\n    Write-Host '[OK] Second authorization accepted' -ForegroundColor Green\n    \n    # Log authorization\n    $LogEntry = \"$(Get-Date -Format 'o'),DUAL_AUTH,$($Cred1.UserName),$($Cred2.UserName),APPROVED\"\n    Add-Content -Path $LogFile -Value $LogEntry\n    \n    Write-Host \"`n[SUCCESS] Dual authorization complete\" -ForegroundColor Green\n    Write-Host \"Authorizers: $($Cred1.UserName) and $($Cred2.UserName)\"\n    return $true\n}\n\n# Main execution\nif (Test-DualAuthorization) {\n    Write-Host \"`nSanitization may now proceed.\" -ForegroundColor Cyan\n    # Call actual sanitization script here\n} else {\n    Write-Host \"`nSanitization blocked - dual authorization failed.\" -ForegroundColor Red\n    exit 1\n}"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-6.8",
    "control_name": "Remote Purging or Wiping of Information",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-6",
    "stig_id": null,
    "official_text": "Provide the capability to purge or wipe information from [Assignment: organization-defined systems or system components] [Selection: remotely; under the following conditions: [Assignment: organization-defined conditions]].",
    "intent": "Enable remote destruction of sensitive data on lost, stolen, or compromised devices before unauthorized access occurs.",
    "plain_english_explanation": "Organizations must have the ability to remotely erase data from devices that may be lost, stolen, or compromised. This is especially important for mobile devices, laptops, and any systems that operate outside secure facilities. The remote wipe capability allows security teams to destroy sensitive data before it falls into the wrong hands, even when they cannot physically access the device.",
    "ai_guidance": "Implement remote wipe capabilities across device types: 1) Mobile Device Management (MDM): Deploy Microsoft Intune, VMware Workspace ONE, or similar for smartphones/tablets with remote wipe enrollment, 2) Laptops: Enable BitLocker with escrow and remote key revocation capability, or use endpoint management tools with remote wipe, 3) Configure conditional access policies that trigger automatic wipe after failed authentication attempts or location anomalies, 4) Test remote wipe procedures quarterly on test devices, 5) Document procedures for initiating remote wipe including authorization requirements, 6) Maintain device inventory with enrollment status, 7) Configure wipe to include both corporate data (selective wipe) and full device wipe options, 8) Ensure wipe commands can reach devices even without VPN (via cellular/public internet).",
    "is_technical": true,
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "related_controls": [
      "MP-6",
      "AC-7",
      "AC-19",
      "SC-7"
    ],
    "supplemental_guidance": "Remote purging/wiping protects organizational information when devices are lost or personnel are terminated.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-6.8: Remote Wipe Client Agent\n# Checks for wipe commands and executes secure deletion\n\nWIPE_CHECK_URL=\"https://mdm.organization.com/api/device/wipe-status\"\nDEVICE_ID=$(cat /etc/machine-id)\nWIPE_FLAG=\"/var/lib/remote-wipe/wipe-triggered\"\nLOG_FILE=\"/var/log/remote-wipe.log\"\n\nlog() {\n    echo \"$(date -Iseconds) - $1\" >> \"$LOG_FILE\"\n}\n\ncheck_wipe_command() {\n    # Check MDM server for wipe command (simplified example)\n    RESPONSE=$(curl -s -H \"X-Device-ID: $DEVICE_ID\" \"$WIPE_CHECK_URL\" 2>/dev/null)\n    \n    if echo \"$RESPONSE\" | grep -q '\"wipe\": true'; then\n        return 0  # Wipe commanded\n    fi\n    return 1\n}\n\nexecute_wipe() {\n    log 'WIPE COMMAND RECEIVED - Beginning secure wipe'\n    \n    # Create wipe flag to prevent re-runs\n    mkdir -p /var/lib/remote-wipe\n    touch \"$WIPE_FLAG\"\n    \n    # Wipe user data directories\n    log 'Wiping /home directories...'\n    find /home -type f -exec shred -vfz -n 1 {} \\; 2>/dev/null\n    \n    # Wipe sensitive system files\n    log 'Wiping sensitive system data...'\n    shred -vfz -n 1 /etc/shadow /etc/gshadow 2>/dev/null\n    \n    # If LUKS encrypted, destroy header\n    if cryptsetup isLuks /dev/sda2 2>/dev/null; then\n        log 'Destroying LUKS header...'\n        cryptsetup luksErase /dev/sda2 --batch-mode\n    fi\n    \n    log 'WIPE COMPLETE - System will be unusable'\n    \n    # Reboot to complete\n    sync\n    reboot -f\n}\n\n# Main - run as systemd service or cron\nif [ -f \"$WIPE_FLAG\" ]; then\n    log 'Wipe already executed'\n    exit 0\nfi\n\nif check_wipe_command; then\n    execute_wipe\nfi",
        "ansible": "---\n# MP-6.8: Remote Wipe Agent Deployment\n- name: Deploy remote wipe capability\n  hosts: managed_endpoints\n  become: yes\n  vars:\n    mdm_server: mdm.organization.com\n  tasks:\n    - name: Create remote wipe directory\n      file:\n        path: /var/lib/remote-wipe\n        state: directory\n        mode: '0700'\n\n    - name: Deploy remote wipe agent script\n      template:\n        src: remote-wipe-agent.sh.j2\n        dest: /usr/local/bin/remote-wipe-agent.sh\n        mode: '0700'\n\n    - name: Create systemd service for wipe agent\n      copy:\n        dest: /etc/systemd/system/remote-wipe-agent.service\n        content: |\n          [Unit]\n          Description=Remote Wipe Agent\n          After=network-online.target\n          Wants=network-online.target\n\n          [Service]\n          Type=simple\n          ExecStart=/usr/local/bin/remote-wipe-agent.sh\n          Restart=always\n          RestartSec=300\n\n          [Install]\n          WantedBy=multi-user.target\n\n    - name: Enable remote wipe agent\n      systemd:\n        name: remote-wipe-agent\n        enabled: yes\n        state: started\n        daemon_reload: yes"
      },
      "windows": {
        "powershell": "# MP-6.8: Remote Wipe Capability Configuration\n# Configures Windows for remote wipe via Intune/SCCM\n\n$LogFile = 'C:\\ProgramData\\RemoteWipe\\wipe.log'\nNew-Item -ItemType Directory -Path 'C:\\ProgramData\\RemoteWipe' -Force | Out-Null\n\nfunction Write-WipeLog {\n    param([string]$Message)\n    \"$(Get-Date -Format 'o') - $Message\" | Add-Content $LogFile\n}\n\nWrite-Host '=== MP-6.8 Remote Wipe Configuration ===' -ForegroundColor Cyan\n\n# Check Intune enrollment\n$MDMEnrollment = Get-WmiObject -Namespace 'root\\cimv2\\mdm\\dmmap' -Class 'MDM_DevDetail_Ext01' -ErrorAction SilentlyContinue\nif ($MDMEnrollment) {\n    Write-Host '[PASS] Device is enrolled in MDM (Intune)' -ForegroundColor Green\n    Write-Host \"  Device ID: $($MDMEnrollment.DeviceID)\"\n    Write-WipeLog 'MDM enrollment verified'\n} else {\n    Write-Host '[WARN] Device not enrolled in MDM - Remote wipe may not be available' -ForegroundColor Yellow\n    Write-WipeLog 'MDM enrollment NOT found'\n}\n\n# Check BitLocker (enables key-based remote wipe)\n$BLStatus = Get-BitLockerVolume -MountPoint 'C:' -ErrorAction SilentlyContinue\nif ($BLStatus -and $BLStatus.ProtectionStatus -eq 'On') {\n    Write-Host '[PASS] BitLocker enabled - Key revocation wipe available' -ForegroundColor Green\n    Write-WipeLog 'BitLocker enabled on C:'\n} else {\n    Write-Host '[WARN] BitLocker not enabled - Consider enabling for remote wipe via key revocation' -ForegroundColor Yellow\n}\n\n# Verify Windows Remote Management for SCCM\n$WinRM = Get-Service WinRM\nif ($WinRM.Status -eq 'Running') {\n    Write-Host '[PASS] WinRM running - SCCM remote commands available' -ForegroundColor Green\n} else {\n    Write-Host '[INFO] WinRM not running - Enable for SCCM management' -ForegroundColor Yellow\n}\n\n# Check for lost device protection\n$FindMyDevice = Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\MdmCommon\\SettingValues' -Name 'LocationSyncEnabled' -ErrorAction SilentlyContinue\nif ($FindMyDevice) {\n    Write-Host '[INFO] Find My Device capability available' -ForegroundColor Cyan\n}\n\nWrite-Host \"`nRemote wipe can be triggered via:\"\nWrite-Host '  1. Microsoft Intune portal - Device Actions > Wipe'\nWrite-Host '  2. Azure AD - Devices > Select device > Wipe'\nWrite-Host '  3. SCCM - Right-click device > Retire/Wipe'\nWrite-Host '  4. BitLocker key revocation via AD'\n\nWrite-WipeLog 'Remote wipe capability check complete'"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00Z",
      "has_scripts": true
    }
  },
  {
    "control_id": "MP-7",
    "control_name": "Media Use",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "a. [Selection: Restrict; Prohibit] the use of [Assignment: organization-defined types of system media] on [Assignment: organization-defined systems or system components] using [Assignment: organization-defined controls]; and b. Prohibit the use of portable storage devices in organizational systems when such devices have no identifiable owner.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Control and restrict the use of system media to prevent unauthorized data exfiltration, malware introduction, and security breaches from unmanaged portable storage devices.",
    "plain_english_explanation": "This control requires organizations to establish policies and technical mechanisms that govern how removable and portable media (USB drives, external hard drives, CDs, DVDs, SD cards) can be used within organizational systems. Organizations must decide whether to completely prohibit certain media types or restrict their use with specific safeguards. Additionally, all portable storage devices connected to systems must have an identifiable owner - anonymous or unattributed devices must be blocked. This prevents scenarios where malicious actors could leave infected USB drives in parking lots or common areas hoping employees will connect them to corporate systems (a common attack vector known as 'USB drop attacks').",
    "ai_guidance": "Implementation of MP-7 requires a multi-layered approach combining technical controls with organizational policies. For Linux systems, implement USB device restrictions using kernel module blacklisting (usb-storage) and USBGuard for granular device whitelisting based on device attributes like vendor ID, product ID, and serial number. Create udev rules to control device mounting behavior and enforce read-only access where appropriate. For Windows environments, deploy Group Policy Objects (GPO) to restrict removable storage access through Computer Configuration > Administrative Templates > System > Removable Storage Access policies. Consider implementing endpoint DLP solutions that can inspect data transfers to removable media. Maintain a device registration system where users must register their portable storage devices with IT, linking devices to specific owners. Deploy endpoint detection tools that alert on unauthorized device connections. Regular audits should verify that only registered devices are being used and that technical controls remain effective.",
    "stig_id": "RHEL-08-040080, RHEL-08-040139, RHEL-08-040141",
    "is_technical": true,
    "enhancements": [
      {
        "id": "MP-7.1",
        "title": "Prohibit Use Without Owner",
        "official_text": "[Withdrawn: Incorporated into MP-7.]"
      },
      {
        "id": "MP-7.2",
        "title": "Prohibit Use of Sanitization-resistant Media",
        "official_text": "Prohibit the use of sanitization-resistant media in organizational systems."
      }
    ],
    "related_controls": [
      "AC-19",
      "AC-20",
      "MP-2",
      "MP-4",
      "MP-6",
      "PL-4",
      "SC-34",
      "SC-41"
    ],
    "supplemental_guidance": "System media includes both digital and non-digital media. Digital media includes diskettes, magnetic tapes, flash drives, compact discs, digital versatile discs, and removable hard disk drives. Non-digital media includes paper and microfilm. Media use protections also apply to mobile devices with information storage capabilities. In contrast to MP-2, which restricts user access to media, MP-7 restricts the use of certain types of media on systems. Organizations can employ technical or nontechnical controls to restrict the use of system media.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-7: Media Use - Disable USB Storage and Configure USBGuard\n# STIG IDs: RHEL-08-040080, RHEL-08-040139, RHEL-08-040141\n\nset -euo pipefail\n\necho \"[MP-7] Configuring USB storage restrictions...\"\n\n# Create modprobe configuration directory if needed\nmkdir -p /etc/modprobe.d\n\n# RHEL-08-040080: Disable USB mass storage kernel module\necho \"[*] Disabling USB storage kernel module...\"\ncat > /etc/modprobe.d/usb-storage.conf << 'EOF'\n# MP-7: Disable USB mass storage (RHEL-08-040080)\ninstall usb-storage /bin/false\nblacklist usb-storage\nEOF\n\n# Also add to blacklist.conf for redundancy\nif [ -f /etc/modprobe.d/blacklist.conf ]; then\n    if ! grep -q \"blacklist usb-storage\" /etc/modprobe.d/blacklist.conf; then\n        echo \"blacklist usb-storage\" >> /etc/modprobe.d/blacklist.conf\n    fi\nelse\n    echo \"blacklist usb-storage\" > /etc/modprobe.d/blacklist.conf\nfi\n\n# Unload the module if currently loaded\nif lsmod | grep -q usb_storage; then\n    echo \"[*] Unloading usb-storage module...\"\n    modprobe -r usb_storage 2>/dev/null || echo \"[!] Could not unload module - may require reboot\"\nfi\n\n# RHEL-08-040139: Install USBGuard\necho \"[*] Installing USBGuard...\"\nif command -v dnf &> /dev/null; then\n    dnf install -y usbguard 2>/dev/null || yum install -y usbguard\nelif command -v yum &> /dev/null; then\n    yum install -y usbguard\nelif command -v apt-get &> /dev/null; then\n    apt-get update && apt-get install -y usbguard\nfi\n\n# Generate initial USBGuard rules for currently connected devices\nif command -v usbguard &> /dev/null; then\n    echo \"[*] Generating initial USBGuard policy...\"\n    mkdir -p /etc/usbguard\n    \n    # Create policy allowing currently connected devices\n    usbguard generate-policy > /etc/usbguard/rules.conf 2>/dev/null || true\n    \n    # Add default deny rule for new devices\n    echo \"\" >> /etc/usbguard/rules.conf\n    echo \"# Default: block all unrecognized USB devices\" >> /etc/usbguard/rules.conf\n    \n    # RHEL-08-040141: Enable USBGuard service\n    echo \"[*] Enabling USBGuard service...\"\n    systemctl enable usbguard.service\n    systemctl start usbguard.service || echo \"[!] USBGuard started - verify keyboard/mouse still work\"\nfi\n\n# Create udev rules for logging USB device connections\necho \"[*] Creating USB device audit rules...\"\ncat > /etc/udev/rules.d/99-usb-audit.rules << 'EOF'\n# MP-7: Log all USB device connections for audit\nACTION==\"add\", SUBSYSTEM==\"usb\", RUN+=\"/usr/bin/logger -t USB-AUDIT 'USB device connected: %k vendor=%s{idVendor} product=%s{idProduct} serial=%s{serial}'\"\nACTION==\"remove\", SUBSYSTEM==\"usb\", RUN+=\"/usr/bin/logger -t USB-AUDIT 'USB device removed: %k'\"\nEOF\n\nudevadm control --reload-rules\n\necho \"[MP-7] USB storage restrictions configured successfully\"\necho \"[!] WARNING: A reboot may be required for all changes to take effect\"\necho \"[!] Verify USBGuard configuration before deploying to production\"",
        "ansible": "---\n# MP-7: Media Use - Ansible Playbook\n# STIG IDs: RHEL-08-040080, RHEL-08-040139, RHEL-08-040141\n\n- name: MP-7 Media Use Implementation\n  hosts: all\n  become: yes\n  vars:\n    usb_storage_config: /etc/modprobe.d/usb-storage.conf\n    blacklist_config: /etc/modprobe.d/blacklist.conf\n    usbguard_rules: /etc/usbguard/rules.conf\n  \n  tasks:\n    # RHEL-08-040080: Disable USB mass storage\n    - name: Create modprobe.d directory\n      file:\n        path: /etc/modprobe.d\n        state: directory\n        mode: '0755'\n    \n    - name: Disable USB storage kernel module\n      copy:\n        dest: \"{{ usb_storage_config }}\"\n        content: |\n          # MP-7: Disable USB mass storage (RHEL-08-040080)\n          install usb-storage /bin/false\n          blacklist usb-storage\n        owner: root\n        group: root\n        mode: '0644'\n      notify: Rebuild initramfs\n    \n    - name: Add usb-storage to blacklist.conf\n      lineinfile:\n        path: \"{{ blacklist_config }}\"\n        line: \"blacklist usb-storage\"\n        create: yes\n        owner: root\n        group: root\n        mode: '0644'\n    \n    - name: Unload usb-storage module if loaded\n      modprobe:\n        name: usb_storage\n        state: absent\n      ignore_errors: yes\n    \n    # RHEL-08-040139: Install USBGuard\n    - name: Install USBGuard package\n      package:\n        name: usbguard\n        state: present\n      when: ansible_os_family == 'RedHat'\n    \n    - name: Create USBGuard directory\n      file:\n        path: /etc/usbguard\n        state: directory\n        mode: '0700'\n        owner: root\n        group: root\n    \n    - name: Generate initial USBGuard policy\n      shell: usbguard generate-policy > {{ usbguard_rules }}\n      args:\n        creates: \"{{ usbguard_rules }}\"\n      when: ansible_os_family == 'RedHat'\n    \n    # RHEL-08-040141: Enable USBGuard\n    - name: Enable and start USBGuard service\n      systemd:\n        name: usbguard\n        enabled: yes\n        state: started\n      when: ansible_os_family == 'RedHat'\n    \n    - name: Create USB audit udev rules\n      copy:\n        dest: /etc/udev/rules.d/99-usb-audit.rules\n        content: |\n          # MP-7: Log all USB device connections\n          ACTION==\"add\", SUBSYSTEM==\"usb\", RUN+=\"/usr/bin/logger -t USB-AUDIT 'USB device connected: %k vendor=%s{idVendor} product=%s{idProduct}'\"\n          ACTION==\"remove\", SUBSYSTEM==\"usb\", RUN+=\"/usr/bin/logger -t USB-AUDIT 'USB device removed: %k'\"\n        owner: root\n        group: root\n        mode: '0644'\n      notify: Reload udev rules\n  \n  handlers:\n    - name: Rebuild initramfs\n      command: dracut -f\n      when: ansible_os_family == 'RedHat'\n    \n    - name: Reload udev rules\n      command: udevadm control --reload-rules"
      },
      "windows": {
        "powershell": "# MP-7: Media Use - Windows Implementation\n# Configures Group Policy settings to restrict removable storage\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-7] Configuring removable storage restrictions...\" -ForegroundColor Cyan\n\n# Registry paths for removable storage policies\n$RemovableStoragePath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\RemovableStorageDevices\"\n$DeviceInstallPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceInstall\\Restrictions\"\n\n# Create registry paths if they don't exist\nif (-not (Test-Path $RemovableStoragePath)) {\n    New-Item -Path $RemovableStoragePath -Force | Out-Null\n}\n\nif (-not (Test-Path $DeviceInstallPath)) {\n    New-Item -Path $DeviceInstallPath -Force | Out-Null\n}\n\n# Option 1: Deny all removable storage access\nWrite-Host \"[*] Setting deny all removable storage policy...\" -ForegroundColor Yellow\nSet-ItemProperty -Path $RemovableStoragePath -Name \"Deny_All\" -Value 1 -Type DWord\n\n# Option 2: Deny specific removable storage classes\n# Removable Disks GUID: {53f5630d-b6bf-11d0-94f2-00a0c91efb8b}\n$RemovableDisksPath = \"$RemovableStoragePath\\{53f5630d-b6bf-11d0-94f2-00a0c91efb8b}\"\nif (-not (Test-Path $RemovableDisksPath)) {\n    New-Item -Path $RemovableDisksPath -Force | Out-Null\n}\nSet-ItemProperty -Path $RemovableDisksPath -Name \"Deny_Read\" -Value 1 -Type DWord\nSet-ItemProperty -Path $RemovableDisksPath -Name \"Deny_Write\" -Value 1 -Type DWord\nSet-ItemProperty -Path $RemovableDisksPath -Name \"Deny_Execute\" -Value 1 -Type DWord\n\n# CD/DVD GUID: {53f56308-b6bf-11d0-94f2-00a0c91efb8b}\n$CDDVDPath = \"$RemovableStoragePath\\{53f56308-b6bf-11d0-94f2-00a0c91efb8b}\"\nif (-not (Test-Path $CDDVDPath)) {\n    New-Item -Path $CDDVDPath -Force | Out-Null\n}\nSet-ItemProperty -Path $CDDVDPath -Name \"Deny_Read\" -Value 1 -Type DWord\nSet-ItemProperty -Path $CDDVDPath -Name \"Deny_Write\" -Value 1 -Type DWord\n\n# WPD Devices (phones, cameras) GUID: {6ac27878-a6fa-4155-ba85-f98f491d4f33}\n$WPDPath = \"$RemovableStoragePath\\{6ac27878-a6fa-4155-ba85-f98f491d4f33}\"\nif (-not (Test-Path $WPDPath)) {\n    New-Item -Path $WPDPath -Force | Out-Null\n}\nSet-ItemProperty -Path $WPDPath -Name \"Deny_Read\" -Value 1 -Type DWord\nSet-ItemProperty -Path $WPDPath -Name \"Deny_Write\" -Value 1 -Type DWord\n\n# Configure Device Installation Restrictions\nWrite-Host \"[*] Configuring device installation restrictions...\" -ForegroundColor Yellow\nSet-ItemProperty -Path $DeviceInstallPath -Name \"DenyUnspecified\" -Value 1 -Type DWord\n\n# Disable AutoPlay for all drives\n$AutoPlayPath = \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"\nif (-not (Test-Path $AutoPlayPath)) {\n    New-Item -Path $AutoPlayPath -Force | Out-Null\n}\nSet-ItemProperty -Path $AutoPlayPath -Name \"NoDriveTypeAutoRun\" -Value 255 -Type DWord\nSet-ItemProperty -Path $AutoPlayPath -Name \"NoAutorun\" -Value 1 -Type DWord\n\n# Enable USB device connection auditing\nWrite-Host \"[*] Enabling USB device auditing...\" -ForegroundColor Yellow\nauditpol /set /subcategory:\"Plug and Play Events\" /success:enable /failure:enable 2>$null\n\nWrite-Host \"[MP-7] Removable storage restrictions configured successfully\" -ForegroundColor Green\nWrite-Host \"[!] Note: Group Policy refresh may be required (gpupdate /force)\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "technical",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "ComplianceAsCode",
      "stig_references": [
        {
          "stig_id": "RHEL-08-040080",
          "rule_id": "SV-230503r1069316_rule",
          "finding_id": "V-230503",
          "cci": "CCI-000778",
          "title": "RHEL 8 must be configured to disable USB mass storage"
        },
        {
          "stig_id": "RHEL-08-040139",
          "rule_id": "SV-244547r1014811_rule",
          "finding_id": "V-244547",
          "cci": "CCI-001958",
          "title": "RHEL 8 must have the USBGuard installed"
        },
        {
          "stig_id": "RHEL-08-040141",
          "rule_id": "SV-244548r1014815_rule",
          "finding_id": "V-244548",
          "cci": "CCI-001958",
          "title": "RHEL 8 must enable the USBGuard"
        }
      ],
      "implementation_guidance": "Technical implementation via kernel module blacklisting and USBGuard for Linux; Group Policy for Windows."
    }
  },
  {
    "control_id": "MP-7.1",
    "control_name": "Prohibit Use Without Owner",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-7",
    "official_text": "[Withdrawn: Incorporated into MP-7.]",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "This enhancement was withdrawn in Rev 5 and incorporated into the base MP-7 control requirement to prohibit portable storage devices without identifiable owners.",
    "plain_english_explanation": "This control enhancement has been withdrawn and merged into the base MP-7 control in NIST SP 800-53 Revision 5. The requirement to prohibit the use of portable storage devices without identifiable owners is now part of MP-7 paragraph (b). Organizations should refer to MP-7 for implementation guidance on this requirement. The merger reflects the understanding that owner identification is a fundamental aspect of media use control, not an optional enhancement.",
    "ai_guidance": "Since MP-7.1 has been withdrawn and incorporated into MP-7, organizations should implement owner identification requirements as part of their MP-7 implementation. This includes establishing a device registration process where users must register portable storage devices with their organizational credentials, maintaining a database of authorized devices linked to specific individuals, implementing technical controls that can verify device registration status before allowing access, and creating procedures for handling unregistered or anonymous devices found in the environment. USBGuard on Linux and endpoint protection solutions can enforce device whitelisting based on unique device identifiers that are registered to specific users.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-7"
    ],
    "supplemental_guidance": "This control enhancement was withdrawn and incorporated into MP-7. See MP-7 for current requirements regarding portable storage devices without identifiable owners.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "metadata": {
      "status": "withdrawn",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": false,
      "withdrawal_note": "Incorporated into MP-7 in NIST SP 800-53 Rev 5"
    },
    "cac_metadata": {
      "implementation_type": "withdrawn",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "This enhancement was withdrawn and incorporated into MP-7. Implement owner identification as part of MP-7 compliance."
    }
  },
  {
    "control_id": "MP-7.2",
    "control_name": "Prohibit Use of Sanitization-resistant Media",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-7",
    "official_text": "Prohibit the use of sanitization-resistant media in organizational systems.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Prevent the use of storage media that cannot be reliably sanitized, reducing the risk of data remnants that could be recovered by adversaries.",
    "plain_english_explanation": "Certain types of storage media have characteristics that make them extremely difficult or impossible to completely sanitize. This includes media with wear-leveling algorithms (like SSDs and flash memory), media with hidden or reserved areas, and devices with proprietary firmware that may retain data in inaccessible locations. This control requires organizations to prohibit such media in environments where complete data sanitization is a security requirement. Examples of sanitization-resistant media include solid-state drives (SSDs) that use wear-leveling, USB flash drives with hidden partitions, and devices with embedded firmware that may cache sensitive data. When data must be completely destroyed, physical destruction may be the only reliable method for such media.",
    "ai_guidance": "Organizations implementing this control should first conduct an inventory of all media types in use and identify those with sanitization-resistant characteristics. Create an approved media list that excludes sanitization-resistant types for environments handling sensitive data. For SSDs and flash media, consider using hardware-encrypted drives where the encryption key can be cryptographically erased (crypto-erase) as an alternative to traditional sanitization. Implement procurement controls to prevent acquisition of non-approved media types. Establish procedures for handling legacy sanitization-resistant media, typically requiring physical destruction. Document exceptions with risk acceptance for operational needs. Technical controls should include blocking device installation for non-approved media types and DLP solutions that can identify attempts to use prohibited media. Regular audits should verify compliance with the approved media list.",
    "stig_id": null,
    "is_technical": true,
    "enhancements": [],
    "related_controls": [
      "MP-6",
      "MP-7",
      "SC-28"
    ],
    "supplemental_guidance": "Sanitization-resistant media includes media that cannot be sanitized using standard sanitization techniques, including media with limited or no write cycles, media with hidden areas, media with excessive overprovisioning, and media that employs wear-leveling. The prohibition on sanitization-resistant media applies to media that is removable as well as media that is contained in organizational systems.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-7.2: Prohibit Use of Sanitization-resistant Media\n# Block specific device types known to be sanitization-resistant\n\nset -euo pipefail\n\necho \"[MP-7.2] Configuring sanitization-resistant media restrictions...\"\n\n# Create udev rules to block specific sanitization-resistant device classes\ncat > /etc/udev/rules.d/98-sanitization-resistant.rules << 'EOF'\n# MP-7.2: Block sanitization-resistant media types\n# Block unauthorized SD card readers (common sanitization-resistant media)\n# Note: Customize based on organizational approved device list\n\n# Log and optionally block unvetted storage devices\nACTION==\"add\", SUBSYSTEM==\"block\", ENV{ID_USB_DRIVER}==\"usb-storage\", \\\n  RUN+=\"/usr/bin/logger -t MP-7.2 'ALERT: USB storage device detected - verify sanitization capability: %k vendor=%s{idVendor} product=%s{idProduct}'\"\n\n# Block memory card readers by class (requires organizational policy decision)\n# Uncomment to enable blocking:\n# ACTION==\"add\", SUBSYSTEM==\"block\", ENV{ID_DRIVE_FLASH_SD}==\"1\", \\\n#   RUN+=\"/bin/sh -c 'echo 0 > /sys$devpath/device/authorized'\"\nEOF\n\nudevadm control --reload-rules\n\n# Create policy documentation\ncat > /etc/security/mp-7.2-policy.txt << 'EOF'\nMP-7.2 Sanitization-Resistant Media Policy\n==========================================\n\nProhibited Media Types:\n- Solid State Drives (SSDs) without crypto-erase capability\n- USB flash drives without hardware encryption\n- SD/microSD cards\n- eMMC storage modules\n- Any media with wear-leveling without verified sanitization support\n\nApproved Alternatives:\n- Self-Encrypting Drives (SEDs) with crypto-erase\n- Hardware-encrypted USB drives with certified sanitization\n- Traditional HDDs for environments requiring complete sanitization\n\nExceptions require documented risk acceptance from the ISSM.\nEOF\n\necho \"[MP-7.2] Policy documentation created at /etc/security/mp-7.2-policy.txt\"\necho \"[*] Review and customize udev rules based on organizational requirements\""
      },
      "windows": {
        "powershell": "# MP-7.2: Prohibit Use of Sanitization-resistant Media\n# Document and optionally block sanitization-resistant media types\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-7.2] Configuring sanitization-resistant media policy...\" -ForegroundColor Cyan\n\n# Create policy documentation directory\n$PolicyDir = \"C:\\SecurityPolicies\"\nif (-not (Test-Path $PolicyDir)) {\n    New-Item -Path $PolicyDir -ItemType Directory -Force | Out-Null\n}\n\n# Document prohibited media types\n$PolicyContent = @\"\nMP-7.2 Sanitization-Resistant Media Policy\n==========================================\nLast Updated: $(Get-Date -Format 'yyyy-MM-dd')\n\nProhibited Media Types (cannot be reliably sanitized):\n- Solid State Drives (SSDs) without crypto-erase capability\n- USB flash drives without hardware encryption and verified sanitization\n- SD/microSD/CompactFlash cards\n- eMMC storage modules\n- Any media employing wear-leveling without NIST 800-88 sanitization verification\n\nApproved Alternatives:\n- Self-Encrypting Drives (SEDs) supporting TCG Opal with crypto-erase\n- Hardware-encrypted USB drives with FIPS 140-2/3 validation\n- Traditional HDDs where complete sanitization is verified\n\nApproved Sanitization Methods:\n- Crypto-erase for approved SEDs\n- Physical destruction (shredding, degaussing for magnetic media)\n- NIST 800-88 Clear/Purge for approved media types\n\nExceptions:\n- All exceptions require documented risk acceptance from the ISSM\n- Exception requests must include business justification and alternative controls\n\nAudit Requirements:\n- Quarterly inventory of all storage media in use\n- Verification of sanitization capability for all approved media\n- Documentation of disposal/sanitization actions\n\"@\n\n$PolicyContent | Out-File \"$PolicyDir\\MP-7.2-Policy.txt\" -Encoding UTF8\n\n# Optional: Block specific device classes via Group Policy registry settings\n# This blocks SD card readers and similar devices\n$DeviceInstallPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceInstall\\Restrictions\"\nif (-not (Test-Path $DeviceInstallPath)) {\n    New-Item -Path $DeviceInstallPath -Force | Out-Null\n}\n\n# Enable device installation restrictions\nSet-ItemProperty -Path $DeviceInstallPath -Name \"DenyDeviceClasses\" -Value 1 -Type DWord\n\n# Create deny list path\n$DenyClassesPath = \"$DeviceInstallPath\\DenyDeviceClasses\"\nif (-not (Test-Path $DenyClassesPath)) {\n    New-Item -Path $DenyClassesPath -Force | Out-Null\n}\n\n# SD Host Adapters class GUID (blocks SD card readers)\n# Uncomment to enable - may affect legitimate devices\n# Set-ItemProperty -Path $DenyClassesPath -Name \"1\" -Value \"{a0a588a4-c46f-4b37-b7ea-c82fe89870c6}\" -Type String\n\nWrite-Host \"[MP-7.2] Policy documentation created at $PolicyDir\\MP-7.2-Policy.txt\" -ForegroundColor Green\nWrite-Host \"[*] Review policy and enable device blocking based on organizational requirements\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "hybrid",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "ComplianceAsCode",
      "implementation_guidance": "Requires combination of policy documentation identifying prohibited media types and technical controls to enforce restrictions."
    }
  },
  {
    "control_id": "MP-8",
    "control_name": "Media Downgrading",
    "family": "Media Protection",
    "family_id": "MP",
    "official_text": "a. Establish [Assignment: organization-defined system media downgrading process] that includes employing downgrading mechanisms with [Assignment: organization-defined strength and integrity]; b. Verify that the system media downgrading process is commensurate with the security category and/or classification level of the information to be removed and the access authorizations of the potential recipients of the downgraded information; c. Identify [Assignment: organization-defined system media requiring downgrading]; and d. Downgrade the identified system media using the established process.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Establish formal processes to remove sensitive information from media before releasing it to recipients with lower clearance levels or to the public.",
    "plain_english_explanation": "Media downgrading is the process of removing or sanitizing classified or sensitive information from storage media so that the media can be safely released to individuals who do not have the required security clearances or authorizations to access the original information. This is different from media sanitization (MP-6) because downgrading specifically addresses the controlled release of media to lower classification environments, not disposal. The downgrading process must use mechanisms that are appropriate for the sensitivity level of the information being removed - highly classified information requires more rigorous downgrading procedures than lower-sensitivity data. Organizations must document what media requires downgrading, establish verified procedures, and execute those procedures consistently before any release.",
    "ai_guidance": "Media downgrading implementation requires establishing a formal, documented process that is approved by security officials and appropriate for the classification levels handled by the organization. The process should define specific downgrading methods based on media type and original classification level, typically referencing NSA/CSS EPL-listed products for classified information or NIST SP 800-88 guidelines for CUI. Implement a media tracking system that identifies media requiring downgrading and records all downgrading actions. Establish verification procedures to confirm successful downgrading before release, potentially including forensic analysis of downgraded media. Create approval workflows requiring security officer authorization before downgrading execution. Train designated personnel on proper downgrading procedures and maintain certification records. Conduct periodic testing of downgrading equipment and procedures to ensure effectiveness. For classified environments, coordinate with cognizant security authority for approved downgrading methods. Document all exceptions and maintain audit trails of all downgrading activities.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [
      {
        "id": "MP-8.1",
        "title": "Documentation of Process",
        "official_text": "Document system media downgrading actions."
      },
      {
        "id": "MP-8.2",
        "title": "Equipment Testing",
        "official_text": "Test downgrading equipment and procedures [Assignment: organization-defined frequency] to ensure that downgrading actions are being achieved."
      },
      {
        "id": "MP-8.3",
        "title": "Controlled Unclassified Information",
        "official_text": "Downgrade system media containing controlled unclassified information prior to public release."
      },
      {
        "id": "MP-8.4",
        "title": "Classified Information",
        "official_text": "Downgrade system media containing classified information prior to release to individuals without required access authorizations."
      }
    ],
    "related_controls": [
      "CM-8",
      "MA-2",
      "MA-3",
      "MP-6",
      "PM-32"
    ],
    "supplemental_guidance": "Media downgrading applies to all system media, digital and non-digital, subject to release outside the organization. The downgrading process removes information from the media, typically by security category or classification level, such that the information cannot be retrieved or reconstructed. Downgrading of media includes redacting information to enable wider release and distribution. Downgrading also ensures that empty space on the media is devoid of information.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-8: Media Downgrading Process Documentation and Tracking\n# This script establishes a framework for documenting downgrading activities\n\nset -euo pipefail\n\nDOWNGRADE_DIR=\"/var/log/media-downgrade\"\nPOLICY_DIR=\"/etc/security/media-downgrade\"\n\necho \"[MP-8] Setting up media downgrading documentation framework...\"\n\n# Create directories\nmkdir -p \"$DOWNGRADE_DIR\"\nmkdir -p \"$POLICY_DIR\"\nchmod 700 \"$DOWNGRADE_DIR\"\nchmod 755 \"$POLICY_DIR\"\n\n# Create downgrading policy template\ncat > \"$POLICY_DIR/downgrade-policy.txt\" << 'EOF'\nMP-8 MEDIA DOWNGRADING POLICY\n=============================\n\n1. PURPOSE\nThis policy establishes procedures for downgrading system media containing\nsensitive information prior to release to recipients without appropriate\naccess authorizations.\n\n2. SCOPE\nApplies to all digital and non-digital media containing organizational\ninformation that requires downgrading before release.\n\n3. DOWNGRADING METHODS BY CLASSIFICATION\n\n3.1 Controlled Unclassified Information (CUI)\n    - Method: NIST SP 800-88 Clear or Purge\n    - Verification: Forensic scan of sample media\n    - Approval: Information System Security Manager (ISSM)\n\n3.2 Classified Information\n    - Method: NSA/CSS EPL-listed products or physical destruction\n    - Verification: Mandatory forensic verification\n    - Approval: Cognizant Security Authority\n\n4. MEDIA TYPES AND APPROVED METHODS\n    - HDDs: Secure erase (ATA), degaussing, or destruction\n    - SSDs: Crypto-erase or destruction\n    - Optical: Physical destruction only\n    - Paper: Cross-cut shredding (NSA approved for classified)\n\n5. DOCUMENTATION REQUIREMENTS\n    - Media identifier/serial number\n    - Original classification/sensitivity level\n    - Target classification level\n    - Downgrading method used\n    - Date and time of downgrading\n    - Personnel performing downgrading\n    - Verification method and results\n    - Approving official signature\n\n6. RETENTION\n    Downgrading records retained for minimum 3 years or per records\n    retention schedule, whichever is longer.\nEOF\n\n# Create downgrading log template\ncat > \"$POLICY_DIR/downgrade-log-template.csv\" << 'EOF'\nDate,Media_ID,Media_Type,Original_Class,Target_Class,Method,Verified_By,Approved_By,Notes\nEOF\n\n# Create downgrading script wrapper\ncat > \"/usr/local/bin/log-media-downgrade\" << 'SCRIPT'\n#!/bin/bash\n# Log media downgrading action for MP-8 compliance\n\nLOG_FILE=\"/var/log/media-downgrade/downgrade-$(date +%Y%m).csv\"\n\nif [ ! -f \"$LOG_FILE\" ]; then\n    cp /etc/security/media-downgrade/downgrade-log-template.csv \"$LOG_FILE\"\nfi\n\nread -p \"Media ID/Serial: \" MEDIA_ID\nread -p \"Media Type (HDD/SSD/Optical/Paper/Other): \" MEDIA_TYPE\nread -p \"Original Classification: \" ORIG_CLASS\nread -p \"Target Classification: \" TARGET_CLASS\nread -p \"Downgrading Method: \" METHOD\nread -p \"Verified By: \" VERIFIED\nread -p \"Approved By: \" APPROVED\nread -p \"Notes: \" NOTES\n\necho \"$(date +%Y-%m-%d),${MEDIA_ID},${MEDIA_TYPE},${ORIG_CLASS},${TARGET_CLASS},${METHOD},${VERIFIED},${APPROVED},${NOTES}\" >> \"$LOG_FILE\"\n\necho \"Downgrading action logged to $LOG_FILE\"\nSCRIPT\n\nchmod 755 \"/usr/local/bin/log-media-downgrade\"\n\necho \"[MP-8] Media downgrading framework established\"\necho \"[*] Policy: $POLICY_DIR/downgrade-policy.txt\"\necho \"[*] Log command: log-media-downgrade\""
      },
      "windows": {
        "powershell": "# MP-8: Media Downgrading Process Documentation Framework\n# Establishes tracking and documentation for media downgrading activities\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-8] Setting up media downgrading documentation framework...\" -ForegroundColor Cyan\n\n$DowngradeDir = \"C:\\SecurityLogs\\MediaDowngrade\"\n$PolicyDir = \"C:\\SecurityPolicies\\MediaDowngrade\"\n\n# Create directories\nNew-Item -Path $DowngradeDir -ItemType Directory -Force | Out-Null\nNew-Item -Path $PolicyDir -ItemType Directory -Force | Out-Null\n\n# Set restrictive permissions on log directory\n$Acl = Get-Acl $DowngradeDir\n$Acl.SetAccessRuleProtection($true, $false)\n$AdminRule = New-Object System.Security.AccessControl.FileSystemAccessRule(\"Administrators\",\"FullControl\",\"ContainerInherit,ObjectInherit\",\"None\",\"Allow\")\n$SystemRule = New-Object System.Security.AccessControl.FileSystemAccessRule(\"SYSTEM\",\"FullControl\",\"ContainerInherit,ObjectInherit\",\"None\",\"Allow\")\n$Acl.AddAccessRule($AdminRule)\n$Acl.AddAccessRule($SystemRule)\nSet-Acl $DowngradeDir $Acl\n\n# Create downgrading policy document\n$PolicyContent = @\"\nMP-8 MEDIA DOWNGRADING POLICY\n=============================\nEffective Date: $(Get-Date -Format 'yyyy-MM-dd')\n\n1. PURPOSE\nThis policy establishes procedures for downgrading system media containing\nsensitive information prior to release to recipients without appropriate\naccess authorizations.\n\n2. SCOPE\nApplies to all digital and non-digital media containing organizational\ninformation that requires downgrading before release.\n\n3. DOWNGRADING METHODS BY CLASSIFICATION\n\n3.1 Controlled Unclassified Information (CUI)\n    - Method: NIST SP 800-88 Clear or Purge\n    - Verification: Forensic scan of sample media\n    - Approval: Information System Security Manager (ISSM)\n\n3.2 Classified Information\n    - Method: NSA/CSS EPL-listed products or physical destruction\n    - Verification: Mandatory forensic verification\n    - Approval: Cognizant Security Authority\n\n4. MEDIA TYPES AND APPROVED METHODS\n    - HDDs: Secure erase (ATA), degaussing, or destruction\n    - SSDs: Crypto-erase (if supported) or destruction\n    - Optical: Physical destruction only\n    - Paper: Cross-cut shredding (NSA approved for classified)\n\n5. DOCUMENTATION REQUIREMENTS\n    - Media identifier/serial number\n    - Original classification/sensitivity level\n    - Target classification level\n    - Downgrading method used\n    - Date and time of downgrading\n    - Personnel performing downgrading\n    - Verification method and results\n    - Approving official signature\n\n6. RETENTION\n    Downgrading records retained for minimum 3 years or per records\n    retention schedule, whichever is longer.\n\"@\n\n$PolicyContent | Out-File \"$PolicyDir\\MP-8-Downgrade-Policy.txt\" -Encoding UTF8\n\n# Create PowerShell function for logging downgrade actions\n$LogFunction = @'\nfunction Log-MediaDowngrade {\n    param(\n        [Parameter(Mandatory=$true)][string]$MediaID,\n        [Parameter(Mandatory=$true)][ValidateSet('HDD','SSD','Optical','Paper','Tape','Other')][string]$MediaType,\n        [Parameter(Mandatory=$true)][string]$OriginalClassification,\n        [Parameter(Mandatory=$true)][string]$TargetClassification,\n        [Parameter(Mandatory=$true)][string]$Method,\n        [Parameter(Mandatory=$true)][string]$VerifiedBy,\n        [Parameter(Mandatory=$true)][string]$ApprovedBy,\n        [string]$Notes = \"\"\n    )\n    \n    $LogDir = \"C:\\SecurityLogs\\MediaDowngrade\"\n    $LogFile = Join-Path $LogDir \"Downgrade-$(Get-Date -Format 'yyyy-MM').csv\"\n    \n    if (-not (Test-Path $LogFile)) {\n        \"Date,MediaID,MediaType,OriginalClass,TargetClass,Method,VerifiedBy,ApprovedBy,Notes\" | Out-File $LogFile -Encoding UTF8\n    }\n    \n    $Entry = \"$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss'),$MediaID,$MediaType,$OriginalClassification,$TargetClassification,$Method,$VerifiedBy,$ApprovedBy,$Notes\"\n    $Entry | Out-File $LogFile -Append -Encoding UTF8\n    \n    Write-Host \"Downgrading action logged to $LogFile\" -ForegroundColor Green\n}\n'@\n\n$LogFunction | Out-File \"$PolicyDir\\Log-MediaDowngrade.ps1\" -Encoding UTF8\n\nWrite-Host \"[MP-8] Media downgrading framework established\" -ForegroundColor Green\nWrite-Host \"[*] Policy: $PolicyDir\\MP-8-Downgrade-Policy.txt\" -ForegroundColor Yellow\nWrite-Host \"[*] Log function: . $PolicyDir\\Log-MediaDowngrade.ps1\" -ForegroundColor Yellow\nWrite-Host \"[*] Usage: Log-MediaDowngrade -MediaID 'SN12345' -MediaType 'HDD' ...\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "Primarily organizational/procedural control requiring documented downgrading processes. Scripts provide documentation and tracking framework."
    }
  },
  {
    "control_id": "MP-8.1",
    "control_name": "Documentation of Process",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-8",
    "official_text": "Document system media downgrading actions.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Create and maintain comprehensive records of all media downgrading activities to support audit, verification, and chain of custody requirements.",
    "plain_english_explanation": "This enhancement requires organizations to maintain detailed documentation of every media downgrading action performed. Documentation should include what media was downgraded, the original and target classification levels, what method was used, who performed and verified the action, and when it occurred. This creates an audit trail that demonstrates compliance with downgrading policies, supports investigations if sensitive data is later discovered to have been improperly released, and provides evidence of due diligence in handling classified or sensitive information. Documentation also enables organizations to identify patterns or issues in their downgrading processes that may require procedural improvements.",
    "ai_guidance": "Implement a standardized documentation system for all media downgrading activities. This should include a unique tracking identifier for each downgrading action, media identification (serial number, asset tag, or other unique identifier), media type and capacity, original classification or sensitivity level and associated handling caveats, target classification or distribution level, specific downgrading method applied with reference to approved procedures, date and time the downgrading was performed, identity of personnel performing the downgrading action, identity of personnel verifying successful downgrading, verification method used and results, approval authority signature and date, and any deviations from standard procedures with justification. Use a centralized tracking database or log management system to maintain records. Implement access controls on documentation to protect sensitive operational details. Establish retention periods aligned with records management requirements. Generate periodic reports for security officials reviewing downgrading activities.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-8",
      "AU-2",
      "AU-3",
      "AU-12"
    ],
    "supplemental_guidance": "Documentation captures the media type, classification or sensitivity level before downgrading, the approved sanitization or redaction techniques used, and the identity of the individual(s) responsible for performing the downgrading, along with verification that the media was properly downgraded.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-8.1: Documentation of Media Downgrading Process\n# Creates a comprehensive logging system for downgrading actions\n\nset -euo pipefail\n\nLOG_DIR=\"/var/log/media-downgrade\"\nDB_FILE=\"$LOG_DIR/downgrade-records.db\"\n\necho \"[MP-8.1] Setting up downgrading documentation system...\"\n\nmkdir -p \"$LOG_DIR\"\nchmod 700 \"$LOG_DIR\"\n\n# Install sqlite if available for structured record keeping\nif command -v sqlite3 &> /dev/null; then\n    # Create SQLite database for structured records\n    sqlite3 \"$DB_FILE\" << 'SQL'\nCREATE TABLE IF NOT EXISTS downgrade_records (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    record_date DATETIME DEFAULT CURRENT_TIMESTAMP,\n    media_id TEXT NOT NULL,\n    media_type TEXT NOT NULL,\n    media_serial TEXT,\n    original_classification TEXT NOT NULL,\n    target_classification TEXT NOT NULL,\n    downgrade_method TEXT NOT NULL,\n    method_reference TEXT,\n    performed_by TEXT NOT NULL,\n    verified_by TEXT NOT NULL,\n    verification_method TEXT,\n    verification_result TEXT,\n    approved_by TEXT NOT NULL,\n    approval_date DATE,\n    recipient TEXT,\n    notes TEXT,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX IF NOT EXISTS idx_date ON downgrade_records(record_date);\nCREATE INDEX IF NOT EXISTS idx_media ON downgrade_records(media_id);\nSQL\n    chmod 600 \"$DB_FILE\"\n    echo \"[*] SQLite database created at $DB_FILE\"\nfi\n\n# Create documentation script\ncat > \"/usr/local/bin/document-downgrade\" << 'SCRIPT'\n#!/bin/bash\n# Document a media downgrading action (MP-8.1)\n\nDB_FILE=\"/var/log/media-downgrade/downgrade-records.db\"\nCSV_LOG=\"/var/log/media-downgrade/downgrade-$(date +%Y).csv\"\n\necho \"=== MP-8.1 Media Downgrading Documentation ===\"\necho\n\nread -p \"Media ID (asset tag/label): \" MEDIA_ID\nread -p \"Media Serial Number: \" MEDIA_SERIAL\nread -p \"Media Type (HDD/SSD/Optical/Tape/Paper): \" MEDIA_TYPE\nread -p \"Original Classification Level: \" ORIG_CLASS\nread -p \"Target Classification Level: \" TARGET_CLASS\nread -p \"Downgrading Method Used: \" METHOD\nread -p \"Method Reference (procedure ID): \" METHOD_REF\nread -p \"Performed By (name): \" PERFORMED_BY\nread -p \"Verified By (name): \" VERIFIED_BY\nread -p \"Verification Method: \" VERIFY_METHOD\nread -p \"Verification Result (PASS/FAIL): \" VERIFY_RESULT\nread -p \"Approved By (authorizing official): \" APPROVED_BY\nread -p \"Recipient (if applicable): \" RECIPIENT\nread -p \"Notes: \" NOTES\n\nTIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')\n\n# Log to SQLite if available\nif [ -f \"$DB_FILE\" ]; then\n    sqlite3 \"$DB_FILE\" \"INSERT INTO downgrade_records \n        (media_id, media_type, media_serial, original_classification, \n         target_classification, downgrade_method, method_reference,\n         performed_by, verified_by, verification_method, verification_result,\n         approved_by, recipient, notes) \n        VALUES ('$MEDIA_ID', '$MEDIA_TYPE', '$MEDIA_SERIAL', '$ORIG_CLASS',\n                '$TARGET_CLASS', '$METHOD', '$METHOD_REF', '$PERFORMED_BY',\n                '$VERIFIED_BY', '$VERIFY_METHOD', '$VERIFY_RESULT',\n                '$APPROVED_BY', '$RECIPIENT', '$NOTES');\"\n    echo \"[*] Record added to database\"\nfi\n\n# Also log to CSV for backup/export\nif [ ! -f \"$CSV_LOG\" ]; then\n    echo \"Timestamp,MediaID,Serial,Type,OrigClass,TargetClass,Method,MethodRef,PerformedBy,VerifiedBy,VerifyMethod,VerifyResult,ApprovedBy,Recipient,Notes\" > \"$CSV_LOG\"\nfi\necho \"$TIMESTAMP,$MEDIA_ID,$MEDIA_SERIAL,$MEDIA_TYPE,$ORIG_CLASS,$TARGET_CLASS,$METHOD,$METHOD_REF,$PERFORMED_BY,$VERIFIED_BY,$VERIFY_METHOD,$VERIFY_RESULT,$APPROVED_BY,$RECIPIENT,$NOTES\" >> \"$CSV_LOG\"\n\necho\necho \"[MP-8.1] Downgrading action documented successfully\"\necho \"Record ID: $(date +%Y%m%d%H%M%S)-$MEDIA_ID\"\nSCRIPT\n\nchmod 755 \"/usr/local/bin/document-downgrade\"\n\necho \"[MP-8.1] Documentation system configured\"\necho \"[*] Use 'document-downgrade' to record downgrading actions\""
      },
      "windows": {
        "powershell": "# MP-8.1: Documentation of Media Downgrading Process\n# Comprehensive logging and documentation system\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-8.1] Setting up downgrading documentation system...\" -ForegroundColor Cyan\n\n$LogDir = \"C:\\SecurityLogs\\MediaDowngrade\"\n$ScriptDir = \"C:\\SecurityPolicies\\MediaDowngrade\"\n\nNew-Item -Path $LogDir -ItemType Directory -Force | Out-Null\nNew-Item -Path $ScriptDir -ItemType Directory -Force | Out-Null\n\n# Create documentation function module\n$DocModule = @'\nfunction New-DowngradeRecord {\n    <#\n    .SYNOPSIS\n    Documents a media downgrading action for MP-8.1 compliance.\n    \n    .DESCRIPTION\n    Creates a comprehensive record of media downgrading activities including\n    all required documentation elements per NIST SP 800-53 MP-8.1.\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory=$true)]\n        [string]$MediaID,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$MediaSerial,\n        \n        [Parameter(Mandatory=$true)]\n        [ValidateSet('HDD','SSD','Optical','Tape','Paper','FlashMedia','Other')]\n        [string]$MediaType,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$OriginalClassification,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$TargetClassification,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$DowngradeMethod,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$MethodReference,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$PerformedBy,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$VerifiedBy,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$VerificationMethod,\n        \n        [Parameter(Mandatory=$true)]\n        [ValidateSet('PASS','FAIL','PARTIAL')]\n        [string]$VerificationResult,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$ApprovedBy,\n        \n        [string]$Recipient = \"N/A\",\n        \n        [string]$Notes = \"\"\n    )\n    \n    $LogDir = \"C:\\SecurityLogs\\MediaDowngrade\"\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    $RecordID = \"DG-$(Get-Date -Format 'yyyyMMddHHmmss')-$($MediaID -replace '[^a-zA-Z0-9]','')\"\n    \n    # Create record object\n    $Record = [PSCustomObject]@{\n        RecordID = $RecordID\n        Timestamp = $Timestamp\n        MediaID = $MediaID\n        MediaSerial = $MediaSerial\n        MediaType = $MediaType\n        OriginalClassification = $OriginalClassification\n        TargetClassification = $TargetClassification\n        DowngradeMethod = $DowngradeMethod\n        MethodReference = $MethodReference\n        PerformedBy = $PerformedBy\n        VerifiedBy = $VerifiedBy\n        VerificationMethod = $VerificationMethod\n        VerificationResult = $VerificationResult\n        ApprovedBy = $ApprovedBy\n        Recipient = $Recipient\n        Notes = $Notes\n    }\n    \n    # Save to JSON log (append to daily file)\n    $JsonFile = Join-Path $LogDir \"downgrade-$(Get-Date -Format 'yyyy-MM-dd').json\"\n    $ExistingRecords = @()\n    if (Test-Path $JsonFile) {\n        $ExistingRecords = @(Get-Content $JsonFile | ConvertFrom-Json)\n    }\n    $ExistingRecords += $Record\n    $ExistingRecords | ConvertTo-Json -Depth 10 | Out-File $JsonFile -Encoding UTF8\n    \n    # Also append to CSV for reporting\n    $CsvFile = Join-Path $LogDir \"downgrade-$(Get-Date -Format 'yyyy').csv\"\n    $Record | Export-Csv -Path $CsvFile -Append -NoTypeInformation\n    \n    Write-Host \"[MP-8.1] Downgrading action documented\" -ForegroundColor Green\n    Write-Host \"Record ID: $RecordID\" -ForegroundColor Yellow\n    \n    return $Record\n}\n\nfunction Get-DowngradeRecords {\n    <#\n    .SYNOPSIS\n    Retrieves media downgrading records for audit purposes.\n    #>\n    param(\n        [datetime]$StartDate = (Get-Date).AddYears(-1),\n        [datetime]$EndDate = (Get-Date),\n        [string]$MediaID = \"*\"\n    )\n    \n    $LogDir = \"C:\\SecurityLogs\\MediaDowngrade\"\n    $AllRecords = @()\n    \n    Get-ChildItem \"$LogDir\\*.json\" | ForEach-Object {\n        $Records = Get-Content $_.FullName | ConvertFrom-Json\n        $AllRecords += $Records\n    }\n    \n    $AllRecords | Where-Object {\n        [datetime]$_.Timestamp -ge $StartDate -and\n        [datetime]$_.Timestamp -le $EndDate -and\n        $_.MediaID -like $MediaID\n    }\n}\n'@\n\n$DocModule | Out-File \"$ScriptDir\\DowngradeDocumentation.psm1\" -Encoding UTF8\n\n# Create shortcut script\n$ShortcutScript = @'\n# Import the downgrade documentation module\nImport-Module \"C:\\SecurityPolicies\\MediaDowngrade\\DowngradeDocumentation.psm1\"\n\nWrite-Host \"MP-8.1 Media Downgrading Documentation System\" -ForegroundColor Cyan\nWrite-Host \"=============================================\" -ForegroundColor Cyan\nWrite-Host \"\"\nWrite-Host \"Available Commands:\" -ForegroundColor Yellow\nWrite-Host \"  New-DowngradeRecord  - Document a new downgrading action\"\nWrite-Host \"  Get-DowngradeRecords - Query existing records\"\nWrite-Host \"\"\nWrite-Host \"Example:\" -ForegroundColor Green\nWrite-Host '  New-DowngradeRecord -MediaID \"HDD-001\" -MediaSerial \"WD12345\" -MediaType \"HDD\" `'\nWrite-Host '    -OriginalClassification \"SECRET\" -TargetClassification \"UNCLASSIFIED\" `'\nWrite-Host '    -DowngradeMethod \"Degauss\" -MethodReference \"SOP-MP8-001\" `'\nWrite-Host '    -PerformedBy \"J.Smith\" -VerifiedBy \"M.Jones\" `'\nWrite-Host '    -VerificationMethod \"ForensicScan\" -VerificationResult \"PASS\" `'\nWrite-Host '    -ApprovedBy \"Col.Williams\"'\n'@\n\n$ShortcutScript | Out-File \"$ScriptDir\\Start-DowngradeDoc.ps1\" -Encoding UTF8\n\nWrite-Host \"[MP-8.1] Documentation system configured\" -ForegroundColor Green\nWrite-Host \"[*] Module: $ScriptDir\\DowngradeDocumentation.psm1\" -ForegroundColor Yellow\nWrite-Host \"[*] To use: . $ScriptDir\\Start-DowngradeDoc.ps1\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "Organizational control requiring documented records of all downgrading activities. Scripts provide logging infrastructure."
    }
  },
  {
    "control_id": "MP-8.2",
    "control_name": "Equipment Testing",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-8",
    "official_text": "Test downgrading equipment and procedures [Assignment: organization-defined frequency] to ensure that downgrading actions are being achieved.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Verify through periodic testing that media downgrading equipment and procedures are functioning correctly and effectively removing sensitive information.",
    "plain_english_explanation": "Organizations must regularly test their media downgrading equipment (such as degaussers, secure erase tools, and shredders) and procedures to verify they are actually achieving complete removal of sensitive information. Testing frequency should be based on the criticality of the information being protected and how often downgrading is performed. Testing typically involves processing test media with known data patterns, then attempting to recover the data using forensic methods appropriate to the original classification level. This verification ensures that equipment has not degraded, procedures are being followed correctly, and the overall downgrading process remains effective. Without testing, organizations cannot have confidence that their downgrading process actually protects sensitive information.",
    "ai_guidance": "Establish a formal equipment testing program that includes scheduled testing at defined intervals (typically quarterly for high-use equipment, annually at minimum), testing procedures documented in standard operating procedures, test media preparation with known data patterns across the entire storage area, forensic verification by trained personnel using tools appropriate to the classification level, documentation of all test results including pass/fail status, calibration records for equipment requiring calibration (such as degaussers), maintenance logs showing preventive maintenance performed, and corrective action procedures when testing reveals deficiencies. For degaussers, verify magnetic field strength meets NSA requirements for the media type. For software-based sanitization, verify correct pattern application and completion. Maintain certification records for personnel operating downgrading equipment. Consider third-party validation for high-classification environments.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-8",
      "MA-2",
      "MA-3",
      "MA-5"
    ],
    "supplemental_guidance": "Periodic testing of downgrading equipment and procedures helps to ensure that the equipment and procedures are operating effectively and that the targeted sanitization or redaction goals are achieved.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-8.2: Equipment Testing Framework for Media Downgrading\n# Creates testing schedule and documentation framework\n\nset -euo pipefail\n\nTEST_DIR=\"/var/log/media-downgrade/equipment-tests\"\nPROC_DIR=\"/etc/security/media-downgrade\"\n\necho \"[MP-8.2] Setting up equipment testing framework...\"\n\nmkdir -p \"$TEST_DIR\"\nmkdir -p \"$PROC_DIR\"\n\n# Create equipment testing procedure document\ncat > \"$PROC_DIR/equipment-testing-procedure.txt\" << 'EOF'\nMP-8.2 EQUIPMENT TESTING PROCEDURE\n==================================\n\n1. TESTING SCHEDULE\n   - Degaussers: Quarterly, or after every 100 uses\n   - Secure Erase Software: Quarterly\n   - Shredders: Monthly visual inspection, annual certification\n   - Disintegrators: Annual certification\n\n2. TEST PROCEDURE - DEGAUSSER\n   a. Obtain test media of same type as production media\n   b. Write known test pattern to entire media surface\n   c. Verify test pattern is readable\n   d. Process media through degausser\n   e. Attempt to read media using appropriate forensic tools\n   f. Document magnetic field strength reading\n   g. Record pass/fail based on data recovery attempt\n\n3. TEST PROCEDURE - SOFTWARE SANITIZATION\n   a. Prepare test media with known data pattern\n   b. Verify pattern using hex editor\n   c. Execute sanitization procedure\n   d. Perform forensic analysis of sanitized media\n   e. Check all sectors including HPA, DCO areas\n   f. Document results with screenshots/logs\n\n4. TEST PROCEDURE - SHREDDER\n   a. Visual inspection of cutting elements\n   b. Process test documents with security markings\n   c. Examine output particle size\n   d. Verify compliance with DIN 66399 security level\n   e. Document shred size measurements\n\n5. DOCUMENTATION REQUIREMENTS\n   - Equipment identifier/serial number\n   - Test date and time\n   - Tester name and certification level\n   - Test media details\n   - Test procedure followed\n   - Results (PASS/FAIL)\n   - Any anomalies noted\n   - Corrective actions if applicable\n\n6. FAILURE RESPONSE\n   - Immediately remove equipment from service\n   - Notify security officer\n   - Review all media processed since last successful test\n   - Repair/recertify or replace equipment\n   - Document incident and resolution\nEOF\n\n# Create test logging script\ncat > \"/usr/local/bin/log-equipment-test\" << 'SCRIPT'\n#!/bin/bash\n# Log equipment test results for MP-8.2\n\nTEST_DIR=\"/var/log/media-downgrade/equipment-tests\"\nLOG_FILE=\"$TEST_DIR/equipment-tests-$(date +%Y).csv\"\n\nif [ ! -f \"$LOG_FILE\" ]; then\n    echo \"TestDate,EquipmentID,EquipmentType,SerialNumber,TestProcedure,TesterName,TesterCert,Result,FieldStrength,Notes,NextTestDue\" > \"$LOG_FILE\"\nfi\n\necho \"=== MP-8.2 Equipment Test Documentation ===\"\necho\n\nread -p \"Equipment ID: \" EQUIP_ID\nread -p \"Equipment Type (Degausser/SanitizeSW/Shredder/Disintegrator): \" EQUIP_TYPE\nread -p \"Serial Number: \" SERIAL\nread -p \"Test Procedure Reference: \" PROCEDURE\nread -p \"Tester Name: \" TESTER\nread -p \"Tester Certification: \" CERT\nread -p \"Test Result (PASS/FAIL): \" RESULT\nread -p \"Field Strength/Measurement (if applicable): \" MEASURE\nread -p \"Notes: \" NOTES\nread -p \"Next Test Due Date (YYYY-MM-DD): \" NEXT_TEST\n\necho \"$(date +%Y-%m-%d),$EQUIP_ID,$EQUIP_TYPE,$SERIAL,$PROCEDURE,$TESTER,$CERT,$RESULT,$MEASURE,$NOTES,$NEXT_TEST\" >> \"$LOG_FILE\"\n\nif [ \"$RESULT\" == \"FAIL\" ]; then\n    echo \"[!] EQUIPMENT FAILURE - Notify security officer immediately\"\n    logger -t MP-8.2 -p auth.alert \"Equipment test FAILURE: $EQUIP_ID ($EQUIP_TYPE)\"\nfi\n\necho\necho \"[MP-8.2] Test result logged to $LOG_FILE\"\nSCRIPT\n\nchmod 755 \"/usr/local/bin/log-equipment-test\"\n\n# Create cron reminder for testing schedule\ncat > \"/etc/cron.monthly/mp8-test-reminder\" << 'CRON'\n#!/bin/bash\n# Monthly reminder to check equipment testing schedule\nlogger -t MP-8.2 \"Monthly reminder: Review media downgrading equipment testing schedule\"\nCRON\nchmod 755 \"/etc/cron.monthly/mp8-test-reminder\"\n\necho \"[MP-8.2] Equipment testing framework configured\"\necho \"[*] Procedure: $PROC_DIR/equipment-testing-procedure.txt\"\necho \"[*] Log tests: log-equipment-test\""
      },
      "windows": {
        "powershell": "# MP-8.2: Equipment Testing Framework\n# Establishes testing schedule and documentation for downgrading equipment\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-8.2] Setting up equipment testing framework...\" -ForegroundColor Cyan\n\n$TestDir = \"C:\\SecurityLogs\\MediaDowngrade\\EquipmentTests\"\n$ProcDir = \"C:\\SecurityPolicies\\MediaDowngrade\"\n\nNew-Item -Path $TestDir -ItemType Directory -Force | Out-Null\n\n# Create testing procedure document\n$TestProcedure = @\"\nMP-8.2 EQUIPMENT TESTING PROCEDURE\n==================================\nVersion: 1.0\nEffective: $(Get-Date -Format 'yyyy-MM-dd')\n\n1. TESTING SCHEDULE\n   - Degaussers: Quarterly, or after every 100 uses\n   - Secure Erase Software: Quarterly\n   - Shredders: Monthly visual inspection, annual certification\n   - Disintegrators: Annual certification by certified technician\n\n2. TEST PROCEDURE - DEGAUSSER\n   a. Obtain test media of same type as production media\n   b. Write known test pattern to entire media surface using dd or equivalent\n   c. Verify test pattern is readable using forensic software\n   d. Process media through degausser per manufacturer instructions\n   e. Attempt data recovery using EnCase, FTK, or equivalent\n   f. Document magnetic field strength reading (Gauss meter)\n   g. Record pass/fail based on data recovery results\n\n3. TEST PROCEDURE - SOFTWARE SANITIZATION\n   a. Prepare test media with known data pattern (all sectors)\n   b. Verify pattern using hex editor (WinHex, HxD)\n   c. Execute sanitization per NIST 800-88 guidelines\n   d. Perform forensic analysis including HPA/DCO areas\n   e. Document results with screenshots\n\n4. TEST PROCEDURE - SHREDDER (Paper/Optical)\n   a. Visual inspection of cutting elements for wear\n   b. Process test documents with mock classification markings\n   c. Examine output particle size with ruler\n   d. Verify compliance with DIN 66399 / NSA EPL requirements\n   e. Document shred size measurements (max dimension)\n\n5. DOCUMENTATION REQUIREMENTS\n   - Equipment identifier/asset tag\n   - Equipment serial number\n   - Test date and time\n   - Tester name and certification level\n   - Test media type and details\n   - Test procedure reference\n   - Pass/Fail result\n   - Measurements taken\n   - Any anomalies noted\n   - Corrective actions if applicable\n   - Next scheduled test date\n\n6. FAILURE RESPONSE PROCEDURE\n   - Immediately tag equipment OUT OF SERVICE\n   - Notify ISSM within 4 hours\n   - Compile list of all media processed since last successful test\n   - Initiate risk assessment for potentially compromised media\n   - Arrange repair or replacement\n   - Retest before returning to service\n   - Document incident in security log\n\"@\n\n$TestProcedure | Out-File \"$ProcDir\\MP-8.2-Testing-Procedure.txt\" -Encoding UTF8\n\n# Create equipment test logging function\n$TestModule = @'\nfunction New-EquipmentTest {\n    <#\n    .SYNOPSIS\n    Documents equipment test results for MP-8.2 compliance.\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory=$true)]\n        [string]$EquipmentID,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$SerialNumber,\n        \n        [Parameter(Mandatory=$true)]\n        [ValidateSet('Degausser','SanitizationSoftware','Shredder','Disintegrator','Other')]\n        [string]$EquipmentType,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$TestProcedure,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$TesterName,\n        \n        [Parameter(Mandatory=$true)]\n        [string]$TesterCertification,\n        \n        [Parameter(Mandatory=$true)]\n        [ValidateSet('PASS','FAIL')]\n        [string]$Result,\n        \n        [string]$Measurement = \"N/A\",\n        \n        [string]$Notes = \"\",\n        \n        [Parameter(Mandatory=$true)]\n        [datetime]$NextTestDue\n    )\n    \n    $TestDir = \"C:\\SecurityLogs\\MediaDowngrade\\EquipmentTests\"\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    \n    $TestRecord = [PSCustomObject]@{\n        TestID = \"TEST-$(Get-Date -Format 'yyyyMMddHHmmss')\"\n        TestDate = $Timestamp\n        EquipmentID = $EquipmentID\n        SerialNumber = $SerialNumber\n        EquipmentType = $EquipmentType\n        TestProcedure = $TestProcedure\n        TesterName = $TesterName\n        TesterCertification = $TesterCertification\n        Result = $Result\n        Measurement = $Measurement\n        Notes = $Notes\n        NextTestDue = $NextTestDue.ToString(\"yyyy-MM-dd\")\n    }\n    \n    # Log to CSV\n    $CsvFile = Join-Path $TestDir \"equipment-tests-$(Get-Date -Format 'yyyy').csv\"\n    $TestRecord | Export-Csv -Path $CsvFile -Append -NoTypeInformation\n    \n    # Alert on failure\n    if ($Result -eq 'FAIL') {\n        Write-Warning \"EQUIPMENT TEST FAILURE - $EquipmentID\"\n        Write-Warning \"Notify ISSM immediately and remove equipment from service!\"\n        \n        # Log to Windows Event Log\n        Write-EventLog -LogName \"Application\" -Source \"MP-8.2\" -EventId 5001 `\n            -EntryType Warning -Message \"Equipment test FAILURE: $EquipmentID ($EquipmentType)\"\n    }\n    \n    Write-Host \"[MP-8.2] Equipment test documented\" -ForegroundColor Green\n    return $TestRecord\n}\n\nfunction Get-EquipmentTestSchedule {\n    <#\n    .SYNOPSIS\n    Shows upcoming equipment tests based on NextTestDue dates.\n    #>\n    param([int]$DaysAhead = 30)\n    \n    $TestDir = \"C:\\SecurityLogs\\MediaDowngrade\\EquipmentTests\"\n    $AllTests = @()\n    \n    Get-ChildItem \"$TestDir\\*.csv\" | ForEach-Object {\n        $AllTests += Import-Csv $_.FullName\n    }\n    \n    $Today = Get-Date\n    $Cutoff = $Today.AddDays($DaysAhead)\n    \n    $AllTests | \n        Sort-Object EquipmentID, TestDate -Descending |\n        Group-Object EquipmentID |\n        ForEach-Object { $_.Group | Select-Object -First 1 } |\n        Where-Object { [datetime]$_.NextTestDue -le $Cutoff } |\n        Sort-Object NextTestDue |\n        Select-Object EquipmentID, EquipmentType, Result, NextTestDue\n}\n'@\n\n$TestModule | Out-File \"$ProcDir\\EquipmentTesting.psm1\" -Encoding UTF8\n\n# Register event log source\ntry {\n    New-EventLog -LogName \"Application\" -Source \"MP-8.2\" -ErrorAction SilentlyContinue\n} catch { }\n\n# Create scheduled task for testing reminders\n$TaskAction = New-ScheduledTaskAction -Execute \"PowerShell.exe\" `\n    -Argument \"-NoProfile -Command `\"Write-EventLog -LogName 'Application' -Source 'MP-8.2' -EventId 5000 -EntryType Information -Message 'Monthly reminder: Review media downgrading equipment testing schedule'`\"\"\n$TaskTrigger = New-ScheduledTaskTrigger -Monthly -At \"09:00\" -DaysOfMonth 1\n$TaskSettings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries\n\nRegister-ScheduledTask -TaskName \"MP-8.2 Equipment Test Reminder\" `\n    -Action $TaskAction -Trigger $TaskTrigger -Settings $TaskSettings `\n    -Description \"Monthly reminder to check equipment testing schedule\" `\n    -Force | Out-Null\n\nWrite-Host \"[MP-8.2] Equipment testing framework configured\" -ForegroundColor Green\nWrite-Host \"[*] Procedure: $ProcDir\\MP-8.2-Testing-Procedure.txt\" -ForegroundColor Yellow\nWrite-Host \"[*] Module: $ProcDir\\EquipmentTesting.psm1\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "Organizational control requiring periodic testing of downgrading equipment. Scripts provide testing schedule and documentation framework."
    }
  },
  {
    "control_id": "MP-8.3",
    "control_name": "Controlled Unclassified Information",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-8",
    "official_text": "Downgrade system media containing controlled unclassified information prior to public release.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure that media containing Controlled Unclassified Information (CUI) is properly sanitized using appropriate methods before any public release or transfer to non-authorized recipients.",
    "plain_english_explanation": "When organizations need to release media to the public or transfer it to parties who are not authorized to handle Controlled Unclassified Information (CUI), the media must first be properly downgraded. CUI includes categories such as Personally Identifiable Information (PII), For Official Use Only (FOUO), Law Enforcement Sensitive (LES), and many other designated categories. The downgrading process must remove all CUI so that it cannot be recovered through forensic analysis. This applies to scenarios such as selling or donating used equipment, releasing information through FOIA requests, or transferring systems between agencies with different CUI handling authorizations. Methods should align with NIST SP 800-88 guidelines for media sanitization.",
    "ai_guidance": "Organizations implementing this control should first identify all media that contains or has contained CUI and establish procedures for tracking this media throughout its lifecycle. Before public release, media must be sanitized using methods appropriate to the media type and CUI category as specified in NIST SP 800-88. For magnetic media, use Clear or Purge methods depending on the intended reuse scenario. For flash-based media, cryptographic erase or physical destruction is typically required due to wear-leveling. Maintain chain of custody documentation from the point CUI is identified through the completion of downgrading. Implement verification procedures to confirm successful sanitization, potentially including forensic spot-checks. Ensure personnel performing downgrading are trained on CUI handling requirements and sanitization procedures. Coordinate with CUI program managers when questions arise about specific category requirements. Document all downgrading actions per MP-8.1 requirements.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-6",
      "MP-8",
      "MP-8.1",
      "PM-17"
    ],
    "supplemental_guidance": "Controlled unclassified information is defined by the National Archives and Records Administration (NARA) and includes information designated by executive order, law, or government-wide policy as requiring safeguarding or dissemination controls. Downgrading of media containing CUI removes the information so that it can be publicly released.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-8.3: CUI Media Downgrading Procedure\n# Framework for handling CUI media prior to public release\n\nset -euo pipefail\n\nCUI_DIR=\"/etc/security/media-downgrade/cui\"\nLOG_DIR=\"/var/log/media-downgrade/cui\"\n\necho \"[MP-8.3] Setting up CUI media downgrading framework...\"\n\nmkdir -p \"$CUI_DIR\"\nmkdir -p \"$LOG_DIR\"\nchmod 700 \"$LOG_DIR\"\n\n# Create CUI downgrading policy\ncat > \"$CUI_DIR/cui-downgrade-policy.txt\" << 'EOF'\nMP-8.3 CUI MEDIA DOWNGRADING POLICY\n====================================\n\n1. PURPOSE\nEnsure all Controlled Unclassified Information (CUI) is properly removed\nfrom system media prior to public release or transfer to unauthorized parties.\n\n2. CUI CATEGORIES REQUIRING DOWNGRADING\n- Privacy (PRVCY) - PII, PHI, student records\n- Law Enforcement (LES)\n- Proprietary Business Information (PROPIN)\n- Export Controlled (EXPT)\n- Critical Infrastructure (CRIT)\n- All other CUI categories per NARA registry\n\n3. APPROVED DOWNGRADING METHODS (per NIST SP 800-88)\n\n3.1 Magnetic Storage (HDD, Tape)\n    - Clear: Overwrite all addressable locations\n    - Purge: Firmware-based secure erase or degaussing\n    - Destroy: Physical destruction (shredding, disintegration)\n\n3.2 Flash-Based Storage (SSD, USB, SD)\n    - Purge: Cryptographic erase (if supported)\n    - Destroy: Physical destruction (shredding, incineration)\n    Note: Clear method NOT approved for flash media due to wear-leveling\n\n3.3 Optical Media (CD, DVD, Blu-ray)\n    - Destroy: Physical destruction only (shredding)\n\n3.4 Paper Documents\n    - Destroy: Cross-cut shredding (minimum P-4/Level 4)\n\n4. VERIFICATION REQUIREMENTS\n- Verification required before public release\n- Use forensic tools to attempt data recovery\n- Document verification results\n\n5. APPROVAL WORKFLOW\n1. Identify media containing CUI\n2. Submit downgrading request to CUI Program Manager\n3. Obtain approval for release destination\n4. Execute downgrading using approved method\n5. Verify successful sanitization\n6. Document per MP-8.1\n7. Release media with downgrading certificate\n\n6. REFERENCES\n- NIST SP 800-88 Rev 1: Guidelines for Media Sanitization\n- 32 CFR Part 2002: CUI Federal Regulation\n- NARA CUI Registry: https://www.archives.gov/cui\nEOF\n\n# Create sanitization verification script\ncat > \"/usr/local/bin/verify-cui-sanitization\" << 'SCRIPT'\n#!/bin/bash\n# Verify media sanitization for CUI media (MP-8.3)\n# This script performs basic verification - use forensic tools for production\n\nif [ $# -lt 1 ]; then\n    echo \"Usage: $0 <device>\"\n    echo \"Example: $0 /dev/sdb\"\n    exit 1\nfi\n\nDEVICE=$1\n\nif [ ! -b \"$DEVICE\" ]; then\n    echo \"Error: $DEVICE is not a block device\"\n    exit 1\nfi\n\necho \"[MP-8.3] Verifying sanitization of $DEVICE\"\necho \"WARNING: This performs read operations only\"\necho\n\n# Check if device contains any non-zero data (sampling)\necho \"[*] Sampling device for residual data...\"\nDATA_FOUND=0\n\nfor OFFSET in 0 1048576 10485760 104857600; do\n    SAMPLE=$(dd if=\"$DEVICE\" bs=4096 count=1 skip=$((OFFSET/4096)) 2>/dev/null | xxd | head -5)\n    if echo \"$SAMPLE\" | grep -qv \"0000 0000 0000 0000\"; then\n        if echo \"$SAMPLE\" | grep -qvE \"^[0-9a-f]+:\\s+(0000\\s*)+$\"; then\n            echo \"[!] Non-zero data found at offset $OFFSET\"\n            DATA_FOUND=1\n        fi\n    fi\ndone\n\nif [ $DATA_FOUND -eq 0 ]; then\n    echo \"[*] Basic verification PASSED - no obvious data patterns found\"\n    echo \"[!] NOTE: Full forensic verification recommended for CUI media\"\nelse\n    echo \"[!] VERIFICATION FAILED - Residual data detected\"\n    echo \"[!] Media requires additional sanitization before release\"\n    exit 1\nfi\nSCRIPT\n\nchmod 755 \"/usr/local/bin/verify-cui-sanitization\"\n\necho \"[MP-8.3] CUI downgrading framework configured\"\necho \"[*] Policy: $CUI_DIR/cui-downgrade-policy.txt\"\necho \"[*] Verification: verify-cui-sanitization <device>\""
      },
      "windows": {
        "powershell": "# MP-8.3: CUI Media Downgrading Framework\n# Procedures for handling CUI media prior to public release\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-8.3] Setting up CUI media downgrading framework...\" -ForegroundColor Cyan\n\n$CUIDir = \"C:\\SecurityPolicies\\MediaDowngrade\\CUI\"\n$LogDir = \"C:\\SecurityLogs\\MediaDowngrade\\CUI\"\n\nNew-Item -Path $CUIDir -ItemType Directory -Force | Out-Null\nNew-Item -Path $LogDir -ItemType Directory -Force | Out-Null\n\n# Create CUI downgrading policy\n$CUIPolicy = @\"\nMP-8.3 CUI MEDIA DOWNGRADING POLICY\n====================================\nEffective: $(Get-Date -Format 'yyyy-MM-dd')\n\n1. PURPOSE\nEnsure all Controlled Unclassified Information (CUI) is properly removed\nfrom system media prior to public release or transfer to unauthorized parties.\n\n2. CUI CATEGORIES REQUIRING DOWNGRADING\n- Privacy (PRVCY) - PII, PHI, HIPAA data, student records (FERPA)\n- Law Enforcement (LES) - Investigation data, witness information\n- Proprietary Business Information (PROPIN) - Trade secrets, proposals\n- Export Controlled (EXPT) - ITAR, EAR controlled data\n- Critical Infrastructure (CRIT) - PCII, CEII\n- Financial (FIN) - Tax information, audit data\n- All other CUI categories per NARA CUI Registry\n\n3. APPROVED DOWNGRADING METHODS (per NIST SP 800-88 Rev 1)\n\n3.1 Magnetic Storage (HDD, Magnetic Tape)\n    - Clear: Overwrite all addressable storage locations\n      * Minimum: One pass of zeros\n      * Recommended: Three-pass overwrite (zeros, ones, random)\n    - Purge: ATA Secure Erase or NSA-approved degaussing\n    - Destroy: Physical destruction via NSA/CSS EPL-listed devices\n\n3.2 Flash-Based Storage (SSD, NVMe, USB Flash, SD Cards)\n    - Purge: ATA Sanitize Block Erase or Cryptographic Erase\n      * Clear method NOT approved due to wear-leveling\n    - Destroy: Physical destruction (shredding to 2mm particles)\n\n3.3 Optical Media (CD, DVD, Blu-ray)\n    - Destroy: Physical destruction only\n      * Commercial optical media shredders approved\n\n3.4 Paper Documents with CUI\n    - Destroy: Cross-cut shredding (DIN 66399 P-4 minimum)\n      * P-5 or P-6 for sensitive CUI categories\n\n4. VERIFICATION REQUIREMENTS\n- Random sampling of sanitized media using forensic tools\n- Minimum 1% of media batch or 5 items, whichever is greater\n- Document verification method and results\n- Forensic tools: EnCase, FTK, Autopsy, or equivalent\n\n5. PUBLIC RELEASE APPROVAL WORKFLOW\n\n   Step 1: Identify media containing/having contained CUI\n           - Check CUI marking, system inventory, data flow records\n   \n   Step 2: Submit Request\n           - Complete CUI Downgrading Request Form\n           - Identify CUI categories present\n           - Specify intended recipient/release destination\n   \n   Step 3: Approval\n           - CUI Program Manager reviews and approves\n           - Legal/Privacy review if PII involved\n   \n   Step 4: Execute Downgrading\n           - Use approved method for media type\n           - Follow documented procedure\n   \n   Step 5: Verification\n           - Perform forensic verification\n           - Document results\n   \n   Step 6: Documentation\n           - Complete MP-8.1 documentation\n           - Generate downgrading certificate\n   \n   Step 7: Release\n           - Attach downgrading certificate to media\n           - Transfer to recipient\n\n6. REFERENCES\n- NIST SP 800-88 Rev 1: Guidelines for Media Sanitization\n- 32 CFR Part 2002: Controlled Unclassified Information\n- NARA CUI Registry: https://www.archives.gov/cui\n- Executive Order 13556: Controlled Unclassified Information\n\"@\n\n$CUIPolicy | Out-File \"$CUIDir\\CUI-Downgrade-Policy.txt\" -Encoding UTF8\n\n# Create CUI downgrading request form template\n$RequestForm = @\"\nCUI MEDIA DOWNGRADING REQUEST FORM\n===================================\n\nRequest Date: ______________\nRequester Name: ______________\nRequester Organization: ______________\nRequester Phone: ______________\n\nMEDIA INFORMATION\n-----------------\nMedia Type: [ ] HDD  [ ] SSD  [ ] USB  [ ] Optical  [ ] Tape  [ ] Other: ______\nMedia ID/Asset Tag: ______________\nMedia Serial Number: ______________\nMedia Capacity: ______________\n\nCUI INFORMATION\n---------------\nCUI Categories Present (check all that apply):\n[ ] Privacy (PII/PHI)\n[ ] Law Enforcement Sensitive\n[ ] Proprietary Business Information\n[ ] Export Controlled\n[ ] Critical Infrastructure\n[ ] Other: ______________\n\nCUI Marking Authority: ______________\nDate CUI was stored on media: ______________\n\nRELEASE INFORMATION\n-------------------\nIntended Recipient: ______________\nRecipient Organization: ______________\nPurpose of Release: ______________\nRelease Date Requested: ______________\n\nDOWNGRADING METHOD REQUESTED\n----------------------------\n[ ] Clear (Overwrite)\n[ ] Purge (Secure Erase/Cryptographic Erase)\n[ ] Destroy (Physical Destruction)\n\nAPPROVALS\n---------\nRequester Signature: ______________ Date: __________\n\nCUI Program Manager: ______________ Date: __________\n[ ] Approved  [ ] Denied  [ ] Requires Additional Review\n\nComments: _________________________________________________\n\n=== FOR DOWNGRADING PERSONNEL USE ===\nDowngrading Performed By: ______________ Date: __________\nMethod Used: ______________\nVerification Performed: [ ] Yes  [ ] No\nVerification Result: [ ] Pass  [ ] Fail\nCertificate Number: ______________\n\"@\n\n$RequestForm | Out-File \"$CUIDir\\CUI-Downgrade-Request-Form.txt\" -Encoding UTF8\n\n# Create PowerShell function for CUI tracking\n$CUIModule = @'\nfunction New-CUIDowngradeRequest {\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory=$true)][string]$MediaID,\n        [Parameter(Mandatory=$true)][string]$MediaType,\n        [Parameter(Mandatory=$true)][string[]]$CUICategories,\n        [Parameter(Mandatory=$true)][string]$Recipient,\n        [Parameter(Mandatory=$true)][string]$Purpose,\n        [Parameter(Mandatory=$true)][string]$RequestedMethod\n    )\n    \n    $Request = [PSCustomObject]@{\n        RequestID = \"CUI-$(Get-Date -Format 'yyyyMMddHHmmss')\"\n        RequestDate = Get-Date -Format \"yyyy-MM-dd\"\n        MediaID = $MediaID\n        MediaType = $MediaType\n        CUICategories = $CUICategories -join \"; \"\n        Recipient = $Recipient\n        Purpose = $Purpose\n        RequestedMethod = $RequestedMethod\n        Status = \"Pending Approval\"\n    }\n    \n    $LogFile = \"C:\\SecurityLogs\\MediaDowngrade\\CUI\\cui-requests-$(Get-Date -Format 'yyyy').csv\"\n    $Request | Export-Csv -Path $LogFile -Append -NoTypeInformation\n    \n    Write-Host \"CUI Downgrade Request Created: $($Request.RequestID)\" -ForegroundColor Green\n    Write-Host \"Submit to CUI Program Manager for approval.\" -ForegroundColor Yellow\n    \n    return $Request\n}\n'@\n\n$CUIModule | Out-File \"$CUIDir\\CUI-Downgrade.psm1\" -Encoding UTF8\n\nWrite-Host \"[MP-8.3] CUI downgrading framework configured\" -ForegroundColor Green\nWrite-Host \"[*] Policy: $CUIDir\\CUI-Downgrade-Policy.txt\" -ForegroundColor Yellow\nWrite-Host \"[*] Request Form: $CUIDir\\CUI-Downgrade-Request-Form.txt\" -ForegroundColor Yellow\nWrite-Host \"[*] Module: $CUIDir\\CUI-Downgrade.psm1\" -ForegroundColor Yellow"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "Organizational control requiring documented procedures for CUI media downgrading. Coordinate with CUI Program Manager and follow NIST SP 800-88 guidelines."
    }
  },
  {
    "control_id": "MP-8.4",
    "control_name": "Classified Information",
    "family": "Media Protection",
    "family_id": "MP",
    "parent_control": "MP-8",
    "official_text": "Downgrade system media containing classified information prior to release to individuals without required access authorizations.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure classified information is properly removed from media using methods approved by the cognizant security authority before release to individuals lacking appropriate security clearances.",
    "plain_english_explanation": "When media that has stored classified information (CONFIDENTIAL, SECRET, TOP SECRET, or information protected under Special Access Programs) needs to be released to individuals who do not have the required security clearances and need-to-know, the media must undergo a rigorous downgrading process. Classified information downgrading is governed by stricter requirements than CUI and typically requires methods approved by the National Security Agency (NSA) for the specific classification level. In many cases, physical destruction is the only approved method for certain classification levels and media types. The downgrading must be verified and documented, and typically requires approval from the organization's Cognizant Security Authority (CSA) or Classification Management Officer. This control applies to scenarios such as declassification programs, contractor facility closures, or system decommissioning where classified systems are being transferred or disposed of.",
    "ai_guidance": "Implementation of classified media downgrading requires strict adherence to Intelligence Community Directives (ICDs), Committee on National Security Systems (CNSS) policies, and NSA guidance. Key requirements include using only NSA-approved products from the Evaluated Products List (EPL) for sanitization of classified media at SECRET level and above. For TOP SECRET/SCI media, physical destruction is typically the only approved method. Establish relationships with the Cognizant Security Authority for approval of downgrading procedures. Maintain trained and cleared personnel with specific certifications for handling classified media sanitization. Implement strict two-person integrity (TPI) for high-classification media downgrading. All downgrading actions require pre-approval from the classification authority and must be documented with chain of custody records. Verification must include forensic analysis by appropriately cleared personnel using approved methods. Retain downgrading records for the duration specified by the classification guide. Physical destruction should utilize NSA/CSS EPL-listed destruction devices with required particle sizes based on media type and classification level.",
    "stig_id": null,
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "MP-6",
      "MP-8",
      "MP-8.1",
      "MP-8.2"
    ],
    "supplemental_guidance": "Classified information is defined by Executive Order 13526 and atomic energy information by the Atomic Energy Act of 1954. Downgrading of media containing classified information uses approved sanitization or destruction methods to reduce the classification level of the information or remove all classification markings, enabling the release of media containing the information to unauthorized individuals. Cognizant security authorities approve methods for the downgrading of classified information in accordance with applicable federal laws, directives, policies, regulations, and standards.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# MP-8.4: Classified Information Media Downgrading Framework\n# NOTE: This provides documentation framework only\n# Actual classified media handling requires NSA-approved methods and cleared personnel\n\nset -euo pipefail\n\nCLASS_DIR=\"/etc/security/media-downgrade/classified\"\nLOG_DIR=\"/var/log/media-downgrade/classified\"\n\necho \"[MP-8.4] Setting up classified media downgrading framework...\"\necho \"[!] WARNING: Actual implementation requires NSA-approved equipment\"\necho \"[!]          and appropriately cleared/trained personnel\"\n\nmkdir -p \"$CLASS_DIR\"\nmkdir -p \"$LOG_DIR\"\nchmod 700 \"$CLASS_DIR\"\nchmod 700 \"$LOG_DIR\"\n\n# Create classified media downgrading policy\ncat > \"$CLASS_DIR/classified-downgrade-policy.txt\" << 'EOF'\nMP-8.4 CLASSIFIED MEDIA DOWNGRADING POLICY\n==========================================\n** HANDLING INSTRUCTIONS: This document describes procedures **\n** for handling classified media. Apply appropriate safeguards. **\n\n1. PURPOSE\nEstablish procedures for downgrading system media containing\nclassified national security information (CNSI) prior to release\nto individuals without required access authorizations.\n\n2. AUTHORITY\n- Executive Order 13526: Classified National Security Information\n- 32 CFR Part 2001: ISOO Implementing Directive\n- CNSSI 4009: Committee on National Security Systems Glossary\n- NSA/CSS Policy Manual 9-12: Storage Device Sanitization\n\n3. CLASSIFICATION LEVELS COVERED\n- CONFIDENTIAL\n- SECRET\n- TOP SECRET\n- Special Access Program (SAP) Information\n- Sensitive Compartmented Information (SCI)\n\n4. APPROVED DOWNGRADING METHODS BY CLASSIFICATION\n\n4.1 CONFIDENTIAL\n    Magnetic Media: NSA-approved degaussing or destruction\n    Flash Media: Physical destruction\n    Optical Media: Physical destruction\n    Paper: Cross-cut shredding (NSA/CSS 02-01 compliant)\n\n4.2 SECRET\n    Magnetic Media: NSA-approved degaussing or destruction\n    Flash Media: Physical destruction required\n    Optical Media: Physical destruction required\n    Paper: Cross-cut shredding (NSA/CSS 02-01 compliant)\n\n4.3 TOP SECRET and Above\n    ALL MEDIA TYPES: Physical destruction ONLY\n    - Magnetic: Degaussing PLUS physical destruction\n    - Flash/SSD: Physical destruction (disintegration)\n    - Optical: Physical destruction\n    - Paper: Pulping or incineration\n\n5. NSA EVALUATED PRODUCTS LIST (EPL) REQUIREMENT\n- All sanitization equipment must be listed on NSA/CSS EPL\n- Current EPL: https://www.nsa.gov/Resources/Media-Destruction-Guidance/\n- Equipment must be operated by trained personnel\n\n6. TWO-PERSON INTEGRITY (TPI)\n- Required for SECRET and above\n- Both personnel must hold clearances at or above media classification\n- Both must witness entire downgrading process\n- Both must sign documentation\n\n7. APPROVAL REQUIREMENTS\n- Pre-approval from Cognizant Security Authority (CSA)\n- Original Classification Authority (OCA) notification for TS/SCI\n- Facility Security Officer (FSO) coordination\n\n8. VERIFICATION REQUIREMENTS\n- Visual verification of destruction\n- Particle size verification per NSA standards\n- Forensic verification not applicable post-destruction\n\n9. DOCUMENTATION REQUIREMENTS (per MP-8.1)\n- Classification level of media\n- Program/project association\n- Serial/identification numbers\n- Destruction method and equipment used\n- Equipment certification date\n- Names and clearance levels of all personnel involved\n- Date, time, and location of destruction\n- Witness signatures (TPI)\n- CSA approval documentation\n\n10. RETENTION\n- Destruction certificates: Per classification guide, minimum 10 years\n- Store destruction records at appropriate classification level\n\n11. REFERENCES\n- NSA/CSS Media Destruction Guidance\n- ICD 705: Sensitive Compartmented Information Facilities\n- NIST SP 800-88 Rev 1 (CUI portions only)\n- DoD Manual 5200.01: DoD Information Security Program\nEOF\n\n# Create destruction certificate template\ncat > \"$CLASS_DIR/destruction-certificate-template.txt\" << 'EOF'\nCLASSIFIED MEDIA DESTRUCTION CERTIFICATE\n========================================\n** CLASSIFICATION: __________ **\n\nCertificate Number: _______________\nDate of Destruction: _______________\n\nMEDIA INFORMATION\n-----------------\nMedia Type: _______________\nSerial Number(s): _______________\nQuantity: _______________\nClassification Level: _______________\nProgram/Project: _______________\nReason for Destruction: _______________\n\nDESTRUCTION DETAILS\n-------------------\nMethod Used: _______________\nEquipment Used: _______________\nEquipment Serial #: _______________\nEPL Certification Date: _______________\nParticle Size (if applicable): _______________\nLocation: _______________\n\nPERSONNEL (Two-Person Integrity)\n--------------------------------\nDestroying Official:\n  Name: _______________\n  Clearance Level: _______________\n  Organization: _______________\n  Signature: _______________ Date: ___________\n\nWitness:\n  Name: _______________\n  Clearance Level: _______________\n  Organization: _______________\n  Signature: _______________ Date: ___________\n\nAPPROVALS\n---------\nCSA Approval Reference: _______________\nFSO Review:\n  Name: _______________\n  Signature: _______________ Date: ___________\n\nI certify that the media described above has been destroyed\nin accordance with applicable security requirements.\n\nClassification Authority: _______________\nDeclassify On: _______________\nEOF\n\nchmod 600 \"$CLASS_DIR\"/*\n\necho \"[MP-8.4] Classified media downgrading framework configured\"\necho \"[*] Policy: $CLASS_DIR/classified-downgrade-policy.txt\"\necho \"[*] Certificate: $CLASS_DIR/destruction-certificate-template.txt\"\necho \"[!] REMINDER: Contact your FSO/CSA before handling classified media\""
      },
      "windows": {
        "powershell": "# MP-8.4: Classified Information Media Downgrading Framework\n# NOTE: This provides documentation framework only\n# Actual classified media handling requires NSA-approved methods and cleared personnel\n\n#Requires -RunAsAdministrator\n\nWrite-Host \"[MP-8.4] Setting up classified media downgrading framework...\" -ForegroundColor Cyan\nWrite-Host \"[!] WARNING: Actual implementation requires NSA-approved equipment\" -ForegroundColor Red\nWrite-Host \"[!]          and appropriately cleared/trained personnel\" -ForegroundColor Red\n\n$ClassDir = \"C:\\SecurityPolicies\\MediaDowngrade\\Classified\"\n$LogDir = \"C:\\SecurityLogs\\MediaDowngrade\\Classified\"\n\nNew-Item -Path $ClassDir -ItemType Directory -Force | Out-Null\nNew-Item -Path $LogDir -ItemType Directory -Force | Out-Null\n\n# Set restrictive permissions\n$Acl = Get-Acl $ClassDir\n$Acl.SetAccessRuleProtection($true, $false)\n$AdminRule = New-Object System.Security.AccessControl.FileSystemAccessRule(\"Administrators\",\"FullControl\",\"ContainerInherit,ObjectInherit\",\"None\",\"Allow\")\n$Acl.AddAccessRule($AdminRule)\nSet-Acl $ClassDir $Acl\nSet-Acl $LogDir $Acl\n\n# Create classified media downgrading policy\n$ClassPolicy = @\"\nMP-8.4 CLASSIFIED MEDIA DOWNGRADING POLICY\n==========================================\n** HANDLING INSTRUCTIONS: This document describes procedures **\n** for handling classified media. Apply appropriate safeguards. **\n\nEffective Date: $(Get-Date -Format 'yyyy-MM-dd')\nVersion: 1.0\n\n1. PURPOSE\nEstablish procedures for downgrading system media containing\nclassified national security information (CNSI) prior to release\nto individuals without required access authorizations.\n\n2. AUTHORITY\n- Executive Order 13526: Classified National Security Information\n- 32 CFR Part 2001: ISOO Implementing Directive\n- CNSSI 4009: Committee on National Security Systems Glossary  \n- NSA/CSS Policy Manual 9-12: Storage Device Sanitization\n- DoD Manual 5200.01: DoD Information Security Program\n\n3. CLASSIFICATION LEVELS COVERED\n- CONFIDENTIAL (C)\n- SECRET (S)\n- TOP SECRET (TS)\n- Special Access Program (SAP) Information\n- Sensitive Compartmented Information (SCI)\n- Restricted Data (RD) / Formerly Restricted Data (FRD)\n\n4. APPROVED DOWNGRADING METHODS BY CLASSIFICATION\n\n4.1 CONFIDENTIAL\n    Magnetic Media (HDD, Tape):\n      - Degaussing with NSA/CSS EPL Type I degausser, OR\n      - Physical destruction\n    Flash Media (SSD, USB, SD):\n      - Physical destruction REQUIRED\n    Optical Media (CD/DVD/Blu-ray):\n      - Physical destruction REQUIRED\n    Paper Documents:\n      - Cross-cut shredding (NSA/CSS 02-01 compliant, P-6 minimum)\n\n4.2 SECRET\n    Magnetic Media:\n      - NSA/CSS EPL Type II degausser minimum, OR\n      - Physical destruction\n    Flash Media:\n      - Physical destruction REQUIRED\n    Optical Media:\n      - Physical destruction REQUIRED\n    Paper Documents:\n      - Cross-cut shredding (NSA/CSS 02-01 compliant, P-7 minimum)\n\n4.3 TOP SECRET and Above (TS/SCI/SAP)\n    ALL MEDIA TYPES: Physical destruction MANDATORY\n    Magnetic Media:\n      - Degaussing with NSA/CSS EPL Type III degausser\n      - FOLLOWED BY physical destruction (shredding/disintegration)\n    Flash/SSD Media:\n      - Physical destruction via disintegration\n      - Particle size: 2mm maximum dimension\n    Optical Media:\n      - Physical destruction via shredding/disintegration\n    Paper Documents:\n      - Pulping, incineration, or NSA-approved shredding\n\n5. NSA EVALUATED PRODUCTS LIST (EPL) REQUIREMENT\n- ALL sanitization/destruction equipment MUST be listed on NSA/CSS EPL\n- Current EPL: https://www.nsa.gov/Resources/Media-Destruction-Guidance/\n- Degausser type must match or exceed classification level\n- Equipment must be maintained per manufacturer specifications\n- Annual recertification required\n\n6. TWO-PERSON INTEGRITY (TPI) REQUIREMENT\n- MANDATORY for SECRET and above\n- Both personnel must hold clearances at or above media classification\n- Both must have appropriate access authorization (SAP/SCI as applicable)\n- Both must witness the ENTIRE downgrading/destruction process\n- Both must physically sign documentation\n- Single-person handling is a security incident\n\n7. APPROVAL REQUIREMENTS\n\nConfidential:\n- FSO approval required\n- CSA notification\n\nSecret:\n- CSA pre-approval required\n- FSO coordination\n\nTop Secret/SCI/SAP:\n- OCA notification required\n- CSA pre-approval mandatory\n- Program Security Officer coordination (SAP)\n- SSO coordination (SCI)\n\n8. DOCUMENTATION REQUIREMENTS\n- Classification level and caveats\n- Program/project/compartment association\n- Media serial numbers and descriptions\n- Destruction method and equipment specifics\n- Equipment certification/calibration date\n- Names, organizations, clearance levels of ALL personnel\n- TPI witness attestation\n- Date, time, and location of destruction\n- CSA approval documentation reference\n- Destruction certificate number\n\n9. RECORD RETENTION\n- Destruction certificates: Minimum 10 years or per classification guide\n- Store records at appropriate classification level\n- Include in facility close-out packages\n\n10. INCIDENT REPORTING\nReport immediately to FSO and CSA:\n- TPI violations\n- Equipment malfunctions during destruction\n- Incomplete destruction\n- Lost or missing media scheduled for destruction\n\n11. REFERENCES\n- NSA/CSS Media Destruction Guidance\n- ICD 705: SCIFs\n- ICD 503: Intelligence Community Information Technology Systems Security\n- NISPOM (32 CFR Part 117)\n- DoD 5220.22-M: NISPOM\n\"@\n\n$ClassPolicy | Out-File \"$ClassDir\\Classified-Downgrade-Policy.txt\" -Encoding UTF8\n\n# Create destruction certificate template (Word-compatible format)\n$CertTemplate = @\"\nCLASSIFIED MEDIA DESTRUCTION CERTIFICATE\n========================================\n\n** CLASSIFICATION OF THIS DOCUMENT: _____________ **\n\nCERTIFICATE NUMBER: _________________________________\nDATE OF DESTRUCTION: ________________________________\n\n--------------------------------------------------------------------------------\nSECTION 1: MEDIA INFORMATION\n--------------------------------------------------------------------------------\nMedia Type:           [ ] HDD  [ ] SSD  [ ] Tape  [ ] Optical  [ ] Paper  [ ] Other\nMedia Description:    _________________________________\nSerial Number(s):     _________________________________\nQuantity Destroyed:   _________________________________\nClassification Level: [ ] C  [ ] S  [ ] TS  [ ] TS/SCI  [ ] SAP\nCompartments/Caveats: _________________________________\nProgram/Project Name: _________________________________\nOriginal Source:      _________________________________\nReason for Destruction: _________________________________\n\n--------------------------------------------------------------------------------\nSECTION 2: DESTRUCTION DETAILS\n--------------------------------------------------------------------------------\nDestruction Method:   [ ] Degaussing  [ ] Shredding  [ ] Disintegration  \n                      [ ] Incineration  [ ] Other: ___________\nEquipment Used:       _________________________________\nEquipment Serial #:   _________________________________\nNSA/CSS EPL Listed:   [ ] Yes  [ ] No (explain: _________________)\nEPL Cert/Calibration: _________________________________\nParticle Size Achieved: ______________ (if applicable)\nDestruction Location: _________________________________\n\n--------------------------------------------------------------------------------\nSECTION 3: PERSONNEL - TWO-PERSON INTEGRITY ATTESTATION\n--------------------------------------------------------------------------------\nDESTROYING OFFICIAL:\nPrinted Name:         _________________________________\nOrganization:         _________________________________\nClearance Level:      _________________________________\nAccess (SAP/SCI):     _________________________________\nSignature:            _________________________________ Date: ___________\n\nWITNESS:\nPrinted Name:         _________________________________\nOrganization:         _________________________________\nClearance Level:      _________________________________\nAccess (SAP/SCI):     _________________________________\nSignature:            _________________________________ Date: ___________\n\nI/We hereby certify that the media described above was destroyed in accordance\nwith applicable security requirements and that we witnessed the complete\ndestruction process.\n\n--------------------------------------------------------------------------------\nSECTION 4: APPROVALS AND COORDINATION\n--------------------------------------------------------------------------------\nCSA Approval Reference: _________________________________\n\nFacility Security Officer:\nPrinted Name:         _________________________________\nSignature:            _________________________________ Date: ___________\n\nProgram Security Officer (if SAP):\nPrinted Name:         _________________________________\nSignature:            _________________________________ Date: ___________\n\nSpecial Security Officer (if SCI):\nPrinted Name:         _________________________________\nSignature:            _________________________________ Date: ___________\n\n--------------------------------------------------------------------------------\nCLASSIFICATION AUTHORITY: _________________________________\nDECLASSIFY ON:           _________________________________\n--------------------------------------------------------------------------------\n\"@\n\n$CertTemplate | Out-File \"$ClassDir\\Destruction-Certificate-Template.txt\" -Encoding UTF8\n\nWrite-Host \"[MP-8.4] Classified media downgrading framework configured\" -ForegroundColor Green\nWrite-Host \"[*] Policy: $ClassDir\\Classified-Downgrade-Policy.txt\" -ForegroundColor Yellow\nWrite-Host \"[*] Certificate: $ClassDir\\Destruction-Certificate-Template.txt\" -ForegroundColor Yellow\nWrite-Host \"\" -ForegroundColor Yellow\nWrite-Host \"[!] CRITICAL REMINDERS:\" -ForegroundColor Red\nWrite-Host \"    - Contact FSO/CSA BEFORE handling any classified media\" -ForegroundColor Red\nWrite-Host \"    - Use ONLY NSA/CSS EPL-listed equipment\" -ForegroundColor Red\nWrite-Host \"    - Maintain Two-Person Integrity for SECRET and above\" -ForegroundColor Red\nWrite-Host \"    - Physical destruction required for all TS/SCI/SAP media\" -ForegroundColor Red"
      }
    },
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22T00:00:00.000Z",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22T00:00:00.000Z",
      "source": "NIST SP 800-53 Rev 5",
      "implementation_guidance": "Highly regulated organizational control requiring NSA-approved equipment, cleared personnel, CSA approval, and strict documentation. Physical destruction typically required for high classifications."
    }
  }
]