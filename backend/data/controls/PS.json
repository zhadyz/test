[
  {
    "control_id": "PS-1",
    "control_name": "Policy and Procedures",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "a. Develop, document, and disseminate to [Assignment: organization-defined personnel or roles]:\n  1. [Selection (one or more): Organization-level; Mission/business process-level; System-level] personnel security policy that:\n    (a) Addresses purpose, scope, roles, responsibilities, management commitment, coordination among organizational entities, and compliance; and\n    (b) Is consistent with applicable laws, executive orders, directives, regulations, policies, standards, and guidelines; and\n  2. Procedures to facilitate the implementation of the personnel security policy and the associated personnel security controls;\nb. Designate an [Assignment: organization-defined official] to manage the development, documentation, and dissemination of the personnel security policy and procedures; and\nc. Review and update the current personnel security:\n  1. Policy [Assignment: organization-defined frequency] and following [Assignment: organization-defined events]; and\n  2. Procedures [Assignment: organization-defined frequency] and following [Assignment: organization-defined events].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Establish a governance framework for personnel security by requiring documented policies and procedures that define how personnel security is managed throughout the organization, ensuring consistent and compliant handling of personnel security matters.",
    "rationale": "Personnel security policies and procedures form the foundation for protecting organizational information systems from insider threats. Without documented governance, organizations cannot consistently screen personnel, manage access authorizations, enforce personnel actions upon termination or transfer, or maintain accountability for personnel security decisions. This control ensures that personnel security practices are formalized, communicated, and regularly updated to address evolving threats and regulatory requirements.",
    "plain_english_explanation": "Organizations must create, document, and share personnel security policies and procedures with designated staff. This control requires establishing rules about how people are screened before gaining system access, how positions are categorized by risk level, what happens when employees leave or transfer, and how personnel security violations are handled. A designated official must be responsible for managing these policies, and the organization must review and update them on a regular schedule or when significant changes occur such as new regulations, security incidents, or organizational restructuring.",
    "ai_guidance": "PS-1 establishes the foundational governance framework for all personnel security activities across the organization. Implementation should begin by identifying all stakeholders including HR, security, IT, legal, and management who need to be involved in policy development. The policy must clearly define roles and responsibilities for personnel security functions including who authorizes access, who conducts screening, who manages termination processes, and who oversees contractor security. Key elements to include: position risk designation criteria, screening requirements by position sensitivity level, rescreening triggers and frequency, access agreement requirements, personnel termination and transfer procedures, sanctions for policy violations, and external personnel management. The policy should reference applicable laws such as FISMA, Privacy Act, E-Government Act, and agency-specific regulations. Procedures should be detailed enough to guide consistent implementation across all organizational units while remaining flexible enough to accommodate different system types and risk levels. Establish clear review cycles with minimum annual reviews plus triggered reviews following security incidents, audit findings, regulatory changes, or significant organizational changes. The designated official should have sufficient authority to enforce compliance and should coordinate with HR, legal, and IT security. Document version control, distribution records, and acknowledgment tracking are essential for demonstrating compliance during audits. Integration with related policies for access control, awareness training, and incident response ensures comprehensive personnel security coverage.",
    "implementation_guidance": "This is an organizational policy control requiring governance and documentation rather than technical implementation. Organizations should: (1) Form a cross-functional team including HR, Security, IT, Legal, and Management to develop comprehensive personnel security policy; (2) Use a standard policy template with sections for purpose, scope, roles, responsibilities, policy statements, compliance requirements, review procedures, and references; (3) Designate an official with appropriate authority to own and manage the policy lifecycle; (4) Develop supporting procedures for each personnel security control including screening, access agreements, termination, and sanctions; (5) Establish distribution mechanisms to ensure all relevant personnel receive and acknowledge the policy; (6) Create a review calendar with annual reviews and trigger events documented; (7) Maintain version control and audit trail of all policy changes; (8) Integrate with HR onboarding and offboarding processes; (9) Coordinate with related organizational policies and procedures.",
    "is_technical": false,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-1 Policy and Procedures Audit Script\n# Verifies existence of personnel security policy documentation\n\nPOLICY_DIR=\"/etc/security/policies\"\nPS_POLICY=\"personnel_security_policy.pdf\"\nPS_PROCEDURES=\"personnel_security_procedures.pdf\"\nAUDIT_LOG=\"/var/log/security/ps1_audit.log\"\n\necho \"[$(date)] PS-1 Policy Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Check if policy directory exists\nif [ ! -d \"$POLICY_DIR\" ]; then\n    echo \"[FAIL] Policy directory $POLICY_DIR does not exist\" >> \"$AUDIT_LOG\"\n    echo \"FAIL: Policy directory not found\"\n    exit 1\nfi\n\n# Check for personnel security policy document\nif [ -f \"$POLICY_DIR/$PS_POLICY\" ]; then\n    POLICY_DATE=$(stat -c %y \"$POLICY_DIR/$PS_POLICY\" | cut -d' ' -f1)\n    echo \"[PASS] Personnel Security Policy found, last modified: $POLICY_DATE\" >> \"$AUDIT_LOG\"\nelse\n    echo \"[FAIL] Personnel Security Policy document not found\" >> \"$AUDIT_LOG\"\nfi\n\n# Check for procedures document\nif [ -f \"$POLICY_DIR/$PS_PROCEDURES\" ]; then\n    PROC_DATE=$(stat -c %y \"$POLICY_DIR/$PS_PROCEDURES\" | cut -d' ' -f1)\n    echo \"[PASS] Personnel Security Procedures found, last modified: $PROC_DATE\" >> \"$AUDIT_LOG\"\nelse\n    echo \"[FAIL] Personnel Security Procedures document not found\" >> \"$AUDIT_LOG\"\nfi\n\necho \"[$(date)] PS-1 Policy Audit Complete\" >> \"$AUDIT_LOG\"\necho \"Audit results logged to $AUDIT_LOG\"",
        "ansible": "---\n# PS-1 Policy and Procedures Verification Playbook\n# Verifies personnel security policy documentation exists\n\n- name: PS-1 Personnel Security Policy Verification\n  hosts: all\n  become: yes\n  vars:\n    policy_directory: /etc/security/policies\n    policy_documents:\n      - personnel_security_policy.pdf\n      - personnel_security_procedures.pdf\n      - position_risk_designation_policy.pdf\n    audit_log: /var/log/security/ps1_audit.log\n    max_policy_age_days: 365\n\n  tasks:\n    - name: Ensure policy directory exists\n      file:\n        path: \"{{ policy_directory }}\"\n        state: directory\n        mode: '0755'\n      register: policy_dir_result\n\n    - name: Check for required policy documents\n      stat:\n        path: \"{{ policy_directory }}/{{ item }}\"\n      register: policy_files\n      loop: \"{{ policy_documents }}\"\n\n    - name: Log policy document status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] {{ item.item }}: {{ 'FOUND' if item.stat.exists else 'MISSING' }}\"\n        create: yes\n      loop: \"{{ policy_files.results }}\"\n\n    - name: Check policy document age\n      shell: |\n        POLICY_AGE=$(( ($(date +%s) - $(stat -c %Y {{ policy_directory }}/{{ item.item }})) / 86400 ))\n        if [ $POLICY_AGE -gt {{ max_policy_age_days }} ]; then\n          echo \"WARNING: {{ item.item }} is $POLICY_AGE days old (exceeds {{ max_policy_age_days }} day threshold)\"\n        else\n          echo \"OK: {{ item.item }} is $POLICY_AGE days old\"\n        fi\n      register: age_check\n      when: item.stat.exists\n      loop: \"{{ policy_files.results }}\"\n      changed_when: false\n\n    - name: Generate compliance report\n      copy:\n        content: |\n          PS-1 Personnel Security Policy Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Policy Documents Status:\n          {% for item in policy_files.results %}\n          - {{ item.item }}: {{ 'PRESENT' if item.stat.exists else 'MISSING' }}\n          {% endfor %}\n          \n          Recommendation: Ensure all policy documents are reviewed annually\n          and updated following significant organizational changes.\n        dest: \"{{ policy_directory }}/ps1_compliance_report.txt\"\n        mode: '0644'"
      },
      "windows": {
        "powershell": "# PS-1 Policy and Procedures Audit Script\n# Verifies existence of personnel security policy documentation\n\n$PolicyPath = \"C:\\SecurityPolicies\"\n$RequiredDocs = @(\n    \"Personnel_Security_Policy.pdf\",\n    \"Personnel_Security_Procedures.pdf\",\n    \"Position_Risk_Designation_Policy.pdf\"\n)\n$AuditLog = \"C:\\SecurityLogs\\PS1_Audit.log\"\n$MaxPolicyAgeDays = 365\n\n# Ensure log directory exists\n$LogDir = Split-Path -Parent $AuditLog\nif (-not (Test-Path $LogDir)) {\n    New-Item -ItemType Directory -Path $LogDir -Force | Out-Null\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    $LogEntry = \"[$Timestamp] [$Status] $Message\"\n    Add-Content -Path $AuditLog -Value $LogEntry\n    if ($Status -eq \"FAIL\") {\n        Write-Host $LogEntry -ForegroundColor Red\n    } elseif ($Status -eq \"WARN\") {\n        Write-Host $LogEntry -ForegroundColor Yellow\n    } else {\n        Write-Host $LogEntry -ForegroundColor Green\n    }\n}\n\nWrite-AuditLog \"PS-1 Personnel Security Policy Audit Starting\" \"INFO\"\n\n# Check if policy directory exists\nif (-not (Test-Path $PolicyPath)) {\n    Write-AuditLog \"Policy directory $PolicyPath does not exist\" \"FAIL\"\n    New-Item -ItemType Directory -Path $PolicyPath -Force | Out-Null\n    Write-AuditLog \"Created policy directory $PolicyPath\" \"INFO\"\n}\n\n# Check for each required document\n$MissingDocs = @()\n$OutdatedDocs = @()\n\nforeach ($Doc in $RequiredDocs) {\n    $DocPath = Join-Path $PolicyPath $Doc\n    if (Test-Path $DocPath) {\n        $FileInfo = Get-Item $DocPath\n        $AgeDays = (New-TimeSpan -Start $FileInfo.LastWriteTime -End (Get-Date)).Days\n        \n        if ($AgeDays -gt $MaxPolicyAgeDays) {\n            Write-AuditLog \"$Doc found but is $AgeDays days old (exceeds $MaxPolicyAgeDays day threshold)\" \"WARN\"\n            $OutdatedDocs += $Doc\n        } else {\n            Write-AuditLog \"$Doc found, last modified: $($FileInfo.LastWriteTime.ToString('yyyy-MM-dd'))\" \"PASS\"\n        }\n    } else {\n        Write-AuditLog \"$Doc not found\" \"FAIL\"\n        $MissingDocs += $Doc\n    }\n}\n\n# Generate summary\nWrite-AuditLog \"Audit Complete - Missing: $($MissingDocs.Count), Outdated: $($OutdatedDocs.Count)\" \"INFO\"\n\n# Return compliance status\nif ($MissingDocs.Count -eq 0 -and $OutdatedDocs.Count -eq 0) {\n    Write-Output \"PS-1 COMPLIANT\"\n    exit 0\n} else {\n    Write-Output \"PS-1 NON-COMPLIANT\"\n    exit 1\n}",
        "ansible": "---\n# PS-1 Policy and Procedures Verification Playbook for Windows\n# Verifies personnel security policy documentation exists\n\n- name: PS-1 Personnel Security Policy Verification (Windows)\n  hosts: windows\n  vars:\n    policy_directory: C:\\SecurityPolicies\n    policy_documents:\n      - Personnel_Security_Policy.pdf\n      - Personnel_Security_Procedures.pdf\n      - Position_Risk_Designation_Policy.pdf\n    audit_log: C:\\SecurityLogs\\PS1_Audit.log\n    max_policy_age_days: 365\n\n  tasks:\n    - name: Ensure policy directory exists\n      win_file:\n        path: \"{{ policy_directory }}\"\n        state: directory\n\n    - name: Ensure log directory exists\n      win_file:\n        path: C:\\SecurityLogs\n        state: directory\n\n    - name: Check for required policy documents\n      win_stat:\n        path: \"{{ policy_directory }}\\\\{{ item }}\"\n      register: policy_files\n      loop: \"{{ policy_documents }}\"\n\n    - name: Log policy document status\n      win_lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] {{ item.item }}: {{ 'FOUND' if item.stat.exists else 'MISSING' }}\"\n        create: yes\n      loop: \"{{ policy_files.results }}\"\n\n    - name: Generate compliance report\n      win_copy:\n        content: |\n          PS-1 Personnel Security Policy Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Policy Documents Status:\n          {% for item in policy_files.results %}\n          - {{ item.item }}: {{ 'PRESENT' if item.stat.exists else 'MISSING' }}\n          {% endfor %}\n          \n          Recommendation: Ensure all policy documents are reviewed annually.\n        dest: \"{{ policy_directory }}\\\\PS1_Compliance_Report.txt\""
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-1",
      "AT-1",
      "AU-1",
      "CA-1",
      "CM-1",
      "CP-1",
      "IA-1",
      "IR-1",
      "MA-1",
      "MP-1",
      "PE-1",
      "PL-1",
      "PM-1",
      "RA-1",
      "SA-1",
      "SC-1",
      "SI-1",
      "SR-1",
      "PS-2",
      "PS-3",
      "PS-4",
      "PS-5",
      "PS-6",
      "PS-7",
      "PS-8",
      "PS-9"
    ],
    "supplemental_guidance": "Personnel security policy and procedures address the controls in the PS family that are implemented within systems and organizations. The risk management strategy is an important factor in establishing such policies and procedures. Policies and procedures contribute to security and privacy assurance. Therefore, it is important that security and privacy programs collaborate on the development of personnel security policy and procedures. Security and privacy program policies and procedures at the organization level are preferable, in general, and may obviate the need for mission- or system-specific policies and procedures. The policy can be included as part of the general security and privacy policy or be represented by multiple policies reflecting the complex nature of organizations. Procedures can be established for security and privacy programs, for mission or business processes, and for systems, if needed. Procedures describe how the policies or controls are implemented and can be directed at the individual or role that is the object of the procedure. Procedures can be documented in system security and privacy plans or in one or more separate documents. Events that may precipitate an update to personnel security policy and procedures include assessment or audit findings, security incidents or breaches, or changes in applicable laws, executive orders, directives, regulations, policies, standards, and guidelines.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-1 is an organizational policy control requiring documented policies and procedures for personnel security programs. This control cannot be fully automated through technical means as it addresses governance, documentation, and organizational processes. The provided scripts audit for the existence and currency of policy documentation but cannot verify policy content or implementation effectiveness."
    }
  },
  {
    "control_id": "PS-2",
    "control_name": "Position Risk Designation",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "a. Assign a risk designation to all organizational positions;\nb. Establish screening criteria for individuals filling those positions; and\nc. Review and update position risk designations [Assignment: organization-defined frequency].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Ensure that organizational positions are categorized by risk level based on the potential for harm to organizational operations, assets, or individuals, and that appropriate screening criteria are applied based on these risk designations.",
    "rationale": "Position risk designation is essential for implementing a risk-based approach to personnel security. Different positions have varying levels of access to sensitive information, critical systems, and decision-making authority. By categorizing positions according to their potential impact on organizational security, organizations can apply proportionate screening measures, ensuring that individuals in high-risk positions receive more thorough vetting while avoiding unnecessary burden on low-risk positions. This approach optimizes security resources and supports the principle of least privilege.",
    "plain_english_explanation": "Organizations must categorize every job position based on the security risk it poses. Positions with access to classified information, critical infrastructure, or sensitive systems should be designated as high-risk and require more extensive background checks. Positions with limited access may be designated as low-risk with less intensive screening requirements. The organization must document what screening is required for each risk level and regularly review position designations to ensure they remain accurate as job responsibilities change.",
    "ai_guidance": "PS-2 requires organizations to implement a systematic approach to categorizing positions by security risk. Implementation begins with developing risk designation criteria that consider factors such as: level of access to sensitive information (classified, PII, financial data), access to critical systems and infrastructure, decision-making authority for security controls, potential for insider threat impact, and public trust responsibilities. Most federal organizations use a three-tier system: High Risk (positions with access to Top Secret information or critical infrastructure), Moderate Risk (positions with access to Secret information or significant system privileges), and Low Risk (positions with limited access). For each risk level, establish corresponding screening requirements including investigation type (Tier 1, 2, 3, or 5 investigations for federal positions), reinvestigation frequency, and any specialized screening requirements. Create a position risk designation matrix mapping job titles or position categories to risk levels and required screening. Ensure HR systems can track position risk designations and link them to screening requirements. Establish a review process to update designations when job responsibilities change, new positions are created, or organizational structure changes. Document the rationale for each designation to support audit requirements. Coordinate with Office of Personnel Management guidelines for federal positions and industry standards for contractor positions. Integration with access control systems ensures that access authorizations align with position risk designations.",
    "implementation_guidance": "Organizations should: (1) Develop a Position Risk Designation Policy that defines risk levels (typically High, Moderate, Low), criteria for each level, and corresponding screening requirements; (2) Inventory all organizational positions including employees, contractors, and temporary personnel; (3) Apply risk designation criteria to categorize each position, documenting the rationale; (4) Create a Position Risk Designation Matrix that maps positions to risk levels and required screenings; (5) Integrate with HR systems to track position designations and trigger appropriate screening for new hires and position changes; (6) Establish review procedures to reassess designations annually or when significant changes occur; (7) Coordinate with access management to ensure system access aligns with position designations; (8) Document all designations and changes for audit purposes; (9) Train HR and hiring managers on the designation process and requirements.",
    "is_technical": false,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-2 Position Risk Designation Audit Script\n# Verifies position risk designation documentation and HR system integration\n\nPOSITION_MATRIX=\"/etc/security/hr/position_risk_matrix.csv\"\nSCREENING_LOG=\"/var/log/security/screening_status.log\"\nAUDIT_LOG=\"/var/log/security/ps2_audit.log\"\n\necho \"[$(date)] PS-2 Position Risk Designation Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Check for position risk designation matrix\nif [ -f \"$POSITION_MATRIX\" ]; then\n    echo \"[PASS] Position Risk Designation Matrix found\" >> \"$AUDIT_LOG\"\n    \n    # Count positions by risk level\n    HIGH_RISK=$(grep -c \",HIGH,\" \"$POSITION_MATRIX\" 2>/dev/null || echo \"0\")\n    MOD_RISK=$(grep -c \",MODERATE,\" \"$POSITION_MATRIX\" 2>/dev/null || echo \"0\")\n    LOW_RISK=$(grep -c \",LOW,\" \"$POSITION_MATRIX\" 2>/dev/null || echo \"0\")\n    \n    echo \"[INFO] Position breakdown - High: $HIGH_RISK, Moderate: $MOD_RISK, Low: $LOW_RISK\" >> \"$AUDIT_LOG\"\n    \n    # Check for last review date in file\n    LAST_REVIEW=$(head -1 \"$POSITION_MATRIX\" | grep -oP 'Last-Review: \\K[0-9-]+')\n    if [ -n \"$LAST_REVIEW\" ]; then\n        REVIEW_AGE=$(( ($(date +%s) - $(date -d \"$LAST_REVIEW\" +%s)) / 86400 ))\n        if [ $REVIEW_AGE -gt 365 ]; then\n            echo \"[WARN] Position matrix last reviewed $REVIEW_AGE days ago (exceeds annual requirement)\" >> \"$AUDIT_LOG\"\n        else\n            echo \"[PASS] Position matrix reviewed within last year ($REVIEW_AGE days ago)\" >> \"$AUDIT_LOG\"\n        fi\n    fi\nelse\n    echo \"[FAIL] Position Risk Designation Matrix not found\" >> \"$AUDIT_LOG\"\nfi\n\n# Check system user accounts against position matrix\nif [ -f \"$POSITION_MATRIX\" ]; then\n    echo \"[INFO] Checking system accounts against position designations...\" >> \"$AUDIT_LOG\"\n    \n    for USER in $(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}'); do\n        if ! grep -q \"^$USER,\" \"$POSITION_MATRIX\" 2>/dev/null; then\n            echo \"[WARN] User $USER not found in position matrix\" >> \"$AUDIT_LOG\"\n        fi\n    done\nfi\n\necho \"[$(date)] PS-2 Audit Complete\" >> \"$AUDIT_LOG\"\necho \"Audit results logged to $AUDIT_LOG\"",
        "ansible": "---\n# PS-2 Position Risk Designation Verification Playbook\n\n- name: PS-2 Position Risk Designation Verification\n  hosts: all\n  become: yes\n  vars:\n    position_matrix_path: /etc/security/hr/position_risk_matrix.csv\n    audit_log: /var/log/security/ps2_audit.log\n    max_review_age_days: 365\n\n  tasks:\n    - name: Ensure HR security directory exists\n      file:\n        path: /etc/security/hr\n        state: directory\n        mode: '0750'\n\n    - name: Check for position risk designation matrix\n      stat:\n        path: \"{{ position_matrix_path }}\"\n      register: matrix_check\n\n    - name: Log matrix status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Position Risk Matrix: {{ 'FOUND' if matrix_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Get system users for verification\n      shell: getent passwd | awk -F':' '$3 >= 1000 && $3 < 65534 {print $1}'\n      register: system_users\n      changed_when: false\n      when: matrix_check.stat.exists\n\n    - name: Verify users have position designations\n      shell: |\n        grep -q \"^{{ item }},\" {{ position_matrix_path }} && echo \"MAPPED\" || echo \"UNMAPPED\"\n      register: user_mapping\n      loop: \"{{ system_users.stdout_lines | default([]) }}\"\n      changed_when: false\n      when: matrix_check.stat.exists\n\n    - name: Log unmapped users\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] WARNING: User {{ item.item }} not in position matrix\"\n      when:\n        - matrix_check.stat.exists\n        - item.stdout == 'UNMAPPED'\n      loop: \"{{ user_mapping.results | default([]) }}\"\n\n    - name: Generate PS-2 compliance report\n      copy:\n        content: |\n          PS-2 Position Risk Designation Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Position Matrix Status: {{ 'PRESENT' if matrix_check.stat.exists else 'MISSING' }}\n          \n          Recommendations:\n          1. Ensure all positions have documented risk designations\n          2. Review designations annually\n          3. Update designations when job responsibilities change\n          4. Verify screening requirements align with risk levels\n        dest: /etc/security/hr/ps2_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-2 Position Risk Designation Audit Script\n# Verifies position risk designation documentation and AD integration\n\n$MatrixPath = \"C:\\SecurityPolicies\\HR\\PositionRiskMatrix.csv\"\n$AuditLog = \"C:\\SecurityLogs\\PS2_Audit.log\"\n$MaxReviewAgeDays = 365\n\n# Ensure directories exist\n$Paths = @(\"C:\\SecurityPolicies\\HR\", \"C:\\SecurityLogs\")\nforeach ($Path in $Paths) {\n    if (-not (Test-Path $Path)) {\n        New-Item -ItemType Directory -Path $Path -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    $LogEntry = \"[$Timestamp] [$Status] $Message\"\n    Add-Content -Path $AuditLog -Value $LogEntry\n}\n\nWrite-AuditLog \"PS-2 Position Risk Designation Audit Starting\" \"INFO\"\n\n# Check for position risk matrix\nif (Test-Path $MatrixPath) {\n    Write-AuditLog \"Position Risk Designation Matrix found\" \"PASS\"\n    \n    $Matrix = Import-Csv $MatrixPath -ErrorAction SilentlyContinue\n    if ($Matrix) {\n        $HighRisk = ($Matrix | Where-Object { $_.RiskLevel -eq 'HIGH' }).Count\n        $ModRisk = ($Matrix | Where-Object { $_.RiskLevel -eq 'MODERATE' }).Count\n        $LowRisk = ($Matrix | Where-Object { $_.RiskLevel -eq 'LOW' }).Count\n        \n        Write-AuditLog \"Position breakdown - High: $HighRisk, Moderate: $ModRisk, Low: $LowRisk\" \"INFO\"\n        \n        # Check file age for review compliance\n        $FileInfo = Get-Item $MatrixPath\n        $AgeDays = (New-TimeSpan -Start $FileInfo.LastWriteTime -End (Get-Date)).Days\n        \n        if ($AgeDays -gt $MaxReviewAgeDays) {\n            Write-AuditLog \"Matrix last modified $AgeDays days ago (exceeds $MaxReviewAgeDays day threshold)\" \"WARN\"\n        } else {\n            Write-AuditLog \"Matrix reviewed within compliance period ($AgeDays days ago)\" \"PASS\"\n        }\n    }\n} else {\n    Write-AuditLog \"Position Risk Designation Matrix not found\" \"FAIL\"\n}\n\n# If Active Directory module available, check AD users against matrix\nif (Get-Module -ListAvailable -Name ActiveDirectory) {\n    Import-Module ActiveDirectory -ErrorAction SilentlyContinue\n    \n    if (Test-Path $MatrixPath) {\n        $Matrix = Import-Csv $MatrixPath\n        $MappedUsers = $Matrix.Username\n        \n        $ADUsers = Get-ADUser -Filter {Enabled -eq $true} -Properties Title | Select-Object SamAccountName, Title\n        \n        foreach ($User in $ADUsers) {\n            if ($User.SamAccountName -notin $MappedUsers) {\n                Write-AuditLog \"AD User $($User.SamAccountName) not found in position matrix\" \"WARN\"\n            }\n        }\n    }\n}\n\nWrite-AuditLog \"PS-2 Audit Complete\" \"INFO\"\nWrite-Output \"Audit logged to $AuditLog\"",
        "ansible": "---\n# PS-2 Position Risk Designation Verification Playbook for Windows\n\n- name: PS-2 Position Risk Designation Verification (Windows)\n  hosts: windows\n  vars:\n    matrix_path: C:\\SecurityPolicies\\HR\\PositionRiskMatrix.csv\n    audit_log: C:\\SecurityLogs\\PS2_Audit.log\n\n  tasks:\n    - name: Ensure policy directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\HR\n        - C:\\SecurityLogs\n\n    - name: Check for position risk matrix\n      win_stat:\n        path: \"{{ matrix_path }}\"\n      register: matrix_check\n\n    - name: Log matrix status\n      win_lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Position Risk Matrix: {{ 'FOUND' if matrix_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Generate PS-2 compliance report\n      win_copy:\n        content: |\n          PS-2 Position Risk Designation Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Position Matrix Status: {{ 'PRESENT' if matrix_check.stat.exists else 'MISSING' }}\n          \n          Requirements:\n          1. All positions must have assigned risk designations\n          2. Screening criteria must align with risk levels\n          3. Review designations at organization-defined frequency\n        dest: C:\\SecurityPolicies\\HR\\PS2_Compliance_Report.txt"
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-5",
      "AC-6",
      "AT-3",
      "PE-2",
      "PE-3",
      "PL-2",
      "PS-3",
      "PS-6",
      "SA-5",
      "SA-21",
      "SI-12"
    ],
    "supplemental_guidance": "Position risk designation reflects Office of Personnel Management (OPM) policy and target audience guidance for suitability determination for positions held by contractors or other external parties. The criteria for determining position risk designations are based on the work performed by those individuals and the impact that work could have on organizational operations, assets, or individuals should the individuals not perform their duties or abuse their positions of trust. Position risk designations include a) criticality—the degree of harm to national security that could result if the information is disclosed to an unauthorized person; b) sensitivity—the degree of harm that could result from inadvertent disclosure of information; and c) special or additional sensitivity—information requiring special protection not identified by criticality or sensitivity.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-2 is an organizational control requiring position categorization and screening criteria establishment. The provided scripts audit for documentation existence and verify user accounts are mapped to position designations but cannot verify the appropriateness of individual risk designations."
    }
  },
  {
    "control_id": "PS-3",
    "control_name": "Personnel Screening",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "a. Screen individuals prior to authorizing access to the system; and\nb. Rescreen individuals in accordance with [Assignment: organization-defined conditions requiring rescreening and, where rescreening is so indicated, the frequency of rescreening].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "Ensure that individuals are appropriately vetted before being granted access to organizational systems, and that periodic rescreening occurs to identify changes that might affect an individual's suitability or trustworthiness.",
    "rationale": "Personnel screening is a critical defense against insider threats. Background investigations help identify individuals who may pose security risks due to criminal history, financial problems, foreign connections, or other factors that could make them susceptible to coercion or indicate unreliability. Initial screening ensures baseline trustworthiness, while rescreening addresses the reality that circumstances change over time. This control directly supports the principle of granting access only to trustworthy individuals and helps organizations make informed risk decisions about personnel.",
    "plain_english_explanation": "Before anyone gets access to your computer systems, you must run a background check on them appropriate to the sensitivity of the information they will access. This typically includes criminal history checks, verification of employment history and education, credit checks for positions involving financial responsibility, and reference checks. After initial screening, you must also periodically rescreen individuals based on defined conditions such as time elapsed since last investigation, security incidents, or significant life changes. The depth of screening should match the risk level of the position.",
    "ai_guidance": "PS-3 establishes requirements for vetting personnel before granting system access and maintaining that vetting over time. Implementation should begin by defining screening requirements that align with position risk designations from PS-2. For federal positions, follow OPM guidance on investigation types: Tier 1 (low risk), Tier 2 (moderate risk public trust), Tier 3 (non-critical sensitive), Tier 4 (high risk public trust), and Tier 5 (critical sensitive/classified). For non-federal positions, establish equivalent screening levels using commercial background investigation services. Key elements to define: (1) Types of checks required at each risk level including criminal history (national and local), employment verification, education verification, credit history, reference checks, and drug screening; (2) Investigation scope (number of years of history to review); (3) Adjudication criteria for evaluating findings; (4) Reciprocity policies for accepting investigations from other organizations; (5) Rescreening triggers including periodic reinvestigation schedules (typically 5 years for Top Secret, 10 years for Secret, 15 years for public trust), continuous evaluation enrollment where available, self-reporting requirements, and event-driven rescreening for security incidents or significant life changes. Establish processes for provisional access pending investigation completion, with appropriate risk mitigation measures. Document screening status in HR systems and integrate with access management. Ensure screening records are protected as sensitive PII. For contractors, include screening requirements in contracts and verify compliance.",
    "implementation_guidance": "Organizations should: (1) Define screening levels that correspond to position risk designations; (2) Establish relationships with investigation service providers (OPM/DCSA for federal, commercial providers for others); (3) Create screening request workflows that trigger appropriate investigations for new hires and position changes; (4) Develop adjudication guidelines for evaluating investigation findings; (5) Implement tracking systems to monitor investigation status and reinvestigation due dates; (6) Define interim access procedures with appropriate risk mitigation for pending investigations; (7) Establish rescreening triggers and frequencies based on position sensitivity and organizational risk tolerance; (8) Enroll eligible personnel in continuous evaluation programs where available; (9) Create self-reporting requirements for security-relevant events; (10) Document and protect screening records in compliance with Privacy Act requirements.",
    "is_technical": false,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-3 Personnel Screening Compliance Audit Script\n# Verifies screening documentation and reinvestigation tracking\n\nSCREENING_DB=\"/etc/security/hr/screening_records.csv\"\nAUDIT_LOG=\"/var/log/security/ps3_audit.log\"\nREINVESTIGATION_THRESHOLD_DAYS=1825  # 5 years default\n\necho \"[$(date)] PS-3 Personnel Screening Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Check for screening records database\nif [ -f \"$SCREENING_DB\" ]; then\n    echo \"[PASS] Screening records database found\" >> \"$AUDIT_LOG\"\n    \n    # Count screening statuses\n    CLEARED=$(grep -c \",CLEARED,\" \"$SCREENING_DB\" 2>/dev/null || echo \"0\")\n    PENDING=$(grep -c \",PENDING,\" \"$SCREENING_DB\" 2>/dev/null || echo \"0\")\n    DENIED=$(grep -c \",DENIED,\" \"$SCREENING_DB\" 2>/dev/null || echo \"0\")\n    \n    echo \"[INFO] Screening status - Cleared: $CLEARED, Pending: $PENDING, Denied: $DENIED\" >> \"$AUDIT_LOG\"\n    \n    # Check for reinvestigation due\n    TODAY=$(date +%s)\n    echo \"[INFO] Checking reinvestigation due dates...\" >> \"$AUDIT_LOG\"\n    \n    while IFS=',' read -r USERNAME STATUS LAST_INVESTIGATION RISK_LEVEL; do\n        if [ \"$STATUS\" = \"CLEARED\" ] && [ -n \"$LAST_INVESTIGATION\" ]; then\n            INVEST_DATE=$(date -d \"$LAST_INVESTIGATION\" +%s 2>/dev/null)\n            if [ -n \"$INVEST_DATE\" ]; then\n                DAYS_SINCE=$(( ($TODAY - $INVEST_DATE) / 86400 ))\n                \n                # Adjust threshold based on risk level\n                case $RISK_LEVEL in\n                    HIGH) THRESHOLD=1825 ;;  # 5 years\n                    MODERATE) THRESHOLD=3650 ;;  # 10 years\n                    LOW) THRESHOLD=5475 ;;  # 15 years\n                    *) THRESHOLD=$REINVESTIGATION_THRESHOLD_DAYS ;;\n                esac\n                \n                if [ $DAYS_SINCE -gt $THRESHOLD ]; then\n                    echo \"[WARN] $USERNAME reinvestigation overdue ($DAYS_SINCE days since last investigation)\" >> \"$AUDIT_LOG\"\n                fi\n            fi\n        fi\n    done < <(tail -n +2 \"$SCREENING_DB\")  # Skip header row\n    \nelse\n    echo \"[FAIL] Screening records database not found\" >> \"$AUDIT_LOG\"\nfi\n\n# Cross-reference with system users\nif [ -f \"$SCREENING_DB\" ]; then\n    echo \"[INFO] Verifying system users have screening records...\" >> \"$AUDIT_LOG\"\n    \n    for USER in $(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}'); do\n        if ! grep -q \"^$USER,\" \"$SCREENING_DB\" 2>/dev/null; then\n            echo \"[FAIL] User $USER has no screening record\" >> \"$AUDIT_LOG\"\n        elif grep -q \"^$USER,PENDING,\" \"$SCREENING_DB\" 2>/dev/null; then\n            echo \"[WARN] User $USER has PENDING screening status\" >> \"$AUDIT_LOG\"\n        fi\n    done\nfi\n\necho \"[$(date)] PS-3 Audit Complete\" >> \"$AUDIT_LOG\"\necho \"Audit results logged to $AUDIT_LOG\"",
        "ansible": "---\n# PS-3 Personnel Screening Verification Playbook\n\n- name: PS-3 Personnel Screening Compliance Verification\n  hosts: all\n  become: yes\n  vars:\n    screening_db: /etc/security/hr/screening_records.csv\n    audit_log: /var/log/security/ps3_audit.log\n    reinvestigation_thresholds:\n      HIGH: 1825    # 5 years\n      MODERATE: 3650  # 10 years\n      LOW: 5475     # 15 years\n\n  tasks:\n    - name: Check for screening records database\n      stat:\n        path: \"{{ screening_db }}\"\n      register: screening_check\n\n    - name: Log screening database status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Screening Records DB: {{ 'FOUND' if screening_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Get system users\n      shell: getent passwd | awk -F':' '$3 >= 1000 && $3 < 65534 {print $1}'\n      register: system_users\n      changed_when: false\n\n    - name: Check user screening status\n      shell: |\n        if grep -q \"^{{ item }},\" {{ screening_db }}; then\n          STATUS=$(grep \"^{{ item }},\" {{ screening_db }} | cut -d',' -f2)\n          echo \"$STATUS\"\n        else\n          echo \"NO_RECORD\"\n        fi\n      register: user_screening\n      loop: \"{{ system_users.stdout_lines }}\"\n      when: screening_check.stat.exists\n      changed_when: false\n\n    - name: Log users without screening records\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] FAIL: User {{ item.item }} has no screening record\"\n      when:\n        - screening_check.stat.exists\n        - item.stdout == 'NO_RECORD'\n      loop: \"{{ user_screening.results | default([]) }}\"\n\n    - name: Generate PS-3 compliance report\n      copy:\n        content: |\n          PS-3 Personnel Screening Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Screening Database: {{ 'PRESENT' if screening_check.stat.exists else 'MISSING' }}\n          Total System Users: {{ system_users.stdout_lines | length }}\n          \n          Requirements:\n          1. Screen individuals prior to authorizing access\n          2. Rescreen per organization-defined frequency\n          3. Track investigation completion and reinvestigation dates\n          4. Document adjudication decisions\n        dest: /etc/security/hr/ps3_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-3 Personnel Screening Compliance Audit Script\n# Verifies screening documentation and reinvestigation tracking\n\n$ScreeningDB = \"C:\\SecurityPolicies\\HR\\ScreeningRecords.csv\"\n$AuditLog = \"C:\\SecurityLogs\\PS3_Audit.log\"\n$ReinvestigationThresholds = @{\n    'HIGH' = 1825      # 5 years\n    'MODERATE' = 3650  # 10 years\n    'LOW' = 5475       # 15 years\n}\n\n# Ensure directories exist\n@(\"C:\\SecurityPolicies\\HR\", \"C:\\SecurityLogs\") | ForEach-Object {\n    if (-not (Test-Path $_)) {\n        New-Item -ItemType Directory -Path $_ -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $AuditLog -Value \"[$Timestamp] [$Status] $Message\"\n}\n\nWrite-AuditLog \"PS-3 Personnel Screening Audit Starting\" \"INFO\"\n\n# Check for screening records\nif (Test-Path $ScreeningDB) {\n    Write-AuditLog \"Screening records database found\" \"PASS\"\n    \n    $Records = Import-Csv $ScreeningDB -ErrorAction SilentlyContinue\n    if ($Records) {\n        $Cleared = ($Records | Where-Object { $_.Status -eq 'CLEARED' }).Count\n        $Pending = ($Records | Where-Object { $_.Status -eq 'PENDING' }).Count\n        $Denied = ($Records | Where-Object { $_.Status -eq 'DENIED' }).Count\n        \n        Write-AuditLog \"Screening status - Cleared: $Cleared, Pending: $Pending, Denied: $Denied\" \"INFO\"\n        \n        # Check reinvestigation due dates\n        $Today = Get-Date\n        foreach ($Record in ($Records | Where-Object { $_.Status -eq 'CLEARED' })) {\n            try {\n                $LastInvestDate = [DateTime]::Parse($Record.LastInvestigation)\n                $DaysSince = ($Today - $LastInvestDate).Days\n                $Threshold = $ReinvestigationThresholds[$Record.RiskLevel]\n                \n                if ($null -eq $Threshold) { $Threshold = 1825 }\n                \n                if ($DaysSince -gt $Threshold) {\n                    Write-AuditLog \"$($Record.Username) reinvestigation overdue ($DaysSince days since last investigation)\" \"WARN\"\n                }\n            } catch {\n                Write-AuditLog \"Could not parse investigation date for $($Record.Username)\" \"WARN\"\n            }\n        }\n    }\n} else {\n    Write-AuditLog \"Screening records database not found\" \"FAIL\"\n}\n\n# Cross-reference with AD users if available\nif (Get-Module -ListAvailable -Name ActiveDirectory) {\n    Import-Module ActiveDirectory -ErrorAction SilentlyContinue\n    \n    if (Test-Path $ScreeningDB) {\n        $Records = Import-Csv $ScreeningDB\n        $ScreenedUsers = $Records.Username\n        \n        $ADUsers = Get-ADUser -Filter {Enabled -eq $true} | Select-Object -ExpandProperty SamAccountName\n        \n        foreach ($User in $ADUsers) {\n            if ($User -notin $ScreenedUsers) {\n                Write-AuditLog \"AD User $User has no screening record\" \"FAIL\"\n            }\n        }\n    }\n}\n\nWrite-AuditLog \"PS-3 Audit Complete\" \"INFO\"\nWrite-Output \"Audit logged to $AuditLog\"",
        "ansible": "---\n# PS-3 Personnel Screening Verification Playbook for Windows\n\n- name: PS-3 Personnel Screening Compliance Verification (Windows)\n  hosts: windows\n  vars:\n    screening_db: C:\\SecurityPolicies\\HR\\ScreeningRecords.csv\n    audit_log: C:\\SecurityLogs\\PS3_Audit.log\n\n  tasks:\n    - name: Ensure directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\HR\n        - C:\\SecurityLogs\n\n    - name: Check for screening records database\n      win_stat:\n        path: \"{{ screening_db }}\"\n      register: screening_check\n\n    - name: Log screening database status\n      win_lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Screening Records: {{ 'FOUND' if screening_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Generate PS-3 compliance report\n      win_copy:\n        content: |\n          PS-3 Personnel Screening Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Screening Database: {{ 'PRESENT' if screening_check.stat.exists else 'MISSING' }}\n          \n          Requirements:\n          1. Screen individuals prior to authorizing system access\n          2. Rescreen per organization-defined frequency\n          3. Track reinvestigation schedules\n        dest: C:\\SecurityPolicies\\HR\\PS3_Compliance_Report.txt"
      }
    },
    "enhancements": [
      {
        "id": "PS-3.1",
        "title": "Classified Information",
        "official_text": "Verify that individuals accessing a system processing, storing, or transmitting classified information are cleared and indoctrinated to the highest classification level of the information to which they have access on the system."
      },
      {
        "id": "PS-3.2",
        "title": "Formal Indoctrination",
        "official_text": "Verify that individuals accessing a system processing, storing, or transmitting types of classified information that require formal indoctrination are formally indoctrinated for all the relevant types of information to which they have access on the system."
      },
      {
        "id": "PS-3.3",
        "title": "Information Requiring Special Protective Measures",
        "official_text": "Verify that individuals accessing a system processing, storing, or transmitting information requiring special protection: (a) Have valid access authorizations that are demonstrated by assigned official government duties; and (b) Satisfy [Assignment: organization-defined additional personnel screening criteria]."
      },
      {
        "id": "PS-3.4",
        "title": "Citizenship Requirements",
        "official_text": "Verify that individuals accessing a system processing, storing, or transmitting [Assignment: organization-defined information types] meet [Assignment: organization-defined citizenship requirements]."
      }
    ],
    "related_controls": [
      "AC-2",
      "IA-4",
      "MA-5",
      "PE-2",
      "PM-12",
      "PS-2",
      "PS-6",
      "PS-7",
      "SA-21"
    ],
    "supplemental_guidance": "Personnel screening and rescreening activities reflect applicable laws, executive orders, directives, regulations, policies, standards, criteria, and guidelines related to the sensitivity of positions and the type of information processed, stored, or transmitted by the system. Organizations may define different rescreening conditions and frequencies for personnel accessing systems based on the type of information processed, stored, or transmitted by the system, including Privacy Act information, Personally Identifiable Information (PII), controlled unclassified information, For Official Use Only information, classified national security information, or information critical to mission/business operations.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "organizational"
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-3 is an organizational control requiring background investigations and rescreening. The provided scripts audit screening record documentation and track reinvestigation due dates but cannot perform actual background investigations or verify investigation quality."
    }
  },
  {
    "control_id": "PS-3.1",
    "control_name": "Classified Information",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-3",
    "stig_id": null,
    "official_text": "Verify that individuals accessing a system processing, storing, or transmitting classified information are cleared and indoctrinated to the highest classification level of the information to which they have access on the system.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure that access to classified information systems is restricted to individuals who have been properly vetted and briefed on their security responsibilities commensurate with the classification level of the information.",
    "rationale": "Classified national security information requires protection beyond standard personnel screening. Security clearances represent a formal government determination that an individual is eligible for access to classified information at a specific level. Indoctrination ensures individuals understand their responsibilities for protecting classified information, the consequences of unauthorized disclosure, and specific handling requirements. This defense-in-depth approach ensures both trustworthiness (clearance) and knowledge (indoctrination) before access is granted.",
    "plain_english_explanation": "Before anyone can access systems that handle classified information (Confidential, Secret, or Top Secret), you must verify two things: (1) They have an active security clearance at or above the highest classification level of information on the system, and (2) They have been formally briefed (indoctrinated) on their security responsibilities and the specific requirements for handling classified information at that level. You cannot grant access based solely on a clearance - the indoctrination briefing is mandatory.",
    "ai_guidance": "PS-3(1) applies to systems processing classified national security information and requires verification of both clearance eligibility and indoctrination completion. Implementation requires integration with the Defense Counterintelligence and Security Agency (DCSA) or relevant security office systems to verify clearance status. Key verification points include: (1) Active clearance at appropriate level (Confidential, Secret, Top Secret) in the Central Verification System (CVS) or other authoritative database; (2) Clearance scope matches access requirements (some clearances have restrictions); (3) Completed initial security briefing documented in personnel security files; (4) Signed SF-312 (Classified Information Nondisclosure Agreement) on file; (5) Any required special access briefings completed if system processes SCI or SAP information. Organizations should implement access control mechanisms that verify clearance status before granting system access, ideally through automated integration with clearance databases. Establish processes to receive and act on clearance status changes (downgrades, revocations, suspensions). Document all clearance verifications and indoctrination briefings. Ensure separation of duties between clearance verification and access provisioning. For contractor personnel, verify clearance sponsorship through the Contract Security Classification Specification (DD Form 254). Regular audits should verify that all users with access to classified systems have valid clearances and completed indoctrination.",
    "implementation_guidance": "Organizations handling classified information should: (1) Establish connectivity to clearance verification systems (CVS, JPAS successor, or agency-specific systems); (2) Implement pre-access verification workflow requiring clearance confirmation and indoctrination documentation before provisioning accounts; (3) Create automated alerts for clearance status changes; (4) Maintain records of SF-312 signatures and security briefings; (5) Implement periodic audits comparing system access lists against clearance databases; (6) Define escalation procedures for access by individuals with pending or expired clearances; (7) Coordinate with Facility Security Officer or Security Control Officer for clearance management; (8) Document visit authorization procedures for external personnel; (9) Establish procedures for handling access during clearance investigations or adjudication actions.",
    "is_technical": true,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-3.1 Classified Information Access Verification Script\n# Verifies users accessing classified systems have valid clearances\n\nCLEARANCE_DB=\"/etc/security/clearances/clearance_registry.csv\"\nINDOC_DB=\"/etc/security/clearances/indoctrination_records.csv\"\nSYSTEM_CLASSIFICATION=\"SECRET\"  # Adjust per system\nAUDIT_LOG=\"/var/log/security/ps3_1_audit.log\"\n\necho \"[$(date)] PS-3.1 Classified Access Audit Starting\" >> \"$AUDIT_LOG\"\necho \"[INFO] System Classification Level: $SYSTEM_CLASSIFICATION\" >> \"$AUDIT_LOG\"\n\n# Define clearance level hierarchy\ndeclare -A CLEARANCE_LEVELS=(\n    [\"UNCLASSIFIED\"]=0\n    [\"CONFIDENTIAL\"]=1\n    [\"SECRET\"]=2\n    [\"TOP SECRET\"]=3\n)\n\nSYSTEM_LEVEL=${CLEARANCE_LEVELS[$SYSTEM_CLASSIFICATION]}\n\n# Check for clearance database\nif [ ! -f \"$CLEARANCE_DB\" ]; then\n    echo \"[FAIL] Clearance registry not found\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\n# Check for indoctrination database\nif [ ! -f \"$INDOC_DB\" ]; then\n    echo \"[FAIL] Indoctrination records not found\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\n# Verify each system user\nfor USER in $(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}'); do\n    # Check clearance\n    CLEARANCE_LINE=$(grep \"^$USER,\" \"$CLEARANCE_DB\" 2>/dev/null)\n    \n    if [ -z \"$CLEARANCE_LINE\" ]; then\n        echo \"[FAIL] User $USER has no clearance record\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    USER_CLEARANCE=$(echo \"$CLEARANCE_LINE\" | cut -d',' -f2)\n    CLEARANCE_STATUS=$(echo \"$CLEARANCE_LINE\" | cut -d',' -f3)\n    \n    if [ \"$CLEARANCE_STATUS\" != \"ACTIVE\" ]; then\n        echo \"[FAIL] User $USER clearance is $CLEARANCE_STATUS (not ACTIVE)\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    USER_LEVEL=${CLEARANCE_LEVELS[$USER_CLEARANCE]}\n    \n    if [ -z \"$USER_LEVEL\" ] || [ \"$USER_LEVEL\" -lt \"$SYSTEM_LEVEL\" ]; then\n        echo \"[FAIL] User $USER clearance level ($USER_CLEARANCE) insufficient for $SYSTEM_CLASSIFICATION system\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    # Check indoctrination\n    INDOC_LINE=$(grep \"^$USER,\" \"$INDOC_DB\" 2>/dev/null)\n    \n    if [ -z \"$INDOC_LINE\" ]; then\n        echo \"[FAIL] User $USER has no indoctrination record\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    SF312_STATUS=$(echo \"$INDOC_LINE\" | cut -d',' -f2)\n    BRIEFING_DATE=$(echo \"$INDOC_LINE\" | cut -d',' -f3)\n    \n    if [ \"$SF312_STATUS\" != \"SIGNED\" ]; then\n        echo \"[FAIL] User $USER SF-312 not signed\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    echo \"[PASS] User $USER verified: $USER_CLEARANCE clearance, indoctrinated $BRIEFING_DATE\" >> \"$AUDIT_LOG\"\ndone\n\necho \"[$(date)] PS-3.1 Audit Complete\" >> \"$AUDIT_LOG\"",
        "ansible": "---\n# PS-3.1 Classified Information Access Verification Playbook\n\n- name: PS-3.1 Classified System Access Verification\n  hosts: classified_systems\n  become: yes\n  vars:\n    clearance_db: /etc/security/clearances/clearance_registry.csv\n    indoc_db: /etc/security/clearances/indoctrination_records.csv\n    system_classification: SECRET\n    audit_log: /var/log/security/ps3_1_audit.log\n    clearance_hierarchy:\n      UNCLASSIFIED: 0\n      CONFIDENTIAL: 1\n      SECRET: 2\n      TOP SECRET: 3\n\n  tasks:\n    - name: Ensure clearance directory exists\n      file:\n        path: /etc/security/clearances\n        state: directory\n        mode: '0750'\n\n    - name: Check for clearance registry\n      stat:\n        path: \"{{ clearance_db }}\"\n      register: clearance_check\n\n    - name: Check for indoctrination records\n      stat:\n        path: \"{{ indoc_db }}\"\n      register: indoc_check\n\n    - name: Fail if required databases missing\n      fail:\n        msg: \"Required clearance/indoctrination databases not found\"\n      when: not clearance_check.stat.exists or not indoc_check.stat.exists\n\n    - name: Get system users\n      shell: getent passwd | awk -F':' '$3 >= 1000 && $3 < 65534 {print $1}'\n      register: system_users\n      changed_when: false\n\n    - name: Verify user clearances and indoctrination\n      shell: |\n        USER=\"{{ item }}\"\n        CLR=$(grep \"^$USER,\" {{ clearance_db }} | cut -d',' -f2,3)\n        INDOC=$(grep \"^$USER,\" {{ indoc_db }} | cut -d',' -f2)\n        echo \"USER:$USER CLR:$CLR INDOC:$INDOC\"\n      register: user_verification\n      loop: \"{{ system_users.stdout_lines }}\"\n      changed_when: false\n\n    - name: Log verification results\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] {{ item.stdout }}\"\n        create: yes\n      loop: \"{{ user_verification.results }}\"\n\n    - name: Generate PS-3.1 compliance report\n      copy:\n        content: |\n          PS-3.1 Classified Information Access Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          System Classification: {{ system_classification }}\n          \n          Requirements:\n          1. All users must have active clearance at or above system level\n          2. All users must have signed SF-312\n          3. All users must have completed indoctrination briefing\n        dest: /etc/security/clearances/ps3_1_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-3.1 Classified Information Access Verification Script\n# Verifies users accessing classified systems have valid clearances\n\n$ClearanceDB = \"C:\\SecurityPolicies\\Clearances\\ClearanceRegistry.csv\"\n$IndocDB = \"C:\\SecurityPolicies\\Clearances\\IndoctrinationRecords.csv\"\n$SystemClassification = \"SECRET\"  # Adjust per system\n$AuditLog = \"C:\\SecurityLogs\\PS3_1_Audit.log\"\n\n# Clearance hierarchy\n$ClearanceLevels = @{\n    'UNCLASSIFIED' = 0\n    'CONFIDENTIAL' = 1\n    'SECRET' = 2\n    'TOP SECRET' = 3\n}\n\n# Ensure directories exist\n@(\"C:\\SecurityPolicies\\Clearances\", \"C:\\SecurityLogs\") | ForEach-Object {\n    if (-not (Test-Path $_)) {\n        New-Item -ItemType Directory -Path $_ -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $AuditLog -Value \"[$Timestamp] [$Status] $Message\"\n}\n\nWrite-AuditLog \"PS-3.1 Classified Access Audit Starting\" \"INFO\"\nWrite-AuditLog \"System Classification Level: $SystemClassification\" \"INFO\"\n\n$SystemLevel = $ClearanceLevels[$SystemClassification]\n\n# Check for required files\nif (-not (Test-Path $ClearanceDB)) {\n    Write-AuditLog \"Clearance registry not found\" \"FAIL\"\n    exit 1\n}\n\nif (-not (Test-Path $IndocDB)) {\n    Write-AuditLog \"Indoctrination records not found\" \"FAIL\"\n    exit 1\n}\n\n$Clearances = Import-Csv $ClearanceDB\n$Indocs = Import-Csv $IndocDB\n\n# Get AD users if available\nif (Get-Module -ListAvailable -Name ActiveDirectory) {\n    Import-Module ActiveDirectory\n    $Users = Get-ADUser -Filter {Enabled -eq $true} | Select-Object -ExpandProperty SamAccountName\n} else {\n    $Users = $Clearances.Username\n}\n\nforeach ($User in $Users) {\n    $ClrRecord = $Clearances | Where-Object { $_.Username -eq $User }\n    $IndocRecord = $Indocs | Where-Object { $_.Username -eq $User }\n    \n    if (-not $ClrRecord) {\n        Write-AuditLog \"User $User has no clearance record\" \"FAIL\"\n        continue\n    }\n    \n    if ($ClrRecord.Status -ne 'ACTIVE') {\n        Write-AuditLog \"User $User clearance is $($ClrRecord.Status) (not ACTIVE)\" \"FAIL\"\n        continue\n    }\n    \n    $UserLevel = $ClearanceLevels[$ClrRecord.ClearanceLevel]\n    if ($null -eq $UserLevel -or $UserLevel -lt $SystemLevel) {\n        Write-AuditLog \"User $User clearance level ($($ClrRecord.ClearanceLevel)) insufficient for $SystemClassification system\" \"FAIL\"\n        continue\n    }\n    \n    if (-not $IndocRecord) {\n        Write-AuditLog \"User $User has no indoctrination record\" \"FAIL\"\n        continue\n    }\n    \n    if ($IndocRecord.SF312Status -ne 'SIGNED') {\n        Write-AuditLog \"User $User SF-312 not signed\" \"FAIL\"\n        continue\n    }\n    \n    Write-AuditLog \"User $User verified: $($ClrRecord.ClearanceLevel) clearance, indoctrinated $($IndocRecord.BriefingDate)\" \"PASS\"\n}\n\nWrite-AuditLog \"PS-3.1 Audit Complete\" \"INFO\"",
        "ansible": "---\n# PS-3.1 Classified Information Access Verification Playbook for Windows\n\n- name: PS-3.1 Classified System Access Verification (Windows)\n  hosts: windows_classified\n  vars:\n    clearance_db: C:\\SecurityPolicies\\Clearances\\ClearanceRegistry.csv\n    indoc_db: C:\\SecurityPolicies\\Clearances\\IndoctrinationRecords.csv\n    system_classification: SECRET\n    audit_log: C:\\SecurityLogs\\PS3_1_Audit.log\n\n  tasks:\n    - name: Ensure directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\Clearances\n        - C:\\SecurityLogs\n\n    - name: Check for clearance registry\n      win_stat:\n        path: \"{{ clearance_db }}\"\n      register: clearance_check\n\n    - name: Check for indoctrination records\n      win_stat:\n        path: \"{{ indoc_db }}\"\n      register: indoc_check\n\n    - name: Log database status\n      win_lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Clearance DB: {{ 'FOUND' if clearance_check.stat.exists else 'MISSING' }}, Indoc DB: {{ 'FOUND' if indoc_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Generate PS-3.1 compliance report\n      win_copy:\n        content: |\n          PS-3.1 Classified Information Access Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          System Classification: {{ system_classification }}\n          \n          Requirements:\n          1. Verify active clearance at/above system classification\n          2. Verify signed SF-312 on file\n          3. Verify completed indoctrination briefing\n        dest: C:\\SecurityPolicies\\Clearances\\PS3_1_Compliance_Report.txt"
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-3",
      "AC-6",
      "IA-2",
      "PE-2",
      "PS-3",
      "PS-6",
      "SC-13"
    ],
    "supplemental_guidance": "Classified information includes information requiring protection pursuant to Executive Order 13526, Classified National Security Information, or any successor order, the Atomic Energy Act of 1954, as amended, and any other statute authorizing classification of information. Clearance status indicates whether an individual has been formally approved for access to classified information based on a completed background investigation and adjudication. Indoctrination ensures individuals understand the legal obligations, potential penalties for unauthorized disclosure, and specific handling procedures for classified information.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "hybrid"
    },
    "cac_metadata": {
      "implementation_type": "hybrid",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-3(1) requires integration with classified information handling systems. The provided scripts audit local clearance and indoctrination records but should be integrated with authoritative clearance verification systems (CVS/DISS) in production environments."
    }
  },
  {
    "control_id": "PS-3.2",
    "control_name": "Formal Indoctrination",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-3",
    "stig_id": null,
    "official_text": "Verify that individuals accessing a system processing, storing, or transmitting types of classified information that require formal indoctrination are formally indoctrinated for all the relevant types of information to which they have access on the system.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure that individuals accessing systems with special categories of classified information (such as SCI, SAP, or RD) have completed specific formal indoctrination for each category of special access information they will encounter.",
    "rationale": "Certain categories of classified information require handling beyond standard classification protocols. Special Access Programs (SAP), Sensitive Compartmented Information (SCI), and Restricted Data (RD) have unique protection requirements, specific need-to-know criteria, and distinct reporting obligations. Formal indoctrination for these programs ensures individuals understand the heightened sensitivity, specific handling procedures, and severe consequences of unauthorized disclosure for each special category. This layered approach to access control provides additional protection for the nation's most sensitive information.",
    "plain_english_explanation": "Some classified information has additional protection requirements beyond the standard classification levels. If your system handles Sensitive Compartmented Information (SCI), Special Access Programs (SAP), Restricted Data (RD), or other specially controlled information, you must verify that each user has been formally indoctrinated (briefed) for every specific program or compartment they can access. A Top Secret clearance alone is not sufficient - the individual must have specific program access approvals and completed program-specific briefings documenting they understand the unique requirements for each special category.",
    "ai_guidance": "PS-3(2) addresses special access programs and compartmented information that require additional indoctrination beyond standard classification briefings. Implementation requires tracking multiple categories of special access for each individual. Key considerations include: (1) Identify all special access programs (SAPs), SCI compartments, and restricted data categories processed by the system; (2) Map system access permissions to required indoctrinations; (3) Verify each user's SCI access approvals through authoritative databases; (4) Confirm SAP program access is documented and current; (5) Ensure Restricted Data (RD) and Formerly Restricted Data (FRD) access is properly authorized for nuclear information; (6) Track indoctrination dates and debriefing requirements; (7) Implement access controls that enforce compartmentalization; (8) Coordinate with Special Security Officers (SSO) for SCI and Program Security Officers (PSO) for SAP management; (9) Establish procedures for temporary access requests and visitor control; (10) Document all access determinations and maintain records per program requirements. Access control systems should be designed to enforce need-to-know at the compartment/program level, not just classification level. Regular audits should verify that all personnel with access have current indoctrinations for all accessible compartments and programs.",
    "implementation_guidance": "Organizations with special access systems should: (1) Maintain a registry of all special access programs, SCI compartments, and restricted data categories on the system; (2) Implement access controls that map system permissions to required indoctrinations; (3) Establish integration with authoritative access management systems (JPAS/DISS for SCI, program databases for SAP); (4) Create verification workflows that confirm all required indoctrinations before provisioning access; (5) Track indoctrination expiration and debriefing requirements; (6) Coordinate with SSO/PSO for access management; (7) Implement audit mechanisms to verify ongoing compliance; (8) Document visitor and temporary access procedures; (9) Establish incident response procedures for potential compromises of special access information.",
    "is_technical": true,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-3.2 Formal Indoctrination Verification Script\n# Verifies SCI/SAP/RD indoctrination for special access systems\n\nSPECIAL_ACCESS_DB=\"/etc/security/special_access/program_access.csv\"\nSYSTEM_PROGRAMS=\"/etc/security/special_access/system_programs.conf\"\nAUDIT_LOG=\"/var/log/security/ps3_2_audit.log\"\n\necho \"[$(date)] PS-3.2 Formal Indoctrination Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Check for required files\nif [ ! -f \"$SPECIAL_ACCESS_DB\" ]; then\n    echo \"[FAIL] Special access database not found\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\nif [ ! -f \"$SYSTEM_PROGRAMS\" ]; then\n    echo \"[FAIL] System programs configuration not found\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\n# Load system-required programs/compartments\nREQUIRED_PROGRAMS=($(grep -v '^#' \"$SYSTEM_PROGRAMS\" | tr '\\n' ' '))\necho \"[INFO] System requires indoctrination for: ${REQUIRED_PROGRAMS[*]}\" >> \"$AUDIT_LOG\"\n\n# Verify each system user\nfor USER in $(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}'); do\n    USER_RECORD=$(grep \"^$USER,\" \"$SPECIAL_ACCESS_DB\" 2>/dev/null)\n    \n    if [ -z \"$USER_RECORD\" ]; then\n        echo \"[FAIL] User $USER has no special access record\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    USER_PROGRAMS=$(echo \"$USER_RECORD\" | cut -d',' -f2)\n    MISSING_PROGRAMS=\"\"\n    \n    for PROG in \"${REQUIRED_PROGRAMS[@]}\"; do\n        if ! echo \"$USER_PROGRAMS\" | grep -q \"$PROG\"; then\n            MISSING_PROGRAMS=\"$MISSING_PROGRAMS $PROG\"\n        fi\n    done\n    \n    if [ -n \"$MISSING_PROGRAMS\" ]; then\n        echo \"[FAIL] User $USER missing indoctrination for:$MISSING_PROGRAMS\" >> \"$AUDIT_LOG\"\n    else\n        echo \"[PASS] User $USER indoctrinated for all required programs\" >> \"$AUDIT_LOG\"\n    fi\ndone\n\necho \"[$(date)] PS-3.2 Audit Complete\" >> \"$AUDIT_LOG\"",
        "ansible": "---\n# PS-3.2 Formal Indoctrination Verification Playbook\n\n- name: PS-3.2 SCI/SAP Indoctrination Verification\n  hosts: special_access_systems\n  become: yes\n  vars:\n    special_access_db: /etc/security/special_access/program_access.csv\n    system_programs: /etc/security/special_access/system_programs.conf\n    audit_log: /var/log/security/ps3_2_audit.log\n\n  tasks:\n    - name: Ensure special access directory exists\n      file:\n        path: /etc/security/special_access\n        state: directory\n        mode: '0750'\n\n    - name: Check for required configuration files\n      stat:\n        path: \"{{ item }}\"\n      register: config_files\n      loop:\n        - \"{{ special_access_db }}\"\n        - \"{{ system_programs }}\"\n\n    - name: Log configuration status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] {{ item.item }}: {{ 'FOUND' if item.stat.exists else 'MISSING' }}\"\n        create: yes\n      loop: \"{{ config_files.results }}\"\n\n    - name: Generate PS-3.2 compliance report\n      copy:\n        content: |\n          PS-3.2 Formal Indoctrination Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Verify SCI/SAP/RD indoctrination for all users\n          2. Map system access to required program briefings\n          3. Coordinate with SSO/PSO for access management\n          4. Maintain current indoctrination records\n        dest: /etc/security/special_access/ps3_2_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-3.2 Formal Indoctrination Verification Script\n# Verifies SCI/SAP/RD indoctrination for special access systems\n\n$SpecialAccessDB = \"C:\\SecurityPolicies\\SpecialAccess\\ProgramAccess.csv\"\n$SystemPrograms = \"C:\\SecurityPolicies\\SpecialAccess\\SystemPrograms.txt\"\n$AuditLog = \"C:\\SecurityLogs\\PS3_2_Audit.log\"\n\n# Ensure directories exist\n@(\"C:\\SecurityPolicies\\SpecialAccess\", \"C:\\SecurityLogs\") | ForEach-Object {\n    if (-not (Test-Path $_)) {\n        New-Item -ItemType Directory -Path $_ -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $AuditLog -Value \"[$Timestamp] [$Status] $Message\"\n}\n\nWrite-AuditLog \"PS-3.2 Formal Indoctrination Audit Starting\" \"INFO\"\n\n# Check for required files\nif (-not (Test-Path $SpecialAccessDB)) {\n    Write-AuditLog \"Special access database not found\" \"FAIL\"\n    exit 1\n}\n\nif (-not (Test-Path $SystemPrograms)) {\n    Write-AuditLog \"System programs configuration not found\" \"FAIL\"\n    exit 1\n}\n\n# Load requirements\n$RequiredPrograms = Get-Content $SystemPrograms | Where-Object { $_ -notmatch '^#' -and $_ -ne '' }\n$AccessRecords = Import-Csv $SpecialAccessDB\n\nWrite-AuditLog \"System requires indoctrination for: $($RequiredPrograms -join ', ')\" \"INFO\"\n\n# Verify users\nforeach ($Record in $AccessRecords) {\n    $UserPrograms = $Record.Programs -split ';'\n    $MissingPrograms = $RequiredPrograms | Where-Object { $_ -notin $UserPrograms }\n    \n    if ($MissingPrograms) {\n        Write-AuditLog \"User $($Record.Username) missing indoctrination for: $($MissingPrograms -join ', ')\" \"FAIL\"\n    } else {\n        Write-AuditLog \"User $($Record.Username) indoctrinated for all required programs\" \"PASS\"\n    }\n}\n\nWrite-AuditLog \"PS-3.2 Audit Complete\" \"INFO\"",
        "ansible": "---\n# PS-3.2 Formal Indoctrination Verification Playbook for Windows\n\n- name: PS-3.2 SCI/SAP Indoctrination Verification (Windows)\n  hosts: windows_special_access\n  vars:\n    special_access_db: C:\\SecurityPolicies\\SpecialAccess\\ProgramAccess.csv\n    system_programs: C:\\SecurityPolicies\\SpecialAccess\\SystemPrograms.txt\n    audit_log: C:\\SecurityLogs\\PS3_2_Audit.log\n\n  tasks:\n    - name: Ensure directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\SpecialAccess\n        - C:\\SecurityLogs\n\n    - name: Check for special access database\n      win_stat:\n        path: \"{{ special_access_db }}\"\n      register: db_check\n\n    - name: Log database status\n      win_lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Special Access DB: {{ 'FOUND' if db_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Generate PS-3.2 compliance report\n      win_copy:\n        content: |\n          PS-3.2 Formal Indoctrination Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Verify program-specific indoctrination\n          2. Track SCI/SAP/RD access authorizations\n          3. Coordinate with security officers\n        dest: C:\\SecurityPolicies\\SpecialAccess\\PS3_2_Compliance_Report.txt"
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-3",
      "AC-6",
      "PE-2",
      "PS-3",
      "PS-3.1",
      "PS-6",
      "SC-13"
    ],
    "supplemental_guidance": "Types of classified information requiring formal indoctrination include, for example, Special Access Program (SAP), Restricted Data (RD), and Sensitive Compartmented Information (SCI). Formal indoctrination for special access programs provides individuals with specific information about the program, required protections, and the consequences for unauthorized disclosure. Organizations determine the frequency of indoctrination briefings based on program requirements, security environment, and organizational risk tolerance.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "hybrid"
    },
    "cac_metadata": {
      "implementation_type": "hybrid",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-3(2) applies to systems processing SCI, SAP, RD, or other special access information. The provided scripts verify local indoctrination records against system requirements but should integrate with authoritative program access management systems in production environments."
    }
  },
  {
    "control_id": "PS-3.3",
    "control_name": "Information Requiring Special Protective Measures",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-3",
    "stig_id": null,
    "official_text": "Verify that individuals accessing a system processing, storing, or transmitting information requiring special protection:\n  (a) Have valid access authorizations that are demonstrated by assigned official government duties; and\n  (b) Satisfy [Assignment: organization-defined additional personnel screening criteria].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure that access to systems containing specially protected information is limited to individuals who have a legitimate need based on their official duties and who meet any additional screening requirements specific to the type of information being protected.",
    "rationale": "Some information requires protection beyond standard classification handling due to its sensitive nature, potential impact if disclosed, or statutory/regulatory requirements. Examples include law enforcement sensitive information, critical infrastructure protection information, personally identifiable information subject to Privacy Act protections, or information related to ongoing legal proceedings. This control ensures access is granted only to individuals with verified need-to-know based on job function and who have undergone any additional screening required by the information's protective requirements.",
    "plain_english_explanation": "Certain types of information require extra protection even if not classified. Before granting access to systems with this specially protected information, you must verify two things: (1) The person actually needs access as part of their official job duties - not just a general interest or convenience, and (2) They have met any additional screening requirements specific to that type of information. For example, access to law enforcement sensitive information might require additional background checks, or access to critical infrastructure data might require citizenship verification. The specific additional criteria depend on the type of protected information and applicable regulations.",
    "ai_guidance": "PS-3(3) addresses information that requires special protection but may not be classified, such as law enforcement sensitive (LES), critical infrastructure information (CII), personally identifiable information (PII), For Official Use Only (FOUO), Controlled Unclassified Information (CUI), or information protected by specific statutes. Implementation requires: (1) Identify and categorize all specially protected information types processed by the system; (2) Document the specific protective requirements for each information type, referencing applicable laws, regulations, or policies; (3) Define additional screening criteria for each information type - these might include polygraph requirements for law enforcement positions, citizenship requirements for certain critical infrastructure roles, or suitability determinations for positions involving PII; (4) Establish need-to-know verification processes that validate access requests against official duty assignments; (5) Implement access control mechanisms that enforce information type-specific permissions; (6) Create audit trails documenting access authorization decisions including the official duties justifying access; (7) Establish procedures for periodic revalidation of need-to-know; (8) Define procedures for handling access requests from individuals who meet clearance requirements but lack specific program access or need-to-know. Organizations should maintain documentation of the legal basis for special protection requirements and the rationale for additional screening criteria.",
    "implementation_guidance": "Organizations should: (1) Inventory all specially protected information types on the system; (2) Document applicable protection requirements and their legal basis; (3) Define additional screening criteria specific to each information type; (4) Implement need-to-know verification in access request workflows; (5) Create access authorization documentation requirements; (6) Establish periodic access review processes; (7) Integrate with HR systems to verify job functions and official duties; (8) Implement audit logging for access to specially protected information; (9) Define escalation procedures for access requests that lack clear need-to-know justification.",
    "is_technical": true,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-3.3 Special Protection Information Access Verification Script\n# Verifies need-to-know and additional screening for protected information\n\nSPECIAL_INFO_DB=\"/etc/security/special_info/access_authorizations.csv\"\nDUTY_ASSIGNMENTS=\"/etc/security/special_info/duty_assignments.csv\"\nINFO_TYPES=\"/etc/security/special_info/protected_info_types.conf\"\nAUDIT_LOG=\"/var/log/security/ps3_3_audit.log\"\n\necho \"[$(date)] PS-3.3 Special Protective Measures Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Check for required files\nfor FILE in \"$SPECIAL_INFO_DB\" \"$DUTY_ASSIGNMENTS\" \"$INFO_TYPES\"; do\n    if [ ! -f \"$FILE\" ]; then\n        echo \"[FAIL] Required file not found: $FILE\" >> \"$AUDIT_LOG\"\n    fi\ndone\n\nif [ -f \"$SPECIAL_INFO_DB\" ] && [ -f \"$DUTY_ASSIGNMENTS\" ]; then\n    # Verify each access authorization\n    while IFS=',' read -r USERNAME INFO_TYPE ACCESS_GRANTED SCREENING_STATUS; do\n        [ \"$USERNAME\" = \"Username\" ] && continue  # Skip header\n        \n        # Check duty assignment justifies access\n        DUTY_MATCH=$(grep \"^$USERNAME,\" \"$DUTY_ASSIGNMENTS\" | grep -c \"$INFO_TYPE\")\n        \n        if [ \"$DUTY_MATCH\" -eq 0 ]; then\n            echo \"[FAIL] User $USERNAME access to $INFO_TYPE not justified by duty assignment\" >> \"$AUDIT_LOG\"\n        else\n            echo \"[PASS] User $USERNAME access to $INFO_TYPE justified by official duties\" >> \"$AUDIT_LOG\"\n        fi\n        \n        # Check additional screening\n        if [ \"$SCREENING_STATUS\" != \"COMPLETE\" ]; then\n            echo \"[FAIL] User $USERNAME additional screening for $INFO_TYPE is $SCREENING_STATUS\" >> \"$AUDIT_LOG\"\n        else\n            echo \"[PASS] User $USERNAME additional screening for $INFO_TYPE complete\" >> \"$AUDIT_LOG\"\n        fi\n    done < \"$SPECIAL_INFO_DB\"\nfi\n\necho \"[$(date)] PS-3.3 Audit Complete\" >> \"$AUDIT_LOG\"",
        "ansible": "---\n# PS-3.3 Special Protective Measures Verification Playbook\n\n- name: PS-3.3 Special Protection Access Verification\n  hosts: special_info_systems\n  become: yes\n  vars:\n    special_info_db: /etc/security/special_info/access_authorizations.csv\n    duty_assignments: /etc/security/special_info/duty_assignments.csv\n    audit_log: /var/log/security/ps3_3_audit.log\n\n  tasks:\n    - name: Ensure special info directory exists\n      file:\n        path: /etc/security/special_info\n        state: directory\n        mode: '0750'\n\n    - name: Check for required files\n      stat:\n        path: \"{{ item }}\"\n      register: required_files\n      loop:\n        - \"{{ special_info_db }}\"\n        - \"{{ duty_assignments }}\"\n\n    - name: Log file status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] {{ item.item }}: {{ 'FOUND' if item.stat.exists else 'MISSING' }}\"\n        create: yes\n      loop: \"{{ required_files.results }}\"\n\n    - name: Generate PS-3.3 compliance report\n      copy:\n        content: |\n          PS-3.3 Information Requiring Special Protection Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Verify access justified by official government duties\n          2. Verify additional screening criteria satisfied\n          3. Document need-to-know determinations\n          4. Maintain access authorization records\n        dest: /etc/security/special_info/ps3_3_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-3.3 Special Protection Information Access Verification Script\n\n$SpecialInfoDB = \"C:\\SecurityPolicies\\SpecialInfo\\AccessAuthorizations.csv\"\n$DutyAssignments = \"C:\\SecurityPolicies\\SpecialInfo\\DutyAssignments.csv\"\n$AuditLog = \"C:\\SecurityLogs\\PS3_3_Audit.log\"\n\n# Ensure directories exist\n@(\"C:\\SecurityPolicies\\SpecialInfo\", \"C:\\SecurityLogs\") | ForEach-Object {\n    if (-not (Test-Path $_)) {\n        New-Item -ItemType Directory -Path $_ -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $AuditLog -Value \"[$Timestamp] [$Status] $Message\"\n}\n\nWrite-AuditLog \"PS-3.3 Special Protective Measures Audit Starting\" \"INFO\"\n\n# Check for required files\nif (-not (Test-Path $SpecialInfoDB)) {\n    Write-AuditLog \"Access authorizations database not found\" \"FAIL\"\n    exit 1\n}\n\nif (-not (Test-Path $DutyAssignments)) {\n    Write-AuditLog \"Duty assignments database not found\" \"FAIL\"\n    exit 1\n}\n\n$Authorizations = Import-Csv $SpecialInfoDB\n$Duties = Import-Csv $DutyAssignments\n\nforeach ($Auth in $Authorizations) {\n    # Verify duty assignment justifies access\n    $DutyMatch = $Duties | Where-Object { \n        $_.Username -eq $Auth.Username -and $_.InfoTypes -match $Auth.InfoType \n    }\n    \n    if (-not $DutyMatch) {\n        Write-AuditLog \"User $($Auth.Username) access to $($Auth.InfoType) not justified by duty assignment\" \"FAIL\"\n    } else {\n        Write-AuditLog \"User $($Auth.Username) access to $($Auth.InfoType) justified by official duties\" \"PASS\"\n    }\n    \n    # Check additional screening\n    if ($Auth.ScreeningStatus -ne 'COMPLETE') {\n        Write-AuditLog \"User $($Auth.Username) additional screening for $($Auth.InfoType) is $($Auth.ScreeningStatus)\" \"FAIL\"\n    } else {\n        Write-AuditLog \"User $($Auth.Username) additional screening for $($Auth.InfoType) complete\" \"PASS\"\n    }\n}\n\nWrite-AuditLog \"PS-3.3 Audit Complete\" \"INFO\"",
        "ansible": "---\n# PS-3.3 Special Protective Measures Verification Playbook for Windows\n\n- name: PS-3.3 Special Protection Access Verification (Windows)\n  hosts: windows_special_info\n  vars:\n    special_info_db: C:\\SecurityPolicies\\SpecialInfo\\AccessAuthorizations.csv\n    duty_assignments: C:\\SecurityPolicies\\SpecialInfo\\DutyAssignments.csv\n    audit_log: C:\\SecurityLogs\\PS3_3_Audit.log\n\n  tasks:\n    - name: Ensure directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\SpecialInfo\n        - C:\\SecurityLogs\n\n    - name: Check for authorization database\n      win_stat:\n        path: \"{{ special_info_db }}\"\n      register: auth_check\n\n    - name: Generate PS-3.3 compliance report\n      win_copy:\n        content: |\n          PS-3.3 Special Protection Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Verify official duty justification for access\n          2. Verify additional screening criteria met\n          3. Document access authorization decisions\n        dest: C:\\SecurityPolicies\\SpecialInfo\\PS3_3_Compliance_Report.txt"
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-3",
      "AC-6",
      "PE-2",
      "PS-3",
      "PS-6",
      "RA-2",
      "SC-7"
    ],
    "supplemental_guidance": "Information requiring special protection includes, for example, Controlled Unclassified Information (CUI), law enforcement information, and information protected by the Privacy Act or other applicable statutes and regulations. Organizations determine which types of information require special protection based on applicable laws, regulations, policies, and guidance. The additional screening criteria for individuals accessing systems processing, storing, or transmitting information requiring special protection are defined based on the specific information types and the associated risks.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "hybrid"
    },
    "cac_metadata": {
      "implementation_type": "hybrid",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-3(3) requires verification of need-to-know and additional screening for specially protected information. The provided scripts audit local access authorization and screening records. Organizations must define the specific additional screening criteria based on their information types and applicable regulations."
    }
  },
  {
    "control_id": "PS-3.4",
    "control_name": "Citizenship Requirements",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-3",
    "stig_id": null,
    "official_text": "Verify that individuals accessing a system processing, storing, or transmitting [Assignment: organization-defined information types] meet [Assignment: organization-defined citizenship requirements].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "intent": "Ensure that access to systems containing certain sensitive information is restricted based on citizenship status as required by law, regulation, or policy, typically for information that cannot be released to foreign nationals.",
    "rationale": "Certain categories of information are restricted by law or policy to U.S. citizens, or have specific requirements regarding foreign national access. Export-controlled technical data under ITAR/EAR, certain classified information programs, and some critical infrastructure protection information have citizenship-based access restrictions. This control ensures organizations verify citizenship status before granting access to systems containing such restricted information, supporting compliance with export control laws and national security requirements.",
    "plain_english_explanation": "Some information can only be accessed by U.S. citizens (or citizens of specific allied nations for certain programs). Before granting access to systems with this citizenship-restricted information, you must verify the person's citizenship status. Common examples include Export-Controlled technical data (ITAR/EAR restricted), certain classified national security information, critical infrastructure protection data, and information covered by foreign ownership control or influence (FOCI) restrictions. You must document what citizenship verification was performed and maintain records of citizenship status for all personnel with access to restricted systems.",
    "ai_guidance": "PS-3(4) addresses citizenship-based access restrictions required by law, regulation, or policy. Implementation requires: (1) Identify all information types on the system subject to citizenship restrictions, documenting the legal basis (ITAR, EAR, classification requirements, agency policy, etc.); (2) Define the specific citizenship requirements for each information type - typically U.S. citizenship, but some programs allow dual nationals or citizens of specific allied nations; (3) Establish citizenship verification procedures using authoritative documentation (birth certificate, naturalization certificate, passport, etc.); (4) Implement access control mechanisms that enforce citizenship requirements; (5) Track citizenship status in personnel records with appropriate documentation; (6) Establish procedures for foreign national employees or visitors, including technology control plans and export licenses where applicable; (7) Define processes for handling naturalization status changes; (8) Coordinate with export control officers for ITAR/EAR covered systems; (9) Implement audit logging to demonstrate compliance with citizenship restrictions; (10) Establish incident response procedures for potential export control violations. Organizations should be aware that citizenship requirements may also apply to contractors, subcontractors, and visitors with access to covered systems. Special care is needed when using cloud services or remote access to ensure citizenship-restricted information is not accessible to unauthorized foreign nationals.",
    "implementation_guidance": "Organizations with citizenship-restricted systems should: (1) Inventory all information types subject to citizenship restrictions and document legal basis; (2) Define acceptable citizenship documentation and verification procedures; (3) Implement pre-access verification requiring citizenship confirmation before account provisioning; (4) Track citizenship status in HR/personnel systems; (5) Establish procedures for handling Lawful Permanent Residents (LPRs) and foreign nationals, including required export authorizations; (6) Coordinate with export control officers for ITAR/EAR compliance; (7) Implement access controls that enforce citizenship-based permissions; (8) Create audit procedures to verify ongoing compliance; (9) Establish visitor control procedures for foreign nationals; (10) Define incident response for potential export control violations.",
    "is_technical": true,
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-3.4 Citizenship Requirements Verification Script\n# Verifies citizenship status for restricted information systems\n\nCITIZENSHIP_DB=\"/etc/security/citizenship/citizen_registry.csv\"\nSYSTEM_REQUIREMENTS=\"/etc/security/citizenship/system_requirements.conf\"\nAUDIT_LOG=\"/var/log/security/ps3_4_audit.log\"\n\necho \"[$(date)] PS-3.4 Citizenship Requirements Audit Starting\" >> \"$AUDIT_LOG\"\n\n# Load system citizenship requirements\nif [ ! -f \"$SYSTEM_REQUIREMENTS\" ]; then\n    echo \"[FAIL] System citizenship requirements not defined\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\nREQUIRED_CITIZENSHIP=$(grep -v '^#' \"$SYSTEM_REQUIREMENTS\" | head -1)\necho \"[INFO] System requires: $REQUIRED_CITIZENSHIP\" >> \"$AUDIT_LOG\"\n\n# Check for citizenship database\nif [ ! -f \"$CITIZENSHIP_DB\" ]; then\n    echo \"[FAIL] Citizenship registry not found\" >> \"$AUDIT_LOG\"\n    exit 1\nfi\n\n# Verify each system user\nfor USER in $(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}'); do\n    CITIZEN_RECORD=$(grep \"^$USER,\" \"$CITIZENSHIP_DB\" 2>/dev/null)\n    \n    if [ -z \"$CITIZEN_RECORD\" ]; then\n        echo \"[FAIL] User $USER has no citizenship record\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    USER_CITIZENSHIP=$(echo \"$CITIZEN_RECORD\" | cut -d',' -f2)\n    VERIFICATION_STATUS=$(echo \"$CITIZEN_RECORD\" | cut -d',' -f3)\n    VERIFICATION_DATE=$(echo \"$CITIZEN_RECORD\" | cut -d',' -f4)\n    \n    if [ \"$VERIFICATION_STATUS\" != \"VERIFIED\" ]; then\n        echo \"[FAIL] User $USER citizenship not verified (status: $VERIFICATION_STATUS)\" >> \"$AUDIT_LOG\"\n        continue\n    fi\n    \n    # Check citizenship meets requirements\n    if [[ \"$REQUIRED_CITIZENSHIP\" == *\"$USER_CITIZENSHIP\"* ]]; then\n        echo \"[PASS] User $USER meets citizenship requirement ($USER_CITIZENSHIP, verified $VERIFICATION_DATE)\" >> \"$AUDIT_LOG\"\n    else\n        echo \"[FAIL] User $USER citizenship ($USER_CITIZENSHIP) does not meet requirement ($REQUIRED_CITIZENSHIP)\" >> \"$AUDIT_LOG\"\n    fi\ndone\n\necho \"[$(date)] PS-3.4 Audit Complete\" >> \"$AUDIT_LOG\"",
        "ansible": "---\n# PS-3.4 Citizenship Requirements Verification Playbook\n\n- name: PS-3.4 Citizenship Requirements Verification\n  hosts: citizenship_restricted_systems\n  become: yes\n  vars:\n    citizenship_db: /etc/security/citizenship/citizen_registry.csv\n    system_requirements: /etc/security/citizenship/system_requirements.conf\n    audit_log: /var/log/security/ps3_4_audit.log\n\n  tasks:\n    - name: Ensure citizenship directory exists\n      file:\n        path: /etc/security/citizenship\n        state: directory\n        mode: '0750'\n\n    - name: Check for citizenship registry\n      stat:\n        path: \"{{ citizenship_db }}\"\n      register: citizenship_check\n\n    - name: Check for system requirements\n      stat:\n        path: \"{{ system_requirements }}\"\n      register: requirements_check\n\n    - name: Log configuration status\n      lineinfile:\n        path: \"{{ audit_log }}\"\n        line: \"[{{ ansible_date_time.iso8601 }}] Citizenship DB: {{ 'FOUND' if citizenship_check.stat.exists else 'MISSING' }}, Requirements: {{ 'FOUND' if requirements_check.stat.exists else 'MISSING' }}\"\n        create: yes\n\n    - name: Generate PS-3.4 compliance report\n      copy:\n        content: |\n          PS-3.4 Citizenship Requirements Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Define citizenship requirements for restricted information\n          2. Verify citizenship status using authoritative documentation\n          3. Track citizenship verification in personnel records\n          4. Coordinate with export control for ITAR/EAR compliance\n        dest: /etc/security/citizenship/ps3_4_compliance_report.txt\n        mode: '0640'"
      },
      "windows": {
        "powershell": "# PS-3.4 Citizenship Requirements Verification Script\n\n$CitizenshipDB = \"C:\\SecurityPolicies\\Citizenship\\CitizenRegistry.csv\"\n$SystemRequirements = \"C:\\SecurityPolicies\\Citizenship\\SystemRequirements.txt\"\n$AuditLog = \"C:\\SecurityLogs\\PS3_4_Audit.log\"\n\n# Ensure directories exist\n@(\"C:\\SecurityPolicies\\Citizenship\", \"C:\\SecurityLogs\") | ForEach-Object {\n    if (-not (Test-Path $_)) {\n        New-Item -ItemType Directory -Path $_ -Force | Out-Null\n    }\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Status)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $AuditLog -Value \"[$Timestamp] [$Status] $Message\"\n}\n\nWrite-AuditLog \"PS-3.4 Citizenship Requirements Audit Starting\" \"INFO\"\n\n# Load system requirements\nif (-not (Test-Path $SystemRequirements)) {\n    Write-AuditLog \"System citizenship requirements not defined\" \"FAIL\"\n    exit 1\n}\n\n$RequiredCitizenship = Get-Content $SystemRequirements | Where-Object { $_ -notmatch '^#' -and $_ -ne '' } | Select-Object -First 1\nWrite-AuditLog \"System requires: $RequiredCitizenship\" \"INFO\"\n\n# Check for citizenship database\nif (-not (Test-Path $CitizenshipDB)) {\n    Write-AuditLog \"Citizenship registry not found\" \"FAIL\"\n    exit 1\n}\n\n$Citizens = Import-Csv $CitizenshipDB\n\nforeach ($Record in $Citizens) {\n    if ($Record.VerificationStatus -ne 'VERIFIED') {\n        Write-AuditLog \"User $($Record.Username) citizenship not verified (status: $($Record.VerificationStatus))\" \"FAIL\"\n        continue\n    }\n    \n    if ($RequiredCitizenship -match $Record.Citizenship) {\n        Write-AuditLog \"User $($Record.Username) meets citizenship requirement ($($Record.Citizenship), verified $($Record.VerificationDate))\" \"PASS\"\n    } else {\n        Write-AuditLog \"User $($Record.Username) citizenship ($($Record.Citizenship)) does not meet requirement ($RequiredCitizenship)\" \"FAIL\"\n    }\n}\n\nWrite-AuditLog \"PS-3.4 Audit Complete\" \"INFO\"",
        "ansible": "---\n# PS-3.4 Citizenship Requirements Verification Playbook for Windows\n\n- name: PS-3.4 Citizenship Requirements Verification (Windows)\n  hosts: windows_citizenship_restricted\n  vars:\n    citizenship_db: C:\\SecurityPolicies\\Citizenship\\CitizenRegistry.csv\n    system_requirements: C:\\SecurityPolicies\\Citizenship\\SystemRequirements.txt\n    audit_log: C:\\SecurityLogs\\PS3_4_Audit.log\n\n  tasks:\n    - name: Ensure directories exist\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\SecurityPolicies\\Citizenship\n        - C:\\SecurityLogs\n\n    - name: Check for citizenship registry\n      win_stat:\n        path: \"{{ citizenship_db }}\"\n      register: citizenship_check\n\n    - name: Generate PS-3.4 compliance report\n      win_copy:\n        content: |\n          PS-3.4 Citizenship Requirements Compliance Report\n          Generated: {{ ansible_date_time.iso8601 }}\n          Host: {{ inventory_hostname }}\n          \n          Requirements:\n          1. Define citizenship requirements per information type\n          2. Verify citizenship with authoritative documentation\n          3. Track verification status and dates\n          4. Coordinate with export control officers\n        dest: C:\\SecurityPolicies\\Citizenship\\PS3_4_Compliance_Report.txt"
      }
    },
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AC-3",
      "AC-6",
      "PE-2",
      "PS-3",
      "PS-6",
      "SA-4",
      "SA-9"
    ],
    "supplemental_guidance": "Citizenship requirements apply when the information being protected by the system is subject to restrictions regarding access by foreign nationals. Citizenship requirements may be based on statute, regulation, or policy. The specific citizenship requirements and information types to which they apply are defined by the organization based on applicable laws, executive orders, directives, regulations, policies, standards, and guidelines.",
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true,
      "implementation_type": "hybrid"
    },
    "cac_metadata": {
      "implementation_type": "hybrid",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "PS-3(4) requires verification of citizenship for systems with citizenship-restricted information. The provided scripts audit citizenship records against system requirements. Organizations must define specific citizenship requirements based on applicable export control laws (ITAR/EAR) and other regulations."
    }
  },
  {
    "control_id": "PS-4",
    "control_name": "Personnel Termination",
    "family": "Personnel Security",
    "family_id": "PS",
    "official_text": "Upon termination of individual employment: a. Disable system access within [Assignment: organization-defined time period]; b. Terminate or revoke any authenticators and credentials associated with the individual; c. Conduct exit interviews that include a discussion of [Assignment: organization-defined information security topics]; d. Retrieve all security-related organizational system-related property; and e. Retain access to organizational information and systems formerly controlled by terminated individual.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure timely and comprehensive revocation of access and retrieval of organizational assets when employees leave the organization.",
    "rationale": "Personnel termination represents a critical security transition point. Former employees who retain system access pose significant insider threat risks. Timely credential revocation, exit interviews, and property retrieval prevent unauthorized access, data exfiltration, and intellectual property theft. The period immediately following termination, especially terminations for cause, presents elevated risk requiring expedited action.",
    "plain_english_explanation": "When an employee leaves your organization, whether voluntarily or involuntarily, you must immediately disable their ability to access company systems. This includes deactivating user accounts, revoking VPN credentials, disabling badge access, collecting company devices like laptops and phones, retrieving keys and access cards, and conducting an exit interview to remind them of ongoing confidentiality obligations. The organization should retain access to any work product, emails, and files the departing employee created or controlled.",
    "ai_guidance": "Personnel termination requires a coordinated, time-sensitive response involving HR, IT Security, Physical Security, and management. Implement an automated termination workflow that triggers upon HR notification: (1) Immediately disable Active Directory/LDAP accounts - do not delete them, as audit trails must be preserved; (2) Revoke VPN, remote access, and cloud service credentials; (3) Disable badge access and collect physical keys; (4) Remove user from email distribution lists and shared resources; (5) Forward email to manager for business continuity; (6) Retrieve all company-issued equipment with chain of custody documentation; (7) Review and transfer ownership of critical files and projects; (8) Conduct exit interview covering NDAs, non-compete agreements, and ongoing confidentiality requirements; (9) Document all termination actions with timestamps for compliance evidence. For terminations for cause or high-risk departures, execute immediate account lockout BEFORE notification. Integrate with HR Information Systems (HRIS) for automated triggering. Maintain audit logs of all access revocation actions. Consider 'dead man switch' patterns where accounts auto-disable if not explicitly renewed. Federal requirements typically specify same-day or immediate termination of access for high-impact systems.",
    "implementation_guidance": "1. Establish formal termination procedures documented in HR and IT Security policies. 2. Define organization-specific time periods for access termination (recommend: immediate for high-impact, same business day for moderate, within 24 hours for low-impact). 3. Create termination checklist covering all access vectors. 4. Integrate HR system with identity management for automated triggers. 5. Designate exit interview topics: NDA review, non-compete obligations, restricted information handling, social media policies, ongoing legal obligations. 6. Maintain inventory of all assets assigned to personnel. 7. Establish property return procedures with acknowledgment forms. 8. Configure account preservation for legal hold and audit requirements.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-4: Personnel Termination - Manual Trigger Script\n# Run when HR notifies of employee departure\n\nUSERNAME=\"$1\"\nTERMINATION_DATE=$(date +%Y-%m-%d)\nLOG_FILE=\"/var/log/terminations/ps4_${USERNAME}_${TERMINATION_DATE}.log\"\n\nif [ -z \"$USERNAME\" ]; then\n    echo \"Usage: $0 <username>\"\n    exit 1\nfi\n\nmkdir -p /var/log/terminations\n\necho \"[$(date)] PS-4: Initiating termination process for user: $USERNAME\" | tee -a \"$LOG_FILE\"\n\n# Lock the account\nusermod -L \"$USERNAME\" 2>/dev/null && echo \"[$(date)] Account locked\" | tee -a \"$LOG_FILE\"\n\n# Expire the account immediately\nchage -E 0 \"$USERNAME\" 2>/dev/null && echo \"[$(date)] Account expired\" | tee -a \"$LOG_FILE\"\n\n# Lock password\npasswd -l \"$USERNAME\" 2>/dev/null && echo \"[$(date)] Password locked\" | tee -a \"$LOG_FILE\"\n\n# Revoke SSH authorized keys\nif [ -d \"/home/${USERNAME}/.ssh\" ]; then\n    mv \"/home/${USERNAME}/.ssh/authorized_keys\" \"/home/${USERNAME}/.ssh/authorized_keys.disabled.${TERMINATION_DATE}\" 2>/dev/null\n    echo \"[$(date)] SSH keys disabled\" | tee -a \"$LOG_FILE\"\nfi\n\n# Kill active sessions\npkill -KILL -u \"$USERNAME\" 2>/dev/null && echo \"[$(date)] Active sessions terminated\" | tee -a \"$LOG_FILE\"\n\n# Log to syslog for SIEM integration\nlogger -p auth.warning \"PS-4: User $USERNAME terminated. Access disabled per personnel termination policy.\"\n\necho \"[$(date)] PS-4: Termination process complete for $USERNAME\" | tee -a \"$LOG_FILE\"\necho \"Review log: $LOG_FILE\"",
        "ansible": "---\n# PS-4: Personnel Termination Playbook\n- name: PS-4 Personnel Termination\n  hosts: all\n  become: yes\n  vars:\n    terminated_user: \"{{ username }}\"\n    termination_date: \"{{ ansible_date_time.date }}\"\n    log_dir: /var/log/terminations\n\n  tasks:\n    - name: Create termination log directory\n      file:\n        path: \"{{ log_dir }}\"\n        state: directory\n        mode: '0750'\n\n    - name: Lock user account\n      user:\n        name: \"{{ terminated_user }}\"\n        password_lock: yes\n      register: lock_result\n\n    - name: Expire user account immediately\n      command: chage -E 0 {{ terminated_user }}\n      when: lock_result is succeeded\n\n    - name: Disable SSH authorized keys\n      command: mv /home/{{ terminated_user }}/.ssh/authorized_keys /home/{{ terminated_user }}/.ssh/authorized_keys.disabled\n      ignore_errors: yes\n\n    - name: Kill active user sessions\n      command: pkill -KILL -u {{ terminated_user }}\n      ignore_errors: yes\n\n    - name: Log termination action\n      lineinfile:\n        path: \"{{ log_dir }}/ps4_terminations.log\"\n        line: \"{{ ansible_date_time.iso8601 }} - User {{ terminated_user }} terminated on {{ inventory_hostname }}\"\n        create: yes\n\n    - name: Send syslog notification\n      command: logger -p auth.warning \"PS-4: User {{ terminated_user }} access terminated per policy\""
      },
      "windows": {
        "powershell": "# PS-4: Personnel Termination - Active Directory\n# Requires: ActiveDirectory module, appropriate permissions\n\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$Username,\n    [string]$TerminatedOU = \"OU=Terminated Users,DC=domain,DC=com\",\n    [string]$LogPath = \"C:\\Logs\\Terminations\"\n)\n\n$ErrorActionPreference = \"Stop\"\n$TerminationDate = Get-Date -Format \"yyyy-MM-dd\"\n$LogFile = Join-Path $LogPath \"PS4_${Username}_${TerminationDate}.log\"\n\n# Create log directory\nif (-not (Test-Path $LogPath)) {\n    New-Item -ItemType Directory -Path $LogPath -Force | Out-Null\n}\n\nfunction Write-Log {\n    param([string]$Message)\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    \"[$Timestamp] $Message\" | Tee-Object -FilePath $LogFile -Append\n}\n\nImport-Module ActiveDirectory\n\nWrite-Log \"PS-4: Initiating termination for user: $Username\"\n\ntry {\n    $ADUser = Get-ADUser -Identity $Username -Properties MemberOf, HomeDirectory\n    \n    # Disable the account\n    Disable-ADAccount -Identity $Username\n    Write-Log \"Account disabled\"\n    \n    # Reset password to random value\n    $RandomPwd = [System.Web.Security.Membership]::GeneratePassword(32, 8)\n    Set-ADAccountPassword -Identity $Username -NewPassword (ConvertTo-SecureString $RandomPwd -AsPlainText -Force) -Reset\n    Write-Log \"Password reset to random value\"\n    \n    # Set account expiration to today\n    Set-ADAccountExpiration -Identity $Username -DateTime (Get-Date)\n    Write-Log \"Account expiration set\"\n    \n    # Remove from all groups except Domain Users\n    $Groups = Get-ADPrincipalGroupMembership -Identity $Username | Where-Object { $_.Name -ne \"Domain Users\" }\n    foreach ($Group in $Groups) {\n        Remove-ADGroupMember -Identity $Group -Members $Username -Confirm:$false\n        Write-Log \"Removed from group: $($Group.Name)\"\n    }\n    \n    # Move to Terminated Users OU\n    Move-ADObject -Identity $ADUser.DistinguishedName -TargetPath $TerminatedOU\n    Write-Log \"Moved to Terminated Users OU\"\n    \n    # Update description with termination info\n    Set-ADUser -Identity $Username -Description \"TERMINATED: $TerminationDate - Original: $($ADUser.Description)\"\n    Write-Log \"Description updated with termination date\"\n    \n    # Log to Windows Security Event Log\n    Write-EventLog -LogName Security -Source \"Personnel Security\" -EventId 4725 -EntryType Warning -Message \"PS-4: Account $Username disabled due to employment termination\"\n    \n    Write-Log \"PS-4: Termination process complete for $Username\"\n    \n} catch {\n    Write-Log \"ERROR: $($_.Exception.Message)\"\n    throw\n}",
        "ansible": "---\n# PS-4: Personnel Termination - Windows/AD Playbook\n- name: PS-4 Personnel Termination for Active Directory\n  hosts: domain_controllers\n  gather_facts: yes\n  vars:\n    terminated_user: \"{{ username }}\"\n    terminated_ou: \"OU=Terminated Users,DC=domain,DC=com\"\n\n  tasks:\n    - name: Disable AD account\n      win_domain_user:\n        name: \"{{ terminated_user }}\"\n        enabled: no\n        state: present\n\n    - name: Set account expiration\n      win_shell: |\n        Set-ADAccountExpiration -Identity {{ terminated_user }} -DateTime (Get-Date)\n\n    - name: Reset password to random value\n      win_shell: |\n        $pwd = [System.Web.Security.Membership]::GeneratePassword(32,8)\n        Set-ADAccountPassword -Identity {{ terminated_user }} -NewPassword (ConvertTo-SecureString $pwd -AsPlainText -Force) -Reset\n\n    - name: Move to Terminated OU\n      win_shell: |\n        $user = Get-ADUser -Identity {{ terminated_user }}\n        Move-ADObject -Identity $user.DistinguishedName -TargetPath \"{{ terminated_ou }}\"\n\n    - name: Log termination event\n      win_eventlog:\n        log: Security\n        source: Personnel Security\n        event_id: 4725\n        message: \"PS-4: Account {{ terminated_user }} terminated per policy\""
      }
    },
    "related_controls": [
      "AC-2",
      "IA-4",
      "IA-5",
      "PE-2",
      "PM-12",
      "PS-5",
      "PS-6",
      "PS-7"
    ],
    "enhancements": [
      {
        "id": "PS-4.1",
        "title": "Post-employment Requirements"
      },
      {
        "id": "PS-4.2",
        "title": "Automated Actions"
      }
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true
    }
  },
  {
    "control_id": "PS-4.1",
    "control_name": "Post-employment Requirements",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-4",
    "official_text": "a. Notify terminated individuals of applicable, legally binding post-employment requirements for the protection of organizational information; and b. Require terminated individuals to sign an acknowledgment of post-employment requirements as part of the organizational termination process.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure departing employees formally acknowledge continuing legal obligations to protect organizational information after employment ends.",
    "rationale": "Post-employment requirements create legally enforceable obligations that extend security protections beyond the employment relationship. Signed acknowledgments provide documented evidence that individuals were informed of their ongoing responsibilities, supporting potential legal action if violations occur. This is particularly critical for employees who had access to trade secrets, classified information, or sensitive business data.",
    "plain_english_explanation": "Before an employee leaves, they must be reminded of any legal obligations that continue after they are gone. This includes non-disclosure agreements, non-compete clauses, and restrictions on using proprietary information at future employers. The departing employee must sign a document confirming they understand these ongoing requirements. This creates a paper trail showing the organization properly informed them of their continuing obligations.",
    "ai_guidance": "Post-employment requirements establish a legal framework for ongoing information protection after the employment relationship ends. Organizations should: (1) Maintain a repository of all agreements signed during onboarding and employment that contain post-employment clauses; (2) Conduct a comprehensive exit interview that explicitly reviews each applicable agreement and restriction; (3) Provide departing employees with copies of all binding agreements and a summary document outlining specific restrictions; (4) Cover key topics including: confidentiality of proprietary information, trade secret protection, non-solicitation of employees/customers, non-compete geographic and temporal scope, return of all organizational property and information, prohibition on retaining copies of work product, social media and public statement restrictions, ongoing cooperation obligations, and consequences of violations; (5) Require signature on acknowledgment form with witness; (6) For employees with access to classified or highly sensitive information, coordinate with legal counsel and potentially government security officials; (7) Retain signed acknowledgments in personnel files for duration specified by legal requirements (typically 7+ years); (8) Consider providing written notice of post-employment restrictions to known future employers where legally permissible. The exit documentation serves as critical evidence in any subsequent litigation.",
    "implementation_guidance": "1. Develop standardized post-employment acknowledgment form reviewed by legal counsel. 2. Create checklist of agreements to review during exit interview based on employee role and access levels. 3. Train HR personnel on conducting thorough exit briefings. 4. Establish secure storage for signed acknowledgments. 5. Define retention periods aligned with statute of limitations for breach claims. 6. Integrate acknowledgment requirement into termination workflow - termination not complete until signed. 7. Have contingency process for situations where employee refuses to sign or abandons job. 8. Consult Office of General Counsel on specific post-employment requirements applicable to organization.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "related_controls": [
      "PS-4",
      "PS-6",
      "PS-6.3",
      "SA-9"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": false
    }
  },
  {
    "control_id": "PS-4.2",
    "control_name": "Automated Actions",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-4",
    "official_text": "Use [Assignment: organization-defined automated mechanisms] to [Selection (one or more): notify [Assignment: organization-defined personnel or roles] of individual termination actions; disable access to system resources].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": true
    },
    "is_technical": true,
    "stig_id": "SRG-OS-000002-GPOS-00002",
    "intent": "Automate personnel termination actions to ensure immediate, consistent, and auditable access revocation without human delay or error.",
    "rationale": "Manual termination processes introduce delays and errors that create security vulnerabilities. The window between termination decision and access revocation represents elevated risk, especially for involuntary terminations or terminations for cause. Automated mechanisms ensure instantaneous action, eliminate human oversight, provide comprehensive coverage across all systems, and generate audit trails. High-baseline systems require this control because the consequences of delayed access revocation are most severe.",
    "plain_english_explanation": "When someone is terminated, automated systems should immediately kick in to disable their access everywhere - no waiting for IT tickets or manual processes. The system should automatically lock their accounts, revoke their credentials, notify security personnel, and log everything. This happens the moment HR marks someone as terminated, without any human having to remember to do each step. For high-security environments, you cannot rely on people remembering to disable accounts.",
    "ai_guidance": "Automated termination actions require integration between Human Resources Information Systems (HRIS), Identity and Access Management (IAM), and security monitoring systems. Implementation architecture should include: (1) HR System Integration - Configure HRIS to emit termination events via API, message queue, or database triggers when employee status changes to terminated; (2) Identity Orchestration - Deploy identity governance platform that consumes termination events and orchestrates downstream actions across all connected systems (Active Directory, cloud IAM, application databases, physical access control); (3) Automated Workflows - Implement termination workflow that executes in sequence: lock primary directory account, propagate disable to federated systems via SCIM/SAML deprovisioning, revoke OAuth tokens and API keys, disable VPN certificates, trigger badge deactivation in physical access control system, remove from email distribution lists, archive mailbox; (4) Notification System - Configure automated alerts to security operations, IT management, and relevant business owners when termination workflow executes; (5) Audit Logging - Capture timestamped evidence of every automated action for compliance reporting; (6) Fallback Processing - Implement batch job to catch any systems not integrated in real-time workflow; (7) Monitoring - Alert on termination workflow failures requiring manual intervention; (8) Testing - Regularly test automated termination with non-production accounts to verify all integrations function correctly. Consider integration with SIEM for correlation of termination events with any subsequent access attempts.",
    "implementation_guidance": "1. Deploy Identity Governance and Administration (IGA) platform with HR connector. 2. Configure HR system to publish termination events. 3. Map all systems requiring access termination. 4. Build automated workflow for each system type. 5. Implement notification to Security Operations Center. 6. Create dashboard for termination status monitoring. 7. Establish SLA for automated termination completion (target: <15 minutes). 8. Configure exception handling and manual override procedures. 9. Test automation quarterly with controlled test accounts. 10. Maintain integration documentation for each connected system.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-4.2: Automated Personnel Termination via HR Feed Integration\n# Runs as scheduled job or triggered by HR system webhook\n\nset -euo pipefail\n\nHR_FEED_FILE=\"/var/hr/terminated_users.txt\"\nPROCESSED_FILE=\"/var/hr/processed_terminations.txt\"\nLOG_FILE=\"/var/log/ps42_automation.log\"\nNOTIFY_EMAIL=\"security-ops@organization.com\"\nSLACK_WEBHOOK=\"https://hooks.slack.com/services/xxx/yyy/zzz\"\n\nlog_action() {\n    echo \"[$(date '+%Y-%m-%d %H:%M:%S')] $1\" | tee -a \"$LOG_FILE\"\n    logger -p auth.notice \"PS-4.2: $1\"\n}\n\nsend_notification() {\n    local message=\"$1\"\n    # Email notification\n    echo \"$message\" | mail -s \"PS-4.2 Automated Termination Alert\" \"$NOTIFY_EMAIL\" 2>/dev/null || true\n    # Slack notification (if configured)\n    if [ -n \"$SLACK_WEBHOOK\" ]; then\n        curl -s -X POST -H 'Content-type: application/json' \\\n            --data \"{\\\"text\\\":\\\"$message\\\"}\" \"$SLACK_WEBHOOK\" 2>/dev/null || true\n    fi\n}\n\ndisable_user_account() {\n    local username=\"$1\"\n    local actions_taken=\"\"\n    \n    # Check if user exists\n    if ! id \"$username\" &>/dev/null; then\n        log_action \"User $username does not exist on this system\"\n        return 0\n    fi\n    \n    # Lock account\n    if usermod -L \"$username\" 2>/dev/null; then\n        actions_taken+=\"account_locked \"\n    fi\n    \n    # Lock password\n    if passwd -l \"$username\" 2>/dev/null; then\n        actions_taken+=\"password_locked \"\n    fi\n    \n    # Expire account immediately\n    if chage -E 0 \"$username\" 2>/dev/null; then\n        actions_taken+=\"account_expired \"\n    fi\n    \n    # Disable SSH access\n    local ssh_dir=\"/home/${username}/.ssh\"\n    if [ -f \"${ssh_dir}/authorized_keys\" ]; then\n        mv \"${ssh_dir}/authorized_keys\" \"${ssh_dir}/authorized_keys.disabled.$(date +%s)\" 2>/dev/null\n        actions_taken+=\"ssh_keys_disabled \"\n    fi\n    \n    # Revoke any active sudo sessions\n    if [ -f \"/var/run/sudo/ts/${username}\" ]; then\n        rm -f \"/var/run/sudo/ts/${username}\" 2>/dev/null\n        actions_taken+=\"sudo_session_revoked \"\n    fi\n    \n    # Kill all active processes\n    if pkill -KILL -u \"$username\" 2>/dev/null; then\n        actions_taken+=\"processes_killed \"\n    fi\n    \n    # Revoke cron jobs\n    if crontab -u \"$username\" -r 2>/dev/null; then\n        actions_taken+=\"crontab_removed \"\n    fi\n    \n    log_action \"User $username disabled: $actions_taken\"\n    return 0\n}\n\n# Main processing loop\nlog_action \"PS-4.2 Automated termination process started\"\n\nif [ ! -f \"$HR_FEED_FILE\" ]; then\n    log_action \"No HR feed file found at $HR_FEED_FILE\"\n    exit 0\nfi\n\ntouch \"$PROCESSED_FILE\"\ntermination_count=0\n\nwhile IFS=, read -r username termination_date department || [ -n \"$username\" ]; do\n    # Skip empty lines and headers\n    [ -z \"$username\" ] && continue\n    [[ \"$username\" =~ ^#.*$ ]] && continue\n    [[ \"$username\" =~ ^username.*$ ]] && continue\n    \n    # Check if already processed\n    if grep -qx \"$username\" \"$PROCESSED_FILE\" 2>/dev/null; then\n        continue\n    fi\n    \n    log_action \"Processing termination for: $username (Department: ${department:-unknown})\"\n    \n    if disable_user_account \"$username\"; then\n        echo \"$username\" >> \"$PROCESSED_FILE\"\n        ((termination_count++))\n        send_notification \"PS-4.2 ALERT: User $username access automatically disabled due to employment termination.\"\n    else\n        log_action \"ERROR: Failed to disable user $username\"\n        send_notification \"PS-4.2 ERROR: Failed to disable user $username - manual intervention required\"\n    fi\n    \ndone < \"$HR_FEED_FILE\"\n\nlog_action \"PS-4.2 Automated termination complete. $termination_count users processed.\"\n\n# Archive processed feed\nif [ $termination_count -gt 0 ]; then\n    mv \"$HR_FEED_FILE\" \"/var/hr/archive/terminated_$(date +%Y%m%d_%H%M%S).txt\" 2>/dev/null || true\nfi",
        "ansible": "---\n# PS-4.2: Automated Personnel Termination Playbook\n# Designed for integration with HR systems via AWX/Tower\n- name: PS-4.2 Automated Termination Actions\n  hosts: all\n  become: yes\n  vars:\n    terminated_users_api: \"https://hr.organization.com/api/terminations\"\n    notification_email: \"security-ops@organization.com\"\n    log_dir: \"/var/log/ps42\"\n    archive_dir: \"/var/hr/archive\"\n\n  tasks:\n    - name: Create logging directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n      loop:\n        - \"{{ log_dir }}\"\n        - \"{{ archive_dir }}\"\n\n    - name: Fetch terminated users from HR API\n      uri:\n        url: \"{{ terminated_users_api }}\"\n        method: GET\n        headers:\n          Authorization: \"Bearer {{ hr_api_token }}\"\n        return_content: yes\n      register: hr_response\n      delegate_to: localhost\n      run_once: yes\n\n    - name: Process each terminated user\n      include_tasks: disable_user.yml\n      loop: \"{{ hr_response.json.terminated_users | default([]) }}\"\n      loop_control:\n        loop_var: terminated_user\n\n# disable_user.yml - included task file\n---\n- name: Check if user exists\n  getent:\n    database: passwd\n    key: \"{{ terminated_user.username }}\"\n  register: user_exists\n  ignore_errors: yes\n\n- name: Lock user account\n  user:\n    name: \"{{ terminated_user.username }}\"\n    password_lock: yes\n  when: user_exists is succeeded\n  register: lock_result\n\n- name: Expire account immediately\n  command: chage -E 0 {{ terminated_user.username }}\n  when: user_exists is succeeded\n\n- name: Disable SSH authorized keys\n  shell: |\n    if [ -f /home/{{ terminated_user.username }}/.ssh/authorized_keys ]; then\n      mv /home/{{ terminated_user.username }}/.ssh/authorized_keys \\\n         /home/{{ terminated_user.username }}/.ssh/authorized_keys.disabled.$(date +%s)\n    fi\n  when: user_exists is succeeded\n  ignore_errors: yes\n\n- name: Kill user processes\n  command: pkill -KILL -u {{ terminated_user.username }}\n  when: user_exists is succeeded\n  ignore_errors: yes\n\n- name: Remove user crontab\n  command: crontab -u {{ terminated_user.username }} -r\n  when: user_exists is succeeded\n  ignore_errors: yes\n\n- name: Log termination action\n  lineinfile:\n    path: \"{{ log_dir }}/ps42_audit.log\"\n    line: \"{{ ansible_date_time.iso8601 }} | {{ inventory_hostname }} | {{ terminated_user.username }} | DISABLED | Automated PS-4.2 action\"\n    create: yes\n  when: lock_result is succeeded\n\n- name: Send syslog notification\n  command: logger -p auth.warning \"PS-4.2: Automated termination - User {{ terminated_user.username }} disabled\"\n  when: user_exists is succeeded"
      },
      "windows": {
        "powershell": "# PS-4.2: Automated Personnel Termination for Active Directory\n# Integrates with HR system feed for immediate account termination\n# Schedule via Task Scheduler or trigger via HR webhook\n\n#Requires -Modules ActiveDirectory\n#Requires -RunAsAdministrator\n\nparam(\n    [string]$HRFeedPath = \"\\\\hr-server\\feeds\\terminated_users.csv\",\n    [string]$TerminatedOU = \"OU=Terminated Users,OU=Disabled,DC=domain,DC=com\",\n    [string]$LogPath = \"C:\\Logs\\PS42\",\n    [string]$ArchivePath = \"C:\\Logs\\PS42\\Archive\",\n    [string[]]$NotifyEmails = @(\"security-ops@organization.com\", \"it-helpdesk@organization.com\"),\n    [string]$SmtpServer = \"smtp.organization.com\"\n)\n\n$ErrorActionPreference = \"Continue\"\n$ProcessedFile = Join-Path $LogPath \"processed_terminations.txt\"\n$AuditLog = Join-Path $LogPath \"ps42_audit_$(Get-Date -Format 'yyyyMMdd').log\"\n\n# Initialize logging\nif (-not (Test-Path $LogPath)) { New-Item -ItemType Directory -Path $LogPath -Force | Out-Null }\nif (-not (Test-Path $ArchivePath)) { New-Item -ItemType Directory -Path $ArchivePath -Force | Out-Null }\nif (-not (Test-Path $ProcessedFile)) { New-Item -ItemType File -Path $ProcessedFile -Force | Out-Null }\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Level = \"INFO\")\n    $Timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    $LogEntry = \"[$Timestamp] [$Level] $Message\"\n    Add-Content -Path $AuditLog -Value $LogEntry\n    Write-Host $LogEntry\n}\n\nfunction Send-TerminationNotification {\n    param(\n        [string]$Username,\n        [string]$Status,\n        [string]$Details\n    )\n    \n    $Subject = \"PS-4.2 Automated Termination Alert: $Username\"\n    $Body = @\"\nPS-4.2 Automated Personnel Termination Notification\n\nUsername: $Username\nStatus: $Status\nTimestamp: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')\nServer: $env:COMPUTERNAME\n\nDetails:\n$Details\n\nThis is an automated security notification.\n\"@\n    \n    try {\n        foreach ($Email in $NotifyEmails) {\n            Send-MailMessage -To $Email -From \"ps42-automation@organization.com\" `\n                -Subject $Subject -Body $Body -SmtpServer $SmtpServer -Priority High\n        }\n        Write-AuditLog \"Notification sent for $Username\"\n    } catch {\n        Write-AuditLog \"Failed to send notification: $($_.Exception.Message)\" \"ERROR\"\n    }\n}\n\nfunction Disable-TerminatedUser {\n    param([string]$Username)\n    \n    $ActionsTaken = @()\n    \n    try {\n        $ADUser = Get-ADUser -Identity $Username -Properties MemberOf, HomeDirectory, EmailAddress, Description -ErrorAction Stop\n    } catch {\n        Write-AuditLog \"User $Username not found in AD\" \"WARNING\"\n        return $false\n    }\n    \n    try {\n        # 1. Disable account immediately\n        Disable-ADAccount -Identity $Username\n        $ActionsTaken += \"Account disabled\"\n        \n        # 2. Reset password to random complex value\n        Add-Type -AssemblyName System.Web\n        $RandomPwd = [System.Web.Security.Membership]::GeneratePassword(32, 10)\n        Set-ADAccountPassword -Identity $Username -NewPassword (ConvertTo-SecureString $RandomPwd -AsPlainText -Force) -Reset\n        $ActionsTaken += \"Password randomized\"\n        \n        # 3. Set account to expire now\n        Set-ADAccountExpiration -Identity $Username -DateTime (Get-Date)\n        $ActionsTaken += \"Account expired\"\n        \n        # 4. Clear manager to prevent delegation attacks\n        Set-ADUser -Identity $Username -Manager $null\n        $ActionsTaken += \"Manager cleared\"\n        \n        # 5. Remove from all groups except Domain Users\n        $Groups = Get-ADPrincipalGroupMembership -Identity $Username | Where-Object { $_.Name -ne \"Domain Users\" }\n        foreach ($Group in $Groups) {\n            Remove-ADGroupMember -Identity $Group -Members $Username -Confirm:$false -ErrorAction SilentlyContinue\n            $ActionsTaken += \"Removed from: $($Group.Name)\"\n        }\n        \n        # 6. Hide from Global Address List\n        Set-ADUser -Identity $Username -Replace @{msExchHideFromAddressLists=$true} -ErrorAction SilentlyContinue\n        $ActionsTaken += \"Hidden from GAL\"\n        \n        # 7. Update description with termination info\n        $NewDescription = \"TERMINATED: $(Get-Date -Format 'yyyy-MM-dd HH:mm') | PS-4.2 Automated | Original: $($ADUser.Description)\"\n        Set-ADUser -Identity $Username -Description $NewDescription\n        $ActionsTaken += \"Description updated\"\n        \n        # 8. Move to Terminated OU\n        Move-ADObject -Identity $ADUser.DistinguishedName -TargetPath $TerminatedOU\n        $ActionsTaken += \"Moved to Terminated OU\"\n        \n        # 9. Log to Windows Security Event Log\n        $EventMessage = \"PS-4.2 Automated Termination: Account $Username disabled. Actions: $($ActionsTaken -join ', ')\"\n        Write-EventLog -LogName Security -Source \"PS-4.2 Automation\" -EventId 4725 -EntryType Warning -Message $EventMessage -ErrorAction SilentlyContinue\n        \n        Write-AuditLog \"Successfully disabled $Username. Actions: $($ActionsTaken -join ', ')\"\n        Send-TerminationNotification -Username $Username -Status \"SUCCESS\" -Details ($ActionsTaken -join \"`n\")\n        \n        return $true\n        \n    } catch {\n        Write-AuditLog \"Error disabling $Username : $($_.Exception.Message)\" \"ERROR\"\n        Send-TerminationNotification -Username $Username -Status \"FAILED\" -Details $_.Exception.Message\n        return $false\n    }\n}\n\n# Main execution\nWrite-AuditLog \"PS-4.2 Automated termination process started\"\nWrite-AuditLog \"Reading HR feed from: $HRFeedPath\"\n\nif (-not (Test-Path $HRFeedPath)) {\n    Write-AuditLog \"HR feed file not found: $HRFeedPath\" \"WARNING\"\n    exit 0\n}\n\n$ProcessedUsers = Get-Content $ProcessedFile -ErrorAction SilentlyContinue\n$TerminatedUsers = Import-Csv $HRFeedPath\n$ProcessedCount = 0\n$FailedCount = 0\n\nforeach ($User in $TerminatedUsers) {\n    $Username = $User.SamAccountName\n    \n    if ([string]::IsNullOrWhiteSpace($Username)) { continue }\n    if ($ProcessedUsers -contains $Username) {\n        Write-AuditLog \"User $Username already processed, skipping\" \"DEBUG\"\n        continue\n    }\n    \n    Write-AuditLog \"Processing termination for: $Username (Dept: $($User.Department), Manager: $($User.Manager))\"\n    \n    if (Disable-TerminatedUser -Username $Username) {\n        Add-Content -Path $ProcessedFile -Value $Username\n        $ProcessedCount++\n    } else {\n        $FailedCount++\n    }\n}\n\n# Archive processed feed\nif ($ProcessedCount -gt 0) {\n    $ArchiveFile = Join-Path $ArchivePath \"terminated_$(Get-Date -Format 'yyyyMMdd_HHmmss').csv\"\n    Move-Item -Path $HRFeedPath -Destination $ArchiveFile -ErrorAction SilentlyContinue\n    Write-AuditLog \"HR feed archived to: $ArchiveFile\"\n}\n\nWrite-AuditLog \"PS-4.2 process complete. Processed: $ProcessedCount, Failed: $FailedCount\"\n\nif ($FailedCount -gt 0) {\n    exit 1\n}",
        "ansible": "---\n# PS-4.2: Automated Personnel Termination - Windows/AD\n# For use with AWX/Tower triggered by HR system\n- name: PS-4.2 Automated AD Termination\n  hosts: domain_controllers[0]\n  gather_facts: yes\n  vars:\n    hr_api_url: \"https://hr.organization.com/api/terminations\"\n    terminated_ou: \"OU=Terminated Users,OU=Disabled,DC=domain,DC=com\"\n    log_path: \"C:\\\\Logs\\\\PS42\"\n    notify_email: \"security-ops@organization.com\"\n\n  tasks:\n    - name: Create log directory\n      win_file:\n        path: \"{{ log_path }}\"\n        state: directory\n\n    - name: Fetch terminated users from HR API\n      uri:\n        url: \"{{ hr_api_url }}\"\n        method: GET\n        headers:\n          Authorization: \"Bearer {{ hr_api_token }}\"\n        return_content: yes\n        validate_certs: yes\n      register: hr_response\n      delegate_to: localhost\n\n    - name: Process terminations\n      win_shell: |\n        Import-Module ActiveDirectory\n        \n        $Username = '{{ item.samaccountname }}'\n        $TerminatedOU = '{{ terminated_ou }}'\n        $LogFile = '{{ log_path }}\\ps42_audit.log'\n        \n        function Log-Action { param($Msg) Add-Content -Path $LogFile -Value \"$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') | $Msg\" }\n        \n        try {\n            $User = Get-ADUser -Identity $Username -Properties MemberOf -ErrorAction Stop\n            \n            # Disable account\n            Disable-ADAccount -Identity $Username\n            Log-Action \"$Username - Account disabled\"\n            \n            # Reset password\n            Add-Type -AssemblyName System.Web\n            $Pwd = [System.Web.Security.Membership]::GeneratePassword(32,10)\n            Set-ADAccountPassword -Identity $Username -NewPassword (ConvertTo-SecureString $Pwd -AsPlainText -Force) -Reset\n            Log-Action \"$Username - Password reset\"\n            \n            # Expire account\n            Set-ADAccountExpiration -Identity $Username -DateTime (Get-Date)\n            Log-Action \"$Username - Account expired\"\n            \n            # Remove from groups\n            $Groups = Get-ADPrincipalGroupMembership -Identity $Username | Where-Object { $_.Name -ne 'Domain Users' }\n            foreach ($Group in $Groups) {\n                Remove-ADGroupMember -Identity $Group -Members $Username -Confirm:$false -ErrorAction SilentlyContinue\n            }\n            Log-Action \"$Username - Removed from $($Groups.Count) groups\"\n            \n            # Move to Terminated OU\n            Move-ADObject -Identity $User.DistinguishedName -TargetPath $TerminatedOU\n            Log-Action \"$Username - Moved to Terminated OU\"\n            \n            # Update description\n            Set-ADUser -Identity $Username -Description \"TERMINATED: $(Get-Date -Format 'yyyy-MM-dd') - PS-4.2 Automated\"\n            \n            Write-Output \"SUCCESS: $Username terminated\"\n            \n        } catch {\n            Log-Action \"$Username - ERROR: $($_.Exception.Message)\"\n            Write-Output \"FAILED: $Username - $($_.Exception.Message)\"\n        }\n      loop: \"{{ hr_response.json.terminated_users | default([]) }}\"\n      register: termination_results\n\n    - name: Send summary notification\n      win_shell: |\n        $Results = @'\n        {{ termination_results.results | map(attribute='stdout') | join('\\n') }}\n        '@\n        \n        Send-MailMessage -To '{{ notify_email }}' `\n            -From 'ps42-automation@organization.com' `\n            -Subject 'PS-4.2 Automated Termination Summary' `\n            -Body \"PS-4.2 Automated Termination Results:`n`n$Results\" `\n            -SmtpServer 'smtp.organization.com'"
      }
    },
    "related_controls": [
      "AC-2",
      "AC-2.4",
      "IA-4",
      "IA-5",
      "PE-2",
      "PS-4"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true
    }
  },
  {
    "control_id": "PS-5",
    "control_name": "Personnel Transfer",
    "family": "Personnel Security",
    "family_id": "PS",
    "official_text": "a. Review and confirm ongoing operational need for current logical and physical access authorizations to systems and facilities when individuals are reassigned or transferred to other positions within the organization; b. Initiate [Assignment: organization-defined transfer or reassignment actions] within [Assignment: organization-defined time period following the formal transfer action]; c. Modify access authorization as needed to correspond with any changes in operational need due to reassignment or transfer; and d. Notify [Assignment: organization-defined personnel or roles] within [Assignment: organization-defined time period].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure access authorizations are promptly reviewed and adjusted when personnel change roles within the organization to prevent privilege accumulation and maintain least privilege.",
    "rationale": "Personnel transfers create security risks when individuals retain access from previous roles while gaining access for new roles, leading to privilege accumulation that violates least privilege principles. Former access may no longer be needed and could enable unauthorized actions. Timely access review ensures individuals have only the access required for their current responsibilities. This is especially critical for transfers between departments with different security domains or sensitivity levels.",
    "plain_english_explanation": "When an employee changes jobs within your organization - whether a promotion, lateral move, or departmental transfer - you must review all their system access. They might no longer need access to systems from their old job, and they might need new access for their new role. Without this review, people accumulate more and more access over time, eventually having far more permissions than they need. The review should happen quickly after the transfer is official, access should be adjusted to match the new role exactly, and relevant people should be notified.",
    "ai_guidance": "Personnel transfers require a systematic access recertification process to maintain security posture. Organizations should implement: (1) Transfer Event Detection - Integrate with HR systems to detect position changes, reporting line updates, and department transfers automatically; (2) Access Inventory Review - Upon transfer notification, generate complete inventory of individual's current access: AD group memberships, application roles, file share permissions, badge access zones, VPN profiles, cloud service entitlements; (3) Role-Based Analysis - Compare current access against access profiles defined for new position; identify access to remove, access to retain, and access to add; (4) Manager Certification - Route access review to both former and new managers for certification; former manager confirms access to revoke, new manager confirms access to retain and add; (5) Timely Execution - Define SLAs for transfer actions (recommend: initiate within 24 hours of effective date, complete within 5 business days); (6) Segregation of Duties Check - Verify new access combination does not create SoD conflicts with retained access; (7) Badge Access Review - Physical access zones often overlooked; ensure badge access matches new work location and responsibilities; (8) Notification Chain - Notify IT Security, Physical Security, relevant system owners, and compliance team of transfer and access changes; (9) Audit Documentation - Maintain records of transfer date, access before, access after, certifying managers, and execution timestamps; (10) Monitoring Period - Consider enhanced monitoring for transferred personnel during transition period, particularly for privileged access.",
    "implementation_guidance": "1. Establish HR notification workflow to alert IT Security of all transfers. 2. Define organization-specific time periods: 24-48 hours to initiate, 5 business days to complete. 3. Create access review templates comparing old role to new role access requirements. 4. Implement manager certification process for access changes. 5. Define notification list: IT Security, Physical Security, system owners, compliance. 6. Establish procedures for credential reissuance if needed (new badge, updated VPN profile). 7. Document transfer actions including former access, new access, and approval chain. 8. Configure identity governance system to flag transfers for review. 9. Establish expedited process for sensitive transfers (to/from privileged roles).",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-5: Personnel Transfer Access Review Script\n# Generates access inventory report for transfer review\n\nUSERNAME=\"$1\"\nOUTPUT_DIR=\"/var/reports/transfers\"\nREPORT_DATE=$(date +%Y-%m-%d)\nREPORT_FILE=\"${OUTPUT_DIR}/ps5_${USERNAME}_${REPORT_DATE}.txt\"\n\nif [ -z \"$USERNAME\" ]; then\n    echo \"Usage: $0 <username>\"\n    exit 1\nfi\n\nmkdir -p \"$OUTPUT_DIR\"\n\necho \"PS-5 Personnel Transfer Access Review Report\" > \"$REPORT_FILE\"\necho \"============================================\" >> \"$REPORT_FILE\"\necho \"Username: $USERNAME\" >> \"$REPORT_FILE\"\necho \"Report Date: $REPORT_DATE\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# User account info\necho \"=== USER ACCOUNT INFORMATION ===\" >> \"$REPORT_FILE\"\ngetent passwd \"$USERNAME\" >> \"$REPORT_FILE\" 2>&1\necho \"\" >> \"$REPORT_FILE\"\n\n# Group memberships\necho \"=== GROUP MEMBERSHIPS ===\" >> \"$REPORT_FILE\"\ngroups \"$USERNAME\" 2>/dev/null >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\necho \"Secondary groups:\" >> \"$REPORT_FILE\"\nid \"$USERNAME\" 2>/dev/null >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# Sudo access\necho \"=== SUDO ACCESS ===\" >> \"$REPORT_FILE\"\nif [ -f \"/etc/sudoers.d/${USERNAME}\" ]; then\n    cat \"/etc/sudoers.d/${USERNAME}\" >> \"$REPORT_FILE\"\nelse\n    echo \"No user-specific sudoers file\" >> \"$REPORT_FILE\"\nfi\ngrep -h \"$USERNAME\" /etc/sudoers /etc/sudoers.d/* 2>/dev/null >> \"$REPORT_FILE\" || echo \"No sudo entries found\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# SSH authorized keys\necho \"=== SSH AUTHORIZED KEYS ===\" >> \"$REPORT_FILE\"\nif [ -f \"/home/${USERNAME}/.ssh/authorized_keys\" ]; then\n    wc -l \"/home/${USERNAME}/.ssh/authorized_keys\" >> \"$REPORT_FILE\"\n    cat \"/home/${USERNAME}/.ssh/authorized_keys\" >> \"$REPORT_FILE\"\nelse\n    echo \"No authorized_keys file\" >> \"$REPORT_FILE\"\nfi\necho \"\" >> \"$REPORT_FILE\"\n\n# Cron jobs\necho \"=== SCHEDULED JOBS ===\" >> \"$REPORT_FILE\"\ncrontab -u \"$USERNAME\" -l 2>/dev/null >> \"$REPORT_FILE\" || echo \"No crontab\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# Home directory permissions\necho \"=== HOME DIRECTORY ===\" >> \"$REPORT_FILE\"\nls -la \"/home/${USERNAME}\" 2>/dev/null | head -20 >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# Last login info\necho \"=== LAST LOGIN ACTIVITY ===\" >> \"$REPORT_FILE\"\nlastlog -u \"$USERNAME\" 2>/dev/null >> \"$REPORT_FILE\"\nlast -n 10 \"$USERNAME\" 2>/dev/null >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\necho \"=== ACTION REQUIRED ===\" >> \"$REPORT_FILE\"\necho \"1. Review all group memberships - remove groups not needed for new role\" >> \"$REPORT_FILE\"\necho \"2. Review sudo access - modify or remove as appropriate\" >> \"$REPORT_FILE\"\necho \"3. Review SSH keys - reissue if needed for new role\" >> \"$REPORT_FILE\"\necho \"4. Certify access changes with new manager\" >> \"$REPORT_FILE\"\necho \"5. Document transfer actions taken\" >> \"$REPORT_FILE\"\n\necho \"Report generated: $REPORT_FILE\"\nlogger -p auth.info \"PS-5: Transfer access review initiated for $USERNAME\"",
        "ansible": "---\n# PS-5: Personnel Transfer Access Review Playbook\n- name: PS-5 Personnel Transfer Access Review\n  hosts: all\n  become: yes\n  vars:\n    transferred_user: \"{{ username }}\"\n    report_dir: /var/reports/transfers\n\n  tasks:\n    - name: Create report directory\n      file:\n        path: \"{{ report_dir }}\"\n        state: directory\n        mode: '0750'\n\n    - name: Get user info\n      getent:\n        database: passwd\n        key: \"{{ transferred_user }}\"\n      register: user_info\n      ignore_errors: yes\n\n    - name: Get group memberships\n      command: groups {{ transferred_user }}\n      register: group_membership\n      when: user_info is succeeded\n\n    - name: Get detailed user ID info\n      command: id {{ transferred_user }}\n      register: id_info\n      when: user_info is succeeded\n\n    - name: Check sudo access\n      shell: grep -h {{ transferred_user }} /etc/sudoers /etc/sudoers.d/* 2>/dev/null || echo 'None'\n      register: sudo_access\n\n    - name: Check SSH authorized keys\n      stat:\n        path: /home/{{ transferred_user }}/.ssh/authorized_keys\n      register: ssh_keys\n\n    - name: Generate transfer review report\n      template:\n        src: ps5_transfer_report.j2\n        dest: \"{{ report_dir }}/ps5_{{ transferred_user }}_{{ ansible_date_time.date }}.txt\"\n        mode: '0640'\n\n    - name: Log transfer review\n      command: logger -p auth.info \"PS-5: Transfer access review for {{ transferred_user }} on {{ inventory_hostname }}\""
      },
      "windows": {
        "powershell": "# PS-5: Personnel Transfer Access Review for Active Directory\n# Generates comprehensive access report for transfer review\n\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$Username,\n    [string]$NewPosition = \"Not Specified\",\n    [string]$NewDepartment = \"Not Specified\",\n    [string]$ReportPath = \"C:\\Reports\\Transfers\"\n)\n\n$ErrorActionPreference = \"Continue\"\nImport-Module ActiveDirectory\n\n$ReportDate = Get-Date -Format \"yyyy-MM-dd\"\n$ReportFile = Join-Path $ReportPath \"PS5_${Username}_${ReportDate}.html\"\n\nif (-not (Test-Path $ReportPath)) {\n    New-Item -ItemType Directory -Path $ReportPath -Force | Out-Null\n}\n\n# Collect access information\n$ADUser = Get-ADUser -Identity $Username -Properties *\n$Groups = Get-ADPrincipalGroupMembership -Identity $Username\n$DirectReports = Get-ADUser -Filter \"Manager -eq '$($ADUser.DistinguishedName)'\" -Properties DisplayName\n\n# Check for privileged access\n$PrivilegedGroups = $Groups | Where-Object { \n    $_.Name -match \"Admin|Privileged|Domain Admins|Enterprise Admins|Schema Admins\" \n}\n\n# Build HTML report\n$Html = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <title>PS-5 Personnel Transfer Access Review - $Username</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        h1 { color: #333; }\n        h2 { color: #666; border-bottom: 1px solid #ccc; }\n        table { border-collapse: collapse; width: 100%; margin: 10px 0; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #4472C4; color: white; }\n        .warning { background-color: #FFF3CD; }\n        .danger { background-color: #F8D7DA; }\n        .action { background-color: #E7F3FF; padding: 15px; margin: 10px 0; }\n    </style>\n</head>\n<body>\n    <h1>PS-5 Personnel Transfer Access Review</h1>\n    <p><strong>Report Date:</strong> $ReportDate</p>\n    <p><strong>Username:</strong> $Username</p>\n    <p><strong>Display Name:</strong> $($ADUser.DisplayName)</p>\n    <p><strong>Current Department:</strong> $($ADUser.Department)</p>\n    <p><strong>Current Title:</strong> $($ADUser.Title)</p>\n    <p><strong>New Position:</strong> $NewPosition</p>\n    <p><strong>New Department:</strong> $NewDepartment</p>\n    \n    <h2>Group Memberships ($($Groups.Count) total)</h2>\n    <table>\n        <tr><th>Group Name</th><th>Category</th><th>Scope</th><th>Review Action</th></tr>\n\"@\n\nforeach ($Group in $Groups | Sort-Object Name) {\n    $IsPrivileged = $Group.Name -match \"Admin|Privileged|Domain Admins\"\n    $RowClass = if ($IsPrivileged) { \"danger\" } else { \"\" }\n    $Action = if ($IsPrivileged) { \"REQUIRES IMMEDIATE REVIEW\" } else { \"Review for new role\" }\n    $Html += \"<tr class='$RowClass'><td>$($Group.Name)</td><td>$($Group.GroupCategory)</td><td>$($Group.GroupScope)</td><td>$Action</td></tr>`n\"\n}\n\n$Html += @\"\n    </table>\n    \n    <h2>Direct Reports ($($DirectReports.Count))</h2>\n\"@\n\nif ($DirectReports.Count -gt 0) {\n    $Html += \"<p class='warning'>User has direct reports. Manager reassignment required.</p><ul>\"\n    foreach ($Report in $DirectReports) {\n        $Html += \"<li>$($Report.DisplayName)</li>\"\n    }\n    $Html += \"</ul>\"\n} else {\n    $Html += \"<p>No direct reports.</p>\"\n}\n\n$Html += @\"\n    \n    <h2>Privileged Access Summary</h2>\n\"@\n\nif ($PrivilegedGroups.Count -gt 0) {\n    $Html += \"<p class='danger'><strong>WARNING:</strong> User has privileged access that requires immediate review:</p><ul>\"\n    foreach ($PG in $PrivilegedGroups) {\n        $Html += \"<li>$($PG.Name)</li>\"\n    }\n    $Html += \"</ul>\"\n} else {\n    $Html += \"<p>No privileged group memberships detected.</p>\"\n}\n\n$Html += @\"\n    \n    <div class='action'>\n        <h2>Required Actions</h2>\n        <ol>\n            <li>Former manager must certify which access should be removed</li>\n            <li>New manager must certify which access should be retained/added</li>\n            <li>Remove access not required for new position within 5 business days</li>\n            <li>Update physical badge access for new work location</li>\n            <li>Notify IT Security when transfer actions complete</li>\n            <li>Document all changes in access management system</li>\n        </ol>\n    </div>\n    \n    <p><em>Report generated for NIST SP 800-53 PS-5 compliance</em></p>\n</body>\n</html>\n\"@\n\n$Html | Out-File -FilePath $ReportFile -Encoding UTF8\nWrite-Host \"Report generated: $ReportFile\"\n\n# Log the review\nWrite-EventLog -LogName Security -Source \"PS-5 Access Review\" -EventId 4700 -EntryType Information -Message \"PS-5: Transfer access review initiated for $Username\"",
        "ansible": "---\n# PS-5: Personnel Transfer Access Review - Windows/AD\n- name: PS-5 Personnel Transfer Access Review\n  hosts: domain_controllers[0]\n  gather_facts: yes\n  vars:\n    transferred_user: \"{{ username }}\"\n    new_position: \"{{ position | default('Not Specified') }}\"\n    report_path: \"C:\\\\Reports\\\\Transfers\"\n\n  tasks:\n    - name: Create report directory\n      win_file:\n        path: \"{{ report_path }}\"\n        state: directory\n\n    - name: Generate transfer access review\n      win_shell: |\n        Import-Module ActiveDirectory\n        \n        $User = Get-ADUser -Identity {{ transferred_user }} -Properties MemberOf, Department, Title, Manager\n        $Groups = Get-ADPrincipalGroupMembership -Identity {{ transferred_user }}\n        \n        $Report = @{\n            Username = '{{ transferred_user }}'\n            Department = $User.Department\n            Title = $User.Title\n            GroupCount = $Groups.Count\n            Groups = $Groups.Name -join ', '\n            PrivilegedGroups = ($Groups | Where-Object { $_.Name -match 'Admin' }).Name -join ', '\n            ReviewDate = Get-Date -Format 'yyyy-MM-dd'\n        }\n        \n        $Report | ConvertTo-Json | Out-File \"{{ report_path }}\\ps5_{{ transferred_user }}_$(Get-Date -Format 'yyyyMMdd').json\"\n        \n        Write-Output \"Groups: $($Groups.Count)\"\n        Write-Output \"Privileged: $($Report.PrivilegedGroups)\"\n      register: access_review\n\n    - name: Display review summary\n      debug:\n        msg: \"{{ access_review.stdout_lines }}\"\n\n    - name: Log transfer review event\n      win_eventlog:\n        log: Security\n        source: PS-5 Access Review\n        event_id: 4700\n        message: \"PS-5: Transfer access review initiated for {{ transferred_user }}\""
      }
    },
    "related_controls": [
      "AC-2",
      "IA-4",
      "PE-2",
      "PM-12",
      "PS-4",
      "PS-7"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": true
    }
  },
  {
    "control_id": "PS-6",
    "control_name": "Access Agreements",
    "family": "Personnel Security",
    "family_id": "PS",
    "official_text": "a. Develop and document access agreements for organizational systems; b. Review and update the access agreements [Assignment: organization-defined frequency]; and c. Verify that individuals requiring access to organizational information and systems: 1. Sign appropriate access agreements prior to being granted access; and 2. Re-sign access agreements to maintain access to organizational information systems when access agreements have been updated or [Assignment: organization-defined frequency].",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure all personnel formally acknowledge security responsibilities and acceptable use requirements before accessing organizational systems.",
    "rationale": "Access agreements establish clear expectations for system use and create legally enforceable user commitments to security policies. Signed agreements demonstrate user awareness of responsibilities, support disciplinary actions for violations, and provide legal protection for the organization. Without documented acknowledgment, organizations cannot effectively enforce security policies or demonstrate compliance with awareness requirements.",
    "plain_english_explanation": "Before anyone can access your systems, they must read and sign agreements that spell out the rules. These typically include acceptable use policies, non-disclosure agreements, rules of behavior, and acknowledgment of monitoring. Users must sign before getting access, and must re-sign whenever the agreements are updated or on a regular schedule. This ensures everyone knows the rules and has formally agreed to follow them. Keep all signed agreements on file as proof of acknowledgment.",
    "ai_guidance": "Access agreements form the contractual foundation for security accountability. Organizations should implement: (1) Agreement Types - Develop suite of access agreements appropriate to organization: Acceptable Use Policy (AUP) covering permitted/prohibited system uses, Rules of Behavior (RoB) defining conduct expectations, Non-Disclosure Agreement (NDA) for confidentiality obligations, Privileged Access Agreement (PAA) for administrators with elevated permissions, Remote Access Agreement for telework, Mobile Device Agreement for BYOD/corporate mobile; (2) Content Requirements - Each agreement should include: scope of covered systems and information, user responsibilities and prohibited activities, monitoring disclosure, password and credential requirements, incident reporting obligations, consequences for violations, applicable laws and regulations, privacy implications; (3) Review Cycle - Establish review frequency (recommend: annual for AUP/RoB, upon amendment for others); track regulatory changes, policy updates, and legal guidance that require agreement modifications; (4) Signing Process - Implement pre-access workflow requiring agreement signature before account provisioning; support electronic signatures per E-SIGN Act where permitted; maintain audit trail of signature date, version signed, and authentication of signer; (5) Re-signing Requirements - Configure annual re-acknowledgment reminder; force re-signing when agreements updated; consider integration with annual security awareness training; (6) Record Retention - Store signed agreements securely with defined retention period (typically duration of access plus 7 years); ensure retrievability for legal proceedings or audits; (7) Exception Handling - Document process for emergency access when agreements cannot be immediately signed; define maximum grace period and compensating controls.",
    "implementation_guidance": "1. Inventory all current access agreements and assess coverage. 2. Develop standardized templates reviewed by legal counsel. 3. Define review frequency: annual recommended for most agreements. 4. Implement electronic signature solution compliant with organizational requirements. 5. Integrate agreement signing into account provisioning workflow. 6. Configure reminder system for re-signing requirements. 7. Establish secure storage repository for signed agreements. 8. Define retention period meeting legal and regulatory requirements. 9. Create process for tracking agreement versions and identifying users requiring re-signing. 10. Train HR and IT staff on agreement administration procedures.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "related_controls": [
      "AC-2",
      "AC-8",
      "AT-2",
      "PL-4",
      "PS-4.1",
      "PS-6.1",
      "PS-6.2",
      "PS-6.3",
      "SA-9"
    ],
    "enhancements": [
      {
        "id": "PS-6.1",
        "title": "Information Requiring Special Protection"
      },
      {
        "id": "PS-6.2",
        "title": "Classified Information Requiring Special Protection"
      },
      {
        "id": "PS-6.3",
        "title": "Post-employment Requirements"
      }
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": false
    }
  },
  {
    "control_id": "PS-6.1",
    "control_name": "Information Requiring Special Protection",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-6",
    "official_text": "Verify that access to information requiring special protection is granted only to individuals who: a. Have a valid access authorization that is demonstrated by assigned official duties; b. Satisfy associated personnel security criteria; and c. Have read, understood, and signed a nondisclosure agreement.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure additional access controls and acknowledgments are in place for information categories requiring protection beyond standard security measures.",
    "rationale": "Certain information categories carry heightened sensitivity requiring additional safeguards beyond baseline access agreements. Examples include Personally Identifiable Information (PII), Protected Health Information (PHI), financial data, attorney-client privileged communications, law enforcement sensitive information, and proprietary trade secrets. Specific access authorization, personnel security verification, and targeted NDAs ensure only appropriate personnel access this information and understand their specific protection obligations.",
    "plain_english_explanation": "Some information in your organization is extra sensitive and needs more than the standard access agreement. This could include medical records, financial data, legal communications, or proprietary secrets. Before anyone accesses this special information, you must verify three things: they have a legitimate job need for it, they meet any special background or clearance requirements, and they have signed a specific nondisclosure agreement for that type of information. This adds an extra layer of protection and accountability.",
    "ai_guidance": "Information requiring special protection demands tiered access controls with enhanced verification. Implementation should include: (1) Information Classification - Identify and categorize information types requiring special protection: PII/PHI (HIPAA, state privacy laws), Financial (SOX, PCI-DSS), Legal (attorney-client privilege, litigation hold), Proprietary (trade secrets, competitive intelligence), Law Enforcement Sensitive (LES), For Official Use Only (FOUO), Controlled Unclassified Information (CUI); (2) Access Authorization Process - For each special protection category, define: job roles with legitimate access need, required approvals (data owner, security officer, legal), time-limited access periods where appropriate, documentation requirements; (3) Personnel Security Criteria - Establish additional screening requirements per category: background check depth, citizenship requirements where applicable, training prerequisites, conflict of interest reviews; (4) Targeted NDAs - Develop category-specific NDAs addressing: precise definition of protected information, specific handling requirements, disclosure restrictions, reporting obligations for suspected breaches, legal penalties for violations; (5) Access Provisioning Workflow - Implement gated process: request with business justification, data owner approval, security verification of criteria satisfaction, NDA signature capture, access grant with audit logging; (6) Periodic Review - Establish quarterly or annual recertification of special access; verify continued need and criteria satisfaction; (7) Enhanced Monitoring - Consider additional logging and alerting for access to specially protected information.",
    "implementation_guidance": "1. Inventory information categories requiring special protection in your environment. 2. Map each category to applicable regulations, contracts, or policies. 3. Define access authorization criteria specific to each category. 4. Document personnel security criteria (background checks, training, clearances). 5. Develop category-specific NDAs with legal counsel. 6. Implement access request workflow with documented approvals. 7. Create process to verify criteria satisfaction before access grant. 8. Configure systems to enforce special access restrictions technically where possible. 9. Establish recertification schedule for special access. 10. Train data owners on their authorization responsibilities.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "related_controls": [
      "AC-2",
      "AC-3",
      "MP-4",
      "PS-3",
      "PS-6",
      "SC-28",
      "SI-12"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": false
    }
  },
  {
    "control_id": "PS-6.2",
    "control_name": "Classified Information Requiring Special Protection",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-6",
    "official_text": "Verify that access to classified information requiring special protection is granted only to individuals who: a. Have a valid access authorization that is demonstrated by assigned official government duties; b. Satisfy associated personnel security criteria; and c. Have read, understood, and signed a nondisclosure agreement.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure individuals accessing classified information meet all government-mandated security requirements including appropriate clearances, need-to-know, and nondisclosure obligations.",
    "rationale": "Classified information (Confidential, Secret, Top Secret) and compartmented programs (SCI, SAP) are protected under Executive Orders, federal regulations, and Intelligence Community directives. Unauthorized disclosure can cause serious to exceptionally grave damage to national security. This control ensures only personnel with valid clearances, demonstrated need-to-know based on official duties, and formal acknowledgment of protection requirements can access such information. Government security requirements are legally binding and carry criminal penalties.",
    "plain_english_explanation": "Classified national security information has strict government requirements for who can access it. Before granting access, you must verify three things: the person has official government duties requiring the access, they hold an active security clearance at the appropriate level from an authorized government agency, and they have signed the required government nondisclosure forms (typically SF-312). This applies to collateral classified information as well as Special Access Programs (SAP) and Sensitive Compartmented Information (SCI), each of which has additional requirements.",
    "ai_guidance": "Classified information access controls are governed by federal regulations with severe penalties for violations. Implementation requirements: (1) Valid Access Authorization - Personnel must have: official government assignment or contract requiring access, active security clearance at required level (Confidential/Secret/Top Secret), need-to-know determination by classification authority or derivative classifier, for SCI: additional access approval by cognizant security agency, for SAP: program-specific access authorization; (2) Personnel Security Criteria - Requirements include: favorable adjudication by authorized investigative agency (DCSA, IC elements), completion of appropriate investigation type (Tier 1-5), continuous evaluation enrollment where required, polygraph for certain SCI compartments, foreign contact/travel reporting compliance; (3) Nondisclosure Agreements - Required forms: SF-312 (Classified Information NDA) for collateral information, SF-4414 (SCI NDA) for compartmented information, Program-specific NDAs for SAP access, annual security acknowledgment statements; (4) Access Management - Maintain access rosters updated in real-time, coordinate with government security officials for clearance verification, implement two-person integrity where required, enforce proper marking and handling procedures, conduct periodic access reviews with cognizant security authority; (5) Incident Response - Immediate reporting of spillage or unauthorized disclosure per agency procedures, coordinate with government counterintelligence/security elements. Note: Implementation details vary significantly based on cognizant security agency and program requirements.",
    "implementation_guidance": "1. Establish Facility Security Officer (FSO) or equivalent for classified operations. 2. Integrate with government clearance verification systems (DISS, Scattered Castles). 3. Maintain personnel security files with investigation dates and clearance levels. 4. Implement need-to-know determination process with documented approvals. 5. Ensure SF-312 execution within 24 hours of initial access. 6. Configure classified systems to enforce clearance-based access controls. 7. Conduct annual security refresher training with acknowledgment. 8. Establish procedures for access termination upon clearance revocation. 9. Coordinate with government oversight for inspections and compliance reviews. 10. Maintain separation between classified and unclassified processing environments.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "related_controls": [
      "AC-2",
      "AC-3",
      "PE-2",
      "PE-3",
      "PS-3.1",
      "PS-3.2",
      "PS-6",
      "SC-7"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": false
    }
  },
  {
    "control_id": "PS-6.3",
    "control_name": "Post-employment Requirements",
    "family": "Personnel Security",
    "family_id": "PS",
    "parent_control": "PS-6",
    "official_text": "a. Notify individuals of applicable, legally binding post-employment requirements for the protection of organizational information; and b. Require individuals to sign an acknowledgment of these requirements, if applicable, as part of granting initial access to covered information.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": false,
      "moderate": false,
      "high": false
    },
    "is_technical": false,
    "stig_id": null,
    "intent": "Ensure individuals understand and acknowledge ongoing information protection obligations before accessing information that carries post-employment restrictions.",
    "rationale": "Certain information types carry protection requirements that extend beyond the employment relationship. Unlike PS-4.1 which addresses notification at termination, this control requires upfront acknowledgment at the time access is initially granted. This ensures individuals make informed decisions about accepting access to restricted information, knowing the ongoing obligations they will incur. Obtaining acknowledgment at the start of access provides clearer legal standing than exit-only notifications.",
    "plain_english_explanation": "Before someone accesses information with ongoing protection requirements, they need to know those requirements will continue even after they leave. This is different from the exit interview - this happens at the beginning when access is first granted. The employee reads the post-employment requirements, understands that accessing this information means they cannot disclose it even years after leaving, and signs acknowledgment. This way, they cannot later claim they did not understand the restrictions. Common examples include trade secret access, classified information, and competitively sensitive business intelligence.",
    "ai_guidance": "Post-employment requirements at initial access establish informed consent for ongoing obligations. Implementation should address: (1) Covered Information Identification - Determine which information categories carry post-employment restrictions: trade secrets and proprietary information, classified national security information, attorney-client privileged materials, pre-release financial information, intellectual property under development, customer lists and business relationships, source code and technical specifications; (2) Requirement Documentation - Clearly articulate post-employment obligations: duration of confidentiality requirements (may be perpetual for some categories), specific disclosure prohibitions, physical and electronic retention restrictions, obligations regarding knowledge vs. documents, geographic scope of restrictions, permitted vs. prohibited future employment activities; (3) Initial Access Workflow - Configure access provisioning to require: display of post-employment notice prior to access enablement, active acknowledgment (not just passive acceptance), electronic or physical signature with timestamp, storage of signed acknowledgment with access record; (4) Relationship to Other Controls - Coordinate with: NDA terms to ensure alignment, employment agreements and offer letters, PS-4.1 exit notification (this creates continuity from entry to exit), legal counsel review of requirement enforceability; (5) Training Integration - Ensure initial access acknowledgment is supported by training explaining: what constitutes covered information, practical examples of prohibited activities, how to handle requests from future employers, reporting obligations that continue after employment; (6) Record Retention - Maintain acknowledgment records for period matching post-employment obligation duration plus statute of limitations for breach claims.",
    "implementation_guidance": "1. Inventory information categories with post-employment restrictions. 2. Work with legal counsel to document specific post-employment requirements. 3. Create acknowledgment form covering all applicable requirements. 4. Integrate acknowledgment into access provisioning workflow for covered information. 5. Require signature before system access or information disclosure. 6. Train managers to explain requirements when assigning staff to covered projects. 7. Maintain secure repository of signed acknowledgments. 8. Define retention period (typically perpetual for trade secrets, as obligations do not expire). 9. Coordinate with PS-4.1 to ensure consistent messaging at entry and exit. 10. Periodically review requirements with legal for regulatory changes.",
    "implementation_scripts": {
      "linux": {},
      "windows": {}
    },
    "related_controls": [
      "PS-4.1",
      "PS-6",
      "PS-6.1",
      "SA-9"
    ],
    "metadata": {
      "status": "implemented",
      "last_updated": "2025-11-22",
      "has_scripts": false
    }
  },
  {
    "control_id": "PS-7",
    "control_name": "External Personnel Security",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "a. Establish personnel security requirements, including security roles and responsibilities for external providers; b. Require external providers to comply with personnel security policies and procedures established by the organization; c. Document personnel security requirements; d. Require external providers to notify [Assignment: organization-defined personnel or roles] of any personnel transfers or terminations of external personnel who possess organizational credentials and/or badges, or who have system privileges within [Assignment: organization-defined time period]; e. Monitor provider compliance with personnel security requirements.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "To establish security requirements and accountability for external personnel (contractors, vendors, service providers) who access organizational systems and facilities, ensuring they are subject to equivalent security controls as internal personnel while maintaining organizational visibility into their activities and personnel changes.",
    "rationale": "External personnel represent a significant attack vector because they often receive privileged access to systems while operating outside direct organizational control. Third-party breaches have been responsible for numerous high-profile security incidents. This control ensures that organizations extend their security posture to cover the entire personnel ecosystem, not just direct employees, through contractual requirements, monitoring, and timely notification of personnel changes that could affect security.",
    "plain_english_explanation": "This control requires organizations to treat external personnel (contractors, consultants, IT service providers, managed service providers, vendors performing on-site work) with the same security rigor as internal employees. Specifically, organizations must: (1) Define clear security requirements for external providers including what security training they must complete, what policies they must follow, and what roles/responsibilities they have for protecting organizational information; (2) Require external providers to formally agree to comply with organizational security policies through contracts and access agreements; (3) Document all personnel security requirements in writing, typically in contracts, statements of work, or security appendices; (4) Require external providers to promptly notify the organization when their personnel who have access to organizational systems or facilities transfer to different positions or leave the company - this is critical because the organization needs to revoke credentials and access; (5) Actively monitor whether external providers are actually following the security requirements, not just trusting that they are compliant. This control is essential because external personnel often have the same system access as employees but may have weaker background checks, security training, or organizational loyalty.",
    "example_implementation": "Implement a comprehensive external personnel security program: (1) Develop a standard security requirements appendix that is attached to all contracts involving external personnel access to systems or data; (2) Require all external personnel to complete organizational security awareness training before receiving access credentials; (3) Establish a contractor access management system that tracks all external personnel with their sponsoring organization, access level, badge ID, and access expiration date; (4) Include contractual clauses requiring 24-hour notification of contractor terminations and 5-business-day notification of transfers; (5) Conduct quarterly audits of external provider compliance with security requirements; (6) Implement automated alerts when contractor badge access or system accounts approach expiration; (7) Perform annual reviews of all external provider contracts to ensure security requirements remain current.",
    "non_technical_guidance": "Organizations should implement these administrative procedures for PS-7 compliance:\n\n1. **Security Requirements Definition**:\n   - Develop standard security requirements for external personnel including:\n     - Background investigation requirements (criminal, financial, reference checks)\n     - Required security training and awareness\n     - Acceptable use policies and rules of behavior\n     - Data handling and confidentiality requirements\n     - Incident reporting obligations\n     - Physical and logical access restrictions\n\n2. **Contractual Requirements**:\n   - Include security requirements in all contracts, SOWs, and vendor agreements\n   - Require formal acknowledgment/signature by external provider representatives\n   - Include right-to-audit clauses for security compliance verification\n   - Specify penalties for non-compliance including contract termination\n\n3. **Documentation Requirements**:\n   - Maintain documentation of all external personnel security requirements\n   - Keep records of external personnel acknowledgments and training completion\n   - Document access granted to each external person or organization\n   - Maintain current contact information for provider security points of contact\n\n4. **Notification Procedures**:\n   - Define required notification timeframes (e.g., 24 hours for terminations)\n   - Establish communication channels (email, phone, portal) for notifications\n   - Define organizational roles responsible for receiving and acting on notifications\n   - Document procedures for immediate access revocation upon notification\n\n5. **Monitoring and Compliance**:\n   - Conduct regular (at least annual) compliance reviews of external providers\n   - Review external personnel access logs for anomalous activity\n   - Verify training completion and agreement signatures\n   - Address non-compliance through contract enforcement mechanisms",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AT-2",
      "AT-3",
      "IA-2",
      "IA-4",
      "IA-5",
      "IA-8",
      "MA-5",
      "PE-2",
      "PE-3",
      "PS-2",
      "PS-3",
      "PS-4",
      "PS-5",
      "PS-6",
      "SA-9",
      "SA-21",
      "SR-3"
    ],
    "supplemental_guidance": "External providers include service bureaus, contractors, and other organizations providing system development, IT services, security services, or other outsourced applications. Organizations establish personnel security requirements for external providers through contracts and other acquisition-related documents. External providers should be notified of the specific personnel who will require access to organizational information and systems. Prompt notification of personnel transfers or terminations is critical because delays allow terminated or transferred personnel to retain unauthorized access. Organizations monitor provider compliance through periodic audits, access reviews, and verification of training completion. This control works in conjunction with SA-9 (External System Services) for comprehensive third-party risk management.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-7: Audit External Personnel Access\n# Verifies contractor/external accounts are documented and compliant\n\nREPORT_FILE=\"/var/log/security/ps7_external_personnel_audit_$(date +%Y%m%d).log\"\nCONTRACTOR_AGREEMENTS_DIR=\"/var/hr/contractor_agreements\"\nALERT_COUNT=0\n\necho \"=== PS-7 External Personnel Security Audit ===\" > \"$REPORT_FILE\"\necho \"Date: $(date)\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# Function to check external/contractor accounts\ncheck_external_accounts() {\n    echo \"[CHECK] Auditing external/contractor accounts...\" >> \"$REPORT_FILE\"\n    \n    # Check for accounts with contractor/vendor indicators\n    for pattern in \"contractor\" \"vendor\" \"external\" \"consultant\" \"temp_\" \"svc_ext\"; do\n        getent passwd | grep -i \"$pattern\" | while read line; do\n            username=$(echo \"$line\" | cut -d: -f1)\n            \n            # Check if access agreement exists\n            if [ ! -f \"${CONTRACTOR_AGREEMENTS_DIR}/${username}.pdf\" ] && \\\n               [ ! -f \"${CONTRACTOR_AGREEMENTS_DIR}/${username}.signed\" ]; then\n                echo \"[WARNING] No access agreement found for: $username\" >> \"$REPORT_FILE\"\n                ((ALERT_COUNT++))\n            else\n                echo \"[OK] Access agreement exists for: $username\" >> \"$REPORT_FILE\"\n            fi\n            \n            # Check account expiration\n            if command -v chage &> /dev/null; then\n                expiry=$(chage -l \"$username\" 2>/dev/null | grep \"Account expires\" | cut -d: -f2 | xargs)\n                if [ \"$expiry\" = \"never\" ]; then\n                    echo \"[WARNING] External account has no expiration: $username\" >> \"$REPORT_FILE\"\n                    ((ALERT_COUNT++))\n                else\n                    echo \"[INFO] Account expires: $username - $expiry\" >> \"$REPORT_FILE\"\n                fi\n            fi\n            \n            # Check last login\n            lastlog_entry=$(lastlog -u \"$username\" 2>/dev/null | tail -1)\n            echo \"[INFO] Last login for $username: $lastlog_entry\" >> \"$REPORT_FILE\"\n        done\n    done\n}\n\n# Check for external accounts in specific groups\ncheck_external_groups() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"[CHECK] Auditing external personnel groups...\" >> \"$REPORT_FILE\"\n    \n    for group in \"contractors\" \"vendors\" \"external_users\" \"third_party\"; do\n        if getent group \"$group\" &> /dev/null; then\n            members=$(getent group \"$group\" | cut -d: -f4)\n            echo \"[INFO] Group '$group' members: $members\" >> \"$REPORT_FILE\"\n            \n            # Verify each member has documentation\n            IFS=',' read -ra MEMBERS <<< \"$members\"\n            for member in \"${MEMBERS[@]}\"; do\n                if [ -n \"$member\" ]; then\n                    if [ ! -f \"${CONTRACTOR_AGREEMENTS_DIR}/${member}.pdf\" ]; then\n                        echo \"[WARNING] No agreement for group member: $member\" >> \"$REPORT_FILE\"\n                        ((ALERT_COUNT++))\n                    fi\n                fi\n            done\n        fi\n    done\n}\n\n# Check SSH authorized keys for external access\ncheck_external_ssh_keys() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"[CHECK] Auditing SSH keys for external personnel...\" >> \"$REPORT_FILE\"\n    \n    find /home -name \"authorized_keys\" 2>/dev/null | while read keyfile; do\n        username=$(echo \"$keyfile\" | cut -d'/' -f3)\n        key_count=$(wc -l < \"$keyfile\" 2>/dev/null || echo 0)\n        \n        if echo \"$username\" | grep -qiE \"contractor|vendor|external|consultant\"; then\n            echo \"[INFO] External user $username has $key_count SSH keys\" >> \"$REPORT_FILE\"\n            \n            # Check for keys without expiration comments\n            grep -v \"^#\" \"$keyfile\" | grep -v \"expire\" | while read key; do\n                if [ -n \"$key\" ]; then\n                    key_fingerprint=$(echo \"$key\" | ssh-keygen -lf - 2>/dev/null | awk '{print $2}')\n                    echo \"[WARNING] SSH key without expiration for $username: $key_fingerprint\" >> \"$REPORT_FILE\"\n                    ((ALERT_COUNT++))\n                fi\n            done\n        fi\n    done\n}\n\n# Generate summary\ngenerate_summary() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"=== AUDIT SUMMARY ===\" >> \"$REPORT_FILE\"\n    echo \"Total alerts: $ALERT_COUNT\" >> \"$REPORT_FILE\"\n    \n    if [ $ALERT_COUNT -gt 0 ]; then\n        echo \"[RESULT] PS-7 Compliance: REVIEW REQUIRED\" >> \"$REPORT_FILE\"\n        exit 1\n    else\n        echo \"[RESULT] PS-7 Compliance: PASS\" >> \"$REPORT_FILE\"\n        exit 0\n    fi\n}\n\n# Main execution\nmkdir -p /var/log/security\nmkdir -p \"$CONTRACTOR_AGREEMENTS_DIR\"\n\ncheck_external_accounts\ncheck_external_groups\ncheck_external_ssh_keys\ngenerate_summary\n\ncat \"$REPORT_FILE\"",
        "ansible": "---\n# PS-7: External Personnel Security Audit Playbook\n# Audits contractor/external personnel accounts and access documentation\n\n- name: PS-7 External Personnel Security Compliance Audit\n  hosts: all\n  become: yes\n  vars:\n    contractor_agreements_dir: \"/var/hr/contractor_agreements\"\n    audit_report_dir: \"/var/log/security/ps7_audits\"\n    external_patterns:\n      - contractor\n      - vendor\n      - external\n      - consultant\n      - temp_\n      - svc_ext\n    external_groups:\n      - contractors\n      - vendors\n      - external_users\n      - third_party\n    notification_email: \"security-team@organization.org\"\n\n  tasks:\n    - name: Create audit directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n        owner: root\n        group: root\n      loop:\n        - \"{{ audit_report_dir }}\"\n        - \"{{ contractor_agreements_dir }}\"\n\n    - name: Get list of all system users\n      getent:\n        database: passwd\n      register: all_users\n\n    - name: Identify external/contractor accounts\n      set_fact:\n        external_accounts: \"{{ all_users.ansible_facts.getent_passwd | \n          dict2items | \n          selectattr('key', 'search', item, ignorecase=True) | \n          map(attribute='key') | list }}\"\n      loop: \"{{ external_patterns }}\"\n      register: external_account_results\n\n    - name: Flatten external accounts list\n      set_fact:\n        all_external_accounts: \"{{ external_account_results.results | \n          map(attribute='ansible_facts.external_accounts') | \n          flatten | unique }}\"\n\n    - name: Check for access agreements\n      stat:\n        path: \"{{ contractor_agreements_dir }}/{{ item }}.pdf\"\n      loop: \"{{ all_external_accounts }}\"\n      register: agreement_checks\n\n    - name: Identify accounts missing agreements\n      set_fact:\n        missing_agreements: \"{{ agreement_checks.results | \n          selectattr('stat.exists', 'equalto', false) | \n          map(attribute='item') | list }}\"\n\n    - name: Check account expiration dates\n      command: \"chage -l {{ item }}\"\n      loop: \"{{ all_external_accounts }}\"\n      register: account_expiry\n      changed_when: false\n      failed_when: false\n\n    - name: Identify accounts without expiration\n      set_fact:\n        no_expiry_accounts: \"{{ account_expiry.results | \n          selectattr('stdout', 'search', 'Account expires.*never') | \n          map(attribute='item') | list }}\"\n\n    - name: Check external groups membership\n      getent:\n        database: group\n        key: \"{{ item }}\"\n      loop: \"{{ external_groups }}\"\n      register: group_members\n      failed_when: false\n\n    - name: Get last login information\n      command: \"lastlog -u {{ item }}\"\n      loop: \"{{ all_external_accounts }}\"\n      register: last_logins\n      changed_when: false\n      failed_when: false\n\n    - name: Generate audit report\n      template:\n        src: ps7_audit_report.j2\n        dest: \"{{ audit_report_dir }}/ps7_audit_{{ ansible_date_time.date }}.html\"\n        mode: '0640'\n      vars:\n        audit_date: \"{{ ansible_date_time.iso8601 }}\"\n        hostname: \"{{ inventory_hostname }}\"\n        external_users: \"{{ all_external_accounts }}\"\n        missing_docs: \"{{ missing_agreements }}\"\n        no_expiry: \"{{ no_expiry_accounts }}\"\n\n    - name: Set compliance status\n      set_fact:\n        ps7_compliant: \"{{ (missing_agreements | length == 0) and \n                           (no_expiry_accounts | length == 0) }}\"\n\n    - name: Display audit results\n      debug:\n        msg: |\n          === PS-7 External Personnel Security Audit Results ===\n          Host: {{ inventory_hostname }}\n          Date: {{ ansible_date_time.iso8601 }}\n          \n          External Accounts Found: {{ all_external_accounts | length }}\n          Accounts Missing Agreements: {{ missing_agreements | length }}\n          Accounts Without Expiration: {{ no_expiry_accounts | length }}\n          \n          Missing Agreements: {{ missing_agreements | join(', ') if missing_agreements else 'None' }}\n          No Expiration Set: {{ no_expiry_accounts | join(', ') if no_expiry_accounts else 'None' }}\n          \n          Compliance Status: {{ 'PASS' if ps7_compliant else 'FAIL - REVIEW REQUIRED' }}\n\n    - name: Send alert for non-compliance\n      mail:\n        host: localhost\n        port: 25\n        to: \"{{ notification_email }}\"\n        subject: \"[ALERT] PS-7 Compliance Issue on {{ inventory_hostname }}\"\n        body: |\n          PS-7 External Personnel Security audit found compliance issues:\n          \n          Missing Agreements: {{ missing_agreements | join(', ') }}\n          No Expiration: {{ no_expiry_accounts | join(', ') }}\n          \n          Please review and remediate.\n      when: not ps7_compliant\n      ignore_errors: yes\n\n    - name: Fail if non-compliant\n      fail:\n        msg: \"PS-7 compliance check failed - external personnel security issues found\"\n      when: not ps7_compliant"
      },
      "windows": {
        "powershell": "# PS-7: External Personnel Security Audit Script\n# Audits contractor/external accounts in Active Directory and local systems\n\n#Requires -Version 5.1\n#Requires -Modules ActiveDirectory\n\nparam(\n    [string]$ContractorAgreementsPath = \"\\\\fileserver\\hr\\contractor_agreements\",\n    [string]$ReportPath = \"C:\\SecurityReports\\PS7\",\n    [string[]]$ExternalPatterns = @(\"contractor\", \"vendor\", \"external\", \"consultant\", \"temp_\", \"svc_ext\"),\n    [string[]]$ExternalOUs = @(\"OU=Contractors,DC=domain,DC=local\", \"OU=Vendors,DC=domain,DC=local\"),\n    [switch]$SendAlerts\n)\n\n$ErrorActionPreference = \"Continue\"\n$ReportDate = Get-Date -Format \"yyyyMMdd_HHmmss\"\n$ReportFile = Join-Path $ReportPath \"PS7_Audit_$ReportDate.html\"\n$AlertCount = 0\n$Findings = @()\n\n# Ensure report directory exists\nif (-not (Test-Path $ReportPath)) {\n    New-Item -ItemType Directory -Path $ReportPath -Force | Out-Null\n}\n\nfunction Write-AuditLog {\n    param([string]$Message, [string]$Level = \"INFO\")\n    $timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Write-Host \"[$Level] $timestamp - $Message\"\n}\n\nfunction Get-ExternalADUsers {\n    Write-AuditLog \"Searching for external/contractor accounts in Active Directory...\"\n    $externalUsers = @()\n    \n    # Search by name patterns\n    foreach ($pattern in $ExternalPatterns) {\n        try {\n            $users = Get-ADUser -Filter \"SamAccountName -like '*$pattern*' -or Description -like '*$pattern*'\" `\n                -Properties Description, AccountExpirationDate, LastLogonDate, WhenCreated, Enabled, Manager\n            $externalUsers += $users\n        } catch {\n            Write-AuditLog \"Error searching for pattern '$pattern': $_\" \"WARNING\"\n        }\n    }\n    \n    # Search in contractor OUs\n    foreach ($ou in $ExternalOUs) {\n        try {\n            $users = Get-ADUser -SearchBase $ou -Filter * `\n                -Properties Description, AccountExpirationDate, LastLogonDate, WhenCreated, Enabled, Manager\n            $externalUsers += $users\n        } catch {\n            Write-AuditLog \"OU not found or error: $ou\" \"WARNING\"\n        }\n    }\n    \n    return $externalUsers | Sort-Object SamAccountName -Unique\n}\n\nfunction Test-AgreementExists {\n    param([string]$Username)\n    \n    $agreementPatterns = @(\n        \"$Username.pdf\",\n        \"$Username.docx\",\n        \"$Username.signed\",\n        \"$Username*agreement*\"\n    )\n    \n    foreach ($pattern in $agreementPatterns) {\n        $path = Join-Path $ContractorAgreementsPath $pattern\n        if (Test-Path $path) { return $true }\n    }\n    return $false\n}\n\nfunction Invoke-PS7Audit {\n    Write-AuditLog \"=== Starting PS-7 External Personnel Security Audit ===\"\n    \n    # Get external users from AD\n    $externalUsers = Get-ExternalADUsers\n    Write-AuditLog \"Found $($externalUsers.Count) external/contractor accounts\"\n    \n    $results = @()\n    \n    foreach ($user in $externalUsers) {\n        $finding = [PSCustomObject]@{\n            Username = $user.SamAccountName\n            DisplayName = $user.Name\n            Description = $user.Description\n            Enabled = $user.Enabled\n            AccountExpiration = $user.AccountExpirationDate\n            LastLogon = $user.LastLogonDate\n            Created = $user.WhenCreated\n            Manager = $user.Manager\n            HasAgreement = Test-AgreementExists -Username $user.SamAccountName\n            Issues = @()\n            Status = \"OK\"\n        }\n        \n        # Check for missing access agreement\n        if (-not $finding.HasAgreement) {\n            $finding.Issues += \"Missing access agreement documentation\"\n            $finding.Status = \"WARNING\"\n            $script:AlertCount++\n        }\n        \n        # Check for no account expiration\n        if ($finding.Enabled -and (-not $finding.AccountExpiration)) {\n            $finding.Issues += \"Active account has no expiration date\"\n            $finding.Status = \"WARNING\"\n            $script:AlertCount++\n        }\n        \n        # Check for expired accounts still enabled\n        if ($finding.Enabled -and $finding.AccountExpiration -and ($finding.AccountExpiration -lt (Get-Date))) {\n            $finding.Issues += \"Account is enabled but past expiration date\"\n            $finding.Status = \"CRITICAL\"\n            $script:AlertCount++\n        }\n        \n        # Check for no recent login (possible orphaned account)\n        if ($finding.Enabled -and $finding.LastLogon -and ($finding.LastLogon -lt (Get-Date).AddDays(-90))) {\n            $finding.Issues += \"No login in 90+ days - may be orphaned\"\n            $finding.Status = \"WARNING\"\n            $script:AlertCount++\n        }\n        \n        # Check for no manager (sponsor)\n        if (-not $finding.Manager) {\n            $finding.Issues += \"No manager/sponsor assigned\"\n            $finding.Status = \"WARNING\"\n            $script:AlertCount++\n        }\n        \n        $results += $finding\n    }\n    \n    return $results\n}\n\nfunction Export-AuditReport {\n    param($Results)\n    \n    $html = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <title>PS-7 External Personnel Security Audit</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        h1 { color: #333; }\n        table { border-collapse: collapse; width: 100%; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #4472C4; color: white; }\n        tr:nth-child(even) { background-color: #f2f2f2; }\n        .ok { color: green; }\n        .warning { color: orange; font-weight: bold; }\n        .critical { color: red; font-weight: bold; }\n        .summary { background-color: #f8f8f8; padding: 15px; margin: 20px 0; }\n    </style>\n</head>\n<body>\n    <h1>PS-7 External Personnel Security Audit Report</h1>\n    <div class=\"summary\">\n        <p><strong>Date:</strong> $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</p>\n        <p><strong>Total External Accounts:</strong> $($Results.Count)</p>\n        <p><strong>Accounts with Issues:</strong> $($Results | Where-Object { $_.Issues.Count -gt 0 } | Measure-Object | Select-Object -ExpandProperty Count)</p>\n        <p><strong>Total Alerts:</strong> $AlertCount</p>\n        <p><strong>Compliance Status:</strong> $(if ($AlertCount -eq 0) { '<span class=\"ok\">PASS</span>' } else { '<span class=\"critical\">REVIEW REQUIRED</span>' })</p>\n    </div>\n    <table>\n        <tr>\n            <th>Username</th>\n            <th>Display Name</th>\n            <th>Enabled</th>\n            <th>Expiration</th>\n            <th>Last Logon</th>\n            <th>Has Agreement</th>\n            <th>Manager</th>\n            <th>Status</th>\n            <th>Issues</th>\n        </tr>\n\"@\n\n    foreach ($r in $Results) {\n        $statusClass = switch ($r.Status) {\n            \"OK\" { \"ok\" }\n            \"WARNING\" { \"warning\" }\n            \"CRITICAL\" { \"critical\" }\n            default { \"\" }\n        }\n        $issues = if ($r.Issues) { $r.Issues -join \"; \" } else { \"None\" }\n        $mgr = if ($r.Manager) { ($r.Manager -split ',')[0] -replace 'CN=' } else { \"None\" }\n        \n        $html += @\"\n        <tr>\n            <td>$($r.Username)</td>\n            <td>$($r.DisplayName)</td>\n            <td>$($r.Enabled)</td>\n            <td>$(if ($r.AccountExpiration) { $r.AccountExpiration.ToString('yyyy-MM-dd') } else { 'Never' })</td>\n            <td>$(if ($r.LastLogon) { $r.LastLogon.ToString('yyyy-MM-dd') } else { 'Never' })</td>\n            <td>$($r.HasAgreement)</td>\n            <td>$mgr</td>\n            <td class=\"$statusClass\">$($r.Status)</td>\n            <td>$issues</td>\n        </tr>\n\"@\n    }\n\n    $html += @\"\n    </table>\n</body>\n</html>\n\"@\n\n    $html | Out-File -FilePath $ReportFile -Encoding UTF8\n    Write-AuditLog \"Report saved to: $ReportFile\"\n}\n\n# Main execution\ntry {\n    $auditResults = Invoke-PS7Audit\n    Export-AuditReport -Results $auditResults\n    \n    Write-AuditLog \"=== PS-7 Audit Complete ===\"\n    Write-AuditLog \"Total Alerts: $AlertCount\"\n    \n    if ($AlertCount -gt 0) {\n        Write-AuditLog \"COMPLIANCE STATUS: REVIEW REQUIRED\" \"WARNING\"\n        exit 1\n    } else {\n        Write-AuditLog \"COMPLIANCE STATUS: PASS\"\n        exit 0\n    }\n} catch {\n    Write-AuditLog \"Audit failed: $_\" \"ERROR\"\n    exit 2\n}",
        "ansible": "---\n# PS-7: External Personnel Security Audit for Windows\n# Audits contractor/external accounts in Active Directory\n\n- name: PS-7 External Personnel Security Audit (Windows)\n  hosts: windows\n  gather_facts: yes\n  vars:\n    contractor_agreements_path: \"\\\\\\\\fileserver\\\\hr\\\\contractor_agreements\"\n    report_path: \"C:\\\\SecurityReports\\\\PS7\"\n    external_patterns:\n      - contractor\n      - vendor\n      - external\n      - consultant\n    notification_email: \"security-team@organization.org\"\n\n  tasks:\n    - name: Create report directory\n      win_file:\n        path: \"{{ report_path }}\"\n        state: directory\n\n    - name: Search for external accounts by pattern\n      win_shell: |\n        Import-Module ActiveDirectory\n        $patterns = @('{{ external_patterns | join(\"','\") }}')\n        $results = @()\n        foreach ($pattern in $patterns) {\n            $users = Get-ADUser -Filter \"SamAccountName -like '*$pattern*'\" `\n                -Properties Description, AccountExpirationDate, LastLogonDate, Enabled, Manager\n            $results += $users\n        }\n        $results | Select-Object SamAccountName, Name, Enabled, AccountExpirationDate, LastLogonDate, Manager | \n            ConvertTo-Json -Depth 3\n      register: external_accounts\n      changed_when: false\n\n    - name: Parse external accounts\n      set_fact:\n        external_users: \"{{ external_accounts.stdout | from_json | default([]) }}\"\n\n    - name: Check for accounts without expiration\n      set_fact:\n        no_expiry_accounts: \"{{ external_users | \n          selectattr('Enabled', 'equalto', true) | \n          selectattr('AccountExpirationDate', 'none') | \n          map(attribute='SamAccountName') | list }}\"\n\n    - name: Generate compliance report\n      win_shell: |\n        $report = @{\n            AuditDate = Get-Date -Format 'yyyy-MM-dd HH:mm:ss'\n            Hostname = $env:COMPUTERNAME\n            ExternalAccountsFound = {{ external_users | length }}\n            AccountsWithoutExpiry = {{ no_expiry_accounts | length }}\n            NoExpiryList = '{{ no_expiry_accounts | join(\", \") }}'\n            ComplianceStatus = '{{ \"PASS\" if no_expiry_accounts | length == 0 else \"FAIL\" }}'\n        }\n        $report | ConvertTo-Json | Out-File \"{{ report_path }}\\PS7_Audit_$(Get-Date -Format 'yyyyMMdd').json\"\n\n    - name: Display audit results\n      debug:\n        msg: |\n          === PS-7 External Personnel Security Audit Results ===\n          Host: {{ inventory_hostname }}\n          External Accounts: {{ external_users | length }}\n          Without Expiration: {{ no_expiry_accounts | length }}\n          Status: {{ 'PASS' if no_expiry_accounts | length == 0 else 'FAIL' }}"
      }
    },
    "metadata": {
      "status": "enhanced",
      "last_updated": "2025-11-22",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control is organizational/procedural in nature. Technical controls can support monitoring of external personnel accounts and verification of access agreements, but core requirements involve contractual relationships and administrative procedures."
    },
    "ai_guidance": "PS-7 External Personnel Security requires a comprehensive third-party personnel management program. AI-assisted compliance monitoring can significantly enhance this control by: (1) Maintaining and querying databases of external personnel with their access agreements, sponsoring organizations, access levels, and expiration dates; (2) Automatically alerting when contractor accounts approach expiration or when new external accounts are created without corresponding documentation; (3) Cross-referencing HR/procurement systems with identity management systems to identify external personnel who may have been granted access without proper authorization; (4) Monitoring for external provider personnel changes by integrating with provider notification systems or periodically verifying active contractor lists; (5) Analyzing access patterns of external personnel to detect anomalous behavior that may indicate unauthorized access or compromised credentials; (6) Generating compliance dashboards showing external provider compliance status, agreement coverage, and expiration timelines; (7) Automating periodic compliance reviews by querying external personnel records against required documentation and training completion records. Integration with contract management systems enables automated tracking of security requirements across vendor relationships. For organizations with significant contractor populations, automated onboarding/offboarding workflows ensure external personnel are properly documented before access is granted and promptly deprovisioned when contracts end.",
    "implementation_guidance": "Organizations should implement these key measures for PS-7 compliance:\n\n1. **Contract Security Requirements**: Develop standard security language for all contracts involving external personnel access. Include background check requirements, security training obligations, data handling restrictions, incident reporting requirements, and notification timeframes for personnel changes.\n\n2. **External Personnel Database**: Establish a centralized tracking system for all external personnel with fields for: name, sponsoring organization, contract number, access granted, badge ID, account IDs, expiration dates, agreement status, and training completion.\n\n3. **Onboarding Process**: Before granting access, verify: signed access agreement, completed background check, security training completion, sponsor approval, and documented business need. Issue credentials with defined expiration dates.\n\n4. **Notification Procedures**: Establish clear channels (dedicated email, portal, phone) for external providers to notify the organization of personnel changes. Define notification timeframes contractually (typically 24 hours for terminations, 5 days for transfers).\n\n5. **Access Revocation**: Upon notification of termination or transfer, immediately disable credentials, revoke badge access, and remove system accounts. Document revocation with timestamp.\n\n6. **Compliance Monitoring**: Conduct quarterly reviews of external personnel access against documentation. Audit external provider compliance annually. Address non-compliance through contract enforcement.\n\n7. **Integration Points**: Connect contractor management to identity management, badge access, and HR systems for automated provisioning/deprovisioning and compliance tracking."
  },
  {
    "control_id": "PS-8",
    "control_name": "Personnel Sanctions",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "a. Employ a formal sanctions process for individuals failing to comply with established information security and privacy policies and procedures; b. Notify [Assignment: organization-defined personnel or roles] within [Assignment: organization-defined time period] when a formal employee sanctions process is initiated, identifying the individual sanctioned and the reason for the sanction.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "To establish accountability for security policy violations through a formal sanctions process that deters non-compliance and ensures consistent enforcement. This control ensures that security violations have meaningful consequences while providing due process and appropriate notification to security personnel.",
    "rationale": "Without meaningful consequences for policy violations, security policies become merely advisory. A formal sanctions process creates accountability, deters intentional violations, motivates compliance, and demonstrates organizational commitment to security. The notification requirement ensures that security personnel are aware of violations that may indicate broader security issues or patterns of behavior requiring investigation.",
    "plain_english_explanation": "This control requires organizations to have a formal, documented process for disciplining employees and contractors who violate security or privacy policies. The sanctions process should be: (1) Formal - documented in policy with clear procedures, not ad-hoc or informal; (2) Consistent - similar violations receive similar consequences regardless of the violator's position; (3) Proportionate - sanctions should match the severity of the violation; (4) Documented - records are maintained of violations and sanctions imposed. Additionally, when the sanctions process is initiated against an individual, the organization must notify designated security personnel within a specified timeframe (such as 24 or 48 hours). This notification must identify who is being sanctioned and why. This notification is critical because security personnel need to know about violations that may indicate: insider threats, compromised accounts, gaps in security training, systemic policy weaknesses, or patterns of non-compliance. The sanctions can range from verbal warnings for minor first-time violations to termination for severe or repeated violations. Common violations include unauthorized data access, sharing passwords, installing unauthorized software, disabling security controls, or failing to report security incidents.",
    "example_implementation": "Implement a comprehensive sanctions program: (1) Develop a formal Personnel Security Sanctions Policy that defines violation categories, corresponding sanctions, and the escalation process; (2) Create a sanctions matrix mapping violation types to consequences (verbal warning, written warning, suspension, termination); (3) Establish a Security Violation Review Board that reviews all reported violations and determines appropriate sanctions; (4) Implement a violation tracking system that records all security incidents, sanctions imposed, and outcomes; (5) Configure automated notification to CISO and HR when sanctions are initiated; (6) Train managers and supervisors on their role in the sanctions process and proper documentation; (7) Include sanctions acknowledgment in employee security agreements; (8) Conduct annual analysis of sanctions data to identify trends and training gaps.",
    "non_technical_guidance": "Organizations should implement these administrative procedures for PS-8 compliance:\n\n1. **Sanctions Policy Development**:\n   - Document a formal sanctions policy covering:\n     - Definition of security/privacy violations subject to sanctions\n     - Sanctions hierarchy (warning, reprimand, suspension, termination)\n     - Factors considered in determining sanctions (severity, intent, history)\n     - Due process procedures and appeal rights\n     - Documentation and recordkeeping requirements\n   - Obtain legal review of sanctions policy\n   - Align with existing HR disciplinary policies\n\n2. **Violation Categories and Consequences**:\n   Define sanctions for common violations:\n   - Minor: Unintentional policy violations, first-time training failures\n     -> Verbal counseling, additional training\n   - Moderate: Sharing passwords, unauthorized software, policy circumvention\n     -> Written warning, mandatory retraining, increased monitoring\n   - Serious: Unauthorized data access, security control bypass, repeated violations\n     -> Suspension, access restrictions, formal reprimand\n   - Severe: Data theft, sabotage, criminal activity, willful gross negligence\n     -> Termination, legal action, law enforcement referral\n\n3. **Notification Requirements**:\n   - Define personnel who must be notified (CISO, HR, Legal, Management)\n   - Establish notification timeframes (typically 24-48 hours)\n   - Specify notification content (individual identity, violation type, proposed action)\n   - Implement secure notification methods protecting employee privacy\n\n4. **Documentation and Tracking**:\n   - Maintain records of all security violations and sanctions\n   - Track violation trends to identify systemic issues\n   - Document investigation findings and evidence\n   - Retain records per legal and HR requirements\n\n5. **Communication and Training**:\n   - Communicate sanctions policy to all employees during onboarding\n   - Include in security awareness training\n   - Ensure employees sign acknowledgment of sanctions policy\n   - Train managers on their responsibilities in the sanctions process",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "AT-2",
      "AT-3",
      "AU-6",
      "IR-1",
      "PL-4",
      "PM-12",
      "PS-1",
      "PS-4",
      "PS-6",
      "SI-12"
    ],
    "supplemental_guidance": "The sanctions process is consistent with the requirements of applicable laws, executive orders, directives, regulations, policies, standards, and guidelines. Organizations should consult with their Office of the General Counsel regarding employee sanctions matters. The sanctions process can be documented in access agreements and may be incorporated into general personnel policies or specified in security and privacy policies. Organizations consider whether the sanctions process could have security implications (such as disgruntled employees) and implement appropriate safeguards. Related controls include PS-6 (Access Agreements) which documents acknowledgment of sanctions policy, PL-4 (Rules of Behavior) which defines acceptable conduct, and PM-12 (Insider Threat Program) which may identify sanction-worthy behavior through monitoring.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-8: Personnel Sanctions Tracking and Reporting Script\n# Tracks security policy violations and generates compliance reports\n\nVIOLATION_DB=\"/var/security/violations.db\"\nREPORT_DIR=\"/var/log/security/ps8_reports\"\nNOTIFY_EMAIL=\"ciso@organization.org,hr@organization.org\"\nREPORT_FILE=\"${REPORT_DIR}/ps8_sanctions_report_$(date +%Y%m%d).txt\"\n\n# Initialize database if not exists\ninit_db() {\n    mkdir -p \"$(dirname \"$VIOLATION_DB\")\"\n    mkdir -p \"$REPORT_DIR\"\n    \n    if [ ! -f \"$VIOLATION_DB\" ]; then\n        cat > \"$VIOLATION_DB\" << 'SCHEMA'\n# PS-8 Violations Database\n# Format: DATE|USERNAME|VIOLATION_TYPE|SEVERITY|SANCTION|NOTIFIED|STATUS\n# Severity: MINOR|MODERATE|SERIOUS|SEVERE\n# Status: OPEN|IN_REVIEW|SANCTIONED|CLOSED\nSCHEMA\n        echo \"Database initialized: $VIOLATION_DB\"\n    fi\n}\n\n# Log a new violation\nlog_violation() {\n    local username=\"$1\"\n    local violation_type=\"$2\"\n    local severity=\"$3\"\n    local details=\"$4\"\n    \n    if [ -z \"$username\" ] || [ -z \"$violation_type\" ] || [ -z \"$severity\" ]; then\n        echo \"Usage: $0 log <username> <violation_type> <severity> [details]\"\n        exit 1\n    fi\n    \n    local date_stamp=$(date +%Y-%m-%d_%H:%M:%S)\n    local entry=\"${date_stamp}|${username}|${violation_type}|${severity}|PENDING|NO|OPEN|${details}\"\n    \n    echo \"$entry\" >> \"$VIOLATION_DB\"\n    echo \"[LOGGED] Violation recorded for $username: $violation_type ($severity)\"\n    \n    # Auto-notify for serious/severe violations\n    if [ \"$severity\" == \"SERIOUS\" ] || [ \"$severity\" == \"SEVERE\" ]; then\n        send_notification \"$username\" \"$violation_type\" \"$severity\" \"$details\"\n    fi\n}\n\n# Send notification to designated personnel\nsend_notification() {\n    local username=\"$1\"\n    local violation=\"$2\"\n    local severity=\"$3\"\n    local details=\"$4\"\n    \n    local subject=\"[PS-8 ALERT] Security Violation - ${severity}\"\n    local body=\"PS-8 Personnel Sanctions Notification\\n\\n\"\n    body+=\"Date: $(date)\\n\"\n    body+=\"Individual: ${username}\\n\"\n    body+=\"Violation Type: ${violation}\\n\"\n    body+=\"Severity: ${severity}\\n\"\n    body+=\"Details: ${details}\\n\\n\"\n    body+=\"Action Required: Initiate formal sanctions review process.\\n\"\n    body+=\"This notification is required per NIST SP 800-53 PS-8.\\n\"\n    \n    if command -v mail &> /dev/null; then\n        echo -e \"$body\" | mail -s \"$subject\" \"$NOTIFY_EMAIL\"\n        # Update notification status in DB\n        sed -i \"s/|${username}|${violation}|${severity}|PENDING|NO|/|${username}|${violation}|${severity}|PENDING|YES|/\" \"$VIOLATION_DB\"\n        echo \"[NOTIFIED] Alert sent to: $NOTIFY_EMAIL\"\n    else\n        echo \"[WARNING] Mail not available - notification logged but not sent\"\n        # Write to notification queue for manual processing\n        echo \"$(date)|$username|$violation|$severity|$details\" >> \"${REPORT_DIR}/pending_notifications.log\"\n    fi\n}\n\n# Generate compliance report\ngenerate_report() {\n    echo \"=== PS-8 Personnel Sanctions Compliance Report ===\" > \"$REPORT_FILE\"\n    echo \"Generated: $(date)\" >> \"$REPORT_FILE\"\n    echo \"\" >> \"$REPORT_FILE\"\n    \n    # Summary statistics\n    local total=$(grep -v \"^#\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n    local open=$(grep \"|OPEN\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n    local in_review=$(grep \"|IN_REVIEW\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n    local sanctioned=$(grep \"|SANCTIONED\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n    local notified=$(grep \"|YES|\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n    \n    echo \"SUMMARY STATISTICS\" >> \"$REPORT_FILE\"\n    echo \"-----------------\" >> \"$REPORT_FILE\"\n    echo \"Total Violations Recorded: $total\" >> \"$REPORT_FILE\"\n    echo \"Open Cases: $open\" >> \"$REPORT_FILE\"\n    echo \"In Review: $in_review\" >> \"$REPORT_FILE\"\n    echo \"Sanctioned: $sanctioned\" >> \"$REPORT_FILE\"\n    echo \"Notifications Sent: $notified\" >> \"$REPORT_FILE\"\n    echo \"\" >> \"$REPORT_FILE\"\n    \n    # Severity breakdown\n    echo \"SEVERITY BREAKDOWN\" >> \"$REPORT_FILE\"\n    echo \"-----------------\" >> \"$REPORT_FILE\"\n    for sev in MINOR MODERATE SERIOUS SEVERE; do\n        count=$(grep \"|${sev}|\" \"$VIOLATION_DB\" 2>/dev/null | wc -l)\n        echo \"$sev: $count\" >> \"$REPORT_FILE\"\n    done\n    echo \"\" >> \"$REPORT_FILE\"\n    \n    # Active violations requiring attention\n    echo \"OPEN VIOLATIONS REQUIRING ACTION\" >> \"$REPORT_FILE\"\n    echo \"--------------------------------\" >> \"$REPORT_FILE\"\n    grep \"|OPEN\\|IN_REVIEW\" \"$VIOLATION_DB\" 2>/dev/null | while IFS='|' read date user vtype sev sanction notify status details; do\n        echo \"Date: $date\" >> \"$REPORT_FILE\"\n        echo \"  User: $user\" >> \"$REPORT_FILE\"\n        echo \"  Violation: $vtype\" >> \"$REPORT_FILE\"\n        echo \"  Severity: $sev\" >> \"$REPORT_FILE\"\n        echo \"  Notified: $notify\" >> \"$REPORT_FILE\"\n        echo \"  Status: $status\" >> \"$REPORT_FILE\"\n        echo \"\" >> \"$REPORT_FILE\"\n    done\n    \n    # Compliance status\n    echo \"COMPLIANCE STATUS\" >> \"$REPORT_FILE\"\n    echo \"-----------------\" >> \"$REPORT_FILE\"\n    \n    local non_notified=$(grep -v \"^#\" \"$VIOLATION_DB\" 2>/dev/null | grep -E \"\\|SERIOUS\\||\\|SEVERE\\|\" | grep \"|NO|\" | wc -l)\n    if [ $non_notified -gt 0 ]; then\n        echo \"[FAIL] $non_notified serious/severe violations without notification\" >> \"$REPORT_FILE\"\n        echo \"PS-8 Compliance: FAIL\" >> \"$REPORT_FILE\"\n    else\n        echo \"[PASS] All serious/severe violations have notifications\" >> \"$REPORT_FILE\"\n        echo \"PS-8 Compliance: PASS\" >> \"$REPORT_FILE\"\n    fi\n    \n    cat \"$REPORT_FILE\"\n}\n\n# Parse security logs for violations\naudit_security_logs() {\n    echo \"[AUDIT] Scanning security logs for policy violations...\"\n    \n    # Check for failed sudo attempts (potential unauthorized privilege escalation)\n    if [ -f /var/log/auth.log ]; then\n        grep \"sudo:.*authentication failure\" /var/log/auth.log 2>/dev/null | tail -20 | while read line; do\n            user=$(echo \"$line\" | grep -oP 'user=\\K\\w+')\n            if [ -n \"$user\" ]; then\n                # Only log if not already recorded today\n                today=$(date +%Y-%m-%d)\n                if ! grep \"${today}.*${user}.*UNAUTHORIZED_SUDO\" \"$VIOLATION_DB\" &>/dev/null; then\n                    log_violation \"$user\" \"UNAUTHORIZED_SUDO_ATTEMPT\" \"MODERATE\" \"Failed sudo authentication\"\n                fi\n            fi\n        done\n    fi\n    \n    # Check for accounts accessing files outside their scope (via auditd)\n    if [ -f /var/log/audit/audit.log ]; then\n        grep \"type=USER_AUTH.*res=failed\" /var/log/audit/audit.log 2>/dev/null | tail -10 | while read line; do\n            user=$(echo \"$line\" | grep -oP 'acct=\"\\K[^\"]+' | head -1)\n            if [ -n \"$user\" ]; then\n                echo \"[INFO] Auth failure detected for: $user\"\n            fi\n        done\n    fi\n    \n    echo \"[AUDIT] Security log scan complete\"\n}\n\n# Main execution\ninit_db\n\ncase \"$1\" in\n    log)\n        log_violation \"$2\" \"$3\" \"$4\" \"$5\"\n        ;;\n    notify)\n        send_notification \"$2\" \"$3\" \"$4\" \"$5\"\n        ;;\n    report)\n        generate_report\n        ;;\n    audit)\n        audit_security_logs\n        ;;\n    *)\n        echo \"PS-8 Personnel Sanctions Management Tool\"\n        echo \"Usage: $0 {log|notify|report|audit}\"\n        echo \"  log <user> <type> <severity> [details] - Log a violation\"\n        echo \"  notify <user> <type> <severity> [details] - Send notification\"\n        echo \"  report - Generate compliance report\"\n        echo \"  audit - Scan security logs for violations\"\n        ;;\nesac",
        "ansible": "---\n# PS-8: Personnel Sanctions Compliance Playbook\n# Implements violation tracking and notification system\n\n- name: PS-8 Personnel Sanctions Management\n  hosts: all\n  become: yes\n  vars:\n    violations_db: \"/var/security/violations.db\"\n    report_dir: \"/var/log/security/ps8_reports\"\n    notification_recipients:\n      - ciso@organization.org\n      - hr@organization.org\n      - legal@organization.org\n    severity_levels:\n      - MINOR\n      - MODERATE\n      - SERIOUS\n      - SEVERE\n\n  tasks:\n    - name: Create violations tracking directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n        owner: root\n        group: security\n      loop:\n        - /var/security\n        - \"{{ report_dir }}\"\n\n    - name: Initialize violations database\n      copy:\n        dest: \"{{ violations_db }}\"\n        content: |\n          # PS-8 Personnel Security Violations Database\n          # Format: DATE|USERNAME|VIOLATION_TYPE|SEVERITY|SANCTION|NOTIFIED|STATUS|DETAILS\n          # Initialized: {{ ansible_date_time.iso8601 }}\n        mode: '0640'\n        owner: root\n        group: security\n        force: no\n\n    - name: Deploy sanctions management script\n      copy:\n        dest: /usr/local/bin/ps8-sanctions\n        mode: '0750'\n        content: |\n          #!/bin/bash\n          # PS-8 Sanctions Management Utility\n          VIOLATIONS_DB=\"{{ violations_db }}\"\n          NOTIFY_EMAIL=\"{{ notification_recipients | join(',') }}\"\n          \n          log_violation() {\n              echo \"$(date +%Y-%m-%d_%H:%M:%S)|$1|$2|$3|PENDING|NO|OPEN|$4\" >> \"$VIOLATIONS_DB\"\n              if [ \"$3\" == \"SERIOUS\" ] || [ \"$3\" == \"SEVERE\" ]; then\n                  echo \"Notification required for $3 violation\"\n              fi\n          }\n          \n          case \"$1\" in\n              log) log_violation \"$2\" \"$3\" \"$4\" \"$5\" ;;\n              *) echo \"Usage: $0 log <user> <type> <severity> [details]\" ;;\n          esac\n\n    - name: Check for untracked security violations in logs\n      shell: |\n        violations=0\n        # Check auth failures\n        if [ -f /var/log/auth.log ]; then\n          sudo_fails=$(grep -c \"sudo:.*authentication failure\" /var/log/auth.log 2>/dev/null || echo 0)\n          violations=$((violations + sudo_fails))\n        fi\n        echo $violations\n      register: untracked_violations\n      changed_when: false\n\n    - name: Generate PS-8 compliance report\n      shell: |\n        echo \"=== PS-8 Compliance Report ===\"\n        echo \"Date: $(date)\"\n        echo \"Host: {{ inventory_hostname }}\"\n        echo \"\"\n        if [ -f \"{{ violations_db }}\" ]; then\n          total=$(grep -v \"^#\" \"{{ violations_db }}\" | wc -l)\n          serious=$(grep -E \"\\|SERIOUS\\||\\|SEVERE\\|\" \"{{ violations_db }}\" | wc -l)\n          notified=$(grep \"|YES|\" \"{{ violations_db }}\" | wc -l)\n          echo \"Total Violations: $total\"\n          echo \"Serious/Severe: $serious\"\n          echo \"Notifications Sent: $notified\"\n        else\n          echo \"No violations database found\"\n        fi\n      register: compliance_report\n\n    - name: Display compliance status\n      debug:\n        msg: \"{{ compliance_report.stdout_lines }}\""
      },
      "windows": {
        "powershell": "# PS-8: Personnel Sanctions Tracking and Compliance Script\n# Tracks security policy violations and manages notifications\n\n#Requires -Version 5.1\n\nparam(\n    [Parameter(Position=0)]\n    [ValidateSet(\"Log\", \"Report\", \"Audit\", \"Notify\")]\n    [string]$Action = \"Report\",\n    \n    [string]$Username,\n    [string]$ViolationType,\n    [ValidateSet(\"Minor\", \"Moderate\", \"Serious\", \"Severe\")]\n    [string]$Severity,\n    [string]$Details,\n    \n    [string]$ViolationsDBPath = \"C:\\Security\\PS8_Violations.csv\",\n    [string]$ReportPath = \"C:\\SecurityReports\\PS8\",\n    [string[]]$NotificationRecipients = @(\"ciso@organization.org\", \"hr@organization.org\")\n)\n\n$ErrorActionPreference = \"Continue\"\n\n# Initialize violations database\nfunction Initialize-ViolationsDB {\n    if (-not (Test-Path (Split-Path $ViolationsDBPath -Parent))) {\n        New-Item -ItemType Directory -Path (Split-Path $ViolationsDBPath -Parent) -Force | Out-Null\n    }\n    \n    if (-not (Test-Path $ViolationsDBPath)) {\n        $header = @(\n            [PSCustomObject]@{\n                Date = \"InitDate\"\n                Username = \"InitUser\"\n                ViolationType = \"Init\"\n                Severity = \"Init\"\n                Sanction = \"Init\"\n                Notified = \"Init\"\n                Status = \"Init\"\n                Details = \"Database Initialized\"\n            }\n        )\n        $header | Export-Csv -Path $ViolationsDBPath -NoTypeInformation\n        # Remove the init row\n        $content = Get-Content $ViolationsDBPath | Select-Object -First 1\n        $content | Set-Content $ViolationsDBPath\n    }\n}\n\n# Log a new violation\nfunction Add-Violation {\n    param(\n        [string]$User,\n        [string]$Type,\n        [string]$Sev,\n        [string]$Desc\n    )\n    \n    $violation = [PSCustomObject]@{\n        Date = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n        Username = $User\n        ViolationType = $Type\n        Severity = $Sev\n        Sanction = \"Pending\"\n        Notified = \"No\"\n        Status = \"Open\"\n        Details = $Desc\n    }\n    \n    $violation | Export-Csv -Path $ViolationsDBPath -Append -NoTypeInformation\n    Write-Host \"[LOGGED] Violation recorded for $User\" -ForegroundColor Yellow\n    \n    # Auto-notify for serious/severe\n    if ($Sev -in @(\"Serious\", \"Severe\")) {\n        Send-ViolationNotification -Violation $violation\n    }\n    \n    return $violation\n}\n\n# Send notification\nfunction Send-ViolationNotification {\n    param($Violation)\n    \n    $subject = \"[PS-8 ALERT] Security Violation - $($Violation.Severity)\"\n    $body = @\"\nPS-8 Personnel Sanctions Notification\n\nDate: $($Violation.Date)\nIndividual: $($Violation.Username)\nViolation Type: $($Violation.ViolationType)\nSeverity: $($Violation.Severity)\nDetails: $($Violation.Details)\n\nAction Required: Initiate formal sanctions review process.\nThis notification is required per NIST SP 800-53 PS-8.\n\"@\n\n    try {\n        # Attempt to send via SMTP\n        Send-MailMessage -To $NotificationRecipients -Subject $subject -Body $body `\n            -SmtpServer \"smtp.organization.org\" -From \"security-alerts@organization.org\" `\n            -ErrorAction SilentlyContinue\n        \n        # Update notification status\n        $violations = Import-Csv $ViolationsDBPath\n        $violations | Where-Object { $_.Username -eq $Violation.Username -and $_.Date -eq $Violation.Date } | \n            ForEach-Object { $_.Notified = \"Yes\" }\n        $violations | Export-Csv $ViolationsDBPath -NoTypeInformation\n        \n        Write-Host \"[NOTIFIED] Alert sent to: $($NotificationRecipients -join ', ')\" -ForegroundColor Green\n    }\n    catch {\n        Write-Host \"[WARNING] Email notification failed - logging for manual follow-up\" -ForegroundColor Yellow\n        # Log to event log as backup\n        Write-EventLog -LogName Application -Source \"PS8-Sanctions\" -EventId 1001 `\n            -EntryType Warning -Message $body -ErrorAction SilentlyContinue\n    }\n}\n\n# Generate compliance report\nfunction Get-ComplianceReport {\n    if (-not (Test-Path $ReportPath)) {\n        New-Item -ItemType Directory -Path $ReportPath -Force | Out-Null\n    }\n    \n    $reportFile = Join-Path $ReportPath \"PS8_Report_$(Get-Date -Format 'yyyyMMdd').html\"\n    \n    $violations = @()\n    if (Test-Path $ViolationsDBPath) {\n        $violations = Import-Csv $ViolationsDBPath\n    }\n    \n    $total = $violations.Count\n    $open = ($violations | Where-Object { $_.Status -eq \"Open\" }).Count\n    $serious = ($violations | Where-Object { $_.Severity -in @(\"Serious\", \"Severe\") }).Count\n    $notified = ($violations | Where-Object { $_.Notified -eq \"Yes\" }).Count\n    \n    # Check for serious violations without notification (compliance failure)\n    $unnotifiedSerious = ($violations | Where-Object { \n        $_.Severity -in @(\"Serious\", \"Severe\") -and $_.Notified -eq \"No\" \n    }).Count\n    \n    $complianceStatus = if ($unnotifiedSerious -eq 0) { \"PASS\" } else { \"FAIL\" }\n    \n    $html = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <title>PS-8 Personnel Sanctions Compliance Report</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        .pass { color: green; font-weight: bold; }\n        .fail { color: red; font-weight: bold; }\n        table { border-collapse: collapse; width: 100%; }\n        th, td { border: 1px solid #ddd; padding: 8px; }\n        th { background-color: #4472C4; color: white; }\n    </style>\n</head>\n<body>\n    <h1>PS-8 Personnel Sanctions Compliance Report</h1>\n    <p><strong>Date:</strong> $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</p>\n    <p><strong>Host:</strong> $env:COMPUTERNAME</p>\n    \n    <h2>Summary</h2>\n    <ul>\n        <li>Total Violations: $total</li>\n        <li>Open Cases: $open</li>\n        <li>Serious/Severe: $serious</li>\n        <li>Notifications Sent: $notified</li>\n        <li>Unnotified Serious: $unnotifiedSerious</li>\n    </ul>\n    \n    <p><strong>Compliance Status:</strong> <span class=\"$(if ($complianceStatus -eq 'PASS') {'pass'} else {'fail'})\">$complianceStatus</span></p>\n    \n    <h2>Violation Details</h2>\n    <table>\n        <tr><th>Date</th><th>User</th><th>Type</th><th>Severity</th><th>Status</th><th>Notified</th></tr>\n        $($violations | ForEach-Object {\n            \"<tr><td>$($_.Date)</td><td>$($_.Username)</td><td>$($_.ViolationType)</td><td>$($_.Severity)</td><td>$($_.Status)</td><td>$($_.Notified)</td></tr>\"\n        })\n    </table>\n</body>\n</html>\n\"@\n\n    $html | Out-File $reportFile -Encoding UTF8\n    \n    Write-Host \"\"\n    Write-Host \"=== PS-8 Personnel Sanctions Compliance Report ===\" -ForegroundColor Cyan\n    Write-Host \"Date: $(Get-Date)\"\n    Write-Host \"Total Violations: $total\"\n    Write-Host \"Open Cases: $open\"\n    Write-Host \"Serious/Severe: $serious\"\n    Write-Host \"Notifications Sent: $notified\"\n    Write-Host \"\"\n    Write-Host \"Compliance Status: $complianceStatus\" -ForegroundColor $(if ($complianceStatus -eq \"PASS\") {\"Green\"} else {\"Red\"})\n    Write-Host \"Report saved: $reportFile\"\n    \n    return @{\n        ComplianceStatus = $complianceStatus\n        TotalViolations = $total\n        OpenCases = $open\n        SeriousViolations = $serious\n        ReportPath = $reportFile\n    }\n}\n\n# Audit Windows security events for violations\nfunction Invoke-SecurityAudit {\n    Write-Host \"[AUDIT] Scanning Windows Security logs for policy violations...\" -ForegroundColor Cyan\n    \n    $violations = @()\n    \n    # Check for failed logon attempts (potential unauthorized access)\n    try {\n        $failedLogons = Get-WinEvent -FilterHashtable @{\n            LogName = 'Security'\n            ID = 4625  # Failed logon\n            StartTime = (Get-Date).AddDays(-1)\n        } -MaxEvents 100 -ErrorAction SilentlyContinue\n        \n        $groupedFailures = $failedLogons | Group-Object { $_.Properties[5].Value } | \n            Where-Object { $_.Count -ge 5 }\n        \n        foreach ($group in $groupedFailures) {\n            Write-Host \"[FINDING] Multiple failed logons for: $($group.Name) ($($group.Count) attempts)\"\n            $violations += @{\n                User = $group.Name\n                Type = \"MULTIPLE_FAILED_LOGONS\"\n                Severity = \"Moderate\"\n                Details = \"$($group.Count) failed logon attempts in 24 hours\"\n            }\n        }\n    } catch {\n        Write-Host \"[INFO] Could not query security log: $_\"\n    }\n    \n    # Check for privilege escalation attempts\n    try {\n        $privEsc = Get-WinEvent -FilterHashtable @{\n            LogName = 'Security'\n            ID = 4673  # Sensitive privilege use\n            StartTime = (Get-Date).AddDays(-1)\n        } -MaxEvents 50 -ErrorAction SilentlyContinue\n        \n        Write-Host \"[INFO] Found $($privEsc.Count) privilege use events to review\"\n    } catch {\n        Write-Host \"[INFO] Could not query privilege events\"\n    }\n    \n    Write-Host \"[AUDIT] Scan complete. Found $($violations.Count) potential violations.\"\n    return $violations\n}\n\n# Main execution\nInitialize-ViolationsDB\n\nswitch ($Action) {\n    \"Log\" {\n        if (-not $Username -or -not $ViolationType -or -not $Severity) {\n            Write-Host \"Usage: .\\PS8-Sanctions.ps1 -Action Log -Username <user> -ViolationType <type> -Severity <Minor|Moderate|Serious|Severe> [-Details <description>]\"\n            exit 1\n        }\n        Add-Violation -User $Username -Type $ViolationType -Sev $Severity -Desc $Details\n    }\n    \"Report\" {\n        $result = Get-ComplianceReport\n        if ($result.ComplianceStatus -eq \"FAIL\") { exit 1 } else { exit 0 }\n    }\n    \"Audit\" {\n        Invoke-SecurityAudit\n    }\n    \"Notify\" {\n        if (-not $Username -or -not $ViolationType -or -not $Severity) {\n            Write-Host \"Usage: .\\PS8-Sanctions.ps1 -Action Notify -Username <user> -ViolationType <type> -Severity <severity>\"\n            exit 1\n        }\n        $violation = [PSCustomObject]@{\n            Date = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n            Username = $Username\n            ViolationType = $ViolationType\n            Severity = $Severity\n            Details = $Details\n        }\n        Send-ViolationNotification -Violation $violation\n    }\n}",
        "ansible": "---\n# PS-8: Personnel Sanctions Compliance for Windows\n\n- name: PS-8 Personnel Sanctions Management (Windows)\n  hosts: windows\n  gather_facts: yes\n  vars:\n    violations_db: \"C:\\\\Security\\\\PS8_Violations.csv\"\n    report_path: \"C:\\\\SecurityReports\\\\PS8\"\n    notification_recipients:\n      - ciso@organization.org\n      - hr@organization.org\n\n  tasks:\n    - name: Create security directories\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - C:\\Security\n        - \"{{ report_path }}\"\n\n    - name: Check for existing violations database\n      win_stat:\n        path: \"{{ violations_db }}\"\n      register: db_exists\n\n    - name: Initialize violations database if not exists\n      win_copy:\n        dest: \"{{ violations_db }}\"\n        content: |\n          \"Date\",\"Username\",\"ViolationType\",\"Severity\",\"Sanction\",\"Notified\",\"Status\",\"Details\"\n      when: not db_exists.stat.exists\n\n    - name: Audit security events for violations\n      win_shell: |\n        # Check for multiple failed logons\n        $violations = @()\n        try {\n            $failedLogons = Get-WinEvent -FilterHashtable @{\n                LogName = 'Security'; ID = 4625\n                StartTime = (Get-Date).AddHours(-24)\n            } -MaxEvents 100 -ErrorAction SilentlyContinue\n            \n            $grouped = $failedLogons | Group-Object { $_.Properties[5].Value } | \n                Where-Object { $_.Count -ge 5 }\n            \n            foreach ($g in $grouped) {\n                $violations += \"$($g.Name):$($g.Count) failed logons\"\n            }\n        } catch {}\n        \n        if ($violations.Count -gt 0) {\n            $violations -join \"; \"\n        } else {\n            \"No violations detected\"\n        }\n      register: security_audit\n\n    - name: Generate compliance summary\n      win_shell: |\n        if (Test-Path '{{ violations_db }}') {\n            $violations = Import-Csv '{{ violations_db }}'\n            $total = $violations.Count\n            $serious = ($violations | Where-Object { $_.Severity -in @('Serious','Severe') }).Count\n            $notified = ($violations | Where-Object { $_.Notified -eq 'Yes' }).Count\n            @{\n                Total = $total\n                Serious = $serious\n                Notified = $notified\n                Status = if (($violations | Where-Object { $_.Severity -in @('Serious','Severe') -and $_.Notified -eq 'No' }).Count -eq 0) { 'PASS' } else { 'FAIL' }\n            } | ConvertTo-Json\n        } else {\n            @{ Total = 0; Serious = 0; Notified = 0; Status = 'PASS' } | ConvertTo-Json\n        }\n      register: compliance_summary\n\n    - name: Display PS-8 compliance status\n      debug:\n        msg: |\n          === PS-8 Personnel Sanctions Compliance ===\n          Host: {{ inventory_hostname }}\n          Security Audit: {{ security_audit.stdout }}\n          Compliance: {{ compliance_summary.stdout }}"
      }
    },
    "metadata": {
      "status": "enhanced",
      "last_updated": "2025-11-22",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control is organizational/procedural. Technical controls support violation detection and notification automation, but the sanctions process itself requires human judgment, HR involvement, and legal review."
    },
    "ai_guidance": "PS-8 Personnel Sanctions establishes accountability through formal disciplinary processes for security policy violations. AI-assisted compliance can enhance this control by: (1) Automatically detecting potential policy violations through analysis of security logs, DLP alerts, access control logs, and user behavior analytics, then flagging them for human review; (2) Maintaining a centralized violations database that tracks all reported incidents, investigation status, sanctions imposed, and notification compliance; (3) Automating notifications to designated personnel (CISO, HR, Legal) when serious violations are detected, ensuring the organization meets notification timeframe requirements; (4) Analyzing violation patterns across the organization to identify systemic issues, training gaps, or high-risk individuals requiring additional attention; (5) Generating compliance reports showing sanctions process metrics including time-to-notification, violation trends, and sanction consistency; (6) Cross-referencing violations against the violator's access privileges to recommend appropriate access restrictions during investigation; (7) Tracking sanction outcomes to ensure similar violations receive consistent treatment across the organization. Integration with HR case management systems enables end-to-end tracking from violation detection through sanction completion. The notification requirement can be fully automated for detected technical violations, though human judgment remains essential for sanction determination.",
    "implementation_guidance": "Organizations should implement these key measures for PS-8 compliance:\n\n1. **Sanctions Policy**: Develop a formal sanctions policy defining: violation categories (minor, moderate, serious, severe), corresponding consequences for each category, escalation procedures for repeat violations, factors affecting sanction severity, due process/appeal procedures, and documentation requirements.\n\n2. **Violation Tracking System**: Implement a system to record all security violations including: date/time, individual involved, violation type, evidence, investigation findings, sanction imposed, notification recipients, and resolution status.\n\n3. **Notification Workflow**: Configure automated notifications when sanctions are initiated. Define recipients (CISO, HR, Legal, management chain), notification timeframes (per organizational policy), and required content (individual identity, violation description, proposed action).\n\n4. **Integration with Security Monitoring**: Connect SIEM, DLP, and access control systems to flag potential violations for review. Establish triage procedures for automated alerts.\n\n5. **Sanctions Matrix**: Create a matrix mapping violation types to appropriate sanctions ensuring consistency across the organization. Review with Legal/HR for compliance with employment law.\n\n6. **Training**: Train managers on violation recognition, documentation requirements, and their role in the sanctions process. Train all employees on the sanctions policy during onboarding and annual refresher training.\n\n7. **Metrics and Review**: Track sanctions metrics (violations by type, time-to-resolution, sanction consistency) and conduct quarterly reviews to identify trends and policy improvement opportunities."
  },
  {
    "control_id": "PS-9",
    "control_name": "Position Descriptions",
    "family": "Personnel Security",
    "family_id": "PS",
    "stig_id": null,
    "official_text": "Incorporate security and privacy roles and responsibilities into organizational position descriptions.",
    "source": "NIST SP 800-53 Rev 5",
    "baselines": {
      "low": true,
      "moderate": true,
      "high": true
    },
    "intent": "To ensure that security and privacy responsibilities are formally documented in job descriptions, creating clear accountability and enabling role-based security training and access decisions. This control integrates security into the fundamental HR infrastructure of position management.",
    "rationale": "When security responsibilities are not documented in position descriptions, employees may be unaware of their security obligations, unable to be held accountable for security failures, and receive inappropriate or insufficient security training. Formal documentation of security roles enables proper role-based access control, targeted security training, and clear accountability for security functions.",
    "plain_english_explanation": "This control requires organizations to update their job descriptions (position descriptions) to include security and privacy responsibilities relevant to each role. This is not just for IT security staff - every position that accesses organizational systems or data should have appropriate security responsibilities documented. For example: (1) An administrative assistant's position description should include responsibilities for protecting sensitive documents, following clean desk policies, and reporting suspicious activities; (2) A system administrator's position description should include responsibilities for maintaining security configurations, reviewing logs, and responding to security incidents; (3) A manager's position description should include responsibilities for ensuring their team completes security training and follows security policies; (4) A developer's position description should include responsibilities for secure coding practices and protecting source code. The benefits of this control include: clear accountability (employees know what security actions they are responsible for), proper training alignment (training can be targeted to documented responsibilities), performance evaluation basis (security responsibilities can be assessed during reviews), and legal protection (documented responsibilities support disciplinary actions for security failures).",
    "example_implementation": "Implement a comprehensive position description security integration program: (1) Develop a catalog of security and privacy responsibilities organized by job family and sensitivity level; (2) Work with HR to identify all position descriptions requiring security responsibility updates; (3) For each position, determine appropriate security responsibilities based on data access, system privileges, and job functions; (4) Draft security responsibility language for each position description using standardized templates; (5) Coordinate with HR, Legal, and hiring managers to review and approve updated position descriptions; (6) Update position descriptions in the HR system of record; (7) Communicate changes to current employees through updated duty statements; (8) Integrate position-based security responsibilities into training management to ensure employees receive training aligned with their documented responsibilities; (9) Review and update position descriptions annually or when roles change significantly.",
    "non_technical_guidance": "Organizations should implement these administrative procedures for PS-9 compliance:\n\n1. **Security Responsibility Catalog**:\n   Develop standardized security responsibilities by role category:\n   \n   **All Employees:**\n   - Complete required security awareness training\n   - Report security incidents and suspicious activities\n   - Protect credentials and access badges\n   - Follow acceptable use and data handling policies\n   - Maintain confidentiality of sensitive information\n   \n   **Managers/Supervisors:**\n   - Ensure team compliance with security policies\n   - Approve access requests based on need-to-know\n   - Support security training completion\n   - Address security violations through appropriate channels\n   \n   **IT/Technical Staff:**\n   - Maintain security configurations per standards\n   - Monitor and respond to security events\n   - Implement security controls during system changes\n   - Follow secure development and operations practices\n   \n   **Information Owners:**\n   - Classify data under their stewardship\n   - Authorize access to their information\n   - Review access permissions periodically\n   - Ensure proper handling and protection of data\n\n2. **Position Description Integration Process**:\n   - Inventory all position descriptions in the organization\n   - Categorize positions by security sensitivity (risk designation)\n   - Map appropriate security responsibilities to each position\n   - Draft updated position descriptions with security language\n   - Obtain HR, Legal, and management approval\n   - Update official position descriptions in HR systems\n   - Communicate changes to incumbents\n\n3. **Ongoing Maintenance**:\n   - Review position descriptions when creating new positions\n   - Update security responsibilities when roles change\n   - Conduct annual review of position description accuracy\n   - Align with changes to security policies and requirements\n\n4. **Training Alignment**:\n   - Map security training requirements to position responsibilities\n   - Ensure role-based training covers documented responsibilities\n   - Track training completion against position requirements\n\n5. **Performance Integration**:\n   - Include security responsibility fulfillment in performance criteria\n   - Evaluate security performance during regular reviews\n   - Recognize exemplary security performance",
    "is_technical": false,
    "enhancements": [],
    "related_controls": [
      "AC-2",
      "AT-2",
      "AT-3",
      "PL-2",
      "PL-4",
      "PM-2",
      "PM-13",
      "PS-2",
      "PS-6",
      "PS-7",
      "SA-3",
      "SI-12"
    ],
    "supplemental_guidance": "The specification of security and privacy roles in individual organizational position descriptions facilitates clarity in understanding the security or privacy responsibilities associated with the roles and the role-based security and privacy training requirements for the roles. Position descriptions are also used in human resource management activities, including position risk designation (PS-2), and support accountability and due diligence in security and privacy-related matters. Organizations consider the spectrum of positions, from senior executives to entry-level employees, when developing position descriptions with security and privacy roles.",
    "implementation_scripts": {
      "linux": {
        "bash": "#!/bin/bash\n# PS-9: Position Descriptions Security Compliance Audit\n# Verifies security roles are documented and aligned with system access\n\nREPORT_DIR=\"/var/log/security/ps9_audits\"\nREPORT_FILE=\"${REPORT_DIR}/ps9_position_audit_$(date +%Y%m%d).txt\"\nHR_POSITIONS_FILE=\"/var/hr/position_descriptions.csv\"\nACCESS_ROLES_FILE=\"/etc/security/access_roles.conf\"\n\nmkdir -p \"$REPORT_DIR\"\n\necho \"=== PS-9 Position Descriptions Security Audit ===\" > \"$REPORT_FILE\"\necho \"Date: $(date)\" >> \"$REPORT_FILE\"\necho \"Host: $(hostname)\" >> \"$REPORT_FILE\"\necho \"\" >> \"$REPORT_FILE\"\n\n# Function to check if users have documented security responsibilities\ncheck_user_positions() {\n    echo \"[CHECK] Auditing user accounts against position descriptions...\" >> \"$REPORT_FILE\"\n    \n    # Get all human users (UID >= 1000)\n    getent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}' | while read username; do\n        # Check if user has documented position\n        if [ -f \"$HR_POSITIONS_FILE\" ]; then\n            position=$(grep -i \"^${username},\" \"$HR_POSITIONS_FILE\" 2>/dev/null | cut -d',' -f2)\n            sec_role=$(grep -i \"^${username},\" \"$HR_POSITIONS_FILE\" 2>/dev/null | cut -d',' -f3)\n            \n            if [ -z \"$position\" ]; then\n                echo \"[WARNING] No position description found for user: $username\" >> \"$REPORT_FILE\"\n            elif [ -z \"$sec_role\" ]; then\n                echo \"[WARNING] No security role documented for: $username (Position: $position)\" >> \"$REPORT_FILE\"\n            else\n                echo \"[OK] $username - Position: $position, Security Role: $sec_role\" >> \"$REPORT_FILE\"\n            fi\n        else\n            echo \"[INFO] User: $username (HR position file not configured)\" >> \"$REPORT_FILE\"\n        fi\n        \n        # Check user's actual system groups/roles\n        groups=$(groups \"$username\" 2>/dev/null | cut -d: -f2)\n        echo \"  System Groups: $groups\" >> \"$REPORT_FILE\"\n    done\n}\n\n# Check privileged users have appropriate security role documentation\ncheck_privileged_users() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"[CHECK] Auditing privileged users for security role documentation...\" >> \"$REPORT_FILE\"\n    \n    # Check sudo users\n    echo \"  Sudoers:\" >> \"$REPORT_FILE\"\n    grep -E '^[^#].*ALL=' /etc/sudoers /etc/sudoers.d/* 2>/dev/null | \n        grep -oE '^[^:]+' | sort -u | while read sudoer; do\n        if [ \"$sudoer\" != \"root\" ]; then\n            echo \"    - $sudoer (requires documented admin security responsibilities)\" >> \"$REPORT_FILE\"\n        fi\n    done\n    \n    # Check wheel/admin group members\n    echo \"  Admin Group Members:\" >> \"$REPORT_FILE\"\n    for group in wheel sudo admin; do\n        members=$(getent group \"$group\" 2>/dev/null | cut -d: -f4)\n        if [ -n \"$members\" ]; then\n            echo \"    Group '$group': $members\" >> \"$REPORT_FILE\"\n        fi\n    done\n}\n\n# Generate security role requirements by access level\ngenerate_role_requirements() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"[INFO] Recommended Security Responsibilities by Access Level:\" >> \"$REPORT_FILE\"\n    \n    cat >> \"$REPORT_FILE\" << 'ROLES'\n    \n    STANDARD USER:\n    - Complete annual security awareness training\n    - Protect credentials and report compromises immediately\n    - Follow acceptable use policy\n    - Report security incidents and suspicious activities\n    - Maintain clean desk and clear screen practices\n    \n    PRIVILEGED USER (sudo/admin access):\n    - All standard user responsibilities, plus:\n    - Use privileged access only for authorized administrative tasks\n    - Log and justify all privileged actions\n    - Maintain current security certifications as required\n    - Participate in security incident response as needed\n    \n    SYSTEM ADMINISTRATOR:\n    - All privileged user responsibilities, plus:\n    - Maintain security configurations per organizational standards\n    - Monitor systems for security events and anomalies\n    - Implement security patches within required timeframes\n    - Document and review access grants\n    - Support security audits and assessments\n    \n    SECURITY PERSONNEL:\n    - All system administrator responsibilities, plus:\n    - Develop and maintain security policies and procedures\n    - Conduct security assessments and audits\n    - Lead incident response activities\n    - Provide security guidance to the organization\n    - Manage security tools and technologies\nROLES\n}\n\n# Create sample position descriptions file if not exists\ncreate_sample_config() {\n    if [ ! -f \"$HR_POSITIONS_FILE\" ]; then\n        mkdir -p \"$(dirname \"$HR_POSITIONS_FILE\")\"\n        cat > \"$HR_POSITIONS_FILE\" << 'SAMPLE'\n# PS-9 Position Descriptions with Security Roles\n# Format: username,position_title,security_role,last_updated\n# Security Roles: standard_user, privileged_user, sysadmin, security_admin, manager\n#\n# Example entries:\n# jsmith,Software Developer,privileged_user,2025-01-15\n# mjones,System Administrator,sysadmin,2025-01-15\n# admin,Security Analyst,security_admin,2025-01-15\nSAMPLE\n        echo \"[INFO] Created sample position descriptions file: $HR_POSITIONS_FILE\" >> \"$REPORT_FILE\"\n    fi\n}\n\n# Generate compliance summary\ngenerate_summary() {\n    echo \"\" >> \"$REPORT_FILE\"\n    echo \"=== COMPLIANCE SUMMARY ===\" >> \"$REPORT_FILE\"\n    \n    local total_users=$(getent passwd | awk -F: '$3 >= 1000 && $3 < 65534' | wc -l)\n    local documented=0\n    local undocumented=0\n    \n    if [ -f \"$HR_POSITIONS_FILE\" ]; then\n        documented=$(grep -v \"^#\" \"$HR_POSITIONS_FILE\" | grep -c \",\")\n    fi\n    \n    undocumented=$((total_users - documented))\n    \n    echo \"Total User Accounts: $total_users\" >> \"$REPORT_FILE\"\n    echo \"Positions Documented: $documented\" >> \"$REPORT_FILE\"\n    echo \"Positions Undocumented: $undocumented\" >> \"$REPORT_FILE\"\n    \n    if [ $undocumented -gt 0 ]; then\n        echo \"\" >> \"$REPORT_FILE\"\n        echo \"[RESULT] PS-9 Compliance: REVIEW REQUIRED\" >> \"$REPORT_FILE\"\n        echo \"Action: Update position descriptions to include security responsibilities\" >> \"$REPORT_FILE\"\n        exit 1\n    else\n        echo \"\" >> \"$REPORT_FILE\"\n        echo \"[RESULT] PS-9 Compliance: PASS\" >> \"$REPORT_FILE\"\n        exit 0\n    fi\n}\n\n# Main execution\ncreate_sample_config\ncheck_user_positions\ncheck_privileged_users\ngenerate_role_requirements\ngenerate_summary\n\ncat \"$REPORT_FILE\"",
        "ansible": "---\n# PS-9: Position Descriptions Security Compliance Playbook\n# Audits and reports on security role documentation\n\n- name: PS-9 Position Descriptions Compliance Audit\n  hosts: all\n  become: yes\n  vars:\n    hr_positions_file: \"/var/hr/position_descriptions.csv\"\n    report_dir: \"/var/log/security/ps9_audits\"\n    security_roles:\n      standard_user:\n        - \"Complete annual security awareness training\"\n        - \"Protect credentials and report compromises\"\n        - \"Follow acceptable use policy\"\n        - \"Report security incidents\"\n      privileged_user:\n        - \"Use privileged access only for authorized tasks\"\n        - \"Log and justify privileged actions\"\n        - \"Maintain required security certifications\"\n      sysadmin:\n        - \"Maintain security configurations\"\n        - \"Monitor for security events\"\n        - \"Implement security patches\"\n        - \"Support security audits\"\n      security_admin:\n        - \"Develop security policies\"\n        - \"Conduct security assessments\"\n        - \"Lead incident response\"\n        - \"Manage security tools\"\n\n  tasks:\n    - name: Create audit directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        mode: '0750'\n      loop:\n        - \"{{ report_dir }}\"\n        - \"{{ hr_positions_file | dirname }}\"\n\n    - name: Get all user accounts\n      getent:\n        database: passwd\n      register: all_users\n\n    - name: Identify human user accounts (UID >= 1000)\n      set_fact:\n        human_users: \"{{ all_users.ansible_facts.getent_passwd | \n          dict2items | \n          selectattr('value.1', 'ge', '1000') | \n          selectattr('value.1', 'lt', '65534') | \n          map(attribute='key') | list }}\"\n\n    - name: Check for position descriptions file\n      stat:\n        path: \"{{ hr_positions_file }}\"\n      register: positions_file\n\n    - name: Read position descriptions if exists\n      slurp:\n        src: \"{{ hr_positions_file }}\"\n      register: positions_content\n      when: positions_file.stat.exists\n\n    - name: Parse position descriptions\n      set_fact:\n        documented_users: \"{{ (positions_content.content | b64decode).split('\\n') | \n          select('match', '^[^#]') | \n          map('regex_replace', ',.*', '') | list }}\"\n      when: positions_file.stat.exists\n\n    - name: Calculate compliance metrics\n      set_fact:\n        total_users: \"{{ human_users | length }}\"\n        documented_count: \"{{ documented_users | default([]) | length }}\"\n        undocumented_users: \"{{ human_users | difference(documented_users | default([])) }}\"\n\n    - name: Get privileged users (sudoers)\n      shell: |\n        grep -E '^[^#].*ALL=' /etc/sudoers /etc/sudoers.d/* 2>/dev/null | \n          grep -oE '^[^:]+' | sort -u || true\n      register: sudoers_list\n      changed_when: false\n\n    - name: Generate compliance report\n      template:\n        src: ps9_report.j2\n        dest: \"{{ report_dir }}/ps9_audit_{{ ansible_date_time.date }}.txt\"\n        mode: '0640'\n      vars:\n        report_date: \"{{ ansible_date_time.iso8601 }}\"\n        privileged_users: \"{{ sudoers_list.stdout_lines }}\"\n\n    - name: Display compliance status\n      debug:\n        msg: |\n          === PS-9 Position Descriptions Compliance ===\n          Host: {{ inventory_hostname }}\n          \n          Total User Accounts: {{ total_users }}\n          Documented Positions: {{ documented_count }}\n          Undocumented: {{ undocumented_users | length }}\n          \n          Undocumented Users: {{ undocumented_users | join(', ') if undocumented_users else 'None' }}\n          \n          Privileged Users Requiring Documentation:\n          {{ sudoers_list.stdout_lines | join('\\n') }}\n          \n          Compliance Status: {{ 'PASS' if (undocumented_users | length == 0) else 'REVIEW REQUIRED' }}\n\n    - name: Create sample position descriptions template\n      copy:\n        dest: \"{{ hr_positions_file }}\"\n        content: |\n          # PS-9 Position Descriptions with Security Roles\n          # Format: username,position_title,security_role,last_updated\n          # \n          # Security Roles:\n          #   standard_user - Basic user responsibilities\n          #   privileged_user - Admin/sudo access\n          #   sysadmin - System administrator\n          #   security_admin - Security personnel\n          #\n          {% for user in human_users %}\n          # {{ user }},Position Title,security_role,{{ ansible_date_time.date }}\n          {% endfor %}\n        mode: '0640'\n      when: not positions_file.stat.exists"
      },
      "windows": {
        "powershell": "# PS-9: Position Descriptions Security Compliance Audit\n# Verifies security roles are documented in position descriptions\n\n#Requires -Version 5.1\n\nparam(\n    [string]$PositionDescriptionsPath = \"C:\\HR\\PositionDescriptions.csv\",\n    [string]$ReportPath = \"C:\\SecurityReports\\PS9\",\n    [switch]$GenerateTemplate\n)\n\n$ErrorActionPreference = \"Continue\"\n$ReportDate = Get-Date -Format \"yyyyMMdd_HHmmss\"\n$ReportFile = Join-Path $ReportPath \"PS9_Audit_$ReportDate.html\"\n\n# Ensure directories exist\nif (-not (Test-Path $ReportPath)) {\n    New-Item -ItemType Directory -Path $ReportPath -Force | Out-Null\n}\nif (-not (Test-Path (Split-Path $PositionDescriptionsPath -Parent))) {\n    New-Item -ItemType Directory -Path (Split-Path $PositionDescriptionsPath -Parent) -Force | Out-Null\n}\n\n# Security role definitions\n$SecurityRoles = @{\n    \"standard_user\" = @(\n        \"Complete annual security awareness training\",\n        \"Protect credentials and report compromises immediately\",\n        \"Follow acceptable use and data handling policies\",\n        \"Report security incidents and suspicious activities\",\n        \"Maintain clean desk and clear screen practices\"\n    )\n    \"privileged_user\" = @(\n        \"Use administrative access only for authorized tasks\",\n        \"Log and document all privileged activities\",\n        \"Maintain required technical certifications\",\n        \"Participate in security incident response\"\n    )\n    \"sysadmin\" = @(\n        \"Maintain security configurations per standards\",\n        \"Monitor systems for security events\",\n        \"Implement security patches within SLA\",\n        \"Support security audits and assessments\",\n        \"Document and review access grants\"\n    )\n    \"security_admin\" = @(\n        \"Develop and maintain security policies\",\n        \"Conduct security assessments and audits\",\n        \"Lead incident response activities\",\n        \"Manage security tools and technologies\",\n        \"Provide security guidance to organization\"\n    )\n    \"manager\" = @(\n        \"Ensure team compliance with security policies\",\n        \"Approve access requests based on need-to-know\",\n        \"Support security training completion\",\n        \"Address security violations appropriately\"\n    )\n}\n\nfunction Get-ADUsersWithAccess {\n    $users = @()\n    \n    try {\n        Import-Module ActiveDirectory -ErrorAction Stop\n        \n        # Get all enabled users\n        $adUsers = Get-ADUser -Filter {Enabled -eq $true} -Properties `\n            Title, Department, Manager, MemberOf, Description | \n            Where-Object { $_.SamAccountName -notlike \"*$\" }  # Exclude computer accounts\n        \n        foreach ($user in $adUsers) {\n            $isPrivileged = $false\n            $isAdmin = $false\n            \n            # Check for privileged group membership\n            $groups = $user.MemberOf | ForEach-Object { (Get-ADGroup $_).Name }\n            \n            $adminGroups = @(\"Domain Admins\", \"Enterprise Admins\", \"Administrators\", \n                            \"Server Operators\", \"Backup Operators\", \"Account Operators\")\n            \n            foreach ($group in $groups) {\n                if ($adminGroups -contains $group) {\n                    $isAdmin = $true\n                    $isPrivileged = $true\n                    break\n                }\n                if ($group -like \"*admin*\" -or $group -like \"*privileged*\") {\n                    $isPrivileged = $true\n                }\n            }\n            \n            $users += [PSCustomObject]@{\n                Username = $user.SamAccountName\n                DisplayName = $user.Name\n                Title = $user.Title\n                Department = $user.Department\n                Manager = if ($user.Manager) { (Get-ADUser $user.Manager).Name } else { \"None\" }\n                IsAdmin = $isAdmin\n                IsPrivileged = $isPrivileged\n                Groups = ($groups -join \", \")\n            }\n        }\n    }\n    catch {\n        Write-Host \"[WARNING] Cannot query AD: $($_.Exception.Message)\"\n        # Fall back to local users\n        Get-LocalUser | Where-Object { $_.Enabled } | ForEach-Object {\n            $users += [PSCustomObject]@{\n                Username = $_.Name\n                DisplayName = $_.FullName\n                Title = \"Local User\"\n                Department = \"N/A\"\n                Manager = \"N/A\"\n                IsAdmin = ($_ | Get-LocalGroupMember -Group \"Administrators\" -ErrorAction SilentlyContinue) -ne $null\n                IsPrivileged = $false\n                Groups = \"N/A\"\n            }\n        }\n    }\n    \n    return $users\n}\n\nfunction Get-PositionDescriptions {\n    if (Test-Path $PositionDescriptionsPath) {\n        return Import-Csv $PositionDescriptionsPath\n    }\n    return @()\n}\n\nfunction New-PositionDescriptionsTemplate {\n    param($Users)\n    \n    $template = @()\n    foreach ($user in $Users) {\n        $suggestedRole = \"standard_user\"\n        if ($user.IsAdmin) { $suggestedRole = \"sysadmin\" }\n        elseif ($user.IsPrivileged) { $suggestedRole = \"privileged_user\" }\n        elseif ($user.Title -like \"*manager*\" -or $user.Title -like \"*director*\") { $suggestedRole = \"manager\" }\n        \n        $template += [PSCustomObject]@{\n            Username = $user.Username\n            DisplayName = $user.DisplayName\n            PositionTitle = $user.Title\n            Department = $user.Department\n            SecurityRole = $suggestedRole\n            SecurityResponsibilities = ($SecurityRoles[$suggestedRole] -join \"; \")\n            LastUpdated = Get-Date -Format \"yyyy-MM-dd\"\n            Status = \"PENDING_REVIEW\"\n        }\n    }\n    \n    $template | Export-Csv -Path $PositionDescriptionsPath -NoTypeInformation\n    Write-Host \"[INFO] Position descriptions template created: $PositionDescriptionsPath\"\n}\n\nfunction Invoke-PS9Audit {\n    Write-Host \"[AUDIT] Starting PS-9 Position Descriptions compliance audit...\" -ForegroundColor Cyan\n    \n    $users = Get-ADUsersWithAccess\n    $positions = Get-PositionDescriptions\n    \n    $results = @()\n    $undocumented = @()\n    $documented = @()\n    \n    foreach ($user in $users) {\n        $position = $positions | Where-Object { $_.Username -eq $user.Username }\n        \n        $finding = [PSCustomObject]@{\n            Username = $user.Username\n            DisplayName = $user.DisplayName\n            Title = $user.Title\n            Department = $user.Department\n            IsPrivileged = $user.IsPrivileged\n            IsAdmin = $user.IsAdmin\n            HasPositionDoc = ($null -ne $position)\n            SecurityRole = if ($position) { $position.SecurityRole } else { \"NOT_DOCUMENTED\" }\n            Status = \"OK\"\n            Issues = @()\n        }\n        \n        if (-not $position) {\n            $finding.Status = \"WARNING\"\n            $finding.Issues += \"No position description with security role\"\n            $undocumented += $user.Username\n        }\n        else {\n            $documented += $user.Username\n            \n            if ([string]::IsNullOrEmpty($position.SecurityRole)) {\n                $finding.Status = \"WARNING\"\n                $finding.Issues += \"Security role not specified in position description\"\n            }\n            \n            if ([string]::IsNullOrEmpty($position.SecurityResponsibilities)) {\n                $finding.Status = \"WARNING\"\n                $finding.Issues += \"Security responsibilities not documented\"\n            }\n        }\n        \n        # Flag privileged users without adequate documentation\n        if ($user.IsPrivileged -and -not $position) {\n            $finding.Status = \"CRITICAL\"\n            $finding.Issues += \"Privileged user without documented security responsibilities\"\n        }\n        \n        $results += $finding\n    }\n    \n    return @{\n        Results = $results\n        TotalUsers = $users.Count\n        Documented = $documented.Count\n        Undocumented = $undocumented\n        PrivilegedUsers = ($users | Where-Object { $_.IsPrivileged }).Count\n        ComplianceStatus = if ($undocumented.Count -eq 0) { \"PASS\" } else { \"REVIEW_REQUIRED\" }\n    }\n}\n\nfunction Export-AuditReport {\n    param($AuditResults)\n    \n    $html = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <title>PS-9 Position Descriptions Compliance Audit</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        h1, h2 { color: #333; }\n        .summary { background: #f5f5f5; padding: 15px; margin: 20px 0; border-radius: 5px; }\n        .pass { color: green; font-weight: bold; }\n        .fail { color: red; font-weight: bold; }\n        .warning { color: orange; }\n        table { border-collapse: collapse; width: 100%; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #4472C4; color: white; }\n        tr:nth-child(even) { background-color: #f9f9f9; }\n        .role-section { background: #e8f4e8; padding: 10px; margin: 10px 0; }\n    </style>\n</head>\n<body>\n    <h1>PS-9 Position Descriptions Compliance Audit</h1>\n    \n    <div class=\"summary\">\n        <p><strong>Date:</strong> $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</p>\n        <p><strong>Host:</strong> $env:COMPUTERNAME</p>\n        <p><strong>Total Users:</strong> $($AuditResults.TotalUsers)</p>\n        <p><strong>Documented:</strong> $($AuditResults.Documented)</p>\n        <p><strong>Undocumented:</strong> $($AuditResults.Undocumented.Count)</p>\n        <p><strong>Privileged Users:</strong> $($AuditResults.PrivilegedUsers)</p>\n        <p><strong>Compliance:</strong> <span class=\"$(if ($AuditResults.ComplianceStatus -eq 'PASS') {'pass'} else {'fail'})\">$($AuditResults.ComplianceStatus)</span></p>\n    </div>\n    \n    <h2>Required Security Responsibilities by Role</h2>\n\"@\n\n    foreach ($role in $SecurityRoles.Keys) {\n        $html += \"<div class='role-section'><h3>$role</h3><ul>\"\n        foreach ($resp in $SecurityRoles[$role]) {\n            $html += \"<li>$resp</li>\"\n        }\n        $html += \"</ul></div>\"\n    }\n\n    $html += @\"\n    <h2>User Position Documentation Status</h2>\n    <table>\n        <tr>\n            <th>Username</th>\n            <th>Display Name</th>\n            <th>Title</th>\n            <th>Privileged</th>\n            <th>Has Position Doc</th>\n            <th>Security Role</th>\n            <th>Status</th>\n            <th>Issues</th>\n        </tr>\n\"@\n\n    foreach ($r in $AuditResults.Results) {\n        $statusClass = switch ($r.Status) {\n            \"OK\" { \"pass\" }\n            \"WARNING\" { \"warning\" }\n            \"CRITICAL\" { \"fail\" }\n            default { \"\" }\n        }\n        $issues = if ($r.Issues) { $r.Issues -join \"; \" } else { \"None\" }\n        \n        $html += @\"\n        <tr>\n            <td>$($r.Username)</td>\n            <td>$($r.DisplayName)</td>\n            <td>$($r.Title)</td>\n            <td>$($r.IsPrivileged)</td>\n            <td>$($r.HasPositionDoc)</td>\n            <td>$($r.SecurityRole)</td>\n            <td class=\"$statusClass\">$($r.Status)</td>\n            <td>$issues</td>\n        </tr>\n\"@\n    }\n\n    $html += @\"\n    </table>\n    \n    <h2>Undocumented Users Requiring Action</h2>\n    <p>$($AuditResults.Undocumented -join ', ')</p>\n</body>\n</html>\n\"@\n\n    $html | Out-File $ReportFile -Encoding UTF8\n    Write-Host \"[INFO] Report saved: $ReportFile\"\n}\n\n# Main execution\nif ($GenerateTemplate) {\n    $users = Get-ADUsersWithAccess\n    New-PositionDescriptionsTemplate -Users $users\n    exit 0\n}\n\n$auditResults = Invoke-PS9Audit\nExport-AuditReport -AuditResults $auditResults\n\nWrite-Host \"\"\nWrite-Host \"=== PS-9 Position Descriptions Compliance Summary ===\" -ForegroundColor Cyan\nWrite-Host \"Total Users: $($auditResults.TotalUsers)\"\nWrite-Host \"Documented: $($auditResults.Documented)\"\nWrite-Host \"Undocumented: $($auditResults.Undocumented.Count)\"\nWrite-Host \"Privileged Users: $($auditResults.PrivilegedUsers)\"\nWrite-Host \"\"\nWrite-Host \"Compliance Status: $($auditResults.ComplianceStatus)\" -ForegroundColor $(if ($auditResults.ComplianceStatus -eq \"PASS\") {\"Green\"} else {\"Red\"})\n\nif ($auditResults.ComplianceStatus -ne \"PASS\") {\n    Write-Host \"\"\n    Write-Host \"Action Required: Update position descriptions to include security responsibilities\" -ForegroundColor Yellow\n    Write-Host \"Run with -GenerateTemplate to create a template CSV for HR\" -ForegroundColor Yellow\n    exit 1\n}\nexit 0",
        "ansible": "---\n# PS-9: Position Descriptions Compliance for Windows\n\n- name: PS-9 Position Descriptions Compliance Audit (Windows)\n  hosts: windows\n  gather_facts: yes\n  vars:\n    position_descriptions_path: \"C:\\\\HR\\\\PositionDescriptions.csv\"\n    report_path: \"C:\\\\SecurityReports\\\\PS9\"\n\n  tasks:\n    - name: Create required directories\n      win_file:\n        path: \"{{ item }}\"\n        state: directory\n      loop:\n        - \"{{ report_path }}\"\n        - C:\\HR\n\n    - name: Get AD users with enabled accounts\n      win_shell: |\n        Import-Module ActiveDirectory\n        $users = Get-ADUser -Filter {Enabled -eq $true} -Properties Title, Department, MemberOf |\n            Where-Object { $_.SamAccountName -notlike \"*$\" }\n        \n        $results = @()\n        foreach ($user in $users) {\n            $groups = $user.MemberOf | ForEach-Object { (Get-ADGroup $_).Name }\n            $isPrivileged = ($groups | Where-Object { $_ -match 'admin|privileged' }).Count -gt 0\n            \n            $results += @{\n                Username = $user.SamAccountName\n                Title = $user.Title\n                Department = $user.Department\n                IsPrivileged = $isPrivileged\n            }\n        }\n        $results | ConvertTo-Json -Depth 2\n      register: ad_users\n      changed_when: false\n\n    - name: Check for position descriptions file\n      win_stat:\n        path: \"{{ position_descriptions_path }}\"\n      register: positions_file\n\n    - name: Read position descriptions\n      win_shell: |\n        if (Test-Path '{{ position_descriptions_path }}') {\n            $positions = Import-Csv '{{ position_descriptions_path }}'\n            $positions | ConvertTo-Json -Depth 2\n        } else {\n            '[]'\n        }\n      register: positions_data\n      changed_when: false\n\n    - name: Calculate compliance metrics\n      win_shell: |\n        $users = '{{ ad_users.stdout }}' | ConvertFrom-Json\n        $positions = '{{ positions_data.stdout }}' | ConvertFrom-Json\n        \n        $documented = ($positions | Where-Object { $_.SecurityRole }).Count\n        $undocumented = $users.Count - $documented\n        \n        @{\n            TotalUsers = $users.Count\n            Documented = $documented\n            Undocumented = $undocumented\n            ComplianceStatus = if ($undocumented -eq 0) { 'PASS' } else { 'REVIEW_REQUIRED' }\n        } | ConvertTo-Json\n      register: compliance_metrics\n\n    - name: Display PS-9 compliance status\n      debug:\n        msg: |\n          === PS-9 Position Descriptions Compliance ===\n          Host: {{ inventory_hostname }}\n          Compliance Metrics: {{ compliance_metrics.stdout }}\n          \n          Action Required: Ensure all position descriptions include\n          documented security and privacy responsibilities."
      }
    },
    "metadata": {
      "status": "enhanced",
      "last_updated": "2025-11-22",
      "has_scripts": true
    },
    "cac_metadata": {
      "implementation_type": "organizational",
      "last_analyzed": "2025-11-22",
      "source": "ComplianceAsCode",
      "implementation_guidance": "This control is primarily organizational, requiring HR coordination to update position descriptions. Technical controls support auditing by comparing documented positions against actual system access levels."
    },
    "ai_guidance": "PS-9 Position Descriptions requires integration of security responsibilities into HR job documentation. AI-assisted compliance can support this control by: (1) Analyzing position descriptions to identify those lacking security and privacy responsibilities, flagging them for HR review; (2) Suggesting appropriate security responsibilities based on the position's access level, data handling requirements, and job functions using a catalog of role-based security responsibilities; (3) Cross-referencing system access privileges against documented security responsibilities to identify misalignments where users have access beyond what their position description authorizes; (4) Generating reports showing position description coverage across the organization, highlighting departments or job families requiring updates; (5) Tracking position description update status and alerting when reviews are overdue; (6) Mapping position-based security responsibilities to training requirements, identifying gaps where employees lack training for their documented responsibilities; (7) Supporting risk designation decisions (PS-2) by analyzing position descriptions for factors affecting security sensitivity. Integration with HR information systems (HRIS) enables automated monitoring of position description currency and completeness. For organizations with large workforces, AI can significantly accelerate the initial effort of adding security responsibilities to existing position descriptions by generating appropriate language based on job classification and access patterns.",
    "implementation_guidance": "Organizations should implement these key measures for PS-9 compliance:\n\n1. **Security Responsibility Catalog**: Develop a catalog of security and privacy responsibilities organized by job category. Standard categories include: all employees (basic security awareness), privileged users (elevated access responsibilities), system administrators (technical security duties), managers (team compliance oversight), and security personnel (specialized security functions).\n\n2. **Position Description Inventory**: Compile a complete inventory of all position descriptions in the organization. Identify which positions have documented security responsibilities and which require updates.\n\n3. **Responsibility Mapping**: For each position, determine appropriate security responsibilities based on: data access level, system privileges, supervisory responsibilities, job function sensitivity, and regulatory requirements affecting the role.\n\n4. **HR Coordination**: Work with HR to update position descriptions in the official HR system of record. Ensure updated descriptions are communicated to current incumbents through duty statement updates.\n\n5. **Training Alignment**: Map position-based security responsibilities to corresponding training requirements. Ensure training management systems can track completion by position requirement.\n\n6. **Performance Integration**: Include security responsibility fulfillment as criteria in performance evaluations. Enable managers to assess employees against their documented security duties.\n\n7. **Ongoing Maintenance**: Review and update position descriptions when: new positions are created, existing roles significantly change, security requirements change, or during regular position classification reviews. Conduct annual validation of security responsibilities across all positions."
  }
]